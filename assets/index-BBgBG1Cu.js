(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();function Qd(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Dn={exports:{}};/*!
 * jQuery JavaScript Library v3.7.1
 * https://jquery.com/
 *
 * Copyright OpenJS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2023-08-28T13:37Z
 */var Zd=Dn.exports,lh;function Jd(){return lh||(lh=1,function(i){(function(t,e){i.exports=t.document?e(t,!0):function(s){if(!s.document)throw new Error("jQuery requires a window with a document");return e(s)}})(typeof window<"u"?window:Zd,function(t,e){var s=[],n=Object.getPrototypeOf,a=s.slice,c=s.flat?function(r){return s.flat.call(r)}:function(r){return s.concat.apply([],r)},u=s.push,p=s.indexOf,x={},_=x.toString,y=x.hasOwnProperty,T=y.toString,D=T.call(Object),v={},M=function(o){return typeof o=="function"&&typeof o.nodeType!="number"&&typeof o.item!="function"},Y=function(o){return o!=null&&o===o.window},z=t.document,at={type:!0,src:!0,nonce:!0,noModule:!0};function mt(r,o,h){h=h||z;var f,d,m=h.createElement("script");if(m.text=r,o)for(f in at)d=o[f]||o.getAttribute&&o.getAttribute(f),d&&m.setAttribute(f,d);h.head.appendChild(m).parentNode.removeChild(m)}function Q(r){return r==null?r+"":typeof r=="object"||typeof r=="function"?x[_.call(r)]||"object":typeof r}var ct="3.7.1",gt=/HTML$/i,l=function(r,o){return new l.fn.init(r,o)};l.fn=l.prototype={jquery:ct,constructor:l,length:0,toArray:function(){return a.call(this)},get:function(r){return r==null?a.call(this):r<0?this[r+this.length]:this[r]},pushStack:function(r){var o=l.merge(this.constructor(),r);return o.prevObject=this,o},each:function(r){return l.each(this,r)},map:function(r){return this.pushStack(l.map(this,function(o,h){return r.call(o,h,o)}))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(l.grep(this,function(r,o){return(o+1)%2}))},odd:function(){return this.pushStack(l.grep(this,function(r,o){return o%2}))},eq:function(r){var o=this.length,h=+r+(r<0?o:0);return this.pushStack(h>=0&&h<o?[this[h]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:s.sort,splice:s.splice},l.extend=l.fn.extend=function(){var r,o,h,f,d,m,g=arguments[0]||{},S=1,C=arguments.length,k=!1;for(typeof g=="boolean"&&(k=g,g=arguments[S]||{},S++),typeof g!="object"&&!M(g)&&(g={}),S===C&&(g=this,S--);S<C;S++)if((r=arguments[S])!=null)for(o in r)f=r[o],!(o==="__proto__"||g===f)&&(k&&f&&(l.isPlainObject(f)||(d=Array.isArray(f)))?(h=g[o],d&&!Array.isArray(h)?m=[]:!d&&!l.isPlainObject(h)?m={}:m=h,d=!1,g[o]=l.extend(k,m,f)):f!==void 0&&(g[o]=f));return g},l.extend({expando:"jQuery"+(ct+Math.random()).replace(/\D/g,""),isReady:!0,error:function(r){throw new Error(r)},noop:function(){},isPlainObject:function(r){var o,h;return!r||_.call(r)!=="[object Object]"?!1:(o=n(r),o?(h=y.call(o,"constructor")&&o.constructor,typeof h=="function"&&T.call(h)===D):!0)},isEmptyObject:function(r){var o;for(o in r)return!1;return!0},globalEval:function(r,o,h){mt(r,{nonce:o&&o.nonce},h)},each:function(r,o){var h,f=0;if(X(r))for(h=r.length;f<h&&o.call(r[f],f,r[f])!==!1;f++);else for(f in r)if(o.call(r[f],f,r[f])===!1)break;return r},text:function(r){var o,h="",f=0,d=r.nodeType;if(!d)for(;o=r[f++];)h+=l.text(o);return d===1||d===11?r.textContent:d===9?r.documentElement.textContent:d===3||d===4?r.nodeValue:h},makeArray:function(r,o){var h=o||[];return r!=null&&(X(Object(r))?l.merge(h,typeof r=="string"?[r]:r):u.call(h,r)),h},inArray:function(r,o,h){return o==null?-1:p.call(o,r,h)},isXMLDoc:function(r){var o=r&&r.namespaceURI,h=r&&(r.ownerDocument||r).documentElement;return!gt.test(o||h&&h.nodeName||"HTML")},merge:function(r,o){for(var h=+o.length,f=0,d=r.length;f<h;f++)r[d++]=o[f];return r.length=d,r},grep:function(r,o,h){for(var f,d=[],m=0,g=r.length,S=!h;m<g;m++)f=!o(r[m],m),f!==S&&d.push(r[m]);return d},map:function(r,o,h){var f,d,m=0,g=[];if(X(r))for(f=r.length;m<f;m++)d=o(r[m],m,h),d!=null&&g.push(d);else for(m in r)d=o(r[m],m,h),d!=null&&g.push(d);return c(g)},guid:1,support:v}),typeof Symbol=="function"&&(l.fn[Symbol.iterator]=s[Symbol.iterator]),l.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(r,o){x["[object "+o+"]"]=o.toLowerCase()});function X(r){var o=!!r&&"length"in r&&r.length,h=Q(r);return M(r)||Y(r)?!1:h==="array"||o===0||typeof o=="number"&&o>0&&o-1 in r}function j(r,o){return r.nodeName&&r.nodeName.toLowerCase()===o.toLowerCase()}var ut=s.pop,it=s.sort,Pt=s.splice,tt="[\\x20\\t\\r\\n\\f]",bt=new RegExp("^"+tt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+tt+"+$","g");l.contains=function(r,o){var h=o&&o.parentNode;return r===h||!!(h&&h.nodeType===1&&(r.contains?r.contains(h):r.compareDocumentPosition&&r.compareDocumentPosition(h)&16))};var Qt=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function Ft(r,o){return o?r==="\0"?"ï¿½":r.slice(0,-1)+"\\"+r.charCodeAt(r.length-1).toString(16)+" ":"\\"+r}l.escapeSelector=function(r){return(r+"").replace(Qt,Ft)};var Lt=z,Ce=u;(function(){var r,o,h,f,d,m=Ce,g,S,C,k,O,F=l.expando,L=0,H=0,lt=an(),vt=an(),pt=an(),Xt=an(),Ut=function(b,w){return b===w&&(d=!0),0},Xe="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Qe="(?:\\\\[\\da-fA-F]{1,6}"+tt+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",yt="\\["+tt+"*("+Qe+")(?:"+tt+"*([*^$|!~]?=)"+tt+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Qe+"))|)"+tt+"*\\]",ts=":("+Qe+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+yt+")*)|.*)\\)|)",St=new RegExp(tt+"+","g"),It=new RegExp("^"+tt+"*,"+tt+"*"),pr=new RegExp("^"+tt+"*([>+~]|"+tt+")"+tt+"*"),xa=new RegExp(tt+"|>"),Ze=new RegExp(ts),mr=new RegExp("^"+Qe+"$"),Je={ID:new RegExp("^#("+Qe+")"),CLASS:new RegExp("^\\.("+Qe+")"),TAG:new RegExp("^("+Qe+"|[*])"),ATTR:new RegExp("^"+yt),PSEUDO:new RegExp("^"+ts),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+tt+"*(even|odd|(([+-]|)(\\d*)n|)"+tt+"*(?:([+-]|)"+tt+"*(\\d+)|))"+tt+"*\\)|)","i"),bool:new RegExp("^(?:"+Xe+")$","i"),needsContext:new RegExp("^"+tt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+tt+"*((?:-\\d)?\\d*)"+tt+"*\\)|)(?=[^-]|$)","i")},Di=/^(?:input|select|textarea|button)$/i,Ri=/^h\d$/i,Le=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ba=/[+~]/,li=new RegExp("\\\\[\\da-fA-F]{1,6}"+tt+"?|\\\\([^\\r\\n\\f])","g"),fi=function(b,w){var R="0x"+b.slice(1)-65536;return w||(R<0?String.fromCharCode(R+65536):String.fromCharCode(R>>10|55296,R&1023|56320))},Gd=function(){Li()},Vd=cn(function(b){return b.disabled===!0&&j(b,"fieldset")},{dir:"parentNode",next:"legend"});function Kd(){try{return g.activeElement}catch{}}try{m.apply(s=a.call(Lt.childNodes),Lt.childNodes),s[Lt.childNodes.length].nodeType}catch{m={apply:function(w,R){Ce.apply(w,a.call(R))},call:function(w){Ce.apply(w,a.call(arguments,1))}}}function Tt(b,w,R,P){var B,V,K,J,q,_t,ht,ft=w&&w.ownerDocument,xt=w?w.nodeType:9;if(R=R||[],typeof b!="string"||!b||xt!==1&&xt!==9&&xt!==11)return R;if(!P&&(Li(w),w=w||g,C)){if(xt!==11&&(q=Le.exec(b)))if(B=q[1]){if(xt===9)if(K=w.getElementById(B)){if(K.id===B)return m.call(R,K),R}else return R;else if(ft&&(K=ft.getElementById(B))&&Tt.contains(w,K)&&K.id===B)return m.call(R,K),R}else{if(q[2])return m.apply(R,w.getElementsByTagName(b)),R;if((B=q[3])&&w.getElementsByClassName)return m.apply(R,w.getElementsByClassName(B)),R}if(!Xt[b+" "]&&(!k||!k.test(b))){if(ht=b,ft=w,xt===1&&(xa.test(b)||pr.test(b))){for(ft=ba.test(b)&&ya(w.parentNode)||w,(ft!=w||!v.scope)&&((J=w.getAttribute("id"))?J=l.escapeSelector(J):w.setAttribute("id",J=F)),_t=gr(b),V=_t.length;V--;)_t[V]=(J?"#"+J:":scope")+" "+on(_t[V]);ht=_t.join(",")}try{return m.apply(R,ft.querySelectorAll(ht)),R}catch{Xt(b,!0)}finally{J===F&&w.removeAttribute("id")}}}return uh(b.replace(bt,"$1"),w,R,P)}function an(){var b=[];function w(R,P){return b.push(R+" ")>o.cacheLength&&delete w[b.shift()],w[R+" "]=P}return w}function Ge(b){return b[F]=!0,b}function Ls(b){var w=g.createElement("fieldset");try{return!!b(w)}catch{return!1}finally{w.parentNode&&w.parentNode.removeChild(w),w=null}}function qd(b){return function(w){return j(w,"input")&&w.type===b}}function jd(b){return function(w){return(j(w,"input")||j(w,"button"))&&w.type===b}}function ch(b){return function(w){return"form"in w?w.parentNode&&w.disabled===!1?"label"in w?"label"in w.parentNode?w.parentNode.disabled===b:w.disabled===b:w.isDisabled===b||w.isDisabled!==!b&&Vd(w)===b:w.disabled===b:"label"in w?w.disabled===b:!1}}function es(b){return Ge(function(w){return w=+w,Ge(function(R,P){for(var B,V=b([],R.length,w),K=V.length;K--;)R[B=V[K]]&&(R[B]=!(P[B]=R[B]))})})}function ya(b){return b&&typeof b.getElementsByTagName<"u"&&b}function Li(b){var w,R=b?b.ownerDocument||b:Lt;return R==g||R.nodeType!==9||!R.documentElement||(g=R,S=g.documentElement,C=!l.isXMLDoc(g),O=S.matches||S.webkitMatchesSelector||S.msMatchesSelector,S.msMatchesSelector&&Lt!=g&&(w=g.defaultView)&&w.top!==w&&w.addEventListener("unload",Gd),v.getById=Ls(function(P){return S.appendChild(P).id=l.expando,!g.getElementsByName||!g.getElementsByName(l.expando).length}),v.disconnectedMatch=Ls(function(P){return O.call(P,"*")}),v.scope=Ls(function(){return g.querySelectorAll(":scope")}),v.cssHas=Ls(function(){try{return g.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),v.getById?(o.filter.ID=function(P){var B=P.replace(li,fi);return function(V){return V.getAttribute("id")===B}},o.find.ID=function(P,B){if(typeof B.getElementById<"u"&&C){var V=B.getElementById(P);return V?[V]:[]}}):(o.filter.ID=function(P){var B=P.replace(li,fi);return function(V){var K=typeof V.getAttributeNode<"u"&&V.getAttributeNode("id");return K&&K.value===B}},o.find.ID=function(P,B){if(typeof B.getElementById<"u"&&C){var V,K,J,q=B.getElementById(P);if(q){if(V=q.getAttributeNode("id"),V&&V.value===P)return[q];for(J=B.getElementsByName(P),K=0;q=J[K++];)if(V=q.getAttributeNode("id"),V&&V.value===P)return[q]}return[]}}),o.find.TAG=function(P,B){return typeof B.getElementsByTagName<"u"?B.getElementsByTagName(P):B.querySelectorAll(P)},o.find.CLASS=function(P,B){if(typeof B.getElementsByClassName<"u"&&C)return B.getElementsByClassName(P)},k=[],Ls(function(P){var B;S.appendChild(P).innerHTML="<a id='"+F+"' href='' disabled='disabled'></a><select id='"+F+"-\r\\' disabled='disabled'><option selected=''></option></select>",P.querySelectorAll("[selected]").length||k.push("\\["+tt+"*(?:value|"+Xe+")"),P.querySelectorAll("[id~="+F+"-]").length||k.push("~="),P.querySelectorAll("a#"+F+"+*").length||k.push(".#.+[+~]"),P.querySelectorAll(":checked").length||k.push(":checked"),B=g.createElement("input"),B.setAttribute("type","hidden"),P.appendChild(B).setAttribute("name","D"),S.appendChild(P).disabled=!0,P.querySelectorAll(":disabled").length!==2&&k.push(":enabled",":disabled"),B=g.createElement("input"),B.setAttribute("name",""),P.appendChild(B),P.querySelectorAll("[name='']").length||k.push("\\["+tt+"*name"+tt+"*="+tt+`*(?:''|"")`)}),v.cssHas||k.push(":has"),k=k.length&&new RegExp(k.join("|")),Ut=function(P,B){if(P===B)return d=!0,0;var V=!P.compareDocumentPosition-!B.compareDocumentPosition;return V||(V=(P.ownerDocument||P)==(B.ownerDocument||B)?P.compareDocumentPosition(B):1,V&1||!v.sortDetached&&B.compareDocumentPosition(P)===V?P===g||P.ownerDocument==Lt&&Tt.contains(Lt,P)?-1:B===g||B.ownerDocument==Lt&&Tt.contains(Lt,B)?1:f?p.call(f,P)-p.call(f,B):0:V&4?-1:1)}),g}Tt.matches=function(b,w){return Tt(b,null,null,w)},Tt.matchesSelector=function(b,w){if(Li(b),C&&!Xt[w+" "]&&(!k||!k.test(w)))try{var R=O.call(b,w);if(R||v.disconnectedMatch||b.document&&b.document.nodeType!==11)return R}catch{Xt(w,!0)}return Tt(w,g,null,[b]).length>0},Tt.contains=function(b,w){return(b.ownerDocument||b)!=g&&Li(b),l.contains(b,w)},Tt.attr=function(b,w){(b.ownerDocument||b)!=g&&Li(b);var R=o.attrHandle[w.toLowerCase()],P=R&&y.call(o.attrHandle,w.toLowerCase())?R(b,w,!C):void 0;return P!==void 0?P:b.getAttribute(w)},Tt.error=function(b){throw new Error("Syntax error, unrecognized expression: "+b)},l.uniqueSort=function(b){var w,R=[],P=0,B=0;if(d=!v.sortStable,f=!v.sortStable&&a.call(b,0),it.call(b,Ut),d){for(;w=b[B++];)w===b[B]&&(P=R.push(B));for(;P--;)Pt.call(b,R[P],1)}return f=null,b},l.fn.uniqueSort=function(){return this.pushStack(l.uniqueSort(a.apply(this)))},o=l.expr={cacheLength:50,createPseudo:Ge,match:Je,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(b){return b[1]=b[1].replace(li,fi),b[3]=(b[3]||b[4]||b[5]||"").replace(li,fi),b[2]==="~="&&(b[3]=" "+b[3]+" "),b.slice(0,4)},CHILD:function(b){return b[1]=b[1].toLowerCase(),b[1].slice(0,3)==="nth"?(b[3]||Tt.error(b[0]),b[4]=+(b[4]?b[5]+(b[6]||1):2*(b[3]==="even"||b[3]==="odd")),b[5]=+(b[7]+b[8]||b[3]==="odd")):b[3]&&Tt.error(b[0]),b},PSEUDO:function(b){var w,R=!b[6]&&b[2];return Je.CHILD.test(b[0])?null:(b[3]?b[2]=b[4]||b[5]||"":R&&Ze.test(R)&&(w=gr(R,!0))&&(w=R.indexOf(")",R.length-w)-R.length)&&(b[0]=b[0].slice(0,w),b[2]=R.slice(0,w)),b.slice(0,3))}},filter:{TAG:function(b){var w=b.replace(li,fi).toLowerCase();return b==="*"?function(){return!0}:function(R){return j(R,w)}},CLASS:function(b){var w=lt[b+" "];return w||(w=new RegExp("(^|"+tt+")"+b+"("+tt+"|$)"))&&lt(b,function(R){return w.test(typeof R.className=="string"&&R.className||typeof R.getAttribute<"u"&&R.getAttribute("class")||"")})},ATTR:function(b,w,R){return function(P){var B=Tt.attr(P,b);return B==null?w==="!=":w?(B+="",w==="="?B===R:w==="!="?B!==R:w==="^="?R&&B.indexOf(R)===0:w==="*="?R&&B.indexOf(R)>-1:w==="$="?R&&B.slice(-R.length)===R:w==="~="?(" "+B.replace(St," ")+" ").indexOf(R)>-1:w==="|="?B===R||B.slice(0,R.length+1)===R+"-":!1):!0}},CHILD:function(b,w,R,P,B){var V=b.slice(0,3)!=="nth",K=b.slice(-4)!=="last",J=w==="of-type";return P===1&&B===0?function(q){return!!q.parentNode}:function(q,_t,ht){var ft,xt,nt,Dt,me,Jt=V!==K?"nextSibling":"previousSibling",Pe=q.parentNode,ti=J&&q.nodeName.toLowerCase(),Ps=!ht&&!J,ne=!1;if(Pe){if(V){for(;Jt;){for(nt=q;nt=nt[Jt];)if(J?j(nt,ti):nt.nodeType===1)return!1;me=Jt=b==="only"&&!me&&"nextSibling"}return!0}if(me=[K?Pe.firstChild:Pe.lastChild],K&&Ps){for(xt=Pe[F]||(Pe[F]={}),ft=xt[b]||[],Dt=ft[0]===L&&ft[1],ne=Dt&&ft[2],nt=Dt&&Pe.childNodes[Dt];nt=++Dt&&nt&&nt[Jt]||(ne=Dt=0)||me.pop();)if(nt.nodeType===1&&++ne&&nt===q){xt[b]=[L,Dt,ne];break}}else if(Ps&&(xt=q[F]||(q[F]={}),ft=xt[b]||[],Dt=ft[0]===L&&ft[1],ne=Dt),ne===!1)for(;(nt=++Dt&&nt&&nt[Jt]||(ne=Dt=0)||me.pop())&&!((J?j(nt,ti):nt.nodeType===1)&&++ne&&(Ps&&(xt=nt[F]||(nt[F]={}),xt[b]=[L,ne]),nt===q)););return ne-=B,ne===P||ne%P===0&&ne/P>=0}}},PSEUDO:function(b,w){var R,P=o.pseudos[b]||o.setFilters[b.toLowerCase()]||Tt.error("unsupported pseudo: "+b);return P[F]?P(w):P.length>1?(R=[b,b,"",w],o.setFilters.hasOwnProperty(b.toLowerCase())?Ge(function(B,V){for(var K,J=P(B,w),q=J.length;q--;)K=p.call(B,J[q]),B[K]=!(V[K]=J[q])}):function(B){return P(B,0,R)}):P}},pseudos:{not:Ge(function(b){var w=[],R=[],P=Ea(b.replace(bt,"$1"));return P[F]?Ge(function(B,V,K,J){for(var q,_t=P(B,null,J,[]),ht=B.length;ht--;)(q=_t[ht])&&(B[ht]=!(V[ht]=q))}):function(B,V,K){return w[0]=B,P(w,null,K,R),w[0]=null,!R.pop()}}),has:Ge(function(b){return function(w){return Tt(b,w).length>0}}),contains:Ge(function(b){return b=b.replace(li,fi),function(w){return(w.textContent||l.text(w)).indexOf(b)>-1}}),lang:Ge(function(b){return mr.test(b||"")||Tt.error("unsupported lang: "+b),b=b.replace(li,fi).toLowerCase(),function(w){var R;do if(R=C?w.lang:w.getAttribute("xml:lang")||w.getAttribute("lang"))return R=R.toLowerCase(),R===b||R.indexOf(b+"-")===0;while((w=w.parentNode)&&w.nodeType===1);return!1}}),target:function(b){var w=t.location&&t.location.hash;return w&&w.slice(1)===b.id},root:function(b){return b===S},focus:function(b){return b===Kd()&&g.hasFocus()&&!!(b.type||b.href||~b.tabIndex)},enabled:ch(!1),disabled:ch(!0),checked:function(b){return j(b,"input")&&!!b.checked||j(b,"option")&&!!b.selected},selected:function(b){return b.parentNode&&b.parentNode.selectedIndex,b.selected===!0},empty:function(b){for(b=b.firstChild;b;b=b.nextSibling)if(b.nodeType<6)return!1;return!0},parent:function(b){return!o.pseudos.empty(b)},header:function(b){return Ri.test(b.nodeName)},input:function(b){return Di.test(b.nodeName)},button:function(b){return j(b,"input")&&b.type==="button"||j(b,"button")},text:function(b){var w;return j(b,"input")&&b.type==="text"&&((w=b.getAttribute("type"))==null||w.toLowerCase()==="text")},first:es(function(){return[0]}),last:es(function(b,w){return[w-1]}),eq:es(function(b,w,R){return[R<0?R+w:R]}),even:es(function(b,w){for(var R=0;R<w;R+=2)b.push(R);return b}),odd:es(function(b,w){for(var R=1;R<w;R+=2)b.push(R);return b}),lt:es(function(b,w,R){var P;for(R<0?P=R+w:R>w?P=w:P=R;--P>=0;)b.push(P);return b}),gt:es(function(b,w,R){for(var P=R<0?R+w:R;++P<w;)b.push(P);return b})}},o.pseudos.nth=o.pseudos.eq;for(r in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})o.pseudos[r]=qd(r);for(r in{submit:!0,reset:!0})o.pseudos[r]=jd(r);function hh(){}hh.prototype=o.filters=o.pseudos,o.setFilters=new hh;function gr(b,w){var R,P,B,V,K,J,q,_t=vt[b+" "];if(_t)return w?0:_t.slice(0);for(K=b,J=[],q=o.preFilter;K;){(!R||(P=It.exec(K)))&&(P&&(K=K.slice(P[0].length)||K),J.push(B=[])),R=!1,(P=pr.exec(K))&&(R=P.shift(),B.push({value:R,type:P[0].replace(bt," ")}),K=K.slice(R.length));for(V in o.filter)(P=Je[V].exec(K))&&(!q[V]||(P=q[V](P)))&&(R=P.shift(),B.push({value:R,type:V,matches:P}),K=K.slice(R.length));if(!R)break}return w?K.length:K?Tt.error(b):vt(b,J).slice(0)}function on(b){for(var w=0,R=b.length,P="";w<R;w++)P+=b[w].value;return P}function cn(b,w,R){var P=w.dir,B=w.next,V=B||P,K=R&&V==="parentNode",J=H++;return w.first?function(q,_t,ht){for(;q=q[P];)if(q.nodeType===1||K)return b(q,_t,ht);return!1}:function(q,_t,ht){var ft,xt,nt=[L,J];if(ht){for(;q=q[P];)if((q.nodeType===1||K)&&b(q,_t,ht))return!0}else for(;q=q[P];)if(q.nodeType===1||K)if(xt=q[F]||(q[F]={}),B&&j(q,B))q=q[P]||q;else{if((ft=xt[V])&&ft[0]===L&&ft[1]===J)return nt[2]=ft[2];if(xt[V]=nt,nt[2]=b(q,_t,ht))return!0}return!1}}function Ca(b){return b.length>1?function(w,R,P){for(var B=b.length;B--;)if(!b[B](w,R,P))return!1;return!0}:b[0]}function Yd(b,w,R){for(var P=0,B=w.length;P<B;P++)Tt(b,w[P],R);return R}function hn(b,w,R,P,B){for(var V,K=[],J=0,q=b.length,_t=w!=null;J<q;J++)(V=b[J])&&(!R||R(V,P,B))&&(K.push(V),_t&&w.push(J));return K}function va(b,w,R,P,B,V){return P&&!P[F]&&(P=va(P)),B&&!B[F]&&(B=va(B,V)),Ge(function(K,J,q,_t){var ht,ft,xt,nt,Dt=[],me=[],Jt=J.length,Pe=K||Yd(w||"*",q.nodeType?[q]:q,[]),ti=b&&(K||!w)?hn(Pe,Dt,b,q,_t):Pe;if(R?(nt=B||(K?b:Jt||P)?[]:J,R(ti,nt,q,_t)):nt=ti,P)for(ht=hn(nt,me),P(ht,[],q,_t),ft=ht.length;ft--;)(xt=ht[ft])&&(nt[me[ft]]=!(ti[me[ft]]=xt));if(K){if(B||b){if(B){for(ht=[],ft=nt.length;ft--;)(xt=nt[ft])&&ht.push(ti[ft]=xt);B(null,nt=[],ht,_t)}for(ft=nt.length;ft--;)(xt=nt[ft])&&(ht=B?p.call(K,xt):Dt[ft])>-1&&(K[ht]=!(J[ht]=xt))}}else nt=hn(nt===J?nt.splice(Jt,nt.length):nt),B?B(null,J,nt,_t):m.apply(J,nt)})}function Sa(b){for(var w,R,P,B=b.length,V=o.relative[b[0].type],K=V||o.relative[" "],J=V?1:0,q=cn(function(ft){return ft===w},K,!0),_t=cn(function(ft){return p.call(w,ft)>-1},K,!0),ht=[function(ft,xt,nt){var Dt=!V&&(nt||xt!=h)||((w=xt).nodeType?q(ft,xt,nt):_t(ft,xt,nt));return w=null,Dt}];J<B;J++)if(R=o.relative[b[J].type])ht=[cn(Ca(ht),R)];else{if(R=o.filter[b[J].type].apply(null,b[J].matches),R[F]){for(P=++J;P<B&&!o.relative[b[P].type];P++);return va(J>1&&Ca(ht),J>1&&on(b.slice(0,J-1).concat({value:b[J-2].type===" "?"*":""})).replace(bt,"$1"),R,J<P&&Sa(b.slice(J,P)),P<B&&Sa(b=b.slice(P)),P<B&&on(b))}ht.push(R)}return Ca(ht)}function Xd(b,w){var R=w.length>0,P=b.length>0,B=function(V,K,J,q,_t){var ht,ft,xt,nt=0,Dt="0",me=V&&[],Jt=[],Pe=h,ti=V||P&&o.find.TAG("*",_t),Ps=L+=Pe==null?1:Math.random()||.1,ne=ti.length;for(_t&&(h=K==g||K||_t);Dt!==ne&&(ht=ti[Dt])!=null;Dt++){if(P&&ht){for(ft=0,!K&&ht.ownerDocument!=g&&(Li(ht),J=!C);xt=b[ft++];)if(xt(ht,K||g,J)){m.call(q,ht);break}_t&&(L=Ps)}R&&((ht=!xt&&ht)&&nt--,V&&me.push(ht))}if(nt+=Dt,R&&Dt!==nt){for(ft=0;xt=w[ft++];)xt(me,Jt,K,J);if(V){if(nt>0)for(;Dt--;)me[Dt]||Jt[Dt]||(Jt[Dt]=ut.call(q));Jt=hn(Jt)}m.apply(q,Jt),_t&&!V&&Jt.length>0&&nt+w.length>1&&l.uniqueSort(q)}return _t&&(L=Ps,h=Pe),me};return R?Ge(B):B}function Ea(b,w){var R,P=[],B=[],V=pt[b+" "];if(!V){for(w||(w=gr(b)),R=w.length;R--;)V=Sa(w[R]),V[F]?P.push(V):B.push(V);V=pt(b,Xd(B,P)),V.selector=b}return V}function uh(b,w,R,P){var B,V,K,J,q,_t=typeof b=="function"&&b,ht=!P&&gr(b=_t.selector||b);if(R=R||[],ht.length===1){if(V=ht[0]=ht[0].slice(0),V.length>2&&(K=V[0]).type==="ID"&&w.nodeType===9&&C&&o.relative[V[1].type]){if(w=(o.find.ID(K.matches[0].replace(li,fi),w)||[])[0],w)_t&&(w=w.parentNode);else return R;b=b.slice(V.shift().value.length)}for(B=Je.needsContext.test(b)?0:V.length;B--&&(K=V[B],!o.relative[J=K.type]);)if((q=o.find[J])&&(P=q(K.matches[0].replace(li,fi),ba.test(V[0].type)&&ya(w.parentNode)||w))){if(V.splice(B,1),b=P.length&&on(V),!b)return m.apply(R,P),R;break}}return(_t||Ea(b,ht))(P,w,!C,R,!w||ba.test(b)&&ya(w.parentNode)||w),R}v.sortStable=F.split("").sort(Ut).join("")===F,Li(),v.sortDetached=Ls(function(b){return b.compareDocumentPosition(g.createElement("fieldset"))&1}),l.find=Tt,l.expr[":"]=l.expr.pseudos,l.unique=l.uniqueSort,Tt.compile=Ea,Tt.select=uh,Tt.setDocument=Li,Tt.tokenize=gr,Tt.escape=l.escapeSelector,Tt.getText=l.text,Tt.isXML=l.isXMLDoc,Tt.selectors=l.expr,Tt.support=l.support,Tt.uniqueSort=l.uniqueSort})();var Ht=function(r,o,h){for(var f=[],d=h!==void 0;(r=r[o])&&r.nodeType!==9;)if(r.nodeType===1){if(d&&l(r).is(h))break;f.push(r)}return f},Ye=function(r,o){for(var h=[];r;r=r.nextSibling)r.nodeType===1&&r!==o&&h.push(r);return h},ai=l.expr.match.needsContext,$e=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function jt(r,o,h){return M(o)?l.grep(r,function(f,d){return!!o.call(f,d,f)!==h}):o.nodeType?l.grep(r,function(f){return f===o!==h}):typeof o!="string"?l.grep(r,function(f){return p.call(o,f)>-1!==h}):l.filter(o,r,h)}l.filter=function(r,o,h){var f=o[0];return h&&(r=":not("+r+")"),o.length===1&&f.nodeType===1?l.find.matchesSelector(f,r)?[f]:[]:l.find.matches(r,l.grep(o,function(d){return d.nodeType===1}))},l.fn.extend({find:function(r){var o,h,f=this.length,d=this;if(typeof r!="string")return this.pushStack(l(r).filter(function(){for(o=0;o<f;o++)if(l.contains(d[o],this))return!0}));for(h=this.pushStack([]),o=0;o<f;o++)l.find(r,d[o],h);return f>1?l.uniqueSort(h):h},filter:function(r){return this.pushStack(jt(this,r||[],!1))},not:function(r){return this.pushStack(jt(this,r||[],!0))},is:function(r){return!!jt(this,typeof r=="string"&&ai.test(r)?l(r):r||[],!1).length}});var ke,re=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/,oi=l.fn.init=function(r,o,h){var f,d;if(!r)return this;if(h=h||ke,typeof r=="string")if(r[0]==="<"&&r[r.length-1]===">"&&r.length>=3?f=[null,r,null]:f=re.exec(r),f&&(f[1]||!o))if(f[1]){if(o=o instanceof l?o[0]:o,l.merge(this,l.parseHTML(f[1],o&&o.nodeType?o.ownerDocument||o:z,!0)),$e.test(f[1])&&l.isPlainObject(o))for(f in o)M(this[f])?this[f](o[f]):this.attr(f,o[f]);return this}else return d=z.getElementById(f[2]),d&&(this[0]=d,this.length=1),this;else return!o||o.jquery?(o||h).find(r):this.constructor(o).find(r);else{if(r.nodeType)return this[0]=r,this.length=1,this;if(M(r))return h.ready!==void 0?h.ready(r):r(l)}return l.makeArray(r,this)};oi.prototype=l.fn,ke=l(z);var Ei=/^(?:parents|prev(?:Until|All))/,He={children:!0,contents:!0,next:!0,prev:!0};l.fn.extend({has:function(r){var o=l(r,this),h=o.length;return this.filter(function(){for(var f=0;f<h;f++)if(l.contains(this,o[f]))return!0})},closest:function(r,o){var h,f=0,d=this.length,m=[],g=typeof r!="string"&&l(r);if(!ai.test(r)){for(;f<d;f++)for(h=this[f];h&&h!==o;h=h.parentNode)if(h.nodeType<11&&(g?g.index(h)>-1:h.nodeType===1&&l.find.matchesSelector(h,r))){m.push(h);break}}return this.pushStack(m.length>1?l.uniqueSort(m):m)},index:function(r){return r?typeof r=="string"?p.call(l(r),this[0]):p.call(this,r.jquery?r[0]:r):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(r,o){return this.pushStack(l.uniqueSort(l.merge(this.get(),l(r,o))))},addBack:function(r){return this.add(r==null?this.prevObject:this.prevObject.filter(r))}});function Ai(r,o){for(;(r=r[o])&&r.nodeType!==1;);return r}l.each({parent:function(r){var o=r.parentNode;return o&&o.nodeType!==11?o:null},parents:function(r){return Ht(r,"parentNode")},parentsUntil:function(r,o,h){return Ht(r,"parentNode",h)},next:function(r){return Ai(r,"nextSibling")},prev:function(r){return Ai(r,"previousSibling")},nextAll:function(r){return Ht(r,"nextSibling")},prevAll:function(r){return Ht(r,"previousSibling")},nextUntil:function(r,o,h){return Ht(r,"nextSibling",h)},prevUntil:function(r,o,h){return Ht(r,"previousSibling",h)},siblings:function(r){return Ye((r.parentNode||{}).firstChild,r)},children:function(r){return Ye(r.firstChild)},contents:function(r){return r.contentDocument!=null&&n(r.contentDocument)?r.contentDocument:(j(r,"template")&&(r=r.content||r),l.merge([],r.childNodes))}},function(r,o){l.fn[r]=function(h,f){var d=l.map(this,o,h);return r.slice(-5)!=="Until"&&(f=h),f&&typeof f=="string"&&(d=l.filter(f,d)),this.length>1&&(He[r]||l.uniqueSort(d),Ei.test(r)&&d.reverse()),this.pushStack(d)}});var Zt=/[^\x20\t\r\n\f]+/g;function Yi(r){var o={};return l.each(r.match(Zt)||[],function(h,f){o[f]=!0}),o}l.Callbacks=function(r){r=typeof r=="string"?Yi(r):l.extend({},r);var o,h,f,d,m=[],g=[],S=-1,C=function(){for(d=d||r.once,f=o=!0;g.length;S=-1)for(h=g.shift();++S<m.length;)m[S].apply(h[0],h[1])===!1&&r.stopOnFalse&&(S=m.length,h=!1);r.memory||(h=!1),o=!1,d&&(h?m=[]:m="")},k={add:function(){return m&&(h&&!o&&(S=m.length-1,g.push(h)),function O(F){l.each(F,function(L,H){M(H)?(!r.unique||!k.has(H))&&m.push(H):H&&H.length&&Q(H)!=="string"&&O(H)})}(arguments),h&&!o&&C()),this},remove:function(){return l.each(arguments,function(O,F){for(var L;(L=l.inArray(F,m,L))>-1;)m.splice(L,1),L<=S&&S--}),this},has:function(O){return O?l.inArray(O,m)>-1:m.length>0},empty:function(){return m&&(m=[]),this},disable:function(){return d=g=[],m=h="",this},disabled:function(){return!m},lock:function(){return d=g=[],!h&&!o&&(m=h=""),this},locked:function(){return!!d},fireWith:function(O,F){return d||(F=F||[],F=[O,F.slice?F.slice():F],g.push(F),o||C()),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!f}};return k};function De(r){return r}function ci(r){throw r}function wi(r,o,h,f){var d;try{r&&M(d=r.promise)?d.call(r).done(o).fail(h):r&&M(d=r.then)?d.call(r,o,h):o.apply(void 0,[r].slice(f))}catch(m){h.apply(void 0,[m])}}l.extend({Deferred:function(r){var o=[["notify","progress",l.Callbacks("memory"),l.Callbacks("memory"),2],["resolve","done",l.Callbacks("once memory"),l.Callbacks("once memory"),0,"resolved"],["reject","fail",l.Callbacks("once memory"),l.Callbacks("once memory"),1,"rejected"]],h="pending",f={state:function(){return h},always:function(){return d.done(arguments).fail(arguments),this},catch:function(m){return f.then(null,m)},pipe:function(){var m=arguments;return l.Deferred(function(g){l.each(o,function(S,C){var k=M(m[C[4]])&&m[C[4]];d[C[1]](function(){var O=k&&k.apply(this,arguments);O&&M(O.promise)?O.promise().progress(g.notify).done(g.resolve).fail(g.reject):g[C[0]+"With"](this,k?[O]:arguments)})}),m=null}).promise()},then:function(m,g,S){var C=0;function k(O,F,L,H){return function(){var lt=this,vt=arguments,pt=function(){var Ut,Xe;if(!(O<C)){if(Ut=L.apply(lt,vt),Ut===F.promise())throw new TypeError("Thenable self-resolution");Xe=Ut&&(typeof Ut=="object"||typeof Ut=="function")&&Ut.then,M(Xe)?H?Xe.call(Ut,k(C,F,De,H),k(C,F,ci,H)):(C++,Xe.call(Ut,k(C,F,De,H),k(C,F,ci,H),k(C,F,De,F.notifyWith))):(L!==De&&(lt=void 0,vt=[Ut]),(H||F.resolveWith)(lt,vt))}},Xt=H?pt:function(){try{pt()}catch(Ut){l.Deferred.exceptionHook&&l.Deferred.exceptionHook(Ut,Xt.error),O+1>=C&&(L!==ci&&(lt=void 0,vt=[Ut]),F.rejectWith(lt,vt))}};O?Xt():(l.Deferred.getErrorHook?Xt.error=l.Deferred.getErrorHook():l.Deferred.getStackHook&&(Xt.error=l.Deferred.getStackHook()),t.setTimeout(Xt))}}return l.Deferred(function(O){o[0][3].add(k(0,O,M(S)?S:De,O.notifyWith)),o[1][3].add(k(0,O,M(m)?m:De)),o[2][3].add(k(0,O,M(g)?g:ci))}).promise()},promise:function(m){return m!=null?l.extend(m,f):f}},d={};return l.each(o,function(m,g){var S=g[2],C=g[5];f[g[1]]=S.add,C&&S.add(function(){h=C},o[3-m][2].disable,o[3-m][3].disable,o[0][2].lock,o[0][3].lock),S.add(g[3].fire),d[g[0]]=function(){return d[g[0]+"With"](this===d?void 0:this,arguments),this},d[g[0]+"With"]=S.fireWith}),f.promise(d),r&&r.call(d,d),d},when:function(r){var o=arguments.length,h=o,f=Array(h),d=a.call(arguments),m=l.Deferred(),g=function(S){return function(C){f[S]=this,d[S]=arguments.length>1?a.call(arguments):C,--o||m.resolveWith(f,d)}};if(o<=1&&(wi(r,m.done(g(h)).resolve,m.reject,!o),m.state()==="pending"||M(d[h]&&d[h].then)))return m.then();for(;h--;)wi(d[h],g(h),m.reject);return m.promise()}});var Xi=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;l.Deferred.exceptionHook=function(r,o){t.console&&t.console.warn&&r&&Xi.test(r.name)&&t.console.warn("jQuery.Deferred exception: "+r.message,r.stack,o)},l.readyException=function(r){t.setTimeout(function(){throw r})};var Ti=l.Deferred();l.fn.ready=function(r){return Ti.then(r).catch(function(o){l.readyException(o)}),this},l.extend({isReady:!1,readyWait:1,ready:function(r){(r===!0?--l.readyWait:l.isReady)||(l.isReady=!0,!(r!==!0&&--l.readyWait>0)&&Ti.resolveWith(z,[l]))}}),l.ready.then=Ti.then;function ze(){z.removeEventListener("DOMContentLoaded",ze),t.removeEventListener("load",ze),l.ready()}z.readyState==="complete"||z.readyState!=="loading"&&!z.documentElement.doScroll?t.setTimeout(l.ready):(z.addEventListener("DOMContentLoaded",ze),t.addEventListener("load",ze));var Rt=function(r,o,h,f,d,m,g){var S=0,C=r.length,k=h==null;if(Q(h)==="object"){d=!0;for(S in h)Rt(r,o,S,h[S],!0,m,g)}else if(f!==void 0&&(d=!0,M(f)||(g=!0),k&&(g?(o.call(r,f),o=null):(k=o,o=function(O,F,L){return k.call(l(O),L)})),o))for(;S<C;S++)o(r[S],h,g?f:f.call(r[S],S,o(r[S],h)));return d?r:k?o.call(r):C?o(r[0],h):m},fe=/^-ms-/,zt=/-([a-z])/g;function ve(r,o){return o.toUpperCase()}function Se(r){return r.replace(fe,"ms-").replace(zt,ve)}var ki=function(r){return r.nodeType===1||r.nodeType===9||!+r.nodeType};function hi(){this.expando=l.expando+hi.uid++}hi.uid=1,hi.prototype={cache:function(r){var o=r[this.expando];return o||(o={},ki(r)&&(r.nodeType?r[this.expando]=o:Object.defineProperty(r,this.expando,{value:o,configurable:!0}))),o},set:function(r,o,h){var f,d=this.cache(r);if(typeof o=="string")d[Se(o)]=h;else for(f in o)d[Se(f)]=o[f];return d},get:function(r,o){return o===void 0?this.cache(r):r[this.expando]&&r[this.expando][Se(o)]},access:function(r,o,h){return o===void 0||o&&typeof o=="string"&&h===void 0?this.get(r,o):(this.set(r,o,h),h!==void 0?h:o)},remove:function(r,o){var h,f=r[this.expando];if(f!==void 0){if(o!==void 0)for(Array.isArray(o)?o=o.map(Se):(o=Se(o),o=o in f?[o]:o.match(Zt)||[]),h=o.length;h--;)delete f[o[h]];(o===void 0||l.isEmptyObject(f))&&(r.nodeType?r[this.expando]=void 0:delete r[this.expando])}},hasData:function(r){var o=r[this.expando];return o!==void 0&&!l.isEmptyObject(o)}};var Z=new hi,Yt=new hi,Zr=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Jr=/[A-Z]/g;function od(r){return r==="true"?!0:r==="false"?!1:r==="null"?null:r===+r+""?+r:Zr.test(r)?JSON.parse(r):r}function Lc(r,o,h){var f;if(h===void 0&&r.nodeType===1)if(f="data-"+o.replace(Jr,"-$&").toLowerCase(),h=r.getAttribute(f),typeof h=="string"){try{h=od(h)}catch{}Yt.set(r,o,h)}else h=void 0;return h}l.extend({hasData:function(r){return Yt.hasData(r)||Z.hasData(r)},data:function(r,o,h){return Yt.access(r,o,h)},removeData:function(r,o){Yt.remove(r,o)},_data:function(r,o,h){return Z.access(r,o,h)},_removeData:function(r,o){Z.remove(r,o)}}),l.fn.extend({data:function(r,o){var h,f,d,m=this[0],g=m&&m.attributes;if(r===void 0){if(this.length&&(d=Yt.get(m),m.nodeType===1&&!Z.get(m,"hasDataAttrs"))){for(h=g.length;h--;)g[h]&&(f=g[h].name,f.indexOf("data-")===0&&(f=Se(f.slice(5)),Lc(m,f,d[f])));Z.set(m,"hasDataAttrs",!0)}return d}return typeof r=="object"?this.each(function(){Yt.set(this,r)}):Rt(this,function(S){var C;if(m&&S===void 0)return C=Yt.get(m,r),C!==void 0||(C=Lc(m,r),C!==void 0)?C:void 0;this.each(function(){Yt.set(this,r,S)})},null,o,arguments.length>1,null,!0)},removeData:function(r){return this.each(function(){Yt.remove(this,r)})}}),l.extend({queue:function(r,o,h){var f;if(r)return o=(o||"fx")+"queue",f=Z.get(r,o),h&&(!f||Array.isArray(h)?f=Z.access(r,o,l.makeArray(h)):f.push(h)),f||[]},dequeue:function(r,o){o=o||"fx";var h=l.queue(r,o),f=h.length,d=h.shift(),m=l._queueHooks(r,o),g=function(){l.dequeue(r,o)};d==="inprogress"&&(d=h.shift(),f--),d&&(o==="fx"&&h.unshift("inprogress"),delete m.stop,d.call(r,g,m)),!f&&m&&m.empty.fire()},_queueHooks:function(r,o){var h=o+"queueHooks";return Z.get(r,h)||Z.access(r,h,{empty:l.Callbacks("once memory").add(function(){Z.remove(r,[o+"queue",h])})})}}),l.fn.extend({queue:function(r,o){var h=2;return typeof r!="string"&&(o=r,r="fx",h--),arguments.length<h?l.queue(this[0],r):o===void 0?this:this.each(function(){var f=l.queue(this,r,o);l._queueHooks(this,r),r==="fx"&&f[0]!=="inprogress"&&l.dequeue(this,r)})},dequeue:function(r){return this.each(function(){l.dequeue(this,r)})},clearQueue:function(r){return this.queue(r||"fx",[])},promise:function(r,o){var h,f=1,d=l.Deferred(),m=this,g=this.length,S=function(){--f||d.resolveWith(m,[m])};for(typeof r!="string"&&(o=r,r=void 0),r=r||"fx";g--;)h=Z.get(m[g],r+"queueHooks"),h&&h.empty&&(f++,h.empty.add(S));return S(),d.promise(o)}});var Pc=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,cr=new RegExp("^(?:([+-])=|)("+Pc+")([a-z%]*)$","i"),ui=["Top","Right","Bottom","Left"],Qi=z.documentElement,As=function(r){return l.contains(r.ownerDocument,r)},cd={composed:!0};Qi.getRootNode&&(As=function(r){return l.contains(r.ownerDocument,r)||r.getRootNode(cd)===r.ownerDocument});var tn=function(r,o){return r=o||r,r.style.display==="none"||r.style.display===""&&As(r)&&l.css(r,"display")==="none"};function Ic(r,o,h,f){var d,m,g=20,S=f?function(){return f.cur()}:function(){return l.css(r,o,"")},C=S(),k=h&&h[3]||(l.cssNumber[o]?"":"px"),O=r.nodeType&&(l.cssNumber[o]||k!=="px"&&+C)&&cr.exec(l.css(r,o));if(O&&O[3]!==k){for(C=C/2,k=k||O[3],O=+C||1;g--;)l.style(r,o,O+k),(1-m)*(1-(m=S()/C||.5))<=0&&(g=0),O=O/m;O=O*2,l.style(r,o,O+k),h=h||[]}return h&&(O=+O||+C||0,d=h[1]?O+(h[1]+1)*h[2]:+h[2],f&&(f.unit=k,f.start=O,f.end=d)),d}var Oc={};function hd(r){var o,h=r.ownerDocument,f=r.nodeName,d=Oc[f];return d||(o=h.body.appendChild(h.createElement(f)),d=l.css(o,"display"),o.parentNode.removeChild(o),d==="none"&&(d="block"),Oc[f]=d,d)}function ws(r,o){for(var h,f,d=[],m=0,g=r.length;m<g;m++)f=r[m],f.style&&(h=f.style.display,o?(h==="none"&&(d[m]=Z.get(f,"display")||null,d[m]||(f.style.display="")),f.style.display===""&&tn(f)&&(d[m]=hd(f))):h!=="none"&&(d[m]="none",Z.set(f,"display",h)));for(m=0;m<g;m++)d[m]!=null&&(r[m].style.display=d[m]);return r}l.fn.extend({show:function(){return ws(this,!0)},hide:function(){return ws(this)},toggle:function(r){return typeof r=="boolean"?r?this.show():this.hide():this.each(function(){tn(this)?l(this).show():l(this).hide()})}});var hr=/^(?:checkbox|radio)$/i,Mc=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Nc=/^$|^module$|\/(?:java|ecma)script/i;(function(){var r=z.createDocumentFragment(),o=r.appendChild(z.createElement("div")),h=z.createElement("input");h.setAttribute("type","radio"),h.setAttribute("checked","checked"),h.setAttribute("name","t"),o.appendChild(h),v.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,o.innerHTML="<textarea>x</textarea>",v.noCloneChecked=!!o.cloneNode(!0).lastChild.defaultValue,o.innerHTML="<option></option>",v.option=!!o.lastChild})();var Re={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Re.tbody=Re.tfoot=Re.colgroup=Re.caption=Re.thead,Re.th=Re.td,v.option||(Re.optgroup=Re.option=[1,"<select multiple='multiple'>","</select>"]);function de(r,o){var h;return typeof r.getElementsByTagName<"u"?h=r.getElementsByTagName(o||"*"):typeof r.querySelectorAll<"u"?h=r.querySelectorAll(o||"*"):h=[],o===void 0||o&&j(r,o)?l.merge([r],h):h}function ra(r,o){for(var h=0,f=r.length;h<f;h++)Z.set(r[h],"globalEval",!o||Z.get(o[h],"globalEval"))}var ud=/<|&#?\w+;/;function Bc(r,o,h,f,d){for(var m,g,S,C,k,O,F=o.createDocumentFragment(),L=[],H=0,lt=r.length;H<lt;H++)if(m=r[H],m||m===0)if(Q(m)==="object")l.merge(L,m.nodeType?[m]:m);else if(!ud.test(m))L.push(o.createTextNode(m));else{for(g=g||F.appendChild(o.createElement("div")),S=(Mc.exec(m)||["",""])[1].toLowerCase(),C=Re[S]||Re._default,g.innerHTML=C[1]+l.htmlPrefilter(m)+C[2],O=C[0];O--;)g=g.lastChild;l.merge(L,g.childNodes),g=F.firstChild,g.textContent=""}for(F.textContent="",H=0;m=L[H++];){if(f&&l.inArray(m,f)>-1){d&&d.push(m);continue}if(k=As(m),g=de(F.appendChild(m),"script"),k&&ra(g),h)for(O=0;m=g[O++];)Nc.test(m.type||"")&&h.push(m)}return F}var Fc=/^([^.]*)(?:\.(.+)|)/;function Ts(){return!0}function ks(){return!1}function na(r,o,h,f,d,m){var g,S;if(typeof o=="object"){typeof h!="string"&&(f=f||h,h=void 0);for(S in o)na(r,S,h,f,o[S],m);return r}if(f==null&&d==null?(d=h,f=h=void 0):d==null&&(typeof h=="string"?(d=f,f=void 0):(d=f,f=h,h=void 0)),d===!1)d=ks;else if(!d)return r;return m===1&&(g=d,d=function(C){return l().off(C),g.apply(this,arguments)},d.guid=g.guid||(g.guid=l.guid++)),r.each(function(){l.event.add(this,o,d,f,h)})}l.event={global:{},add:function(r,o,h,f,d){var m,g,S,C,k,O,F,L,H,lt,vt,pt=Z.get(r);if(ki(r))for(h.handler&&(m=h,h=m.handler,d=m.selector),d&&l.find.matchesSelector(Qi,d),h.guid||(h.guid=l.guid++),(C=pt.events)||(C=pt.events=Object.create(null)),(g=pt.handle)||(g=pt.handle=function(Xt){return typeof l<"u"&&l.event.triggered!==Xt.type?l.event.dispatch.apply(r,arguments):void 0}),o=(o||"").match(Zt)||[""],k=o.length;k--;)S=Fc.exec(o[k])||[],H=vt=S[1],lt=(S[2]||"").split(".").sort(),H&&(F=l.event.special[H]||{},H=(d?F.delegateType:F.bindType)||H,F=l.event.special[H]||{},O=l.extend({type:H,origType:vt,data:f,handler:h,guid:h.guid,selector:d,needsContext:d&&l.expr.match.needsContext.test(d),namespace:lt.join(".")},m),(L=C[H])||(L=C[H]=[],L.delegateCount=0,(!F.setup||F.setup.call(r,f,lt,g)===!1)&&r.addEventListener&&r.addEventListener(H,g)),F.add&&(F.add.call(r,O),O.handler.guid||(O.handler.guid=h.guid)),d?L.splice(L.delegateCount++,0,O):L.push(O),l.event.global[H]=!0)},remove:function(r,o,h,f,d){var m,g,S,C,k,O,F,L,H,lt,vt,pt=Z.hasData(r)&&Z.get(r);if(!(!pt||!(C=pt.events))){for(o=(o||"").match(Zt)||[""],k=o.length;k--;){if(S=Fc.exec(o[k])||[],H=vt=S[1],lt=(S[2]||"").split(".").sort(),!H){for(H in C)l.event.remove(r,H+o[k],h,f,!0);continue}for(F=l.event.special[H]||{},H=(f?F.delegateType:F.bindType)||H,L=C[H]||[],S=S[2]&&new RegExp("(^|\\.)"+lt.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=m=L.length;m--;)O=L[m],(d||vt===O.origType)&&(!h||h.guid===O.guid)&&(!S||S.test(O.namespace))&&(!f||f===O.selector||f==="**"&&O.selector)&&(L.splice(m,1),O.selector&&L.delegateCount--,F.remove&&F.remove.call(r,O));g&&!L.length&&((!F.teardown||F.teardown.call(r,lt,pt.handle)===!1)&&l.removeEvent(r,H,pt.handle),delete C[H])}l.isEmptyObject(C)&&Z.remove(r,"handle events")}},dispatch:function(r){var o,h,f,d,m,g,S=new Array(arguments.length),C=l.event.fix(r),k=(Z.get(this,"events")||Object.create(null))[C.type]||[],O=l.event.special[C.type]||{};for(S[0]=C,o=1;o<arguments.length;o++)S[o]=arguments[o];if(C.delegateTarget=this,!(O.preDispatch&&O.preDispatch.call(this,C)===!1)){for(g=l.event.handlers.call(this,C,k),o=0;(d=g[o++])&&!C.isPropagationStopped();)for(C.currentTarget=d.elem,h=0;(m=d.handlers[h++])&&!C.isImmediatePropagationStopped();)(!C.rnamespace||m.namespace===!1||C.rnamespace.test(m.namespace))&&(C.handleObj=m,C.data=m.data,f=((l.event.special[m.origType]||{}).handle||m.handler).apply(d.elem,S),f!==void 0&&(C.result=f)===!1&&(C.preventDefault(),C.stopPropagation()));return O.postDispatch&&O.postDispatch.call(this,C),C.result}},handlers:function(r,o){var h,f,d,m,g,S=[],C=o.delegateCount,k=r.target;if(C&&k.nodeType&&!(r.type==="click"&&r.button>=1)){for(;k!==this;k=k.parentNode||this)if(k.nodeType===1&&!(r.type==="click"&&k.disabled===!0)){for(m=[],g={},h=0;h<C;h++)f=o[h],d=f.selector+" ",g[d]===void 0&&(g[d]=f.needsContext?l(d,this).index(k)>-1:l.find(d,this,null,[k]).length),g[d]&&m.push(f);m.length&&S.push({elem:k,handlers:m})}}return k=this,C<o.length&&S.push({elem:k,handlers:o.slice(C)}),S},addProp:function(r,o){Object.defineProperty(l.Event.prototype,r,{enumerable:!0,configurable:!0,get:M(o)?function(){if(this.originalEvent)return o(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[r]},set:function(h){Object.defineProperty(this,r,{enumerable:!0,configurable:!0,writable:!0,value:h})}})},fix:function(r){return r[l.expando]?r:new l.Event(r)},special:{load:{noBubble:!0},click:{setup:function(r){var o=this||r;return hr.test(o.type)&&o.click&&j(o,"input")&&en(o,"click",!0),!1},trigger:function(r){var o=this||r;return hr.test(o.type)&&o.click&&j(o,"input")&&en(o,"click"),!0},_default:function(r){var o=r.target;return hr.test(o.type)&&o.click&&j(o,"input")&&Z.get(o,"click")||j(o,"a")}},beforeunload:{postDispatch:function(r){r.result!==void 0&&r.originalEvent&&(r.originalEvent.returnValue=r.result)}}}};function en(r,o,h){if(!h){Z.get(r,o)===void 0&&l.event.add(r,o,Ts);return}Z.set(r,o,!1),l.event.add(r,o,{namespace:!1,handler:function(f){var d,m=Z.get(this,o);if(f.isTrigger&1&&this[o]){if(m)(l.event.special[o]||{}).delegateType&&f.stopPropagation();else if(m=a.call(arguments),Z.set(this,o,m),this[o](),d=Z.get(this,o),Z.set(this,o,!1),m!==d)return f.stopImmediatePropagation(),f.preventDefault(),d}else m&&(Z.set(this,o,l.event.trigger(m[0],m.slice(1),this)),f.stopPropagation(),f.isImmediatePropagationStopped=Ts)}})}l.removeEvent=function(r,o,h){r.removeEventListener&&r.removeEventListener(o,h)},l.Event=function(r,o){if(!(this instanceof l.Event))return new l.Event(r,o);r&&r.type?(this.originalEvent=r,this.type=r.type,this.isDefaultPrevented=r.defaultPrevented||r.defaultPrevented===void 0&&r.returnValue===!1?Ts:ks,this.target=r.target&&r.target.nodeType===3?r.target.parentNode:r.target,this.currentTarget=r.currentTarget,this.relatedTarget=r.relatedTarget):this.type=r,o&&l.extend(this,o),this.timeStamp=r&&r.timeStamp||Date.now(),this[l.expando]=!0},l.Event.prototype={constructor:l.Event,isDefaultPrevented:ks,isPropagationStopped:ks,isImmediatePropagationStopped:ks,isSimulated:!1,preventDefault:function(){var r=this.originalEvent;this.isDefaultPrevented=Ts,r&&!this.isSimulated&&r.preventDefault()},stopPropagation:function(){var r=this.originalEvent;this.isPropagationStopped=Ts,r&&!this.isSimulated&&r.stopPropagation()},stopImmediatePropagation:function(){var r=this.originalEvent;this.isImmediatePropagationStopped=Ts,r&&!this.isSimulated&&r.stopImmediatePropagation(),this.stopPropagation()}},l.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},l.event.addProp),l.each({focus:"focusin",blur:"focusout"},function(r,o){function h(f){if(z.documentMode){var d=Z.get(this,"handle"),m=l.event.fix(f);m.type=f.type==="focusin"?"focus":"blur",m.isSimulated=!0,d(f),m.target===m.currentTarget&&d(m)}else l.event.simulate(o,f.target,l.event.fix(f))}l.event.special[r]={setup:function(){var f;if(en(this,r,!0),z.documentMode)f=Z.get(this,o),f||this.addEventListener(o,h),Z.set(this,o,(f||0)+1);else return!1},trigger:function(){return en(this,r),!0},teardown:function(){var f;if(z.documentMode)f=Z.get(this,o)-1,f?Z.set(this,o,f):(this.removeEventListener(o,h),Z.remove(this,o));else return!1},_default:function(f){return Z.get(f.target,r)},delegateType:o},l.event.special[o]={setup:function(){var f=this.ownerDocument||this.document||this,d=z.documentMode?this:f,m=Z.get(d,o);m||(z.documentMode?this.addEventListener(o,h):f.addEventListener(r,h,!0)),Z.set(d,o,(m||0)+1)},teardown:function(){var f=this.ownerDocument||this.document||this,d=z.documentMode?this:f,m=Z.get(d,o)-1;m?Z.set(d,o,m):(z.documentMode?this.removeEventListener(o,h):f.removeEventListener(r,h,!0),Z.remove(d,o))}}}),l.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(r,o){l.event.special[r]={delegateType:o,bindType:o,handle:function(h){var f,d=this,m=h.relatedTarget,g=h.handleObj;return(!m||m!==d&&!l.contains(d,m))&&(h.type=g.origType,f=g.handler.apply(this,arguments),h.type=o),f}}}),l.fn.extend({on:function(r,o,h,f){return na(this,r,o,h,f)},one:function(r,o,h,f){return na(this,r,o,h,f,1)},off:function(r,o,h){var f,d;if(r&&r.preventDefault&&r.handleObj)return f=r.handleObj,l(r.delegateTarget).off(f.namespace?f.origType+"."+f.namespace:f.origType,f.selector,f.handler),this;if(typeof r=="object"){for(d in r)this.off(d,o,r[d]);return this}return(o===!1||typeof o=="function")&&(h=o,o=void 0),h===!1&&(h=ks),this.each(function(){l.event.remove(this,r,h,o)})}});var ld=/<script|<style|<link/i,fd=/checked\s*(?:[^=]|=\s*.checked.)/i,dd=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Uc(r,o){return j(r,"table")&&j(o.nodeType!==11?o:o.firstChild,"tr")&&l(r).children("tbody")[0]||r}function pd(r){return r.type=(r.getAttribute("type")!==null)+"/"+r.type,r}function md(r){return(r.type||"").slice(0,5)==="true/"?r.type=r.type.slice(5):r.removeAttribute("type"),r}function $c(r,o){var h,f,d,m,g,S,C;if(o.nodeType===1){if(Z.hasData(r)&&(m=Z.get(r),C=m.events,C)){Z.remove(o,"handle events");for(d in C)for(h=0,f=C[d].length;h<f;h++)l.event.add(o,d,C[d][h])}Yt.hasData(r)&&(g=Yt.access(r),S=l.extend({},g),Yt.set(o,S))}}function gd(r,o){var h=o.nodeName.toLowerCase();h==="input"&&hr.test(r.type)?o.checked=r.checked:(h==="input"||h==="textarea")&&(o.defaultValue=r.defaultValue)}function Ds(r,o,h,f){o=c(o);var d,m,g,S,C,k,O=0,F=r.length,L=F-1,H=o[0],lt=M(H);if(lt||F>1&&typeof H=="string"&&!v.checkClone&&fd.test(H))return r.each(function(vt){var pt=r.eq(vt);lt&&(o[0]=H.call(this,vt,pt.html())),Ds(pt,o,h,f)});if(F&&(d=Bc(o,r[0].ownerDocument,!1,r,f),m=d.firstChild,d.childNodes.length===1&&(d=m),m||f)){for(g=l.map(de(d,"script"),pd),S=g.length;O<F;O++)C=d,O!==L&&(C=l.clone(C,!0,!0),S&&l.merge(g,de(C,"script"))),h.call(r[O],C,O);if(S)for(k=g[g.length-1].ownerDocument,l.map(g,md),O=0;O<S;O++)C=g[O],Nc.test(C.type||"")&&!Z.access(C,"globalEval")&&l.contains(k,C)&&(C.src&&(C.type||"").toLowerCase()!=="module"?l._evalUrl&&!C.noModule&&l._evalUrl(C.src,{nonce:C.nonce||C.getAttribute("nonce")},k):mt(C.textContent.replace(dd,""),C,k))}return r}function Hc(r,o,h){for(var f,d=o?l.filter(o,r):r,m=0;(f=d[m])!=null;m++)!h&&f.nodeType===1&&l.cleanData(de(f)),f.parentNode&&(h&&As(f)&&ra(de(f,"script")),f.parentNode.removeChild(f));return r}l.extend({htmlPrefilter:function(r){return r},clone:function(r,o,h){var f,d,m,g,S=r.cloneNode(!0),C=As(r);if(!v.noCloneChecked&&(r.nodeType===1||r.nodeType===11)&&!l.isXMLDoc(r))for(g=de(S),m=de(r),f=0,d=m.length;f<d;f++)gd(m[f],g[f]);if(o)if(h)for(m=m||de(r),g=g||de(S),f=0,d=m.length;f<d;f++)$c(m[f],g[f]);else $c(r,S);return g=de(S,"script"),g.length>0&&ra(g,!C&&de(r,"script")),S},cleanData:function(r){for(var o,h,f,d=l.event.special,m=0;(h=r[m])!==void 0;m++)if(ki(h)){if(o=h[Z.expando]){if(o.events)for(f in o.events)d[f]?l.event.remove(h,f):l.removeEvent(h,f,o.handle);h[Z.expando]=void 0}h[Yt.expando]&&(h[Yt.expando]=void 0)}}}),l.fn.extend({detach:function(r){return Hc(this,r,!0)},remove:function(r){return Hc(this,r)},text:function(r){return Rt(this,function(o){return o===void 0?l.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=o)})},null,r,arguments.length)},append:function(){return Ds(this,arguments,function(r){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=Uc(this,r);o.appendChild(r)}})},prepend:function(){return Ds(this,arguments,function(r){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var o=Uc(this,r);o.insertBefore(r,o.firstChild)}})},before:function(){return Ds(this,arguments,function(r){this.parentNode&&this.parentNode.insertBefore(r,this)})},after:function(){return Ds(this,arguments,function(r){this.parentNode&&this.parentNode.insertBefore(r,this.nextSibling)})},empty:function(){for(var r,o=0;(r=this[o])!=null;o++)r.nodeType===1&&(l.cleanData(de(r,!1)),r.textContent="");return this},clone:function(r,o){return r=r??!1,o=o??r,this.map(function(){return l.clone(this,r,o)})},html:function(r){return Rt(this,function(o){var h=this[0]||{},f=0,d=this.length;if(o===void 0&&h.nodeType===1)return h.innerHTML;if(typeof o=="string"&&!ld.test(o)&&!Re[(Mc.exec(o)||["",""])[1].toLowerCase()]){o=l.htmlPrefilter(o);try{for(;f<d;f++)h=this[f]||{},h.nodeType===1&&(l.cleanData(de(h,!1)),h.innerHTML=o);h=0}catch{}}h&&this.empty().append(o)},null,r,arguments.length)},replaceWith:function(){var r=[];return Ds(this,arguments,function(o){var h=this.parentNode;l.inArray(this,r)<0&&(l.cleanData(de(this)),h&&h.replaceChild(o,this))},r)}}),l.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(r,o){l.fn[r]=function(h){for(var f,d=[],m=l(h),g=m.length-1,S=0;S<=g;S++)f=S===g?this:this.clone(!0),l(m[S])[o](f),u.apply(d,f.get());return this.pushStack(d)}});var aa=new RegExp("^("+Pc+")(?!px)[a-z%]+$","i"),oa=/^--/,sn=function(r){var o=r.ownerDocument.defaultView;return(!o||!o.opener)&&(o=t),o.getComputedStyle(r)},zc=function(r,o,h){var f,d,m={};for(d in o)m[d]=r.style[d],r.style[d]=o[d];f=h.call(r);for(d in o)r.style[d]=m[d];return f},_d=new RegExp(ui.join("|"),"i");(function(){function r(){if(k){C.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",k.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",Qi.appendChild(C).appendChild(k);var O=t.getComputedStyle(k);h=O.top!=="1%",S=o(O.marginLeft)===12,k.style.right="60%",m=o(O.right)===36,f=o(O.width)===36,k.style.position="absolute",d=o(k.offsetWidth/3)===12,Qi.removeChild(C),k=null}}function o(O){return Math.round(parseFloat(O))}var h,f,d,m,g,S,C=z.createElement("div"),k=z.createElement("div");k.style&&(k.style.backgroundClip="content-box",k.cloneNode(!0).style.backgroundClip="",v.clearCloneStyle=k.style.backgroundClip==="content-box",l.extend(v,{boxSizingReliable:function(){return r(),f},pixelBoxStyles:function(){return r(),m},pixelPosition:function(){return r(),h},reliableMarginLeft:function(){return r(),S},scrollboxSize:function(){return r(),d},reliableTrDimensions:function(){var O,F,L,H;return g==null&&(O=z.createElement("table"),F=z.createElement("tr"),L=z.createElement("div"),O.style.cssText="position:absolute;left:-11111px;border-collapse:separate",F.style.cssText="box-sizing:content-box;border:1px solid",F.style.height="1px",L.style.height="9px",L.style.display="block",Qi.appendChild(O).appendChild(F).appendChild(L),H=t.getComputedStyle(F),g=parseInt(H.height,10)+parseInt(H.borderTopWidth,10)+parseInt(H.borderBottomWidth,10)===F.offsetHeight,Qi.removeChild(O)),g}}))})();function ur(r,o,h){var f,d,m,g,S=oa.test(o),C=r.style;return h=h||sn(r),h&&(g=h.getPropertyValue(o)||h[o],S&&g&&(g=g.replace(bt,"$1")||void 0),g===""&&!As(r)&&(g=l.style(r,o)),!v.pixelBoxStyles()&&aa.test(g)&&_d.test(o)&&(f=C.width,d=C.minWidth,m=C.maxWidth,C.minWidth=C.maxWidth=C.width=g,g=h.width,C.width=f,C.minWidth=d,C.maxWidth=m)),g!==void 0?g+"":g}function Wc(r,o){return{get:function(){if(r()){delete this.get;return}return(this.get=o).apply(this,arguments)}}}var Gc=["Webkit","Moz","ms"],Vc=z.createElement("div").style,Kc={};function xd(r){for(var o=r[0].toUpperCase()+r.slice(1),h=Gc.length;h--;)if(r=Gc[h]+o,r in Vc)return r}function ca(r){var o=l.cssProps[r]||Kc[r];return o||(r in Vc?r:Kc[r]=xd(r)||r)}var bd=/^(none|table(?!-c[ea]).+)/,yd={position:"absolute",visibility:"hidden",display:"block"},qc={letterSpacing:"0",fontWeight:"400"};function jc(r,o,h){var f=cr.exec(o);return f?Math.max(0,f[2]-(h||0))+(f[3]||"px"):o}function ha(r,o,h,f,d,m){var g=o==="width"?1:0,S=0,C=0,k=0;if(h===(f?"border":"content"))return 0;for(;g<4;g+=2)h==="margin"&&(k+=l.css(r,h+ui[g],!0,d)),f?(h==="content"&&(C-=l.css(r,"padding"+ui[g],!0,d)),h!=="margin"&&(C-=l.css(r,"border"+ui[g]+"Width",!0,d))):(C+=l.css(r,"padding"+ui[g],!0,d),h!=="padding"?C+=l.css(r,"border"+ui[g]+"Width",!0,d):S+=l.css(r,"border"+ui[g]+"Width",!0,d));return!f&&m>=0&&(C+=Math.max(0,Math.ceil(r["offset"+o[0].toUpperCase()+o.slice(1)]-m-C-S-.5))||0),C+k}function Yc(r,o,h){var f=sn(r),d=!v.boxSizingReliable()||h,m=d&&l.css(r,"boxSizing",!1,f)==="border-box",g=m,S=ur(r,o,f),C="offset"+o[0].toUpperCase()+o.slice(1);if(aa.test(S)){if(!h)return S;S="auto"}return(!v.boxSizingReliable()&&m||!v.reliableTrDimensions()&&j(r,"tr")||S==="auto"||!parseFloat(S)&&l.css(r,"display",!1,f)==="inline")&&r.getClientRects().length&&(m=l.css(r,"boxSizing",!1,f)==="border-box",g=C in r,g&&(S=r[C])),S=parseFloat(S)||0,S+ha(r,o,h||(m?"border":"content"),g,f,S)+"px"}l.extend({cssHooks:{opacity:{get:function(r,o){if(o){var h=ur(r,"opacity");return h===""?"1":h}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(r,o,h,f){if(!(!r||r.nodeType===3||r.nodeType===8||!r.style)){var d,m,g,S=Se(o),C=oa.test(o),k=r.style;if(C||(o=ca(S)),g=l.cssHooks[o]||l.cssHooks[S],h!==void 0){if(m=typeof h,m==="string"&&(d=cr.exec(h))&&d[1]&&(h=Ic(r,o,d),m="number"),h==null||h!==h)return;m==="number"&&!C&&(h+=d&&d[3]||(l.cssNumber[S]?"":"px")),!v.clearCloneStyle&&h===""&&o.indexOf("background")===0&&(k[o]="inherit"),(!g||!("set"in g)||(h=g.set(r,h,f))!==void 0)&&(C?k.setProperty(o,h):k[o]=h)}else return g&&"get"in g&&(d=g.get(r,!1,f))!==void 0?d:k[o]}},css:function(r,o,h,f){var d,m,g,S=Se(o),C=oa.test(o);return C||(o=ca(S)),g=l.cssHooks[o]||l.cssHooks[S],g&&"get"in g&&(d=g.get(r,!0,h)),d===void 0&&(d=ur(r,o,f)),d==="normal"&&o in qc&&(d=qc[o]),h===""||h?(m=parseFloat(d),h===!0||isFinite(m)?m||0:d):d}}),l.each(["height","width"],function(r,o){l.cssHooks[o]={get:function(h,f,d){if(f)return bd.test(l.css(h,"display"))&&(!h.getClientRects().length||!h.getBoundingClientRect().width)?zc(h,yd,function(){return Yc(h,o,d)}):Yc(h,o,d)},set:function(h,f,d){var m,g=sn(h),S=!v.scrollboxSize()&&g.position==="absolute",C=S||d,k=C&&l.css(h,"boxSizing",!1,g)==="border-box",O=d?ha(h,o,d,k,g):0;return k&&S&&(O-=Math.ceil(h["offset"+o[0].toUpperCase()+o.slice(1)]-parseFloat(g[o])-ha(h,o,"border",!1,g)-.5)),O&&(m=cr.exec(f))&&(m[3]||"px")!=="px"&&(h.style[o]=f,f=l.css(h,o)),jc(h,f,O)}}}),l.cssHooks.marginLeft=Wc(v.reliableMarginLeft,function(r,o){if(o)return(parseFloat(ur(r,"marginLeft"))||r.getBoundingClientRect().left-zc(r,{marginLeft:0},function(){return r.getBoundingClientRect().left}))+"px"}),l.each({margin:"",padding:"",border:"Width"},function(r,o){l.cssHooks[r+o]={expand:function(h){for(var f=0,d={},m=typeof h=="string"?h.split(" "):[h];f<4;f++)d[r+ui[f]+o]=m[f]||m[f-2]||m[0];return d}},r!=="margin"&&(l.cssHooks[r+o].set=jc)}),l.fn.extend({css:function(r,o){return Rt(this,function(h,f,d){var m,g,S={},C=0;if(Array.isArray(f)){for(m=sn(h),g=f.length;C<g;C++)S[f[C]]=l.css(h,f[C],!1,m);return S}return d!==void 0?l.style(h,f,d):l.css(h,f)},r,o,arguments.length>1)}});function pe(r,o,h,f,d){return new pe.prototype.init(r,o,h,f,d)}l.Tween=pe,pe.prototype={constructor:pe,init:function(r,o,h,f,d,m){this.elem=r,this.prop=h,this.easing=d||l.easing._default,this.options=o,this.start=this.now=this.cur(),this.end=f,this.unit=m||(l.cssNumber[h]?"":"px")},cur:function(){var r=pe.propHooks[this.prop];return r&&r.get?r.get(this):pe.propHooks._default.get(this)},run:function(r){var o,h=pe.propHooks[this.prop];return this.options.duration?this.pos=o=l.easing[this.easing](r,this.options.duration*r,0,1,this.options.duration):this.pos=o=r,this.now=(this.end-this.start)*o+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),h&&h.set?h.set(this):pe.propHooks._default.set(this),this}},pe.prototype.init.prototype=pe.prototype,pe.propHooks={_default:{get:function(r){var o;return r.elem.nodeType!==1||r.elem[r.prop]!=null&&r.elem.style[r.prop]==null?r.elem[r.prop]:(o=l.css(r.elem,r.prop,""),!o||o==="auto"?0:o)},set:function(r){l.fx.step[r.prop]?l.fx.step[r.prop](r):r.elem.nodeType===1&&(l.cssHooks[r.prop]||r.elem.style[ca(r.prop)]!=null)?l.style(r.elem,r.prop,r.now+r.unit):r.elem[r.prop]=r.now}}},pe.propHooks.scrollTop=pe.propHooks.scrollLeft={set:function(r){r.elem.nodeType&&r.elem.parentNode&&(r.elem[r.prop]=r.now)}},l.easing={linear:function(r){return r},swing:function(r){return .5-Math.cos(r*Math.PI)/2},_default:"swing"},l.fx=pe.prototype.init,l.fx.step={};var Rs,rn,Cd=/^(?:toggle|show|hide)$/,vd=/queueHooks$/;function ua(){rn&&(z.hidden===!1&&t.requestAnimationFrame?t.requestAnimationFrame(ua):t.setTimeout(ua,l.fx.interval),l.fx.tick())}function Xc(){return t.setTimeout(function(){Rs=void 0}),Rs=Date.now()}function nn(r,o){var h,f=0,d={height:r};for(o=o?1:0;f<4;f+=2-o)h=ui[f],d["margin"+h]=d["padding"+h]=r;return o&&(d.opacity=d.width=r),d}function Qc(r,o,h){for(var f,d=(We.tweeners[o]||[]).concat(We.tweeners["*"]),m=0,g=d.length;m<g;m++)if(f=d[m].call(h,o,r))return f}function Sd(r,o,h){var f,d,m,g,S,C,k,O,F="width"in o||"height"in o,L=this,H={},lt=r.style,vt=r.nodeType&&tn(r),pt=Z.get(r,"fxshow");h.queue||(g=l._queueHooks(r,"fx"),g.unqueued==null&&(g.unqueued=0,S=g.empty.fire,g.empty.fire=function(){g.unqueued||S()}),g.unqueued++,L.always(function(){L.always(function(){g.unqueued--,l.queue(r,"fx").length||g.empty.fire()})}));for(f in o)if(d=o[f],Cd.test(d)){if(delete o[f],m=m||d==="toggle",d===(vt?"hide":"show"))if(d==="show"&&pt&&pt[f]!==void 0)vt=!0;else continue;H[f]=pt&&pt[f]||l.style(r,f)}if(C=!l.isEmptyObject(o),!(!C&&l.isEmptyObject(H))){F&&r.nodeType===1&&(h.overflow=[lt.overflow,lt.overflowX,lt.overflowY],k=pt&&pt.display,k==null&&(k=Z.get(r,"display")),O=l.css(r,"display"),O==="none"&&(k?O=k:(ws([r],!0),k=r.style.display||k,O=l.css(r,"display"),ws([r]))),(O==="inline"||O==="inline-block"&&k!=null)&&l.css(r,"float")==="none"&&(C||(L.done(function(){lt.display=k}),k==null&&(O=lt.display,k=O==="none"?"":O)),lt.display="inline-block")),h.overflow&&(lt.overflow="hidden",L.always(function(){lt.overflow=h.overflow[0],lt.overflowX=h.overflow[1],lt.overflowY=h.overflow[2]})),C=!1;for(f in H)C||(pt?"hidden"in pt&&(vt=pt.hidden):pt=Z.access(r,"fxshow",{display:k}),m&&(pt.hidden=!vt),vt&&ws([r],!0),L.done(function(){vt||ws([r]),Z.remove(r,"fxshow");for(f in H)l.style(r,f,H[f])})),C=Qc(vt?pt[f]:0,f,L),f in pt||(pt[f]=C.start,vt&&(C.end=C.start,C.start=0))}}function Ed(r,o){var h,f,d,m,g;for(h in r)if(f=Se(h),d=o[f],m=r[h],Array.isArray(m)&&(d=m[1],m=r[h]=m[0]),h!==f&&(r[f]=m,delete r[h]),g=l.cssHooks[f],g&&"expand"in g){m=g.expand(m),delete r[f];for(h in m)h in r||(r[h]=m[h],o[h]=d)}else o[f]=d}function We(r,o,h){var f,d,m=0,g=We.prefilters.length,S=l.Deferred().always(function(){delete C.elem}),C=function(){if(d)return!1;for(var F=Rs||Xc(),L=Math.max(0,k.startTime+k.duration-F),H=L/k.duration||0,lt=1-H,vt=0,pt=k.tweens.length;vt<pt;vt++)k.tweens[vt].run(lt);return S.notifyWith(r,[k,lt,L]),lt<1&&pt?L:(pt||S.notifyWith(r,[k,1,0]),S.resolveWith(r,[k]),!1)},k=S.promise({elem:r,props:l.extend({},o),opts:l.extend(!0,{specialEasing:{},easing:l.easing._default},h),originalProperties:o,originalOptions:h,startTime:Rs||Xc(),duration:h.duration,tweens:[],createTween:function(F,L){var H=l.Tween(r,k.opts,F,L,k.opts.specialEasing[F]||k.opts.easing);return k.tweens.push(H),H},stop:function(F){var L=0,H=F?k.tweens.length:0;if(d)return this;for(d=!0;L<H;L++)k.tweens[L].run(1);return F?(S.notifyWith(r,[k,1,0]),S.resolveWith(r,[k,F])):S.rejectWith(r,[k,F]),this}}),O=k.props;for(Ed(O,k.opts.specialEasing);m<g;m++)if(f=We.prefilters[m].call(k,r,O,k.opts),f)return M(f.stop)&&(l._queueHooks(k.elem,k.opts.queue).stop=f.stop.bind(f)),f;return l.map(O,Qc,k),M(k.opts.start)&&k.opts.start.call(r,k),k.progress(k.opts.progress).done(k.opts.done,k.opts.complete).fail(k.opts.fail).always(k.opts.always),l.fx.timer(l.extend(C,{elem:r,anim:k,queue:k.opts.queue})),k}l.Animation=l.extend(We,{tweeners:{"*":[function(r,o){var h=this.createTween(r,o);return Ic(h.elem,r,cr.exec(o),h),h}]},tweener:function(r,o){M(r)?(o=r,r=["*"]):r=r.match(Zt);for(var h,f=0,d=r.length;f<d;f++)h=r[f],We.tweeners[h]=We.tweeners[h]||[],We.tweeners[h].unshift(o)},prefilters:[Sd],prefilter:function(r,o){o?We.prefilters.unshift(r):We.prefilters.push(r)}}),l.speed=function(r,o,h){var f=r&&typeof r=="object"?l.extend({},r):{complete:h||!h&&o||M(r)&&r,duration:r,easing:h&&o||o&&!M(o)&&o};return l.fx.off?f.duration=0:typeof f.duration!="number"&&(f.duration in l.fx.speeds?f.duration=l.fx.speeds[f.duration]:f.duration=l.fx.speeds._default),(f.queue==null||f.queue===!0)&&(f.queue="fx"),f.old=f.complete,f.complete=function(){M(f.old)&&f.old.call(this),f.queue&&l.dequeue(this,f.queue)},f},l.fn.extend({fadeTo:function(r,o,h,f){return this.filter(tn).css("opacity",0).show().end().animate({opacity:o},r,h,f)},animate:function(r,o,h,f){var d=l.isEmptyObject(r),m=l.speed(o,h,f),g=function(){var S=We(this,l.extend({},r),m);(d||Z.get(this,"finish"))&&S.stop(!0)};return g.finish=g,d||m.queue===!1?this.each(g):this.queue(m.queue,g)},stop:function(r,o,h){var f=function(d){var m=d.stop;delete d.stop,m(h)};return typeof r!="string"&&(h=o,o=r,r=void 0),o&&this.queue(r||"fx",[]),this.each(function(){var d=!0,m=r!=null&&r+"queueHooks",g=l.timers,S=Z.get(this);if(m)S[m]&&S[m].stop&&f(S[m]);else for(m in S)S[m]&&S[m].stop&&vd.test(m)&&f(S[m]);for(m=g.length;m--;)g[m].elem===this&&(r==null||g[m].queue===r)&&(g[m].anim.stop(h),d=!1,g.splice(m,1));(d||!h)&&l.dequeue(this,r)})},finish:function(r){return r!==!1&&(r=r||"fx"),this.each(function(){var o,h=Z.get(this),f=h[r+"queue"],d=h[r+"queueHooks"],m=l.timers,g=f?f.length:0;for(h.finish=!0,l.queue(this,r,[]),d&&d.stop&&d.stop.call(this,!0),o=m.length;o--;)m[o].elem===this&&m[o].queue===r&&(m[o].anim.stop(!0),m.splice(o,1));for(o=0;o<g;o++)f[o]&&f[o].finish&&f[o].finish.call(this);delete h.finish})}}),l.each(["toggle","show","hide"],function(r,o){var h=l.fn[o];l.fn[o]=function(f,d,m){return f==null||typeof f=="boolean"?h.apply(this,arguments):this.animate(nn(o,!0),f,d,m)}}),l.each({slideDown:nn("show"),slideUp:nn("hide"),slideToggle:nn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(r,o){l.fn[r]=function(h,f,d){return this.animate(o,h,f,d)}}),l.timers=[],l.fx.tick=function(){var r,o=0,h=l.timers;for(Rs=Date.now();o<h.length;o++)r=h[o],!r()&&h[o]===r&&h.splice(o--,1);h.length||l.fx.stop(),Rs=void 0},l.fx.timer=function(r){l.timers.push(r),l.fx.start()},l.fx.interval=13,l.fx.start=function(){rn||(rn=!0,ua())},l.fx.stop=function(){rn=null},l.fx.speeds={slow:600,fast:200,_default:400},l.fn.delay=function(r,o){return r=l.fx&&l.fx.speeds[r]||r,o=o||"fx",this.queue(o,function(h,f){var d=t.setTimeout(h,r);f.stop=function(){t.clearTimeout(d)}})},function(){var r=z.createElement("input"),o=z.createElement("select"),h=o.appendChild(z.createElement("option"));r.type="checkbox",v.checkOn=r.value!=="",v.optSelected=h.selected,r=z.createElement("input"),r.value="t",r.type="radio",v.radioValue=r.value==="t"}();var Zc,lr=l.expr.attrHandle;l.fn.extend({attr:function(r,o){return Rt(this,l.attr,r,o,arguments.length>1)},removeAttr:function(r){return this.each(function(){l.removeAttr(this,r)})}}),l.extend({attr:function(r,o,h){var f,d,m=r.nodeType;if(!(m===3||m===8||m===2)){if(typeof r.getAttribute>"u")return l.prop(r,o,h);if((m!==1||!l.isXMLDoc(r))&&(d=l.attrHooks[o.toLowerCase()]||(l.expr.match.bool.test(o)?Zc:void 0)),h!==void 0){if(h===null){l.removeAttr(r,o);return}return d&&"set"in d&&(f=d.set(r,h,o))!==void 0?f:(r.setAttribute(o,h+""),h)}return d&&"get"in d&&(f=d.get(r,o))!==null?f:(f=l.find.attr(r,o),f??void 0)}},attrHooks:{type:{set:function(r,o){if(!v.radioValue&&o==="radio"&&j(r,"input")){var h=r.value;return r.setAttribute("type",o),h&&(r.value=h),o}}}},removeAttr:function(r,o){var h,f=0,d=o&&o.match(Zt);if(d&&r.nodeType===1)for(;h=d[f++];)r.removeAttribute(h)}}),Zc={set:function(r,o,h){return o===!1?l.removeAttr(r,h):r.setAttribute(h,h),h}},l.each(l.expr.match.bool.source.match(/\w+/g),function(r,o){var h=lr[o]||l.find.attr;lr[o]=function(f,d,m){var g,S,C=d.toLowerCase();return m||(S=lr[C],lr[C]=g,g=h(f,d,m)!=null?C:null,lr[C]=S),g}});var Ad=/^(?:input|select|textarea|button)$/i,wd=/^(?:a|area)$/i;l.fn.extend({prop:function(r,o){return Rt(this,l.prop,r,o,arguments.length>1)},removeProp:function(r){return this.each(function(){delete this[l.propFix[r]||r]})}}),l.extend({prop:function(r,o,h){var f,d,m=r.nodeType;if(!(m===3||m===8||m===2))return(m!==1||!l.isXMLDoc(r))&&(o=l.propFix[o]||o,d=l.propHooks[o]),h!==void 0?d&&"set"in d&&(f=d.set(r,h,o))!==void 0?f:r[o]=h:d&&"get"in d&&(f=d.get(r,o))!==null?f:r[o]},propHooks:{tabIndex:{get:function(r){var o=l.find.attr(r,"tabindex");return o?parseInt(o,10):Ad.test(r.nodeName)||wd.test(r.nodeName)&&r.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),v.optSelected||(l.propHooks.selected={get:function(r){var o=r.parentNode;return o&&o.parentNode&&o.parentNode.selectedIndex,null},set:function(r){var o=r.parentNode;o&&(o.selectedIndex,o.parentNode&&o.parentNode.selectedIndex)}}),l.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){l.propFix[this.toLowerCase()]=this});function Zi(r){var o=r.match(Zt)||[];return o.join(" ")}function Ji(r){return r.getAttribute&&r.getAttribute("class")||""}function la(r){return Array.isArray(r)?r:typeof r=="string"?r.match(Zt)||[]:[]}l.fn.extend({addClass:function(r){var o,h,f,d,m,g;return M(r)?this.each(function(S){l(this).addClass(r.call(this,S,Ji(this)))}):(o=la(r),o.length?this.each(function(){if(f=Ji(this),h=this.nodeType===1&&" "+Zi(f)+" ",h){for(m=0;m<o.length;m++)d=o[m],h.indexOf(" "+d+" ")<0&&(h+=d+" ");g=Zi(h),f!==g&&this.setAttribute("class",g)}}):this)},removeClass:function(r){var o,h,f,d,m,g;return M(r)?this.each(function(S){l(this).removeClass(r.call(this,S,Ji(this)))}):arguments.length?(o=la(r),o.length?this.each(function(){if(f=Ji(this),h=this.nodeType===1&&" "+Zi(f)+" ",h){for(m=0;m<o.length;m++)for(d=o[m];h.indexOf(" "+d+" ")>-1;)h=h.replace(" "+d+" "," ");g=Zi(h),f!==g&&this.setAttribute("class",g)}}):this):this.attr("class","")},toggleClass:function(r,o){var h,f,d,m,g=typeof r,S=g==="string"||Array.isArray(r);return M(r)?this.each(function(C){l(this).toggleClass(r.call(this,C,Ji(this),o),o)}):typeof o=="boolean"&&S?o?this.addClass(r):this.removeClass(r):(h=la(r),this.each(function(){if(S)for(m=l(this),d=0;d<h.length;d++)f=h[d],m.hasClass(f)?m.removeClass(f):m.addClass(f);else(r===void 0||g==="boolean")&&(f=Ji(this),f&&Z.set(this,"__className__",f),this.setAttribute&&this.setAttribute("class",f||r===!1?"":Z.get(this,"__className__")||""))}))},hasClass:function(r){var o,h,f=0;for(o=" "+r+" ";h=this[f++];)if(h.nodeType===1&&(" "+Zi(Ji(h))+" ").indexOf(o)>-1)return!0;return!1}});var Td=/\r/g;l.fn.extend({val:function(r){var o,h,f,d=this[0];return arguments.length?(f=M(r),this.each(function(m){var g;this.nodeType===1&&(f?g=r.call(this,m,l(this).val()):g=r,g==null?g="":typeof g=="number"?g+="":Array.isArray(g)&&(g=l.map(g,function(S){return S==null?"":S+""})),o=l.valHooks[this.type]||l.valHooks[this.nodeName.toLowerCase()],(!o||!("set"in o)||o.set(this,g,"value")===void 0)&&(this.value=g))})):d?(o=l.valHooks[d.type]||l.valHooks[d.nodeName.toLowerCase()],o&&"get"in o&&(h=o.get(d,"value"))!==void 0?h:(h=d.value,typeof h=="string"?h.replace(Td,""):h??"")):void 0}}),l.extend({valHooks:{option:{get:function(r){var o=l.find.attr(r,"value");return o??Zi(l.text(r))}},select:{get:function(r){var o,h,f,d=r.options,m=r.selectedIndex,g=r.type==="select-one",S=g?null:[],C=g?m+1:d.length;for(m<0?f=C:f=g?m:0;f<C;f++)if(h=d[f],(h.selected||f===m)&&!h.disabled&&(!h.parentNode.disabled||!j(h.parentNode,"optgroup"))){if(o=l(h).val(),g)return o;S.push(o)}return S},set:function(r,o){for(var h,f,d=r.options,m=l.makeArray(o),g=d.length;g--;)f=d[g],(f.selected=l.inArray(l.valHooks.option.get(f),m)>-1)&&(h=!0);return h||(r.selectedIndex=-1),m}}}}),l.each(["radio","checkbox"],function(){l.valHooks[this]={set:function(r,o){if(Array.isArray(o))return r.checked=l.inArray(l(r).val(),o)>-1}},v.checkOn||(l.valHooks[this].get=function(r){return r.getAttribute("value")===null?"on":r.value})});var fr=t.location,Jc={guid:Date.now()},fa=/\?/;l.parseXML=function(r){var o,h;if(!r||typeof r!="string")return null;try{o=new t.DOMParser().parseFromString(r,"text/xml")}catch{}return h=o&&o.getElementsByTagName("parsererror")[0],(!o||h)&&l.error("Invalid XML: "+(h?l.map(h.childNodes,function(f){return f.textContent}).join(`
`):r)),o};var th=/^(?:focusinfocus|focusoutblur)$/,eh=function(r){r.stopPropagation()};l.extend(l.event,{trigger:function(r,o,h,f){var d,m,g,S,C,k,O,F,L=[h||z],H=y.call(r,"type")?r.type:r,lt=y.call(r,"namespace")?r.namespace.split("."):[];if(m=F=g=h=h||z,!(h.nodeType===3||h.nodeType===8)&&!th.test(H+l.event.triggered)&&(H.indexOf(".")>-1&&(lt=H.split("."),H=lt.shift(),lt.sort()),C=H.indexOf(":")<0&&"on"+H,r=r[l.expando]?r:new l.Event(H,typeof r=="object"&&r),r.isTrigger=f?2:3,r.namespace=lt.join("."),r.rnamespace=r.namespace?new RegExp("(^|\\.)"+lt.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,r.result=void 0,r.target||(r.target=h),o=o==null?[r]:l.makeArray(o,[r]),O=l.event.special[H]||{},!(!f&&O.trigger&&O.trigger.apply(h,o)===!1))){if(!f&&!O.noBubble&&!Y(h)){for(S=O.delegateType||H,th.test(S+H)||(m=m.parentNode);m;m=m.parentNode)L.push(m),g=m;g===(h.ownerDocument||z)&&L.push(g.defaultView||g.parentWindow||t)}for(d=0;(m=L[d++])&&!r.isPropagationStopped();)F=m,r.type=d>1?S:O.bindType||H,k=(Z.get(m,"events")||Object.create(null))[r.type]&&Z.get(m,"handle"),k&&k.apply(m,o),k=C&&m[C],k&&k.apply&&ki(m)&&(r.result=k.apply(m,o),r.result===!1&&r.preventDefault());return r.type=H,!f&&!r.isDefaultPrevented()&&(!O._default||O._default.apply(L.pop(),o)===!1)&&ki(h)&&C&&M(h[H])&&!Y(h)&&(g=h[C],g&&(h[C]=null),l.event.triggered=H,r.isPropagationStopped()&&F.addEventListener(H,eh),h[H](),r.isPropagationStopped()&&F.removeEventListener(H,eh),l.event.triggered=void 0,g&&(h[C]=g)),r.result}},simulate:function(r,o,h){var f=l.extend(new l.Event,h,{type:r,isSimulated:!0});l.event.trigger(f,null,o)}}),l.fn.extend({trigger:function(r,o){return this.each(function(){l.event.trigger(r,o,this)})},triggerHandler:function(r,o){var h=this[0];if(h)return l.event.trigger(r,o,h,!0)}});var kd=/\[\]$/,ih=/\r?\n/g,Dd=/^(?:submit|button|image|reset|file)$/i,Rd=/^(?:input|select|textarea|keygen)/i;function da(r,o,h,f){var d;if(Array.isArray(o))l.each(o,function(m,g){h||kd.test(r)?f(r,g):da(r+"["+(typeof g=="object"&&g!=null?m:"")+"]",g,h,f)});else if(!h&&Q(o)==="object")for(d in o)da(r+"["+d+"]",o[d],h,f);else f(r,o)}l.param=function(r,o){var h,f=[],d=function(m,g){var S=M(g)?g():g;f[f.length]=encodeURIComponent(m)+"="+encodeURIComponent(S??"")};if(r==null)return"";if(Array.isArray(r)||r.jquery&&!l.isPlainObject(r))l.each(r,function(){d(this.name,this.value)});else for(h in r)da(h,r[h],o,d);return f.join("&")},l.fn.extend({serialize:function(){return l.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var r=l.prop(this,"elements");return r?l.makeArray(r):this}).filter(function(){var r=this.type;return this.name&&!l(this).is(":disabled")&&Rd.test(this.nodeName)&&!Dd.test(r)&&(this.checked||!hr.test(r))}).map(function(r,o){var h=l(this).val();return h==null?null:Array.isArray(h)?l.map(h,function(f){return{name:o.name,value:f.replace(ih,`\r
`)}}):{name:o.name,value:h.replace(ih,`\r
`)}}).get()}});var Ld=/%20/g,Pd=/#.*$/,Id=/([?&])_=[^&]*/,Od=/^(.*?):[ \t]*([^\r\n]*)$/mg,Md=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Nd=/^(?:GET|HEAD)$/,Bd=/^\/\//,sh={},pa={},rh="*/".concat("*"),ma=z.createElement("a");ma.href=fr.href;function nh(r){return function(o,h){typeof o!="string"&&(h=o,o="*");var f,d=0,m=o.toLowerCase().match(Zt)||[];if(M(h))for(;f=m[d++];)f[0]==="+"?(f=f.slice(1)||"*",(r[f]=r[f]||[]).unshift(h)):(r[f]=r[f]||[]).push(h)}}function ah(r,o,h,f){var d={},m=r===pa;function g(S){var C;return d[S]=!0,l.each(r[S]||[],function(k,O){var F=O(o,h,f);if(typeof F=="string"&&!m&&!d[F])return o.dataTypes.unshift(F),g(F),!1;if(m)return!(C=F)}),C}return g(o.dataTypes[0])||!d["*"]&&g("*")}function ga(r,o){var h,f,d=l.ajaxSettings.flatOptions||{};for(h in o)o[h]!==void 0&&((d[h]?r:f||(f={}))[h]=o[h]);return f&&l.extend(!0,r,f),r}function Fd(r,o,h){for(var f,d,m,g,S=r.contents,C=r.dataTypes;C[0]==="*";)C.shift(),f===void 0&&(f=r.mimeType||o.getResponseHeader("Content-Type"));if(f){for(d in S)if(S[d]&&S[d].test(f)){C.unshift(d);break}}if(C[0]in h)m=C[0];else{for(d in h){if(!C[0]||r.converters[d+" "+C[0]]){m=d;break}g||(g=d)}m=m||g}if(m)return m!==C[0]&&C.unshift(m),h[m]}function Ud(r,o,h,f){var d,m,g,S,C,k={},O=r.dataTypes.slice();if(O[1])for(g in r.converters)k[g.toLowerCase()]=r.converters[g];for(m=O.shift();m;)if(r.responseFields[m]&&(h[r.responseFields[m]]=o),!C&&f&&r.dataFilter&&(o=r.dataFilter(o,r.dataType)),C=m,m=O.shift(),m){if(m==="*")m=C;else if(C!=="*"&&C!==m){if(g=k[C+" "+m]||k["* "+m],!g){for(d in k)if(S=d.split(" "),S[1]===m&&(g=k[C+" "+S[0]]||k["* "+S[0]],g)){g===!0?g=k[d]:k[d]!==!0&&(m=S[0],O.unshift(S[1]));break}}if(g!==!0)if(g&&r.throws)o=g(o);else try{o=g(o)}catch(F){return{state:"parsererror",error:g?F:"No conversion from "+C+" to "+m}}}}return{state:"success",data:o}}l.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fr.href,type:"GET",isLocal:Md.test(fr.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":rh,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":l.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(r,o){return o?ga(ga(r,l.ajaxSettings),o):ga(l.ajaxSettings,r)},ajaxPrefilter:nh(sh),ajaxTransport:nh(pa),ajax:function(r,o){typeof r=="object"&&(o=r,r=void 0),o=o||{};var h,f,d,m,g,S,C,k,O,F,L=l.ajaxSetup({},o),H=L.context||L,lt=L.context&&(H.nodeType||H.jquery)?l(H):l.event,vt=l.Deferred(),pt=l.Callbacks("once memory"),Xt=L.statusCode||{},Ut={},Xe={},Qe="canceled",yt={readyState:0,getResponseHeader:function(St){var It;if(C){if(!m)for(m={};It=Od.exec(d);)m[It[1].toLowerCase()+" "]=(m[It[1].toLowerCase()+" "]||[]).concat(It[2]);It=m[St.toLowerCase()+" "]}return It==null?null:It.join(", ")},getAllResponseHeaders:function(){return C?d:null},setRequestHeader:function(St,It){return C==null&&(St=Xe[St.toLowerCase()]=Xe[St.toLowerCase()]||St,Ut[St]=It),this},overrideMimeType:function(St){return C==null&&(L.mimeType=St),this},statusCode:function(St){var It;if(St)if(C)yt.always(St[yt.status]);else for(It in St)Xt[It]=[Xt[It],St[It]];return this},abort:function(St){var It=St||Qe;return h&&h.abort(It),ts(0,It),this}};if(vt.promise(yt),L.url=((r||L.url||fr.href)+"").replace(Bd,fr.protocol+"//"),L.type=o.method||o.type||L.method||L.type,L.dataTypes=(L.dataType||"*").toLowerCase().match(Zt)||[""],L.crossDomain==null){S=z.createElement("a");try{S.href=L.url,S.href=S.href,L.crossDomain=ma.protocol+"//"+ma.host!=S.protocol+"//"+S.host}catch{L.crossDomain=!0}}if(L.data&&L.processData&&typeof L.data!="string"&&(L.data=l.param(L.data,L.traditional)),ah(sh,L,o,yt),C)return yt;k=l.event&&L.global,k&&l.active++===0&&l.event.trigger("ajaxStart"),L.type=L.type.toUpperCase(),L.hasContent=!Nd.test(L.type),f=L.url.replace(Pd,""),L.hasContent?L.data&&L.processData&&(L.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(L.data=L.data.replace(Ld,"+")):(F=L.url.slice(f.length),L.data&&(L.processData||typeof L.data=="string")&&(f+=(fa.test(f)?"&":"?")+L.data,delete L.data),L.cache===!1&&(f=f.replace(Id,"$1"),F=(fa.test(f)?"&":"?")+"_="+Jc.guid+++F),L.url=f+F),L.ifModified&&(l.lastModified[f]&&yt.setRequestHeader("If-Modified-Since",l.lastModified[f]),l.etag[f]&&yt.setRequestHeader("If-None-Match",l.etag[f])),(L.data&&L.hasContent&&L.contentType!==!1||o.contentType)&&yt.setRequestHeader("Content-Type",L.contentType),yt.setRequestHeader("Accept",L.dataTypes[0]&&L.accepts[L.dataTypes[0]]?L.accepts[L.dataTypes[0]]+(L.dataTypes[0]!=="*"?", "+rh+"; q=0.01":""):L.accepts["*"]);for(O in L.headers)yt.setRequestHeader(O,L.headers[O]);if(L.beforeSend&&(L.beforeSend.call(H,yt,L)===!1||C))return yt.abort();if(Qe="abort",pt.add(L.complete),yt.done(L.success),yt.fail(L.error),h=ah(pa,L,o,yt),!h)ts(-1,"No Transport");else{if(yt.readyState=1,k&&lt.trigger("ajaxSend",[yt,L]),C)return yt;L.async&&L.timeout>0&&(g=t.setTimeout(function(){yt.abort("timeout")},L.timeout));try{C=!1,h.send(Ut,ts)}catch(St){if(C)throw St;ts(-1,St)}}function ts(St,It,pr,xa){var Ze,mr,Je,Di,Ri,Le=It;C||(C=!0,g&&t.clearTimeout(g),h=void 0,d=xa||"",yt.readyState=St>0?4:0,Ze=St>=200&&St<300||St===304,pr&&(Di=Fd(L,yt,pr)),!Ze&&l.inArray("script",L.dataTypes)>-1&&l.inArray("json",L.dataTypes)<0&&(L.converters["text script"]=function(){}),Di=Ud(L,Di,yt,Ze),Ze?(L.ifModified&&(Ri=yt.getResponseHeader("Last-Modified"),Ri&&(l.lastModified[f]=Ri),Ri=yt.getResponseHeader("etag"),Ri&&(l.etag[f]=Ri)),St===204||L.type==="HEAD"?Le="nocontent":St===304?Le="notmodified":(Le=Di.state,mr=Di.data,Je=Di.error,Ze=!Je)):(Je=Le,(St||!Le)&&(Le="error",St<0&&(St=0))),yt.status=St,yt.statusText=(It||Le)+"",Ze?vt.resolveWith(H,[mr,Le,yt]):vt.rejectWith(H,[yt,Le,Je]),yt.statusCode(Xt),Xt=void 0,k&&lt.trigger(Ze?"ajaxSuccess":"ajaxError",[yt,L,Ze?mr:Je]),pt.fireWith(H,[yt,Le]),k&&(lt.trigger("ajaxComplete",[yt,L]),--l.active||l.event.trigger("ajaxStop")))}return yt},getJSON:function(r,o,h){return l.get(r,o,h,"json")},getScript:function(r,o){return l.get(r,void 0,o,"script")}}),l.each(["get","post"],function(r,o){l[o]=function(h,f,d,m){return M(f)&&(m=m||d,d=f,f=void 0),l.ajax(l.extend({url:h,type:o,dataType:m,data:f,success:d},l.isPlainObject(h)&&h))}}),l.ajaxPrefilter(function(r){var o;for(o in r.headers)o.toLowerCase()==="content-type"&&(r.contentType=r.headers[o]||"")}),l._evalUrl=function(r,o,h){return l.ajax({url:r,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(f){l.globalEval(f,o,h)}})},l.fn.extend({wrapAll:function(r){var o;return this[0]&&(M(r)&&(r=r.call(this[0])),o=l(r,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&o.insertBefore(this[0]),o.map(function(){for(var h=this;h.firstElementChild;)h=h.firstElementChild;return h}).append(this)),this},wrapInner:function(r){return M(r)?this.each(function(o){l(this).wrapInner(r.call(this,o))}):this.each(function(){var o=l(this),h=o.contents();h.length?h.wrapAll(r):o.append(r)})},wrap:function(r){var o=M(r);return this.each(function(h){l(this).wrapAll(o?r.call(this,h):r)})},unwrap:function(r){return this.parent(r).not("body").each(function(){l(this).replaceWith(this.childNodes)}),this}}),l.expr.pseudos.hidden=function(r){return!l.expr.pseudos.visible(r)},l.expr.pseudos.visible=function(r){return!!(r.offsetWidth||r.offsetHeight||r.getClientRects().length)},l.ajaxSettings.xhr=function(){try{return new t.XMLHttpRequest}catch{}};var $d={0:200,1223:204},dr=l.ajaxSettings.xhr();v.cors=!!dr&&"withCredentials"in dr,v.ajax=dr=!!dr,l.ajaxTransport(function(r){var o,h;if(v.cors||dr&&!r.crossDomain)return{send:function(f,d){var m,g=r.xhr();if(g.open(r.type,r.url,r.async,r.username,r.password),r.xhrFields)for(m in r.xhrFields)g[m]=r.xhrFields[m];r.mimeType&&g.overrideMimeType&&g.overrideMimeType(r.mimeType),!r.crossDomain&&!f["X-Requested-With"]&&(f["X-Requested-With"]="XMLHttpRequest");for(m in f)g.setRequestHeader(m,f[m]);o=function(S){return function(){o&&(o=h=g.onload=g.onerror=g.onabort=g.ontimeout=g.onreadystatechange=null,S==="abort"?g.abort():S==="error"?typeof g.status!="number"?d(0,"error"):d(g.status,g.statusText):d($d[g.status]||g.status,g.statusText,(g.responseType||"text")!=="text"||typeof g.responseText!="string"?{binary:g.response}:{text:g.responseText},g.getAllResponseHeaders()))}},g.onload=o(),h=g.onerror=g.ontimeout=o("error"),g.onabort!==void 0?g.onabort=h:g.onreadystatechange=function(){g.readyState===4&&t.setTimeout(function(){o&&h()})},o=o("abort");try{g.send(r.hasContent&&r.data||null)}catch(S){if(o)throw S}},abort:function(){o&&o()}}}),l.ajaxPrefilter(function(r){r.crossDomain&&(r.contents.script=!1)}),l.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(r){return l.globalEval(r),r}}}),l.ajaxPrefilter("script",function(r){r.cache===void 0&&(r.cache=!1),r.crossDomain&&(r.type="GET")}),l.ajaxTransport("script",function(r){if(r.crossDomain||r.scriptAttrs){var o,h;return{send:function(f,d){o=l("<script>").attr(r.scriptAttrs||{}).prop({charset:r.scriptCharset,src:r.url}).on("load error",h=function(m){o.remove(),h=null,m&&d(m.type==="error"?404:200,m.type)}),z.head.appendChild(o[0])},abort:function(){h&&h()}}}});var oh=[],_a=/(=)\?(?=&|$)|\?\?/;l.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var r=oh.pop()||l.expando+"_"+Jc.guid++;return this[r]=!0,r}}),l.ajaxPrefilter("json jsonp",function(r,o,h){var f,d,m,g=r.jsonp!==!1&&(_a.test(r.url)?"url":typeof r.data=="string"&&(r.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&_a.test(r.data)&&"data");if(g||r.dataTypes[0]==="jsonp")return f=r.jsonpCallback=M(r.jsonpCallback)?r.jsonpCallback():r.jsonpCallback,g?r[g]=r[g].replace(_a,"$1"+f):r.jsonp!==!1&&(r.url+=(fa.test(r.url)?"&":"?")+r.jsonp+"="+f),r.converters["script json"]=function(){return m||l.error(f+" was not called"),m[0]},r.dataTypes[0]="json",d=t[f],t[f]=function(){m=arguments},h.always(function(){d===void 0?l(t).removeProp(f):t[f]=d,r[f]&&(r.jsonpCallback=o.jsonpCallback,oh.push(f)),m&&M(d)&&d(m[0]),m=d=void 0}),"script"}),v.createHTMLDocument=function(){var r=z.implementation.createHTMLDocument("").body;return r.innerHTML="<form></form><form></form>",r.childNodes.length===2}(),l.parseHTML=function(r,o,h){if(typeof r!="string")return[];typeof o=="boolean"&&(h=o,o=!1);var f,d,m;return o||(v.createHTMLDocument?(o=z.implementation.createHTMLDocument(""),f=o.createElement("base"),f.href=z.location.href,o.head.appendChild(f)):o=z),d=$e.exec(r),m=!h&&[],d?[o.createElement(d[1])]:(d=Bc([r],o,m),m&&m.length&&l(m).remove(),l.merge([],d.childNodes))},l.fn.load=function(r,o,h){var f,d,m,g=this,S=r.indexOf(" ");return S>-1&&(f=Zi(r.slice(S)),r=r.slice(0,S)),M(o)?(h=o,o=void 0):o&&typeof o=="object"&&(d="POST"),g.length>0&&l.ajax({url:r,type:d||"GET",dataType:"html",data:o}).done(function(C){m=arguments,g.html(f?l("<div>").append(l.parseHTML(C)).find(f):C)}).always(h&&function(C,k){g.each(function(){h.apply(this,m||[C.responseText,k,C])})}),this},l.expr.pseudos.animated=function(r){return l.grep(l.timers,function(o){return r===o.elem}).length},l.offset={setOffset:function(r,o,h){var f,d,m,g,S,C,k,O=l.css(r,"position"),F=l(r),L={};O==="static"&&(r.style.position="relative"),S=F.offset(),m=l.css(r,"top"),C=l.css(r,"left"),k=(O==="absolute"||O==="fixed")&&(m+C).indexOf("auto")>-1,k?(f=F.position(),g=f.top,d=f.left):(g=parseFloat(m)||0,d=parseFloat(C)||0),M(o)&&(o=o.call(r,h,l.extend({},S))),o.top!=null&&(L.top=o.top-S.top+g),o.left!=null&&(L.left=o.left-S.left+d),"using"in o?o.using.call(r,L):F.css(L)}},l.fn.extend({offset:function(r){if(arguments.length)return r===void 0?this:this.each(function(d){l.offset.setOffset(this,r,d)});var o,h,f=this[0];if(f)return f.getClientRects().length?(o=f.getBoundingClientRect(),h=f.ownerDocument.defaultView,{top:o.top+h.pageYOffset,left:o.left+h.pageXOffset}):{top:0,left:0}},position:function(){if(this[0]){var r,o,h,f=this[0],d={top:0,left:0};if(l.css(f,"position")==="fixed")o=f.getBoundingClientRect();else{for(o=this.offset(),h=f.ownerDocument,r=f.offsetParent||h.documentElement;r&&(r===h.body||r===h.documentElement)&&l.css(r,"position")==="static";)r=r.parentNode;r&&r!==f&&r.nodeType===1&&(d=l(r).offset(),d.top+=l.css(r,"borderTopWidth",!0),d.left+=l.css(r,"borderLeftWidth",!0))}return{top:o.top-d.top-l.css(f,"marginTop",!0),left:o.left-d.left-l.css(f,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var r=this.offsetParent;r&&l.css(r,"position")==="static";)r=r.offsetParent;return r||Qi})}}),l.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(r,o){var h=o==="pageYOffset";l.fn[r]=function(f){return Rt(this,function(d,m,g){var S;if(Y(d)?S=d:d.nodeType===9&&(S=d.defaultView),g===void 0)return S?S[o]:d[m];S?S.scrollTo(h?S.pageXOffset:g,h?g:S.pageYOffset):d[m]=g},r,f,arguments.length)}}),l.each(["top","left"],function(r,o){l.cssHooks[o]=Wc(v.pixelPosition,function(h,f){if(f)return f=ur(h,o),aa.test(f)?l(h).position()[o]+"px":f})}),l.each({Height:"height",Width:"width"},function(r,o){l.each({padding:"inner"+r,content:o,"":"outer"+r},function(h,f){l.fn[f]=function(d,m){var g=arguments.length&&(h||typeof d!="boolean"),S=h||(d===!0||m===!0?"margin":"border");return Rt(this,function(C,k,O){var F;return Y(C)?f.indexOf("outer")===0?C["inner"+r]:C.document.documentElement["client"+r]:C.nodeType===9?(F=C.documentElement,Math.max(C.body["scroll"+r],F["scroll"+r],C.body["offset"+r],F["offset"+r],F["client"+r])):O===void 0?l.css(C,k,S):l.style(C,k,O,S)},o,g?d:void 0,g)}})}),l.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(r,o){l.fn[o]=function(h){return this.on(o,h)}}),l.fn.extend({bind:function(r,o,h){return this.on(r,null,o,h)},unbind:function(r,o){return this.off(r,null,o)},delegate:function(r,o,h,f){return this.on(o,r,h,f)},undelegate:function(r,o,h){return arguments.length===1?this.off(r,"**"):this.off(o,r||"**",h)},hover:function(r,o){return this.on("mouseenter",r).on("mouseleave",o||r)}}),l.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(r,o){l.fn[o]=function(h,f){return arguments.length>0?this.on(o,null,h,f):this.trigger(o)}});var Hd=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;l.proxy=function(r,o){var h,f,d;if(typeof o=="string"&&(h=r[o],o=r,r=h),!!M(r))return f=a.call(arguments,2),d=function(){return r.apply(o||this,f.concat(a.call(arguments)))},d.guid=r.guid=r.guid||l.guid++,d},l.holdReady=function(r){r?l.readyWait++:l.ready(!0)},l.isArray=Array.isArray,l.parseJSON=JSON.parse,l.nodeName=j,l.isFunction=M,l.isWindow=Y,l.camelCase=Se,l.type=Q,l.now=Date.now,l.isNumeric=function(r){var o=l.type(r);return(o==="number"||o==="string")&&!isNaN(r-parseFloat(r))},l.trim=function(r){return r==null?"":(r+"").replace(Hd,"$1")};var zd=t.jQuery,Wd=t.$;return l.noConflict=function(r){return t.$===l&&(t.$=Wd),r&&t.jQuery===l&&(t.jQuery=zd),l},typeof e>"u"&&(t.jQuery=t.$=l),l})}(Dn)),Dn.exports}var tp=Jd();const U=Qd(tp);var sl="1.13.7",fh=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},qn=Array.prototype,No=Object.prototype,dh=typeof Symbol<"u"?Symbol.prototype:null,ep=qn.push,$r=qn.slice,Lr=No.toString,ip=No.hasOwnProperty,rl=typeof ArrayBuffer<"u",sp=typeof DataView<"u",rp=Array.isArray,ph=Object.keys,mh=Object.create,gh=rl&&ArrayBuffer.isView,np=isNaN,ap=isFinite,nl=!{toString:null}.propertyIsEnumerable("toString"),_h=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],op=Math.pow(2,53)-1;function _e(i,t){return t=t==null?i.length-1:+t,function(){for(var e=Math.max(arguments.length-t,0),s=Array(e),n=0;n<e;n++)s[n]=arguments[n+t];switch(t){case 0:return i.call(this,s);case 1:return i.call(this,arguments[0],s);case 2:return i.call(this,arguments[0],arguments[1],s)}var a=Array(t+1);for(n=0;n<t;n++)a[n]=arguments[n];return a[t]=s,i.apply(this,a)}}function bs(i){var t=typeof i;return t==="function"||t==="object"&&!!i}function cp(i){return i===null}function al(i){return i===void 0}function ol(i){return i===!0||i===!1||Lr.call(i)==="[object Boolean]"}function hp(i){return!!(i&&i.nodeType===1)}function se(i){var t="[object "+i+"]";return function(e){return Lr.call(e)===t}}const Bo=se("String"),cl=se("Number"),up=se("Date"),lp=se("RegExp"),fp=se("Error"),hl=se("Symbol"),ul=se("ArrayBuffer");var ll=se("Function"),dp=fh.document&&fh.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof dp!="function"&&(ll=function(i){return typeof i=="function"||!1});const le=ll,fl=se("Object");var dl=sp&&(!/\[native code\]/.test(String(DataView))||fl(new DataView(new ArrayBuffer(8)))),Fo=typeof Map<"u"&&fl(new Map),pp=se("DataView");function mp(i){return i!=null&&le(i.getInt8)&&ul(i.buffer)}const Nn=dl?mp:pp,ys=rp||se("Array");function Gi(i,t){return i!=null&&ip.call(i,t)}var ao=se("Arguments");(function(){ao(arguments)||(ao=function(i){return Gi(i,"callee")})})();const Uo=ao;function gp(i){return!hl(i)&&ap(i)&&!isNaN(parseFloat(i))}function pl(i){return cl(i)&&np(i)}function ml(i){return function(){return i}}function gl(i){return function(t){var e=i(t);return typeof e=="number"&&e>=0&&e<=op}}function _l(i){return function(t){return t==null?void 0:t[i]}}const Bn=_l("byteLength"),_p=gl(Bn);var xp=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function bp(i){return gh?gh(i)&&!Nn(i):_p(i)&&xp.test(Lr.call(i))}const xl=rl?bp:ml(!1),xe=_l("length");function yp(i){for(var t={},e=i.length,s=0;s<e;++s)t[i[s]]=!0;return{contains:function(n){return t[n]===!0},push:function(n){return t[n]=!0,i.push(n)}}}function bl(i,t){t=yp(t);var e=_h.length,s=i.constructor,n=le(s)&&s.prototype||No,a="constructor";for(Gi(i,a)&&!t.contains(a)&&t.push(a);e--;)a=_h[e],a in i&&i[a]!==n[a]&&!t.contains(a)&&t.push(a)}function qt(i){if(!bs(i))return[];if(ph)return ph(i);var t=[];for(var e in i)Gi(i,e)&&t.push(e);return nl&&bl(i,t),t}function Cp(i){if(i==null)return!0;var t=xe(i);return typeof t=="number"&&(ys(i)||Bo(i)||Uo(i))?t===0:xe(qt(i))===0}function yl(i,t){var e=qt(t),s=e.length;if(i==null)return!s;for(var n=Object(i),a=0;a<s;a++){var c=e[a];if(t[c]!==n[c]||!(c in n))return!1}return!0}function wt(i){if(i instanceof wt)return i;if(!(this instanceof wt))return new wt(i);this._wrapped=i}wt.VERSION=sl;wt.prototype.value=function(){return this._wrapped};wt.prototype.valueOf=wt.prototype.toJSON=wt.prototype.value;wt.prototype.toString=function(){return String(this._wrapped)};function xh(i){return new Uint8Array(i.buffer||i,i.byteOffset||0,Bn(i))}var bh="[object DataView]";function oo(i,t,e,s){if(i===t)return i!==0||1/i===1/t;if(i==null||t==null)return!1;if(i!==i)return t!==t;var n=typeof i;return n!=="function"&&n!=="object"&&typeof t!="object"?!1:Cl(i,t,e,s)}function Cl(i,t,e,s){i instanceof wt&&(i=i._wrapped),t instanceof wt&&(t=t._wrapped);var n=Lr.call(i);if(n!==Lr.call(t))return!1;if(dl&&n=="[object Object]"&&Nn(i)){if(!Nn(t))return!1;n=bh}switch(n){case"[object RegExp]":case"[object String]":return""+i==""+t;case"[object Number]":return+i!=+i?+t!=+t:+i==0?1/+i===1/t:+i==+t;case"[object Date]":case"[object Boolean]":return+i==+t;case"[object Symbol]":return dh.valueOf.call(i)===dh.valueOf.call(t);case"[object ArrayBuffer]":case bh:return Cl(xh(i),xh(t),e,s)}var a=n==="[object Array]";if(!a&&xl(i)){var c=Bn(i);if(c!==Bn(t))return!1;if(i.buffer===t.buffer&&i.byteOffset===t.byteOffset)return!0;a=!0}if(!a){if(typeof i!="object"||typeof t!="object")return!1;var u=i.constructor,p=t.constructor;if(u!==p&&!(le(u)&&u instanceof u&&le(p)&&p instanceof p)&&"constructor"in i&&"constructor"in t)return!1}e=e||[],s=s||[];for(var x=e.length;x--;)if(e[x]===i)return s[x]===t;if(e.push(i),s.push(t),a){if(x=i.length,x!==t.length)return!1;for(;x--;)if(!oo(i[x],t[x],e,s))return!1}else{var _=qt(i),y;if(x=_.length,qt(t).length!==x)return!1;for(;x--;)if(y=_[x],!(Gi(t,y)&&oo(i[y],t[y],e,s)))return!1}return e.pop(),s.pop(),!0}function vp(i,t){return oo(i,t)}function Hr(i){if(!bs(i))return[];var t=[];for(var e in i)t.push(e);return nl&&bl(i,t),t}function $o(i){var t=xe(i);return function(e){if(e==null)return!1;var s=Hr(e);if(xe(s))return!1;for(var n=0;n<t;n++)if(!le(e[i[n]]))return!1;return i!==El||!le(e[Ho])}}var Ho="forEach",vl="has",zo=["clear","delete"],Sl=["get",vl,"set"],Sp=zo.concat(Ho,Sl),El=zo.concat(Sl),Ep=["add"].concat(zo,Ho,vl);const Ap=Fo?$o(Sp):se("Map"),wp=Fo?$o(El):se("WeakMap"),Tp=Fo?$o(Ep):se("Set"),kp=se("WeakSet");function Js(i){for(var t=qt(i),e=t.length,s=Array(e),n=0;n<e;n++)s[n]=i[t[n]];return s}function Dp(i){for(var t=qt(i),e=t.length,s=Array(e),n=0;n<e;n++)s[n]=[t[n],i[t[n]]];return s}function Al(i){for(var t={},e=qt(i),s=0,n=e.length;s<n;s++)t[i[e[s]]]=e[s];return t}function co(i){var t=[];for(var e in i)le(i[e])&&t.push(e);return t.sort()}function Wo(i,t){return function(e){var s=arguments.length;if(t&&(e=Object(e)),s<2||e==null)return e;for(var n=1;n<s;n++)for(var a=arguments[n],c=i(a),u=c.length,p=0;p<u;p++){var x=c[p];(!t||e[x]===void 0)&&(e[x]=a[x])}return e}}const wl=Wo(Hr),Fn=Wo(qt),Tl=Wo(Hr,!0);function Rp(){return function(){}}function kl(i){if(!bs(i))return{};if(mh)return mh(i);var t=Rp();t.prototype=i;var e=new t;return t.prototype=null,e}function Lp(i,t){var e=kl(i);return t&&Fn(e,t),e}function Pp(i){return bs(i)?ys(i)?i.slice():wl({},i):i}function Ip(i,t){return t(i),i}function Dl(i){return ys(i)?i:[i]}wt.toPath=Dl;function zr(i){return wt.toPath(i)}function Go(i,t){for(var e=t.length,s=0;s<e;s++){if(i==null)return;i=i[t[s]]}return e?i:void 0}function Rl(i,t,e){var s=Go(i,zr(t));return al(s)?e:s}function Op(i,t){t=zr(t);for(var e=t.length,s=0;s<e;s++){var n=t[s];if(!Gi(i,n))return!1;i=i[n]}return!!e}function Vo(i){return i}function Pr(i){return i=Fn({},i),function(t){return yl(t,i)}}function Ko(i){return i=zr(i),function(t){return Go(t,i)}}function Wr(i,t,e){if(t===void 0)return i;switch(e??3){case 1:return function(s){return i.call(t,s)};case 3:return function(s,n,a){return i.call(t,s,n,a)};case 4:return function(s,n,a,c){return i.call(t,s,n,a,c)}}return function(){return i.apply(t,arguments)}}function Ll(i,t,e){return i==null?Vo:le(i)?Wr(i,t,e):bs(i)&&!ys(i)?Pr(i):Ko(i)}function qo(i,t){return Ll(i,t,1/0)}wt.iteratee=qo;function ye(i,t,e){return wt.iteratee!==qo?wt.iteratee(i,t):Ll(i,t,e)}function Mp(i,t,e){t=ye(t,e);for(var s=qt(i),n=s.length,a={},c=0;c<n;c++){var u=s[c];a[u]=t(i[u],u,i)}return a}function Pl(){}function Np(i){return i==null?Pl:function(t){return Rl(i,t)}}function Bp(i,t,e){var s=Array(Math.max(0,i));t=Wr(t,e,1);for(var n=0;n<i;n++)s[n]=t(n);return s}function ho(i,t){return t==null&&(t=i,i=0),i+Math.floor(Math.random()*(t-i+1))}const Ir=Date.now||function(){return new Date().getTime()};function Il(i){var t=function(a){return i[a]},e="(?:"+qt(i).join("|")+")",s=RegExp(e),n=RegExp(e,"g");return function(a){return a=a==null?"":""+a,s.test(a)?a.replace(n,t):a}}const Ol={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Fp=Il(Ol),Up=Al(Ol),$p=Il(Up),Hp=wt.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Aa=/(.)^/,zp={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Wp=/\\|'|\r|\n|\u2028|\u2029/g;function Gp(i){return"\\"+zp[i]}var Vp=/^\s*(\w|\$)+\s*$/;function Kp(i,t,e){!t&&e&&(t=e),t=Tl({},t,wt.templateSettings);var s=RegExp([(t.escape||Aa).source,(t.interpolate||Aa).source,(t.evaluate||Aa).source].join("|")+"|$","g"),n=0,a="__p+='";i.replace(s,function(x,_,y,T,D){return a+=i.slice(n,D).replace(Wp,Gp),n=D+x.length,_?a+=`'+
((__t=(`+_+`))==null?'':_.escape(__t))+
'`:y?a+=`'+
((__t=(`+y+`))==null?'':__t)+
'`:T&&(a+=`';
`+T+`
__p+='`),x}),a+=`';
`;var c=t.variable;if(c){if(!Vp.test(c))throw new Error("variable is not a bare identifier: "+c)}else a=`with(obj||{}){
`+a+`}
`,c="obj";a=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+a+`return __p;
`;var u;try{u=new Function(c,"_",a)}catch(x){throw x.source=a,x}var p=function(x){return u.call(this,x,wt)};return p.source="function("+c+`){
`+a+"}",p}function qp(i,t,e){t=zr(t);var s=t.length;if(!s)return le(e)?e.call(i):e;for(var n=0;n<s;n++){var a=i==null?void 0:i[t[n]];a===void 0&&(a=e,n=s),i=le(a)?a.call(i):a}return i}var jp=0;function Yp(i){var t=++jp+"";return i?i+t:t}function Xp(i){var t=wt(i);return t._chain=!0,t}function Ml(i,t,e,s,n){if(!(s instanceof t))return i.apply(e,n);var a=kl(i.prototype),c=i.apply(a,n);return bs(c)?c:a}var tr=_e(function(i,t){var e=tr.placeholder,s=function(){for(var n=0,a=t.length,c=Array(a),u=0;u<a;u++)c[u]=t[u]===e?arguments[n++]:t[u];for(;n<arguments.length;)c.push(arguments[n++]);return Ml(i,s,this,this,c)};return s});tr.placeholder=wt;const Nl=_e(function(i,t,e){if(!le(i))throw new TypeError("Bind must be called on a function");var s=_e(function(n){return Ml(i,s,t,this,e.concat(n))});return s}),Te=gl(xe);function Cs(i,t,e,s){if(s=s||[],!t&&t!==0)t=1/0;else if(t<=0)return s.concat(i);for(var n=s.length,a=0,c=xe(i);a<c;a++){var u=i[a];if(Te(u)&&(ys(u)||Uo(u)))if(t>1)Cs(u,t-1,e,s),n=s.length;else for(var p=0,x=u.length;p<x;)s[n++]=u[p++];else e||(s[n++]=u)}return s}const Qp=_e(function(i,t){t=Cs(t,!1,!1);var e=t.length;if(e<1)throw new Error("bindAll must be passed function names");for(;e--;){var s=t[e];i[s]=Nl(i[s],i)}return i});function Zp(i,t){var e=function(s){var n=e.cache,a=""+(t?t.apply(this,arguments):s);return Gi(n,a)||(n[a]=i.apply(this,arguments)),n[a]};return e.cache={},e}const Bl=_e(function(i,t,e){return setTimeout(function(){return i.apply(null,e)},t)}),Jp=tr(Bl,wt,1);function tm(i,t,e){var s,n,a,c,u=0;e||(e={});var p=function(){u=e.leading===!1?0:Ir(),s=null,c=i.apply(n,a),s||(n=a=null)},x=function(){var _=Ir();!u&&e.leading===!1&&(u=_);var y=t-(_-u);return n=this,a=arguments,y<=0||y>t?(s&&(clearTimeout(s),s=null),u=_,c=i.apply(n,a),s||(n=a=null)):!s&&e.trailing!==!1&&(s=setTimeout(p,y)),c};return x.cancel=function(){clearTimeout(s),u=0,s=n=a=null},x}function em(i,t,e){var s,n,a,c,u,p=function(){var _=Ir()-n;t>_?s=setTimeout(p,t-_):(s=null,e||(c=i.apply(u,a)),s||(a=u=null))},x=_e(function(_){return u=this,a=_,n=Ir(),s||(s=setTimeout(p,t),e&&(c=i.apply(u,a))),c});return x.cancel=function(){clearTimeout(s),s=a=u=null},x}function im(i,t){return tr(t,i)}function jo(i){return function(){return!i.apply(this,arguments)}}function sm(){var i=arguments,t=i.length-1;return function(){for(var e=t,s=i[t].apply(this,arguments);e--;)s=i[e].call(this,s);return s}}function rm(i,t){return function(){if(--i<1)return t.apply(this,arguments)}}function Fl(i,t){var e;return function(){return--i>0&&(e=t.apply(this,arguments)),i<=1&&(t=null),e}}const nm=tr(Fl,2);function Ul(i,t,e){t=ye(t,e);for(var s=qt(i),n,a=0,c=s.length;a<c;a++)if(n=s[a],t(i[n],n,i))return n}function $l(i){return function(t,e,s){e=ye(e,s);for(var n=xe(t),a=i>0?0:n-1;a>=0&&a<n;a+=i)if(e(t[a],a,t))return a;return-1}}const Yo=$l(1),Hl=$l(-1);function zl(i,t,e,s){e=ye(e,s,1);for(var n=e(t),a=0,c=xe(i);a<c;){var u=Math.floor((a+c)/2);e(i[u])<n?a=u+1:c=u}return a}function Wl(i,t,e){return function(s,n,a){var c=0,u=xe(s);if(typeof a=="number")i>0?c=a>=0?a:Math.max(a+u,c):u=a>=0?Math.min(a+1,u):a+u+1;else if(e&&a&&u)return a=e(s,n),s[a]===n?a:-1;if(n!==n)return a=t($r.call(s,c,u),pl),a>=0?a+c:-1;for(a=i>0?c:u-1;a>=0&&a<u;a+=i)if(s[a]===n)return a;return-1}}const Gl=Wl(1,Yo,zl),am=Wl(-1,Hl);function uo(i,t,e){var s=Te(i)?Yo:Ul,n=s(i,t,e);if(n!==void 0&&n!==-1)return i[n]}function om(i,t){return uo(i,Pr(t))}function yi(i,t,e){t=Wr(t,e);var s,n;if(Te(i))for(s=0,n=i.length;s<n;s++)t(i[s],s,i);else{var a=qt(i);for(s=0,n=a.length;s<n;s++)t(i[a[s]],a[s],i)}return i}function ps(i,t,e){t=ye(t,e);for(var s=!Te(i)&&qt(i),n=(s||i).length,a=Array(n),c=0;c<n;c++){var u=s?s[c]:c;a[c]=t(i[u],u,i)}return a}function Vl(i){var t=function(e,s,n,a){var c=!Te(e)&&qt(e),u=(c||e).length,p=i>0?0:u-1;for(a||(n=e[c?c[p]:p],p+=i);p>=0&&p<u;p+=i){var x=c?c[p]:p;n=s(n,e[x],x,e)}return n};return function(e,s,n,a){var c=arguments.length>=3;return t(e,Wr(s,a,4),n,c)}}const wa=Vl(1),yh=Vl(-1);function Ks(i,t,e){var s=[];return t=ye(t,e),yi(i,function(n,a,c){t(n,a,c)&&s.push(n)}),s}function cm(i,t,e){return Ks(i,jo(ye(t)),e)}function Ch(i,t,e){t=ye(t,e);for(var s=!Te(i)&&qt(i),n=(s||i).length,a=0;a<n;a++){var c=s?s[a]:a;if(!t(i[c],c,i))return!1}return!0}function vh(i,t,e){t=ye(t,e);for(var s=!Te(i)&&qt(i),n=(s||i).length,a=0;a<n;a++){var c=s?s[a]:a;if(t(i[c],c,i))return!0}return!1}function gi(i,t,e,s){return Te(i)||(i=Js(i)),(typeof e!="number"||s)&&(e=0),Gl(i,t,e)>=0}const hm=_e(function(i,t,e){var s,n;return le(t)?n=t:(t=zr(t),s=t.slice(0,-1),t=t[t.length-1]),ps(i,function(a){var c=n;if(!c){if(s&&s.length&&(a=Go(a,s)),a==null)return;c=a[t]}return c==null?c:c.apply(a,e)})});function Xo(i,t){return ps(i,Ko(t))}function um(i,t){return Ks(i,Pr(t))}function Kl(i,t,e){var s=-1/0,n=-1/0,a,c;if(t==null||typeof t=="number"&&typeof i[0]!="object"&&i!=null){i=Te(i)?i:Js(i);for(var u=0,p=i.length;u<p;u++)a=i[u],a!=null&&a>s&&(s=a)}else t=ye(t,e),yi(i,function(x,_,y){c=t(x,_,y),(c>n||c===-1/0&&s===-1/0)&&(s=x,n=c)});return s}function lm(i,t,e){var s=1/0,n=1/0,a,c;if(t==null||typeof t=="number"&&typeof i[0]!="object"&&i!=null){i=Te(i)?i:Js(i);for(var u=0,p=i.length;u<p;u++)a=i[u],a!=null&&a<s&&(s=a)}else t=ye(t,e),yi(i,function(x,_,y){c=t(x,_,y),(c<n||c===1/0&&s===1/0)&&(s=x,n=c)});return s}var fm=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function ql(i){return i?ys(i)?$r.call(i):Bo(i)?i.match(fm):Te(i)?ps(i,Vo):Js(i):[]}function jl(i,t,e){if(t==null||e)return Te(i)||(i=Js(i)),i[ho(i.length-1)];var s=ql(i),n=xe(s);t=Math.max(Math.min(t,n),0);for(var a=n-1,c=0;c<t;c++){var u=ho(c,a),p=s[c];s[c]=s[u],s[u]=p}return s.slice(0,t)}function dm(i){return jl(i,1/0)}function pm(i,t,e){var s=0;return t=ye(t,e),Xo(ps(i,function(n,a,c){return{value:n,index:s++,criteria:t(n,a,c)}}).sort(function(n,a){var c=n.criteria,u=a.criteria;if(c!==u){if(c>u||c===void 0)return 1;if(c<u||u===void 0)return-1}return n.index-a.index}),"value")}function jn(i,t){return function(e,s,n){var a=t?[[],[]]:{};return s=ye(s,n),yi(e,function(c,u){var p=s(c,u,e);i(a,c,p)}),a}}const mm=jn(function(i,t,e){Gi(i,e)?i[e].push(t):i[e]=[t]}),gm=jn(function(i,t,e){i[e]=t}),_m=jn(function(i,t,e){Gi(i,e)?i[e]++:i[e]=1}),xm=jn(function(i,t,e){i[e?0:1].push(t)},!0);function bm(i){return i==null?0:Te(i)?i.length:qt(i).length}function ym(i,t,e){return t in e}const Yl=_e(function(i,t){var e={},s=t[0];if(i==null)return e;le(s)?(t.length>1&&(s=Wr(s,t[1])),t=Hr(i)):(s=ym,t=Cs(t,!1,!1),i=Object(i));for(var n=0,a=t.length;n<a;n++){var c=t[n],u=i[c];s(u,c,i)&&(e[c]=u)}return e}),Cm=_e(function(i,t){var e=t[0],s;return le(e)?(e=jo(e),t.length>1&&(s=t[1])):(t=ps(Cs(t,!1,!1),String),e=function(n,a){return!gi(t,a)}),Yl(i,e,s)});function Xl(i,t,e){return $r.call(i,0,Math.max(0,i.length-(t==null||e?1:t)))}function Ta(i,t,e){return i==null||i.length<1?t==null||e?void 0:[]:t==null||e?i[0]:Xl(i,i.length-t)}function Rn(i,t,e){return $r.call(i,t==null||e?1:t)}function vm(i,t,e){return i==null||i.length<1?t==null||e?void 0:[]:t==null||e?i[i.length-1]:Rn(i,Math.max(0,i.length-t))}function Sm(i){return Ks(i,Boolean)}function Em(i,t){return Cs(i,t,!1)}const Ql=_e(function(i,t){return t=Cs(t,!0,!0),Ks(i,function(e){return!gi(t,e)})}),Am=_e(function(i,t){return Ql(i,t)});function lo(i,t,e,s){ol(t)||(s=e,e=t,t=!1),e!=null&&(e=ye(e,s));for(var n=[],a=[],c=0,u=xe(i);c<u;c++){var p=i[c],x=e?e(p,c,i):p;t&&!e?((!c||a!==x)&&n.push(p),a=x):e?gi(a,x)||(a.push(x),n.push(p)):gi(n,p)||n.push(p)}return n}const wm=_e(function(i){return lo(Cs(i,!0,!0))});function Tm(i){for(var t=[],e=arguments.length,s=0,n=xe(i);s<n;s++){var a=i[s];if(!gi(t,a)){var c;for(c=1;c<e&&gi(arguments[c],a);c++);c===e&&t.push(a)}}return t}function fo(i){for(var t=i&&Kl(i,xe).length||0,e=Array(t),s=0;s<t;s++)e[s]=Xo(i,s);return e}const km=_e(fo);function Dm(i,t){for(var e={},s=0,n=xe(i);s<n;s++)t?e[i[s]]=t[s]:e[i[s][0]]=i[s][1];return e}function Rm(i,t,e){t==null&&(t=i||0,i=0),e||(e=t<i?-1:1);for(var s=Math.max(Math.ceil((t-i)/e),0),n=Array(s),a=0;a<s;a++,i+=e)n[a]=i;return n}function Lm(i,t){if(t==null||t<1)return[];for(var e=[],s=0,n=i.length;s<n;)e.push($r.call(i,s,s+=t));return e}function Qo(i,t){return i._chain?wt(t).chain():t}function Zl(i){return yi(co(i),function(t){var e=wt[t]=i[t];wt.prototype[t]=function(){var s=[this._wrapped];return ep.apply(s,arguments),Qo(this,e.apply(wt,s))}}),wt}yi(["pop","push","reverse","shift","sort","splice","unshift"],function(i){var t=qn[i];wt.prototype[i]=function(){var e=this._wrapped;return e!=null&&(t.apply(e,arguments),(i==="shift"||i==="splice")&&e.length===0&&delete e[0]),Qo(this,e)}});yi(["concat","join","slice"],function(i){var t=qn[i];wt.prototype[i]=function(){var e=this._wrapped;return e!=null&&(e=t.apply(e,arguments)),Qo(this,e)}});const Pm=Object.freeze(Object.defineProperty({__proto__:null,VERSION:sl,after:rm,all:Ch,allKeys:Hr,any:vh,assign:Fn,before:Fl,bind:Nl,bindAll:Qp,chain:Xp,chunk:Lm,clone:Pp,collect:ps,compact:Sm,compose:sm,constant:ml,contains:gi,countBy:_m,create:Lp,debounce:em,default:wt,defaults:Tl,defer:Jp,delay:Bl,detect:uo,difference:Ql,drop:Rn,each:yi,escape:Fp,every:Ch,extend:wl,extendOwn:Fn,filter:Ks,find:uo,findIndex:Yo,findKey:Ul,findLastIndex:Hl,findWhere:om,first:Ta,flatten:Em,foldl:wa,foldr:yh,forEach:yi,functions:co,get:Rl,groupBy:mm,has:Op,head:Ta,identity:Vo,include:gi,includes:gi,indexBy:gm,indexOf:Gl,initial:Xl,inject:wa,intersection:Tm,invert:Al,invoke:hm,isArguments:Uo,isArray:ys,isArrayBuffer:ul,isBoolean:ol,isDataView:Nn,isDate:up,isElement:hp,isEmpty:Cp,isEqual:vp,isError:fp,isFinite:gp,isFunction:le,isMap:Ap,isMatch:yl,isNaN:pl,isNull:cp,isNumber:cl,isObject:bs,isRegExp:lp,isSet:Tp,isString:Bo,isSymbol:hl,isTypedArray:xl,isUndefined:al,isWeakMap:wp,isWeakSet:kp,iteratee:qo,keys:qt,last:vm,lastIndexOf:am,map:ps,mapObject:Mp,matcher:Pr,matches:Pr,max:Kl,memoize:Zp,methods:co,min:lm,mixin:Zl,negate:jo,noop:Pl,now:Ir,object:Dm,omit:Cm,once:nm,pairs:Dp,partial:tr,partition:xm,pick:Yl,pluck:Xo,property:Ko,propertyOf:Np,random:ho,range:Rm,reduce:wa,reduceRight:yh,reject:cm,rest:Rn,restArguments:_e,result:qp,sample:jl,select:Ks,shuffle:dm,size:bm,some:vh,sortBy:pm,sortedIndex:zl,tail:Rn,take:Ta,tap:Ip,template:Kp,templateSettings:Hp,throttle:tm,times:Bp,toArray:ql,toPath:Dl,transpose:fo,unescape:$p,union:wm,uniq:lo,unique:lo,uniqueId:Yp,unzip:fo,values:Js,where:um,without:Am,wrap:im,zip:km},Symbol.toStringTag,{value:"Module"}));var ce=Zl(Pm);ce._=ce;var he="top",Ee="bottom",Ae="right",ue="left",Yn="auto",er=[he,Ee,Ae,ue],ms="start",qs="end",Jl="clippingParents",Zo="viewport",Fs="popper",t0="reference",po=er.reduce(function(i,t){return i.concat([t+"-"+ms,t+"-"+qs])},[]),Jo=[].concat(er,[Yn]).reduce(function(i,t){return i.concat([t,t+"-"+ms,t+"-"+qs])},[]),e0="beforeRead",i0="read",s0="afterRead",r0="beforeMain",n0="main",a0="afterMain",o0="beforeWrite",c0="write",h0="afterWrite",u0=[e0,i0,s0,r0,n0,a0,o0,c0,h0];function ri(i){return i?(i.nodeName||"").toLowerCase():null}function we(i){if(i==null)return window;if(i.toString()!=="[object Window]"){var t=i.ownerDocument;return t&&t.defaultView||window}return i}function gs(i){var t=we(i).Element;return i instanceof t||i instanceof Element}function Me(i){var t=we(i).HTMLElement;return i instanceof t||i instanceof HTMLElement}function tc(i){if(typeof ShadowRoot>"u")return!1;var t=we(i).ShadowRoot;return i instanceof t||i instanceof ShadowRoot}function Im(i){var t=i.state;Object.keys(t.elements).forEach(function(e){var s=t.styles[e]||{},n=t.attributes[e]||{},a=t.elements[e];!Me(a)||!ri(a)||(Object.assign(a.style,s),Object.keys(n).forEach(function(c){var u=n[c];u===!1?a.removeAttribute(c):a.setAttribute(c,u===!0?"":u)}))})}function Om(i){var t=i.state,e={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,e.popper),t.styles=e,t.elements.arrow&&Object.assign(t.elements.arrow.style,e.arrow),function(){Object.keys(t.elements).forEach(function(s){var n=t.elements[s],a=t.attributes[s]||{},c=Object.keys(t.styles.hasOwnProperty(s)?t.styles[s]:e[s]),u=c.reduce(function(p,x){return p[x]="",p},{});!Me(n)||!ri(n)||(Object.assign(n.style,u),Object.keys(a).forEach(function(p){n.removeAttribute(p)}))})}}const ec={name:"applyStyles",enabled:!0,phase:"write",fn:Im,effect:Om,requires:["computeStyles"]};function ii(i){return i.split("-")[0]}var ds=Math.max,Un=Math.min,js=Math.round;function mo(){var i=navigator.userAgentData;return i!=null&&i.brands&&Array.isArray(i.brands)?i.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function l0(){return!/^((?!chrome|android).)*safari/i.test(mo())}function Ys(i,t,e){t===void 0&&(t=!1),e===void 0&&(e=!1);var s=i.getBoundingClientRect(),n=1,a=1;t&&Me(i)&&(n=i.offsetWidth>0&&js(s.width)/i.offsetWidth||1,a=i.offsetHeight>0&&js(s.height)/i.offsetHeight||1);var c=gs(i)?we(i):window,u=c.visualViewport,p=!l0()&&e,x=(s.left+(p&&u?u.offsetLeft:0))/n,_=(s.top+(p&&u?u.offsetTop:0))/a,y=s.width/n,T=s.height/a;return{width:y,height:T,top:_,right:x+y,bottom:_+T,left:x,x,y:_}}function ic(i){var t=Ys(i),e=i.offsetWidth,s=i.offsetHeight;return Math.abs(t.width-e)<=1&&(e=t.width),Math.abs(t.height-s)<=1&&(s=t.height),{x:i.offsetLeft,y:i.offsetTop,width:e,height:s}}function f0(i,t){var e=t.getRootNode&&t.getRootNode();if(i.contains(t))return!0;if(e&&tc(e)){var s=t;do{if(s&&i.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function Ci(i){return we(i).getComputedStyle(i)}function Mm(i){return["table","td","th"].indexOf(ri(i))>=0}function Vi(i){return((gs(i)?i.ownerDocument:i.document)||window.document).documentElement}function Xn(i){return ri(i)==="html"?i:i.assignedSlot||i.parentNode||(tc(i)?i.host:null)||Vi(i)}function Sh(i){return!Me(i)||Ci(i).position==="fixed"?null:i.offsetParent}function Nm(i){var t=/firefox/i.test(mo()),e=/Trident/i.test(mo());if(e&&Me(i)){var s=Ci(i);if(s.position==="fixed")return null}var n=Xn(i);for(tc(n)&&(n=n.host);Me(n)&&["html","body"].indexOf(ri(n))<0;){var a=Ci(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||t&&a.willChange==="filter"||t&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function Gr(i){for(var t=we(i),e=Sh(i);e&&Mm(e)&&Ci(e).position==="static";)e=Sh(e);return e&&(ri(e)==="html"||ri(e)==="body"&&Ci(e).position==="static")?t:e||Nm(i)||t}function sc(i){return["top","bottom"].indexOf(i)>=0?"x":"y"}function Tr(i,t,e){return ds(i,Un(t,e))}function Bm(i,t,e){var s=Tr(i,t,e);return s>e?e:s}function d0(){return{top:0,right:0,bottom:0,left:0}}function p0(i){return Object.assign({},d0(),i)}function m0(i,t){return t.reduce(function(e,s){return e[s]=i,e},{})}var Fm=function(t,e){return t=typeof t=="function"?t(Object.assign({},e.rects,{placement:e.placement})):t,p0(typeof t!="number"?t:m0(t,er))};function Um(i){var t,e=i.state,s=i.name,n=i.options,a=e.elements.arrow,c=e.modifiersData.popperOffsets,u=ii(e.placement),p=sc(u),x=[ue,Ae].indexOf(u)>=0,_=x?"height":"width";if(!(!a||!c)){var y=Fm(n.padding,e),T=ic(a),D=p==="y"?he:ue,v=p==="y"?Ee:Ae,M=e.rects.reference[_]+e.rects.reference[p]-c[p]-e.rects.popper[_],Y=c[p]-e.rects.reference[p],z=Gr(a),at=z?p==="y"?z.clientHeight||0:z.clientWidth||0:0,mt=M/2-Y/2,Q=y[D],ct=at-T[_]-y[v],gt=at/2-T[_]/2+mt,l=Tr(Q,gt,ct),X=p;e.modifiersData[s]=(t={},t[X]=l,t.centerOffset=l-gt,t)}}function $m(i){var t=i.state,e=i.options,s=e.element,n=s===void 0?"[data-popper-arrow]":s;n!=null&&(typeof n=="string"&&(n=t.elements.popper.querySelector(n),!n)||f0(t.elements.popper,n)&&(t.elements.arrow=n))}const g0={name:"arrow",enabled:!0,phase:"main",fn:Um,effect:$m,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Xs(i){return i.split("-")[1]}var Hm={top:"auto",right:"auto",bottom:"auto",left:"auto"};function zm(i,t){var e=i.x,s=i.y,n=t.devicePixelRatio||1;return{x:js(e*n)/n||0,y:js(s*n)/n||0}}function Eh(i){var t,e=i.popper,s=i.popperRect,n=i.placement,a=i.variation,c=i.offsets,u=i.position,p=i.gpuAcceleration,x=i.adaptive,_=i.roundOffsets,y=i.isFixed,T=c.x,D=T===void 0?0:T,v=c.y,M=v===void 0?0:v,Y=typeof _=="function"?_({x:D,y:M}):{x:D,y:M};D=Y.x,M=Y.y;var z=c.hasOwnProperty("x"),at=c.hasOwnProperty("y"),mt=ue,Q=he,ct=window;if(x){var gt=Gr(e),l="clientHeight",X="clientWidth";if(gt===we(e)&&(gt=Vi(e),Ci(gt).position!=="static"&&u==="absolute"&&(l="scrollHeight",X="scrollWidth")),gt=gt,n===he||(n===ue||n===Ae)&&a===qs){Q=Ee;var j=y&&gt===ct&&ct.visualViewport?ct.visualViewport.height:gt[l];M-=j-s.height,M*=p?1:-1}if(n===ue||(n===he||n===Ee)&&a===qs){mt=Ae;var ut=y&&gt===ct&&ct.visualViewport?ct.visualViewport.width:gt[X];D-=ut-s.width,D*=p?1:-1}}var it=Object.assign({position:u},x&&Hm),Pt=_===!0?zm({x:D,y:M},we(e)):{x:D,y:M};if(D=Pt.x,M=Pt.y,p){var tt;return Object.assign({},it,(tt={},tt[Q]=at?"0":"",tt[mt]=z?"0":"",tt.transform=(ct.devicePixelRatio||1)<=1?"translate("+D+"px, "+M+"px)":"translate3d("+D+"px, "+M+"px, 0)",tt))}return Object.assign({},it,(t={},t[Q]=at?M+"px":"",t[mt]=z?D+"px":"",t.transform="",t))}function Wm(i){var t=i.state,e=i.options,s=e.gpuAcceleration,n=s===void 0?!0:s,a=e.adaptive,c=a===void 0?!0:a,u=e.roundOffsets,p=u===void 0?!0:u,x={placement:ii(t.placement),variation:Xs(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:n,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Eh(Object.assign({},x,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:c,roundOffsets:p})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Eh(Object.assign({},x,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:p})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const rc={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Wm,data:{}};var un={passive:!0};function Gm(i){var t=i.state,e=i.instance,s=i.options,n=s.scroll,a=n===void 0?!0:n,c=s.resize,u=c===void 0?!0:c,p=we(t.elements.popper),x=[].concat(t.scrollParents.reference,t.scrollParents.popper);return a&&x.forEach(function(_){_.addEventListener("scroll",e.update,un)}),u&&p.addEventListener("resize",e.update,un),function(){a&&x.forEach(function(_){_.removeEventListener("scroll",e.update,un)}),u&&p.removeEventListener("resize",e.update,un)}}const nc={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Gm,data:{}};var Vm={left:"right",right:"left",bottom:"top",top:"bottom"};function Ln(i){return i.replace(/left|right|bottom|top/g,function(t){return Vm[t]})}var Km={start:"end",end:"start"};function Ah(i){return i.replace(/start|end/g,function(t){return Km[t]})}function ac(i){var t=we(i),e=t.pageXOffset,s=t.pageYOffset;return{scrollLeft:e,scrollTop:s}}function oc(i){return Ys(Vi(i)).left+ac(i).scrollLeft}function qm(i,t){var e=we(i),s=Vi(i),n=e.visualViewport,a=s.clientWidth,c=s.clientHeight,u=0,p=0;if(n){a=n.width,c=n.height;var x=l0();(x||!x&&t==="fixed")&&(u=n.offsetLeft,p=n.offsetTop)}return{width:a,height:c,x:u+oc(i),y:p}}function jm(i){var t,e=Vi(i),s=ac(i),n=(t=i.ownerDocument)==null?void 0:t.body,a=ds(e.scrollWidth,e.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),c=ds(e.scrollHeight,e.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),u=-s.scrollLeft+oc(i),p=-s.scrollTop;return Ci(n||e).direction==="rtl"&&(u+=ds(e.clientWidth,n?n.clientWidth:0)-a),{width:a,height:c,x:u,y:p}}function cc(i){var t=Ci(i),e=t.overflow,s=t.overflowX,n=t.overflowY;return/auto|scroll|overlay|hidden/.test(e+n+s)}function _0(i){return["html","body","#document"].indexOf(ri(i))>=0?i.ownerDocument.body:Me(i)&&cc(i)?i:_0(Xn(i))}function kr(i,t){var e;t===void 0&&(t=[]);var s=_0(i),n=s===((e=i.ownerDocument)==null?void 0:e.body),a=we(s),c=n?[a].concat(a.visualViewport||[],cc(s)?s:[]):s,u=t.concat(c);return n?u:u.concat(kr(Xn(c)))}function go(i){return Object.assign({},i,{left:i.x,top:i.y,right:i.x+i.width,bottom:i.y+i.height})}function Ym(i,t){var e=Ys(i,!1,t==="fixed");return e.top=e.top+i.clientTop,e.left=e.left+i.clientLeft,e.bottom=e.top+i.clientHeight,e.right=e.left+i.clientWidth,e.width=i.clientWidth,e.height=i.clientHeight,e.x=e.left,e.y=e.top,e}function wh(i,t,e){return t===Zo?go(qm(i,e)):gs(t)?Ym(t,e):go(jm(Vi(i)))}function Xm(i){var t=kr(Xn(i)),e=["absolute","fixed"].indexOf(Ci(i).position)>=0,s=e&&Me(i)?Gr(i):i;return gs(s)?t.filter(function(n){return gs(n)&&f0(n,s)&&ri(n)!=="body"}):[]}function Qm(i,t,e,s){var n=t==="clippingParents"?Xm(i):[].concat(t),a=[].concat(n,[e]),c=a[0],u=a.reduce(function(p,x){var _=wh(i,x,s);return p.top=ds(_.top,p.top),p.right=Un(_.right,p.right),p.bottom=Un(_.bottom,p.bottom),p.left=ds(_.left,p.left),p},wh(i,c,s));return u.width=u.right-u.left,u.height=u.bottom-u.top,u.x=u.left,u.y=u.top,u}function x0(i){var t=i.reference,e=i.element,s=i.placement,n=s?ii(s):null,a=s?Xs(s):null,c=t.x+t.width/2-e.width/2,u=t.y+t.height/2-e.height/2,p;switch(n){case he:p={x:c,y:t.y-e.height};break;case Ee:p={x:c,y:t.y+t.height};break;case Ae:p={x:t.x+t.width,y:u};break;case ue:p={x:t.x-e.width,y:u};break;default:p={x:t.x,y:t.y}}var x=n?sc(n):null;if(x!=null){var _=x==="y"?"height":"width";switch(a){case ms:p[x]=p[x]-(t[_]/2-e[_]/2);break;case qs:p[x]=p[x]+(t[_]/2-e[_]/2);break}}return p}function Qs(i,t){t===void 0&&(t={});var e=t,s=e.placement,n=s===void 0?i.placement:s,a=e.strategy,c=a===void 0?i.strategy:a,u=e.boundary,p=u===void 0?Jl:u,x=e.rootBoundary,_=x===void 0?Zo:x,y=e.elementContext,T=y===void 0?Fs:y,D=e.altBoundary,v=D===void 0?!1:D,M=e.padding,Y=M===void 0?0:M,z=p0(typeof Y!="number"?Y:m0(Y,er)),at=T===Fs?t0:Fs,mt=i.rects.popper,Q=i.elements[v?at:T],ct=Qm(gs(Q)?Q:Q.contextElement||Vi(i.elements.popper),p,_,c),gt=Ys(i.elements.reference),l=x0({reference:gt,element:mt,placement:n}),X=go(Object.assign({},mt,l)),j=T===Fs?X:gt,ut={top:ct.top-j.top+z.top,bottom:j.bottom-ct.bottom+z.bottom,left:ct.left-j.left+z.left,right:j.right-ct.right+z.right},it=i.modifiersData.offset;if(T===Fs&&it){var Pt=it[n];Object.keys(ut).forEach(function(tt){var bt=[Ae,Ee].indexOf(tt)>=0?1:-1,Qt=[he,Ee].indexOf(tt)>=0?"y":"x";ut[tt]+=Pt[Qt]*bt})}return ut}function Zm(i,t){t===void 0&&(t={});var e=t,s=e.placement,n=e.boundary,a=e.rootBoundary,c=e.padding,u=e.flipVariations,p=e.allowedAutoPlacements,x=p===void 0?Jo:p,_=Xs(s),y=_?u?po:po.filter(function(v){return Xs(v)===_}):er,T=y.filter(function(v){return x.indexOf(v)>=0});T.length===0&&(T=y);var D=T.reduce(function(v,M){return v[M]=Qs(i,{placement:M,boundary:n,rootBoundary:a,padding:c})[ii(M)],v},{});return Object.keys(D).sort(function(v,M){return D[v]-D[M]})}function Jm(i){if(ii(i)===Yn)return[];var t=Ln(i);return[Ah(i),t,Ah(t)]}function tg(i){var t=i.state,e=i.options,s=i.name;if(!t.modifiersData[s]._skip){for(var n=e.mainAxis,a=n===void 0?!0:n,c=e.altAxis,u=c===void 0?!0:c,p=e.fallbackPlacements,x=e.padding,_=e.boundary,y=e.rootBoundary,T=e.altBoundary,D=e.flipVariations,v=D===void 0?!0:D,M=e.allowedAutoPlacements,Y=t.options.placement,z=ii(Y),at=z===Y,mt=p||(at||!v?[Ln(Y)]:Jm(Y)),Q=[Y].concat(mt).reduce(function(ke,re){return ke.concat(ii(re)===Yn?Zm(t,{placement:re,boundary:_,rootBoundary:y,padding:x,flipVariations:v,allowedAutoPlacements:M}):re)},[]),ct=t.rects.reference,gt=t.rects.popper,l=new Map,X=!0,j=Q[0],ut=0;ut<Q.length;ut++){var it=Q[ut],Pt=ii(it),tt=Xs(it)===ms,bt=[he,Ee].indexOf(Pt)>=0,Qt=bt?"width":"height",Ft=Qs(t,{placement:it,boundary:_,rootBoundary:y,altBoundary:T,padding:x}),Lt=bt?tt?Ae:ue:tt?Ee:he;ct[Qt]>gt[Qt]&&(Lt=Ln(Lt));var Ce=Ln(Lt),Ht=[];if(a&&Ht.push(Ft[Pt]<=0),u&&Ht.push(Ft[Lt]<=0,Ft[Ce]<=0),Ht.every(function(ke){return ke})){j=it,X=!1;break}l.set(it,Ht)}if(X)for(var Ye=v?3:1,ai=function(re){var oi=Q.find(function(Ei){var He=l.get(Ei);if(He)return He.slice(0,re).every(function(Ai){return Ai})});if(oi)return j=oi,"break"},$e=Ye;$e>0;$e--){var jt=ai($e);if(jt==="break")break}t.placement!==j&&(t.modifiersData[s]._skip=!0,t.placement=j,t.reset=!0)}}const b0={name:"flip",enabled:!0,phase:"main",fn:tg,requiresIfExists:["offset"],data:{_skip:!1}};function Th(i,t,e){return e===void 0&&(e={x:0,y:0}),{top:i.top-t.height-e.y,right:i.right-t.width+e.x,bottom:i.bottom-t.height+e.y,left:i.left-t.width-e.x}}function kh(i){return[he,Ae,Ee,ue].some(function(t){return i[t]>=0})}function eg(i){var t=i.state,e=i.name,s=t.rects.reference,n=t.rects.popper,a=t.modifiersData.preventOverflow,c=Qs(t,{elementContext:"reference"}),u=Qs(t,{altBoundary:!0}),p=Th(c,s),x=Th(u,n,a),_=kh(p),y=kh(x);t.modifiersData[e]={referenceClippingOffsets:p,popperEscapeOffsets:x,isReferenceHidden:_,hasPopperEscaped:y},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":_,"data-popper-escaped":y})}const y0={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:eg};function ig(i,t,e){var s=ii(i),n=[ue,he].indexOf(s)>=0?-1:1,a=typeof e=="function"?e(Object.assign({},t,{placement:i})):e,c=a[0],u=a[1];return c=c||0,u=(u||0)*n,[ue,Ae].indexOf(s)>=0?{x:u,y:c}:{x:c,y:u}}function sg(i){var t=i.state,e=i.options,s=i.name,n=e.offset,a=n===void 0?[0,0]:n,c=Jo.reduce(function(_,y){return _[y]=ig(y,t.rects,a),_},{}),u=c[t.placement],p=u.x,x=u.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=p,t.modifiersData.popperOffsets.y+=x),t.modifiersData[s]=c}const C0={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:sg};function rg(i){var t=i.state,e=i.name;t.modifiersData[e]=x0({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const hc={name:"popperOffsets",enabled:!0,phase:"read",fn:rg,data:{}};function ng(i){return i==="x"?"y":"x"}function ag(i){var t=i.state,e=i.options,s=i.name,n=e.mainAxis,a=n===void 0?!0:n,c=e.altAxis,u=c===void 0?!1:c,p=e.boundary,x=e.rootBoundary,_=e.altBoundary,y=e.padding,T=e.tether,D=T===void 0?!0:T,v=e.tetherOffset,M=v===void 0?0:v,Y=Qs(t,{boundary:p,rootBoundary:x,padding:y,altBoundary:_}),z=ii(t.placement),at=Xs(t.placement),mt=!at,Q=sc(z),ct=ng(Q),gt=t.modifiersData.popperOffsets,l=t.rects.reference,X=t.rects.popper,j=typeof M=="function"?M(Object.assign({},t.rects,{placement:t.placement})):M,ut=typeof j=="number"?{mainAxis:j,altAxis:j}:Object.assign({mainAxis:0,altAxis:0},j),it=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,Pt={x:0,y:0};if(gt){if(a){var tt,bt=Q==="y"?he:ue,Qt=Q==="y"?Ee:Ae,Ft=Q==="y"?"height":"width",Lt=gt[Q],Ce=Lt+Y[bt],Ht=Lt-Y[Qt],Ye=D?-X[Ft]/2:0,ai=at===ms?l[Ft]:X[Ft],$e=at===ms?-X[Ft]:-l[Ft],jt=t.elements.arrow,ke=D&&jt?ic(jt):{width:0,height:0},re=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:d0(),oi=re[bt],Ei=re[Qt],He=Tr(0,l[Ft],ke[Ft]),Ai=mt?l[Ft]/2-Ye-He-oi-ut.mainAxis:ai-He-oi-ut.mainAxis,Zt=mt?-l[Ft]/2+Ye+He+Ei+ut.mainAxis:$e+He+Ei+ut.mainAxis,Yi=t.elements.arrow&&Gr(t.elements.arrow),De=Yi?Q==="y"?Yi.clientTop||0:Yi.clientLeft||0:0,ci=(tt=it==null?void 0:it[Q])!=null?tt:0,wi=Lt+Ai-ci-De,Xi=Lt+Zt-ci,Ti=Tr(D?Un(Ce,wi):Ce,Lt,D?ds(Ht,Xi):Ht);gt[Q]=Ti,Pt[Q]=Ti-Lt}if(u){var ze,Rt=Q==="x"?he:ue,fe=Q==="x"?Ee:Ae,zt=gt[ct],ve=ct==="y"?"height":"width",Se=zt+Y[Rt],ki=zt-Y[fe],hi=[he,ue].indexOf(z)!==-1,Z=(ze=it==null?void 0:it[ct])!=null?ze:0,Yt=hi?Se:zt-l[ve]-X[ve]-Z+ut.altAxis,Zr=hi?zt+l[ve]+X[ve]-Z-ut.altAxis:ki,Jr=D&&hi?Bm(Yt,zt,Zr):Tr(D?Yt:Se,zt,D?Zr:ki);gt[ct]=Jr,Pt[ct]=Jr-zt}t.modifiersData[s]=Pt}}const v0={name:"preventOverflow",enabled:!0,phase:"main",fn:ag,requiresIfExists:["offset"]};function og(i){return{scrollLeft:i.scrollLeft,scrollTop:i.scrollTop}}function cg(i){return i===we(i)||!Me(i)?ac(i):og(i)}function hg(i){var t=i.getBoundingClientRect(),e=js(t.width)/i.offsetWidth||1,s=js(t.height)/i.offsetHeight||1;return e!==1||s!==1}function ug(i,t,e){e===void 0&&(e=!1);var s=Me(t),n=Me(t)&&hg(t),a=Vi(t),c=Ys(i,n,e),u={scrollLeft:0,scrollTop:0},p={x:0,y:0};return(s||!s&&!e)&&((ri(t)!=="body"||cc(a))&&(u=cg(t)),Me(t)?(p=Ys(t,!0),p.x+=t.clientLeft,p.y+=t.clientTop):a&&(p.x=oc(a))),{x:c.left+u.scrollLeft-p.x,y:c.top+u.scrollTop-p.y,width:c.width,height:c.height}}function lg(i){var t=new Map,e=new Set,s=[];i.forEach(function(a){t.set(a.name,a)});function n(a){e.add(a.name);var c=[].concat(a.requires||[],a.requiresIfExists||[]);c.forEach(function(u){if(!e.has(u)){var p=t.get(u);p&&n(p)}}),s.push(a)}return i.forEach(function(a){e.has(a.name)||n(a)}),s}function fg(i){var t=lg(i);return u0.reduce(function(e,s){return e.concat(t.filter(function(n){return n.phase===s}))},[])}function dg(i){var t;return function(){return t||(t=new Promise(function(e){Promise.resolve().then(function(){t=void 0,e(i())})})),t}}function pg(i){var t=i.reduce(function(e,s){var n=e[s.name];return e[s.name]=n?Object.assign({},n,s,{options:Object.assign({},n.options,s.options),data:Object.assign({},n.data,s.data)}):s,e},{});return Object.keys(t).map(function(e){return t[e]})}var Dh={placement:"bottom",modifiers:[],strategy:"absolute"};function Rh(){for(var i=arguments.length,t=new Array(i),e=0;e<i;e++)t[e]=arguments[e];return!t.some(function(s){return!(s&&typeof s.getBoundingClientRect=="function")})}function Qn(i){i===void 0&&(i={});var t=i,e=t.defaultModifiers,s=e===void 0?[]:e,n=t.defaultOptions,a=n===void 0?Dh:n;return function(u,p,x){x===void 0&&(x=a);var _={placement:"bottom",orderedModifiers:[],options:Object.assign({},Dh,a),modifiersData:{},elements:{reference:u,popper:p},attributes:{},styles:{}},y=[],T=!1,D={state:_,setOptions:function(z){var at=typeof z=="function"?z(_.options):z;M(),_.options=Object.assign({},a,_.options,at),_.scrollParents={reference:gs(u)?kr(u):u.contextElement?kr(u.contextElement):[],popper:kr(p)};var mt=fg(pg([].concat(s,_.options.modifiers)));return _.orderedModifiers=mt.filter(function(Q){return Q.enabled}),v(),D.update()},forceUpdate:function(){if(!T){var z=_.elements,at=z.reference,mt=z.popper;if(Rh(at,mt)){_.rects={reference:ug(at,Gr(mt),_.options.strategy==="fixed"),popper:ic(mt)},_.reset=!1,_.placement=_.options.placement,_.orderedModifiers.forEach(function(ut){return _.modifiersData[ut.name]=Object.assign({},ut.data)});for(var Q=0;Q<_.orderedModifiers.length;Q++){if(_.reset===!0){_.reset=!1,Q=-1;continue}var ct=_.orderedModifiers[Q],gt=ct.fn,l=ct.options,X=l===void 0?{}:l,j=ct.name;typeof gt=="function"&&(_=gt({state:_,options:X,name:j,instance:D})||_)}}}},update:dg(function(){return new Promise(function(Y){D.forceUpdate(),Y(_)})}),destroy:function(){M(),T=!0}};if(!Rh(u,p))return D;D.setOptions(x).then(function(Y){!T&&x.onFirstUpdate&&x.onFirstUpdate(Y)});function v(){_.orderedModifiers.forEach(function(Y){var z=Y.name,at=Y.options,mt=at===void 0?{}:at,Q=Y.effect;if(typeof Q=="function"){var ct=Q({state:_,name:z,instance:D,options:mt}),gt=function(){};y.push(ct||gt)}})}function M(){y.forEach(function(Y){return Y()}),y=[]}return D}}var mg=Qn(),gg=[nc,hc,rc,ec],_g=Qn({defaultModifiers:gg}),xg=[nc,hc,rc,ec,C0,b0,v0,g0,y0],uc=Qn({defaultModifiers:xg});const S0=Object.freeze(Object.defineProperty({__proto__:null,afterMain:a0,afterRead:s0,afterWrite:h0,applyStyles:ec,arrow:g0,auto:Yn,basePlacements:er,beforeMain:r0,beforeRead:e0,beforeWrite:o0,bottom:Ee,clippingParents:Jl,computeStyles:rc,createPopper:uc,createPopperBase:mg,createPopperLite:_g,detectOverflow:Qs,end:qs,eventListeners:nc,flip:b0,hide:y0,left:ue,main:n0,modifierPhases:u0,offset:C0,placements:Jo,popper:Fs,popperGenerator:Qn,popperOffsets:hc,preventOverflow:v0,read:i0,reference:t0,right:Ae,start:ms,top:he,variationPlacements:po,viewport:Zo,write:c0},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const Pi=new Map,ka={set(i,t,e){Pi.has(i)||Pi.set(i,new Map);const s=Pi.get(i);if(!s.has(t)&&s.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(s.keys())[0]}.`);return}s.set(t,e)},get(i,t){return Pi.has(i)&&Pi.get(i).get(t)||null},remove(i,t){if(!Pi.has(i))return;const e=Pi.get(i);e.delete(t),e.size===0&&Pi.delete(i)}},bg=1e6,yg=1e3,_o="transitionend",E0=i=>(i&&window.CSS&&window.CSS.escape&&(i=i.replace(/#([^\s"#']+)/g,(t,e)=>`#${CSS.escape(e)}`)),i),Cg=i=>i==null?`${i}`:Object.prototype.toString.call(i).match(/\s([a-z]+)/i)[1].toLowerCase(),vg=i=>{do i+=Math.floor(Math.random()*bg);while(document.getElementById(i));return i},Sg=i=>{if(!i)return 0;let{transitionDuration:t,transitionDelay:e}=window.getComputedStyle(i);const s=Number.parseFloat(t),n=Number.parseFloat(e);return!s&&!n?0:(t=t.split(",")[0],e=e.split(",")[0],(Number.parseFloat(t)+Number.parseFloat(e))*yg)},A0=i=>{i.dispatchEvent(new Event(_o))},_i=i=>!i||typeof i!="object"?!1:(typeof i.jquery<"u"&&(i=i[0]),typeof i.nodeType<"u"),Hi=i=>_i(i)?i.jquery?i[0]:i:typeof i=="string"&&i.length>0?document.querySelector(E0(i)):null,ir=i=>{if(!_i(i)||i.getClientRects().length===0)return!1;const t=getComputedStyle(i).getPropertyValue("visibility")==="visible",e=i.closest("details:not([open])");if(!e)return t;if(e!==i){const s=i.closest("summary");if(s&&s.parentNode!==e||s===null)return!1}return t},zi=i=>!i||i.nodeType!==Node.ELEMENT_NODE||i.classList.contains("disabled")?!0:typeof i.disabled<"u"?i.disabled:i.hasAttribute("disabled")&&i.getAttribute("disabled")!=="false",w0=i=>{if(!document.documentElement.attachShadow)return null;if(typeof i.getRootNode=="function"){const t=i.getRootNode();return t instanceof ShadowRoot?t:null}return i instanceof ShadowRoot?i:i.parentNode?w0(i.parentNode):null},$n=()=>{},Vr=i=>{i.offsetHeight},T0=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Da=[],Eg=i=>{document.readyState==="loading"?(Da.length||document.addEventListener("DOMContentLoaded",()=>{for(const t of Da)t()}),Da.push(i)):i()},Ne=()=>document.documentElement.dir==="rtl",Ue=i=>{Eg(()=>{const t=T0();if(t){const e=i.NAME,s=t.fn[e];t.fn[e]=i.jQueryInterface,t.fn[e].Constructor=i,t.fn[e].noConflict=()=>(t.fn[e]=s,i.jQueryInterface)}})},ge=(i,t=[],e=i)=>typeof i=="function"?i(...t):e,k0=(i,t,e=!0)=>{if(!e){ge(i);return}const n=Sg(t)+5;let a=!1;const c=({target:u})=>{u===t&&(a=!0,t.removeEventListener(_o,c),ge(i))};t.addEventListener(_o,c),setTimeout(()=>{a||A0(t)},n)},lc=(i,t,e,s)=>{const n=i.length;let a=i.indexOf(t);return a===-1?!e&&s?i[n-1]:i[0]:(a+=e?1:-1,s&&(a=(a+n)%n),i[Math.max(0,Math.min(a,n-1))])},Ag=/[^.]*(?=\..*)\.|.*/,wg=/\..*/,Tg=/::\d+$/,Ra={};let Lh=1;const D0={mouseenter:"mouseover",mouseleave:"mouseout"},kg=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function R0(i,t){return t&&`${t}::${Lh++}`||i.uidEvent||Lh++}function L0(i){const t=R0(i);return i.uidEvent=t,Ra[t]=Ra[t]||{},Ra[t]}function Dg(i,t){return function e(s){return fc(s,{delegateTarget:i}),e.oneOff&&$.off(i,s.type,t),t.apply(i,[s])}}function Rg(i,t,e){return function s(n){const a=i.querySelectorAll(t);for(let{target:c}=n;c&&c!==this;c=c.parentNode)for(const u of a)if(u===c)return fc(n,{delegateTarget:c}),s.oneOff&&$.off(i,n.type,t,e),e.apply(c,[n])}}function P0(i,t,e=null){return Object.values(i).find(s=>s.callable===t&&s.delegationSelector===e)}function I0(i,t,e){const s=typeof t=="string",n=s?e:t||e;let a=O0(i);return kg.has(a)||(a=i),[s,n,a]}function Ph(i,t,e,s,n){if(typeof t!="string"||!i)return;let[a,c,u]=I0(t,e,s);t in D0&&(c=(v=>function(M){if(!M.relatedTarget||M.relatedTarget!==M.delegateTarget&&!M.delegateTarget.contains(M.relatedTarget))return v.call(this,M)})(c));const p=L0(i),x=p[u]||(p[u]={}),_=P0(x,c,a?e:null);if(_){_.oneOff=_.oneOff&&n;return}const y=R0(c,t.replace(Ag,"")),T=a?Rg(i,e,c):Dg(i,c);T.delegationSelector=a?e:null,T.callable=c,T.oneOff=n,T.uidEvent=y,x[y]=T,i.addEventListener(u,T,a)}function xo(i,t,e,s,n){const a=P0(t[e],s,n);a&&(i.removeEventListener(e,a,!!n),delete t[e][a.uidEvent])}function Lg(i,t,e,s){const n=t[e]||{};for(const[a,c]of Object.entries(n))a.includes(s)&&xo(i,t,e,c.callable,c.delegationSelector)}function O0(i){return i=i.replace(wg,""),D0[i]||i}const $={on(i,t,e,s){Ph(i,t,e,s,!1)},one(i,t,e,s){Ph(i,t,e,s,!0)},off(i,t,e,s){if(typeof t!="string"||!i)return;const[n,a,c]=I0(t,e,s),u=c!==t,p=L0(i),x=p[c]||{},_=t.startsWith(".");if(typeof a<"u"){if(!Object.keys(x).length)return;xo(i,p,c,a,n?e:null);return}if(_)for(const y of Object.keys(p))Lg(i,p,y,t.slice(1));for(const[y,T]of Object.entries(x)){const D=y.replace(Tg,"");(!u||t.includes(D))&&xo(i,p,c,T.callable,T.delegationSelector)}},trigger(i,t,e){if(typeof t!="string"||!i)return null;const s=T0(),n=O0(t),a=t!==n;let c=null,u=!0,p=!0,x=!1;a&&s&&(c=s.Event(t,e),s(i).trigger(c),u=!c.isPropagationStopped(),p=!c.isImmediatePropagationStopped(),x=c.isDefaultPrevented());const _=fc(new Event(t,{bubbles:u,cancelable:!0}),e);return x&&_.preventDefault(),p&&i.dispatchEvent(_),_.defaultPrevented&&c&&c.preventDefault(),_}};function fc(i,t={}){for(const[e,s]of Object.entries(t))try{i[e]=s}catch{Object.defineProperty(i,e,{configurable:!0,get(){return s}})}return i}function Ih(i){if(i==="true")return!0;if(i==="false")return!1;if(i===Number(i).toString())return Number(i);if(i===""||i==="null")return null;if(typeof i!="string")return i;try{return JSON.parse(decodeURIComponent(i))}catch{return i}}function La(i){return i.replace(/[A-Z]/g,t=>`-${t.toLowerCase()}`)}const xi={setDataAttribute(i,t,e){i.setAttribute(`data-bs-${La(t)}`,e)},removeDataAttribute(i,t){i.removeAttribute(`data-bs-${La(t)}`)},getDataAttributes(i){if(!i)return{};const t={},e=Object.keys(i.dataset).filter(s=>s.startsWith("bs")&&!s.startsWith("bsConfig"));for(const s of e){let n=s.replace(/^bs/,"");n=n.charAt(0).toLowerCase()+n.slice(1,n.length),t[n]=Ih(i.dataset[s])}return t},getDataAttribute(i,t){return Ih(i.getAttribute(`data-bs-${La(t)}`))}};let Kr=class{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const s=_i(e)?xi.getDataAttribute(e,"config"):{};return{...this.constructor.Default,...typeof s=="object"?s:{},..._i(e)?xi.getDataAttributes(e):{},...typeof t=="object"?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[s,n]of Object.entries(e)){const a=t[s],c=_i(a)?"element":Cg(a);if(!new RegExp(n).test(c))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${s}" provided type "${c}" but expected type "${n}".`)}}};const Pg="5.3.3";class je extends Kr{constructor(t,e){super(),t=Hi(t),t&&(this._element=t,this._config=this._getConfig(e),ka.set(this._element,this.constructor.DATA_KEY,this))}dispose(){ka.remove(this._element,this.constructor.DATA_KEY),$.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,s=!0){k0(t,e,s)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return ka.get(Hi(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,typeof e=="object"?e:null)}static get VERSION(){return Pg}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const Pa=i=>{let t=i.getAttribute("data-bs-target");if(!t||t==="#"){let e=i.getAttribute("href");if(!e||!e.includes("#")&&!e.startsWith("."))return null;e.includes("#")&&!e.startsWith("#")&&(e=`#${e.split("#")[1]}`),t=e&&e!=="#"?e.trim():null}return t?t.split(",").map(e=>E0(e)).join(","):null},rt={find(i,t=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(t,i))},findOne(i,t=document.documentElement){return Element.prototype.querySelector.call(t,i)},children(i,t){return[].concat(...i.children).filter(e=>e.matches(t))},parents(i,t){const e=[];let s=i.parentNode.closest(t);for(;s;)e.push(s),s=s.parentNode.closest(t);return e},prev(i,t){let e=i.previousElementSibling;for(;e;){if(e.matches(t))return[e];e=e.previousElementSibling}return[]},next(i,t){let e=i.nextElementSibling;for(;e;){if(e.matches(t))return[e];e=e.nextElementSibling}return[]},focusableChildren(i){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(e=>`${e}:not([tabindex^="-"])`).join(",");return this.find(t,i).filter(e=>!zi(e)&&ir(e))},getSelectorFromElement(i){const t=Pa(i);return t&&rt.findOne(t)?t:null},getElementFromSelector(i){const t=Pa(i);return t?rt.findOne(t):null},getMultipleElementsFromSelector(i){const t=Pa(i);return t?rt.find(t):[]}},Zn=(i,t="hide")=>{const e=`click.dismiss${i.EVENT_KEY}`,s=i.NAME;$.on(document,e,`[data-bs-dismiss="${s}"]`,function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),zi(this))return;const a=rt.getElementFromSelector(this)||this.closest(`.${s}`);i.getOrCreateInstance(a)[t]()})},Ig="alert",Og="bs.alert",M0=`.${Og}`,Mg=`close${M0}`,Ng=`closed${M0}`,Bg="fade",Fg="show";class Jn extends je{static get NAME(){return Ig}close(){if($.trigger(this._element,Mg).defaultPrevented)return;this._element.classList.remove(Fg);const e=this._element.classList.contains(Bg);this._queueCallback(()=>this._destroyElement(),this._element,e)}_destroyElement(){this._element.remove(),$.trigger(this._element,Ng),this.dispose()}static jQueryInterface(t){return this.each(function(){const e=Jn.getOrCreateInstance(this);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}Zn(Jn,"close");Ue(Jn);const Ug="button",$g="bs.button",Hg=`.${$g}`,zg=".data-api",Wg="active",Oh='[data-bs-toggle="button"]',Gg=`click${Hg}${zg}`;class ta extends je{static get NAME(){return Ug}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(Wg))}static jQueryInterface(t){return this.each(function(){const e=ta.getOrCreateInstance(this);t==="toggle"&&e[t]()})}}$.on(document,Gg,Oh,i=>{i.preventDefault();const t=i.target.closest(Oh);ta.getOrCreateInstance(t).toggle()});Ue(ta);const Vg="swipe",sr=".bs.swipe",Kg=`touchstart${sr}`,qg=`touchmove${sr}`,jg=`touchend${sr}`,Yg=`pointerdown${sr}`,Xg=`pointerup${sr}`,Qg="touch",Zg="pen",Jg="pointer-event",t_=40,e_={endCallback:null,leftCallback:null,rightCallback:null},i_={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Hn extends Kr{constructor(t,e){super(),this._element=t,!(!t||!Hn.isSupported())&&(this._config=this._getConfig(e),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return e_}static get DefaultType(){return i_}static get NAME(){return Vg}dispose(){$.off(this._element,sr)}_start(t){if(!this._supportPointerEvents){this._deltaX=t.touches[0].clientX;return}this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX)}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),ge(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=t_)return;const e=t/this._deltaX;this._deltaX=0,e&&ge(e>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?($.on(this._element,Yg,t=>this._start(t)),$.on(this._element,Xg,t=>this._end(t)),this._element.classList.add(Jg)):($.on(this._element,Kg,t=>this._start(t)),$.on(this._element,qg,t=>this._move(t)),$.on(this._element,jg,t=>this._end(t)))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&(t.pointerType===Zg||t.pointerType===Qg)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const s_="carousel",r_="bs.carousel",Ki=`.${r_}`,N0=".data-api",n_="ArrowLeft",a_="ArrowRight",o_=500,_r="next",Is="prev",Us="left",Pn="right",c_=`slide${Ki}`,Ia=`slid${Ki}`,h_=`keydown${Ki}`,u_=`mouseenter${Ki}`,l_=`mouseleave${Ki}`,f_=`dragstart${Ki}`,d_=`load${Ki}${N0}`,p_=`click${Ki}${N0}`,B0="carousel",ln="active",m_="slide",g_="carousel-item-end",__="carousel-item-start",x_="carousel-item-next",b_="carousel-item-prev",F0=".active",U0=".carousel-item",y_=F0+U0,C_=".carousel-item img",v_=".carousel-indicators",S_="[data-bs-slide], [data-bs-slide-to]",E_='[data-bs-ride="carousel"]',A_={[n_]:Pn,[a_]:Us},w_={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},T_={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class qr extends je{constructor(t,e){super(t,e),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=rt.findOne(v_,this._element),this._addEventListeners(),this._config.ride===B0&&this.cycle()}static get Default(){return w_}static get DefaultType(){return T_}static get NAME(){return s_}next(){this._slide(_r)}nextWhenVisible(){!document.hidden&&ir(this._element)&&this.next()}prev(){this._slide(Is)}pause(){this._isSliding&&A0(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){$.one(this._element,Ia,()=>this.cycle());return}this.cycle()}}to(t){const e=this._getItems();if(t>e.length-1||t<0)return;if(this._isSliding){$.one(this._element,Ia,()=>this.to(t));return}const s=this._getItemIndex(this._getActive());if(s===t)return;const n=t>s?_r:Is;this._slide(n,e[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&$.on(this._element,h_,t=>this._keydown(t)),this._config.pause==="hover"&&($.on(this._element,u_,()=>this.pause()),$.on(this._element,l_,()=>this._maybeEnableCycle())),this._config.touch&&Hn.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const s of rt.find(C_,this._element))$.on(s,f_,n=>n.preventDefault());const e={leftCallback:()=>this._slide(this._directionToOrder(Us)),rightCallback:()=>this._slide(this._directionToOrder(Pn)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),o_+this._config.interval))}};this._swipeHelper=new Hn(this._element,e)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=A_[t.key];e&&(t.preventDefault(),this._slide(this._directionToOrder(e)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const e=rt.findOne(F0,this._indicatorsElement);e.classList.remove(ln),e.removeAttribute("aria-current");const s=rt.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);s&&(s.classList.add(ln),s.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=e||this._config.defaultInterval}_slide(t,e=null){if(this._isSliding)return;const s=this._getActive(),n=t===_r,a=e||lc(this._getItems(),s,n,this._config.wrap);if(a===s)return;const c=this._getItemIndex(a),u=D=>$.trigger(this._element,D,{relatedTarget:a,direction:this._orderToDirection(t),from:this._getItemIndex(s),to:c});if(u(c_).defaultPrevented||!s||!a)return;const x=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(c),this._activeElement=a;const _=n?__:g_,y=n?x_:b_;a.classList.add(y),Vr(a),s.classList.add(_),a.classList.add(_);const T=()=>{a.classList.remove(_,y),a.classList.add(ln),s.classList.remove(ln,y,_),this._isSliding=!1,u(Ia)};this._queueCallback(T,s,this._isAnimated()),x&&this.cycle()}_isAnimated(){return this._element.classList.contains(m_)}_getActive(){return rt.findOne(y_,this._element)}_getItems(){return rt.find(U0,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return Ne()?t===Us?Is:_r:t===Us?_r:Is}_orderToDirection(t){return Ne()?t===Is?Us:Pn:t===Is?Pn:Us}static jQueryInterface(t){return this.each(function(){const e=qr.getOrCreateInstance(this,t);if(typeof t=="number"){e.to(t);return}if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}$.on(document,p_,S_,function(i){const t=rt.getElementFromSelector(this);if(!t||!t.classList.contains(B0))return;i.preventDefault();const e=qr.getOrCreateInstance(t),s=this.getAttribute("data-bs-slide-to");if(s){e.to(s),e._maybeEnableCycle();return}if(xi.getDataAttribute(this,"slide")==="next"){e.next(),e._maybeEnableCycle();return}e.prev(),e._maybeEnableCycle()});$.on(window,d_,()=>{const i=rt.find(E_);for(const t of i)qr.getOrCreateInstance(t)});Ue(qr);const k_="collapse",D_="bs.collapse",jr=`.${D_}`,R_=".data-api",L_=`show${jr}`,P_=`shown${jr}`,I_=`hide${jr}`,O_=`hidden${jr}`,M_=`click${jr}${R_}`,Oa="show",Ws="collapse",fn="collapsing",N_="collapsed",B_=`:scope .${Ws} .${Ws}`,F_="collapse-horizontal",U_="width",$_="height",H_=".collapse.show, .collapse.collapsing",bo='[data-bs-toggle="collapse"]',z_={parent:null,toggle:!0},W_={parent:"(null|element)",toggle:"boolean"};class Or extends je{constructor(t,e){super(t,e),this._isTransitioning=!1,this._triggerArray=[];const s=rt.find(bo);for(const n of s){const a=rt.getSelectorFromElement(n),c=rt.find(a).filter(u=>u===this._element);a!==null&&c.length&&this._triggerArray.push(n)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return z_}static get DefaultType(){return W_}static get NAME(){return k_}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(H_).filter(u=>u!==this._element).map(u=>Or.getOrCreateInstance(u,{toggle:!1}))),t.length&&t[0]._isTransitioning||$.trigger(this._element,L_).defaultPrevented)return;for(const u of t)u.hide();const s=this._getDimension();this._element.classList.remove(Ws),this._element.classList.add(fn),this._element.style[s]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const n=()=>{this._isTransitioning=!1,this._element.classList.remove(fn),this._element.classList.add(Ws,Oa),this._element.style[s]="",$.trigger(this._element,P_)},c=`scroll${s[0].toUpperCase()+s.slice(1)}`;this._queueCallback(n,this._element,!0),this._element.style[s]=`${this._element[c]}px`}hide(){if(this._isTransitioning||!this._isShown()||$.trigger(this._element,I_).defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,Vr(this._element),this._element.classList.add(fn),this._element.classList.remove(Ws,Oa);for(const n of this._triggerArray){const a=rt.getElementFromSelector(n);a&&!this._isShown(a)&&this._addAriaAndCollapsedClass([n],!1)}this._isTransitioning=!0;const s=()=>{this._isTransitioning=!1,this._element.classList.remove(fn),this._element.classList.add(Ws),$.trigger(this._element,O_)};this._element.style[e]="",this._queueCallback(s,this._element,!0)}_isShown(t=this._element){return t.classList.contains(Oa)}_configAfterMerge(t){return t.toggle=!!t.toggle,t.parent=Hi(t.parent),t}_getDimension(){return this._element.classList.contains(F_)?U_:$_}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(bo);for(const e of t){const s=rt.getElementFromSelector(e);s&&this._addAriaAndCollapsedClass([e],this._isShown(s))}}_getFirstLevelChildren(t){const e=rt.find(B_,this._config.parent);return rt.find(t,this._config.parent).filter(s=>!e.includes(s))}_addAriaAndCollapsedClass(t,e){if(t.length)for(const s of t)s.classList.toggle(N_,!e),s.setAttribute("aria-expanded",e)}static jQueryInterface(t){const e={};return typeof t=="string"&&/show|hide/.test(t)&&(e.toggle=!1),this.each(function(){const s=Or.getOrCreateInstance(this,e);if(typeof t=="string"){if(typeof s[t]>"u")throw new TypeError(`No method named "${t}"`);s[t]()}})}}$.on(document,M_,bo,function(i){(i.target.tagName==="A"||i.delegateTarget&&i.delegateTarget.tagName==="A")&&i.preventDefault();for(const t of rt.getMultipleElementsFromSelector(this))Or.getOrCreateInstance(t,{toggle:!1}).toggle()});Ue(Or);const Mh="dropdown",G_="bs.dropdown",vs=`.${G_}`,dc=".data-api",V_="Escape",Nh="Tab",K_="ArrowUp",Bh="ArrowDown",q_=2,j_=`hide${vs}`,Y_=`hidden${vs}`,X_=`show${vs}`,Q_=`shown${vs}`,$0=`click${vs}${dc}`,H0=`keydown${vs}${dc}`,Z_=`keyup${vs}${dc}`,$s="show",J_="dropup",t1="dropend",e1="dropstart",i1="dropup-center",s1="dropdown-center",hs='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',r1=`${hs}.${$s}`,In=".dropdown-menu",n1=".navbar",a1=".navbar-nav",o1=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",c1=Ne()?"top-end":"top-start",h1=Ne()?"top-start":"top-end",u1=Ne()?"bottom-end":"bottom-start",l1=Ne()?"bottom-start":"bottom-end",f1=Ne()?"left-start":"right-start",d1=Ne()?"right-start":"left-start",p1="top",m1="bottom",g1={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},_1={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class si extends je{constructor(t,e){super(t,e),this._popper=null,this._parent=this._element.parentNode,this._menu=rt.next(this._element,In)[0]||rt.prev(this._element,In)[0]||rt.findOne(In,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return g1}static get DefaultType(){return _1}static get NAME(){return Mh}toggle(){return this._isShown()?this.hide():this.show()}show(){if(zi(this._element)||this._isShown())return;const t={relatedTarget:this._element};if(!$.trigger(this._element,X_,t).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(a1))for(const s of[].concat(...document.body.children))$.on(s,"mouseover",$n);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add($s),this._element.classList.add($s),$.trigger(this._element,Q_,t)}}hide(){if(zi(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){if(!$.trigger(this._element,j_,t).defaultPrevented){if("ontouchstart"in document.documentElement)for(const s of[].concat(...document.body.children))$.off(s,"mouseover",$n);this._popper&&this._popper.destroy(),this._menu.classList.remove($s),this._element.classList.remove($s),this._element.setAttribute("aria-expanded","false"),xi.removeDataAttribute(this._menu,"popper"),$.trigger(this._element,Y_,t)}}_getConfig(t){if(t=super._getConfig(t),typeof t.reference=="object"&&!_i(t.reference)&&typeof t.reference.getBoundingClientRect!="function")throw new TypeError(`${Mh.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if(typeof S0>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;this._config.reference==="parent"?t=this._parent:_i(this._config.reference)?t=Hi(this._config.reference):typeof this._config.reference=="object"&&(t=this._config.reference);const e=this._getPopperConfig();this._popper=uc(t,this._menu,e)}_isShown(){return this._menu.classList.contains($s)}_getPlacement(){const t=this._parent;if(t.classList.contains(t1))return f1;if(t.classList.contains(e1))return d1;if(t.classList.contains(i1))return p1;if(t.classList.contains(s1))return m1;const e=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return t.classList.contains(J_)?e?h1:c1:e?l1:u1}_detectNavbar(){return this._element.closest(n1)!==null}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(e=>Number.parseInt(e,10)):typeof t=="function"?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(xi.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,...ge(this._config.popperConfig,[t])}}_selectMenuItem({key:t,target:e}){const s=rt.find(o1,this._menu).filter(n=>ir(n));s.length&&lc(s,e,t===Bh,!s.includes(e)).focus()}static jQueryInterface(t){return this.each(function(){const e=si.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}static clearMenus(t){if(t.button===q_||t.type==="keyup"&&t.key!==Nh)return;const e=rt.find(r1);for(const s of e){const n=si.getInstance(s);if(!n||n._config.autoClose===!1)continue;const a=t.composedPath(),c=a.includes(n._menu);if(a.includes(n._element)||n._config.autoClose==="inside"&&!c||n._config.autoClose==="outside"&&c||n._menu.contains(t.target)&&(t.type==="keyup"&&t.key===Nh||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const u={relatedTarget:n._element};t.type==="click"&&(u.clickEvent=t),n._completeHide(u)}}static dataApiKeydownHandler(t){const e=/input|textarea/i.test(t.target.tagName),s=t.key===V_,n=[K_,Bh].includes(t.key);if(!n&&!s||e&&!s)return;t.preventDefault();const a=this.matches(hs)?this:rt.prev(this,hs)[0]||rt.next(this,hs)[0]||rt.findOne(hs,t.delegateTarget.parentNode),c=si.getOrCreateInstance(a);if(n){t.stopPropagation(),c.show(),c._selectMenuItem(t);return}c._isShown()&&(t.stopPropagation(),c.hide(),a.focus())}}$.on(document,H0,hs,si.dataApiKeydownHandler);$.on(document,H0,In,si.dataApiKeydownHandler);$.on(document,$0,si.clearMenus);$.on(document,Z_,si.clearMenus);$.on(document,$0,hs,function(i){i.preventDefault(),si.getOrCreateInstance(this).toggle()});Ue(si);const z0="backdrop",x1="fade",Fh="show",Uh=`mousedown.bs.${z0}`,b1={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},y1={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class W0 extends Kr{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return b1}static get DefaultType(){return y1}static get NAME(){return z0}show(t){if(!this._config.isVisible){ge(t);return}this._append();const e=this._getElement();this._config.isAnimated&&Vr(e),e.classList.add(Fh),this._emulateAnimation(()=>{ge(t)})}hide(t){if(!this._config.isVisible){ge(t);return}this._getElement().classList.remove(Fh),this._emulateAnimation(()=>{this.dispose(),ge(t)})}dispose(){this._isAppended&&($.off(this._element,Uh),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add(x1),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=Hi(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),$.on(t,Uh,()=>{ge(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(t){k0(t,this._getElement(),this._config.isAnimated)}}const C1="focustrap",v1="bs.focustrap",zn=`.${v1}`,S1=`focusin${zn}`,E1=`keydown.tab${zn}`,A1="Tab",w1="forward",$h="backward",T1={autofocus:!0,trapElement:null},k1={autofocus:"boolean",trapElement:"element"};class G0 extends Kr{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return T1}static get DefaultType(){return k1}static get NAME(){return C1}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),$.off(document,zn),$.on(document,S1,t=>this._handleFocusin(t)),$.on(document,E1,t=>this._handleKeydown(t)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,$.off(document,zn))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const s=rt.focusableChildren(e);s.length===0?e.focus():this._lastTabNavDirection===$h?s[s.length-1].focus():s[0].focus()}_handleKeydown(t){t.key===A1&&(this._lastTabNavDirection=t.shiftKey?$h:w1)}}const Hh=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",zh=".sticky-top",dn="padding-right",Wh="margin-right";class yo{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,dn,e=>e+t),this._setElementAttributes(Hh,dn,e=>e+t),this._setElementAttributes(zh,Wh,e=>e-t)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,dn),this._resetElementAttributes(Hh,dn),this._resetElementAttributes(zh,Wh)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,s){const n=this.getWidth(),a=c=>{if(c!==this._element&&window.innerWidth>c.clientWidth+n)return;this._saveInitialAttribute(c,e);const u=window.getComputedStyle(c).getPropertyValue(e);c.style.setProperty(e,`${s(Number.parseFloat(u))}px`)};this._applyManipulationCallback(t,a)}_saveInitialAttribute(t,e){const s=t.style.getPropertyValue(e);s&&xi.setDataAttribute(t,e,s)}_resetElementAttributes(t,e){const s=n=>{const a=xi.getDataAttribute(n,e);if(a===null){n.style.removeProperty(e);return}xi.removeDataAttribute(n,e),n.style.setProperty(e,a)};this._applyManipulationCallback(t,s)}_applyManipulationCallback(t,e){if(_i(t)){e(t);return}for(const s of rt.find(t,this._element))e(s)}}const D1="modal",R1="bs.modal",Be=`.${R1}`,L1=".data-api",P1="Escape",I1=`hide${Be}`,O1=`hidePrevented${Be}`,V0=`hidden${Be}`,K0=`show${Be}`,M1=`shown${Be}`,N1=`resize${Be}`,B1=`click.dismiss${Be}`,F1=`mousedown.dismiss${Be}`,U1=`keydown.dismiss${Be}`,$1=`click${Be}${L1}`,Gh="modal-open",H1="fade",Vh="show",Ma="modal-static",z1=".modal.show",W1=".modal-dialog",G1=".modal-body",V1='[data-bs-toggle="modal"]',K1={backdrop:!0,focus:!0,keyboard:!0},q1={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class ni extends je{constructor(t,e){super(t,e),this._dialog=rt.findOne(W1,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new yo,this._addEventListeners()}static get Default(){return K1}static get DefaultType(){return q1}static get NAME(){return D1}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){this._isShown||this._isTransitioning||$.trigger(this._element,K0,{relatedTarget:t}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(Gh),this._adjustDialog(),this._backdrop.show(()=>this._showElement(t)))}hide(){!this._isShown||this._isTransitioning||$.trigger(this._element,I1).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(Vh),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){$.off(window,Be),$.off(this._dialog,Be),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new W0({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new G0({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=rt.findOne(G1,this._dialog);e&&(e.scrollTop=0),Vr(this._element),this._element.classList.add(Vh);const s=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,$.trigger(this._element,M1,{relatedTarget:t})};this._queueCallback(s,this._dialog,this._isAnimated())}_addEventListeners(){$.on(this._element,U1,t=>{if(t.key===P1){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),$.on(window,N1,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),$.on(this._element,F1,t=>{$.one(this._element,B1,e=>{if(!(this._element!==t.target||this._element!==e.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(Gh),this._resetAdjustments(),this._scrollBar.reset(),$.trigger(this._element,V0)})}_isAnimated(){return this._element.classList.contains(H1)}_triggerBackdropTransition(){if($.trigger(this._element,O1).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,s=this._element.style.overflowY;s==="hidden"||this._element.classList.contains(Ma)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(Ma),this._queueCallback(()=>{this._element.classList.remove(Ma),this._queueCallback(()=>{this._element.style.overflowY=s},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),s=e>0;if(s&&!t){const n=Ne()?"paddingLeft":"paddingRight";this._element.style[n]=`${e}px`}if(!s&&t){const n=Ne()?"paddingRight":"paddingLeft";this._element.style[n]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each(function(){const s=ni.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof s[t]>"u")throw new TypeError(`No method named "${t}"`);s[t](e)}})}}$.on(document,$1,V1,function(i){const t=rt.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&i.preventDefault(),$.one(t,K0,n=>{n.defaultPrevented||$.one(t,V0,()=>{ir(this)&&this.focus()})});const e=rt.findOne(z1);e&&ni.getInstance(e).hide(),ni.getOrCreateInstance(t).toggle(this)});Zn(ni);Ue(ni);const j1="offcanvas",Y1="bs.offcanvas",Si=`.${Y1}`,q0=".data-api",X1=`load${Si}${q0}`,Q1="Escape",Kh="show",qh="showing",jh="hiding",Z1="offcanvas-backdrop",j0=".offcanvas.show",J1=`show${Si}`,tx=`shown${Si}`,ex=`hide${Si}`,Yh=`hidePrevented${Si}`,Y0=`hidden${Si}`,ix=`resize${Si}`,sx=`click${Si}${q0}`,rx=`keydown.dismiss${Si}`,nx='[data-bs-toggle="offcanvas"]',ax={backdrop:!0,keyboard:!0,scroll:!1},ox={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Wi extends je{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return ax}static get DefaultType(){return ox}static get NAME(){return j1}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||$.trigger(this._element,J1,{relatedTarget:t}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new yo().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(qh);const s=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(Kh),this._element.classList.remove(qh),$.trigger(this._element,tx,{relatedTarget:t})};this._queueCallback(s,this._element,!0)}hide(){if(!this._isShown||$.trigger(this._element,ex).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(jh),this._backdrop.hide();const e=()=>{this._element.classList.remove(Kh,jh),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new yo().reset(),$.trigger(this._element,Y0)};this._queueCallback(e,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=()=>{if(this._config.backdrop==="static"){$.trigger(this._element,Yh);return}this.hide()},e=!!this._config.backdrop;return new W0({className:Z1,isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?t:null})}_initializeFocusTrap(){return new G0({trapElement:this._element})}_addEventListeners(){$.on(this._element,rx,t=>{if(t.key===Q1){if(this._config.keyboard){this.hide();return}$.trigger(this._element,Yh)}})}static jQueryInterface(t){return this.each(function(){const e=Wi.getOrCreateInstance(this,t);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}$.on(document,sx,nx,function(i){const t=rt.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&i.preventDefault(),zi(this))return;$.one(t,Y0,()=>{ir(this)&&this.focus()});const e=rt.findOne(j0);e&&e!==t&&Wi.getInstance(e).hide(),Wi.getOrCreateInstance(t).toggle(this)});$.on(window,X1,()=>{for(const i of rt.find(j0))Wi.getOrCreateInstance(i).show()});$.on(window,ix,()=>{for(const i of rt.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(i).position!=="fixed"&&Wi.getOrCreateInstance(i).hide()});Zn(Wi);Ue(Wi);const cx=/^aria-[\w-]*$/i,X0={"*":["class","dir","id","lang","role",cx],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},hx=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),ux=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,lx=(i,t)=>{const e=i.nodeName.toLowerCase();return t.includes(e)?hx.has(e)?!!ux.test(i.nodeValue):!0:t.filter(s=>s instanceof RegExp).some(s=>s.test(e))};function fx(i,t,e){if(!i.length)return i;if(e&&typeof e=="function")return e(i);const n=new window.DOMParser().parseFromString(i,"text/html"),a=[].concat(...n.body.querySelectorAll("*"));for(const c of a){const u=c.nodeName.toLowerCase();if(!Object.keys(t).includes(u)){c.remove();continue}const p=[].concat(...c.attributes),x=[].concat(t["*"]||[],t[u]||[]);for(const _ of p)lx(_,x)||c.removeAttribute(_.nodeName)}return n.body.innerHTML}const dx="TemplateFactory",px={allowList:X0,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},mx={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},gx={entry:"(string|element|function|null)",selector:"(string|element)"};class _x extends Kr{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return px}static get DefaultType(){return mx}static get NAME(){return dx}getContent(){return Object.values(this._config.content).map(t=>this._resolvePossibleFunction(t)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[n,a]of Object.entries(this._config.content))this._setContent(t,a,n);const e=t.children[0],s=this._resolvePossibleFunction(this._config.extraClass);return s&&e.classList.add(...s.split(" ")),e}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[e,s]of Object.entries(t))super._typeCheckConfig({selector:e,entry:s},gx)}_setContent(t,e,s){const n=rt.findOne(s,t);if(n){if(e=this._resolvePossibleFunction(e),!e){n.remove();return}if(_i(e)){this._putElementInTemplate(Hi(e),n);return}if(this._config.html){n.innerHTML=this._maybeSanitize(e);return}n.textContent=e}}_maybeSanitize(t){return this._config.sanitize?fx(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return ge(t,[this])}_putElementInTemplate(t,e){if(this._config.html){e.innerHTML="",e.append(t);return}e.textContent=t.textContent}}const xx="tooltip",bx=new Set(["sanitize","allowList","sanitizeFn"]),Na="fade",yx="modal",pn="show",Cx=".tooltip-inner",Xh=`.${yx}`,Qh="hide.bs.modal",xr="hover",Ba="focus",vx="click",Sx="manual",Ex="hide",Ax="hidden",wx="show",Tx="shown",kx="inserted",Dx="click",Rx="focusin",Lx="focusout",Px="mouseenter",Ix="mouseleave",Ox={AUTO:"auto",TOP:"top",RIGHT:Ne()?"left":"right",BOTTOM:"bottom",LEFT:Ne()?"right":"left"},Mx={allowList:X0,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Nx={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class rr extends je{constructor(t,e){if(typeof S0>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t,e),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return Mx}static get DefaultType(){return Nx}static get NAME(){return xx}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),$.off(this._element.closest(Xh),Qh,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const t=$.trigger(this._element,this.constructor.eventName(wx)),s=(w0(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!s)return;this._disposePopper();const n=this._getTipElement();this._element.setAttribute("aria-describedby",n.getAttribute("id"));const{container:a}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(a.append(n),$.trigger(this._element,this.constructor.eventName(kx))),this._popper=this._createPopper(n),n.classList.add(pn),"ontouchstart"in document.documentElement)for(const u of[].concat(...document.body.children))$.on(u,"mouseover",$n);const c=()=>{$.trigger(this._element,this.constructor.eventName(Tx)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(c,this.tip,this._isAnimated())}hide(){if(!this._isShown()||$.trigger(this._element,this.constructor.eventName(Ex)).defaultPrevented)return;if(this._getTipElement().classList.remove(pn),"ontouchstart"in document.documentElement)for(const n of[].concat(...document.body.children))$.off(n,"mouseover",$n);this._activeTrigger[vx]=!1,this._activeTrigger[Ba]=!1,this._activeTrigger[xr]=!1,this._isHovered=null;const s=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),$.trigger(this._element,this.constructor.eventName(Ax)))};this._queueCallback(s,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(Na,pn),e.classList.add(`bs-${this.constructor.NAME}-auto`);const s=vg(this.constructor.NAME).toString();return e.setAttribute("id",s),this._isAnimated()&&e.classList.add(Na),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new _x({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[Cx]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Na)}_isShown(){return this.tip&&this.tip.classList.contains(pn)}_createPopper(t){const e=ge(this._config.placement,[this,t,this._element]),s=Ox[e.toUpperCase()];return uc(this._element,t,this._getPopperConfig(s))}_getOffset(){const{offset:t}=this._config;return typeof t=="string"?t.split(",").map(e=>Number.parseInt(e,10)):typeof t=="function"?e=>t(e,this._element):t}_resolvePossibleFunction(t){return ge(t,[this._element])}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:s=>{this._getTipElement().setAttribute("data-popper-placement",s.state.placement)}}]};return{...e,...ge(this._config.popperConfig,[e])}}_setListeners(){const t=this._config.trigger.split(" ");for(const e of t)if(e==="click")$.on(this._element,this.constructor.eventName(Dx),this._config.selector,s=>{this._initializeOnDelegatedTarget(s).toggle()});else if(e!==Sx){const s=e===xr?this.constructor.eventName(Px):this.constructor.eventName(Rx),n=e===xr?this.constructor.eventName(Ix):this.constructor.eventName(Lx);$.on(this._element,s,this._config.selector,a=>{const c=this._initializeOnDelegatedTarget(a);c._activeTrigger[a.type==="focusin"?Ba:xr]=!0,c._enter()}),$.on(this._element,n,this._config.selector,a=>{const c=this._initializeOnDelegatedTarget(a);c._activeTrigger[a.type==="focusout"?Ba:xr]=c._element.contains(a.relatedTarget),c._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},$.on(this._element.closest(Xh),Qh,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const e=xi.getDataAttributes(this._element);for(const s of Object.keys(e))bx.has(s)&&delete e[s];return t={...e,...typeof t=="object"&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=t.container===!1?document.body:Hi(t.container),typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),typeof t.title=="number"&&(t.title=t.title.toString()),typeof t.content=="number"&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[e,s]of Object.entries(this._config))this.constructor.Default[e]!==s&&(t[e]=s);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each(function(){const e=rr.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}}Ue(rr);const Bx="popover",Fx=".popover-header",Ux=".popover-body",$x={...rr.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Hx={...rr.DefaultType,content:"(null|string|element|function)"};class pc extends rr{static get Default(){return $x}static get DefaultType(){return Hx}static get NAME(){return Bx}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Fx]:this._getTitle(),[Ux]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each(function(){const e=pc.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t]()}})}}Ue(pc);const zx="scrollspy",Wx="bs.scrollspy",mc=`.${Wx}`,Gx=".data-api",Vx=`activate${mc}`,Zh=`click${mc}`,Kx=`load${mc}${Gx}`,qx="dropdown-item",Os="active",jx='[data-bs-spy="scroll"]',Fa="[href]",Yx=".nav, .list-group",Jh=".nav-link",Xx=".nav-item",Qx=".list-group-item",Zx=`${Jh}, ${Xx} > ${Jh}, ${Qx}`,Jx=".dropdown",tb=".dropdown-toggle",eb={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},ib={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class ea extends je{constructor(t,e){super(t,e),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return eb}static get DefaultType(){return ib}static get NAME(){return zx}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=Hi(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,typeof t.threshold=="string"&&(t.threshold=t.threshold.split(",").map(e=>Number.parseFloat(e))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&($.off(this._config.target,Zh),$.on(this._config.target,Zh,Fa,t=>{const e=this._observableSections.get(t.target.hash);if(e){t.preventDefault();const s=this._rootElement||window,n=e.offsetTop-this._element.offsetTop;if(s.scrollTo){s.scrollTo({top:n,behavior:"smooth"});return}s.scrollTop=n}}))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(e=>this._observerCallback(e),t)}_observerCallback(t){const e=c=>this._targetLinks.get(`#${c.target.id}`),s=c=>{this._previousScrollData.visibleEntryTop=c.target.offsetTop,this._process(e(c))},n=(this._rootElement||document.documentElement).scrollTop,a=n>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=n;for(const c of t){if(!c.isIntersecting){this._activeTarget=null,this._clearActiveClass(e(c));continue}const u=c.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(a&&u){if(s(c),!n)return;continue}!a&&!u&&s(c)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=rt.find(Fa,this._config.target);for(const e of t){if(!e.hash||zi(e))continue;const s=rt.findOne(decodeURI(e.hash),this._element);ir(s)&&(this._targetLinks.set(decodeURI(e.hash),e),this._observableSections.set(e.hash,s))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(Os),this._activateParents(t),$.trigger(this._element,Vx,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains(qx)){rt.findOne(tb,t.closest(Jx)).classList.add(Os);return}for(const e of rt.parents(t,Yx))for(const s of rt.prev(e,Zx))s.classList.add(Os)}_clearActiveClass(t){t.classList.remove(Os);const e=rt.find(`${Fa}.${Os}`,t);for(const s of e)s.classList.remove(Os)}static jQueryInterface(t){return this.each(function(){const e=ea.getOrCreateInstance(this,t);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}$.on(window,Kx,()=>{for(const i of rt.find(jx))ea.getOrCreateInstance(i)});Ue(ea);const sb="tab",rb="bs.tab",Ss=`.${rb}`,nb=`hide${Ss}`,ab=`hidden${Ss}`,ob=`show${Ss}`,cb=`shown${Ss}`,hb=`click${Ss}`,ub=`keydown${Ss}`,lb=`load${Ss}`,fb="ArrowLeft",tu="ArrowRight",db="ArrowUp",eu="ArrowDown",Ua="Home",iu="End",us="active",su="fade",$a="show",pb="dropdown",Q0=".dropdown-toggle",mb=".dropdown-menu",Ha=`:not(${Q0})`,gb='.list-group, .nav, [role="tablist"]',_b=".nav-item, .list-group-item",xb=`.nav-link${Ha}, .list-group-item${Ha}, [role="tab"]${Ha}`,Z0='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',za=`${xb}, ${Z0}`,bb=`.${us}[data-bs-toggle="tab"], .${us}[data-bs-toggle="pill"], .${us}[data-bs-toggle="list"]`;class Zs extends je{constructor(t){super(t),this._parent=this._element.closest(gb),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),$.on(this._element,ub,e=>this._keydown(e)))}static get NAME(){return sb}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),s=e?$.trigger(e,nb,{relatedTarget:t}):null;$.trigger(t,ob,{relatedTarget:e}).defaultPrevented||s&&s.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){if(!t)return;t.classList.add(us),this._activate(rt.getElementFromSelector(t));const s=()=>{if(t.getAttribute("role")!=="tab"){t.classList.add($a);return}t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),$.trigger(t,cb,{relatedTarget:e})};this._queueCallback(s,t,t.classList.contains(su))}_deactivate(t,e){if(!t)return;t.classList.remove(us),t.blur(),this._deactivate(rt.getElementFromSelector(t));const s=()=>{if(t.getAttribute("role")!=="tab"){t.classList.remove($a);return}t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),$.trigger(t,ab,{relatedTarget:e})};this._queueCallback(s,t,t.classList.contains(su))}_keydown(t){if(![fb,tu,db,eu,Ua,iu].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=this._getChildren().filter(n=>!zi(n));let s;if([Ua,iu].includes(t.key))s=e[t.key===Ua?0:e.length-1];else{const n=[tu,eu].includes(t.key);s=lc(e,t.target,n,!0)}s&&(s.focus({preventScroll:!0}),Zs.getOrCreateInstance(s).show())}_getChildren(){return rt.find(za,this._parent)}_getActiveElem(){return this._getChildren().find(t=>this._elemIsActive(t))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const s of e)this._setInitialAttributesOnChild(s)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),s=this._getOuterElement(t);t.setAttribute("aria-selected",e),s!==t&&this._setAttributeIfNotExists(s,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=rt.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const s=this._getOuterElement(t);if(!s.classList.contains(pb))return;const n=(a,c)=>{const u=rt.findOne(a,s);u&&u.classList.toggle(c,e)};n(Q0,us),n(mb,$a),s.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,s){t.hasAttribute(e)||t.setAttribute(e,s)}_elemIsActive(t){return t.classList.contains(us)}_getInnerElement(t){return t.matches(za)?t:rt.findOne(za,t)}_getOuterElement(t){return t.closest(_b)||t}static jQueryInterface(t){return this.each(function(){const e=Zs.getOrCreateInstance(this);if(typeof t=="string"){if(e[t]===void 0||t.startsWith("_")||t==="constructor")throw new TypeError(`No method named "${t}"`);e[t]()}})}}$.on(document,hb,Z0,function(i){["A","AREA"].includes(this.tagName)&&i.preventDefault(),!zi(this)&&Zs.getOrCreateInstance(this).show()});$.on(window,lb,()=>{for(const i of rt.find(bb))Zs.getOrCreateInstance(i)});Ue(Zs);const yb="toast",Cb="bs.toast",qi=`.${Cb}`,vb=`mouseover${qi}`,Sb=`mouseout${qi}`,Eb=`focusin${qi}`,Ab=`focusout${qi}`,wb=`hide${qi}`,Tb=`hidden${qi}`,kb=`show${qi}`,Db=`shown${qi}`,Rb="fade",ru="hide",mn="show",gn="showing",Lb={animation:"boolean",autohide:"boolean",delay:"number"},Pb={animation:!0,autohide:!0,delay:5e3};class ia extends je{constructor(t,e){super(t,e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return Pb}static get DefaultType(){return Lb}static get NAME(){return yb}show(){if($.trigger(this._element,kb).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(Rb);const e=()=>{this._element.classList.remove(gn),$.trigger(this._element,Db),this._maybeScheduleHide()};this._element.classList.remove(ru),Vr(this._element),this._element.classList.add(mn,gn),this._queueCallback(e,this._element,this._config.animation)}hide(){if(!this.isShown()||$.trigger(this._element,wb).defaultPrevented)return;const e=()=>{this._element.classList.add(ru),this._element.classList.remove(gn,mn),$.trigger(this._element,Tb)};this._element.classList.add(gn),this._queueCallback(e,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(mn),super.dispose()}isShown(){return this._element.classList.contains(mn)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=e;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=e;break}}if(e){this._clearTimeout();return}const s=t.relatedTarget;this._element===s||this._element.contains(s)||this._maybeScheduleHide()}_setListeners(){$.on(this._element,vb,t=>this._onInteraction(t,!0)),$.on(this._element,Sb,t=>this._onInteraction(t,!1)),$.on(this._element,Eb,t=>this._onInteraction(t,!0)),$.on(this._element,Ab,t=>this._onInteraction(t,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each(function(){const e=ia.getOrCreateInstance(this,t);if(typeof t=="string"){if(typeof e[t]>"u")throw new TypeError(`No method named "${t}"`);e[t](this)}})}}Zn(ia);Ue(ia);const Ib="modulepreload",Ob=function(i){return"/"+i},nu={},Mb=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),u=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));n=Promise.allSettled(e.map(p=>{if(p=Ob(p),p in nu)return;nu[p]=!0;const x=p.endsWith(".css"),_=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${_}`))return;const y=document.createElement("link");if(y.rel=x?"stylesheet":Ib,x||(y.as="script"),y.crossOrigin="",y.href=p,u&&y.setAttribute("nonce",u),document.head.appendChild(y),x)return new Promise((T,D)=>{y.addEventListener("load",T),y.addEventListener("error",()=>D(new Error(`Unable to preload CSS for ${p}`)))})}))}function a(c){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=c,window.dispatchEvent(u),!u.defaultPrevented)throw c}return n.then(c=>{for(const u of c||[])u.status==="rejected"&&a(u.reason);return t().catch(a)})};var br;function Nb(){this.getInt=function(i,t){switch(t){case 4:return(this.data[i+3]&255)<<24|(this.data[i+2]&255)<<16|(this.data[i+1]&255)<<8|this.data[i+0]&255;case 2:return(this.data[i+1]&255)<<8|this.data[i+0]&255;default:return this.data[i]&255}},this.getDOSDate=function(i,t){var e=i&31,s=(i>>>5&15)-1,n=1980+(i>>>9&127),a=(t&31)*2,c=t>>>5&63,u=t>>>11&31;return new Date(n,s,e,u,c,a)},this.stringOf=function(i,t){for(var e="";i!=t;)e+=String.fromCharCode(this.data[i++]);return e},this.open=function(i){if(this.data=i,this.files=[],this.data.length<22)return{status:!1,error:"Invalid data"};for(var t=this.data.length-22;t>=0&&this.getInt(t,4)!=101010256;)--t;if(t<0)return{status:!1,error:"Invalid data"};if(this.getInt(t+4,2)!==0||this.getInt(t+6,2)!==0)return{status:!1,error:"No multidisk support"};var e=this.getInt(t+8,2),s=this.getInt(t+16,4),n=this.getInt(t+20,2);this.comment=this.stringOf(t+22,t+22+n);for(var a=s,c=0;c<e;++c){if(this.getInt(a+0,4)!=33639248)return{status:!1,error:"Invalid data"};if(this.getInt(a+6,2)>20)return{status:!1,error:"Unsupported version"};if(this.getInt(a+8,2)&1)return{status:!1,error:"Encryption not implemented"};var u=this.getInt(a+10,2);if(u!==0&&u!==8)return{status:!1,error:"Unsupported compression method"};var p=this.getInt(a+12,2),x=this.getInt(a+14,2),_=this.getDOSDate(x,p),y=this.getInt(a+20,4),T=this.getInt(a+24,4),D=this.getInt(a+28,2),v=this.getInt(a+30,2),M=this.getInt(a+32,2),Y=this.getInt(a+42,4),z=this.stringOf(a+46,a+46+D),at=this.stringOf(a+46+D+v,a+46+D+v+M);if(this.getInt(Y+0,4)!=67324752)return{status:!1,error:"Invalid data"};var mt=this.getInt(Y+26,2),Q=this.getInt(Y+28,2),ct=Y+30+mt+Q;this.files[z]={fileComment:at,compressionMethod:u,compressedSize:y,uncompressedSize:T,localFileContent:ct,lastModifiedDate:_},a+=46+D+v+M}return{status:!0}},this.read=function(i){var t=this.files[i];if(t)if(t.compressionMethod==8){br||(br=new J0,br.init());var e=br.uncompress(this.data,t.localFileContent,t.uncompressedSize);return e.status==br.OK?{status:!0,data:e.data}:{status:!1,error:"deflate error "+e.status}}else return{status:!0,data:this.data.subarray(t.localFileContent,t.localFileContent+t.uncompressedSize)};return{status:!1,error:"File '"+i+"' doesn't exist in zip"}}}function J0(){this.OK=0,this.DATA_ERROR=-3,this.TREE=function(){this.table=new Array(16),this.trans=new Array(288)},this.DATA=function(i){this.source="",this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=[],this.ltree=new i.TREE,this.dtree=new i.TREE},this.sltree=new this.TREE,this.sdtree=new this.TREE,this.length_bits=new Array(30),this.length_base=new Array(30),this.dist_bits=new Array(30),this.dist_base=new Array(30),this.clcidx=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],this.build_bits_base=function(i,t,e,s){var n,a;for(n=0;n<e;++n)i[n]=0;for(n=0;n<30-e;++n)i[n+e]=Math.floor(n/e);for(a=s,n=0;n<30;++n)t[n]=a,a+=1<<i[n]},this.build_fixed_trees=function(i,t){var e;for(e=0;e<7;++e)i.table[e]=0;for(i.table[7]=24,i.table[8]=152,i.table[9]=112,e=0;e<24;++e)i.trans[e]=256+e;for(e=0;e<144;++e)i.trans[24+e]=e;for(e=0;e<8;++e)i.trans[168+e]=280+e;for(e=0;e<112;++e)i.trans[176+e]=144+e;for(e=0;e<5;++e)t.table[e]=0;for(t.table[5]=32,e=0;e<32;++e)t.trans[e]=e},this.build_tree=function(i,t,e,s){var n=new Array(16),a,c;for(a=0;a<16;++a)i.table[a]=0;for(a=0;a<s;++a)i.table[t[e+a]]++;for(i.table[0]=0,c=0,a=0;a<16;++a)n[a]=c,c+=i.table[a];for(a=0;a<s;++a)t[e+a]&&(i.trans[n[t[e+a]]++]=a)},this.getbit=function(i){var t;return i.bitcount--||(i.tag=i.source[i.sourceIndex++]&255,i.bitcount=7),t=i.tag&1,i.tag>>>=1,t},this.read_bits=function(i,t,e){if(!t)return e;for(;i.bitcount<24;)i.tag=i.tag|(i.source[i.sourceIndex++]&255)<<i.bitcount,i.bitcount+=8;var s=i.tag&65535>>>16-t;return i.tag>>>=t,i.bitcount-=t,s+e},this.round_to_byte_boundary=function(i){for(;i.bitcount>=8;)i.sourceIndex--,i.bitcount-=8;i.bitcount=i.tag=0},this.decode_symbol=function(i,t){for(;i.bitcount<24;)i.tag=i.tag|(i.source[i.sourceIndex++]&255)<<i.bitcount,i.bitcount+=8;var e=0,s=0,n=0;do s=2*s+((i.tag&1<<n)>>>n),++n,e+=t.table[n],s-=t.table[n];while(s>=0);return i.tag>>>=n,i.bitcount-=n,t.trans[e+s]},this.decode_trees=function(i,t,e){var s=new this.TREE,n=new Array(320),a,c,u,p,x,_;for(a=this.read_bits(i,5,257),c=this.read_bits(i,5,1),u=this.read_bits(i,4,4),p=0;p<19;++p)n[p]=0;for(p=0;p<u;++p){var y=this.read_bits(i,3,0);n[this.clcidx[p]]=y}for(this.build_tree(s,n,0,19),x=0;x<a+c;){var T=this.decode_symbol(i,s);switch(T){case 16:{var D=n[x-1];for(_=this.read_bits(i,2,3);_;--_)n[x++]=D}break;case 17:for(_=this.read_bits(i,3,3);_;--_)n[x++]=0;break;case 18:for(_=this.read_bits(i,7,11);_;--_)n[x++]=0;break;default:n[x++]=T;break}}this.build_tree(t,n,0,a),this.build_tree(e,n,a,c)},this.inflate_block_data=function(i,t,e){for(var s=i.dest,n=i.destIndex;;){var a=this.decode_symbol(i,t);if(a==256)return i.destIndex=n,this.OK;if(a<256)s[n++]=a;else{var c,u,p,x;for(a-=257,c=this.read_bits(i,this.length_bits[a],this.length_base[a]),u=this.decode_symbol(i,e),p=this.read_bits(i,this.dist_bits[u],this.dist_base[u],n==26116),p=n-p,x=p;x<p+c;++x)s[n++]=s[x]}}},this.inflate_uncompressed_block=function(i){var t,e,s;if(this.round_to_byte_boundary(i),t=i.source[i.sourceIndex+1],t=256*t+i.source[i.sourceIndex],e=i.source[i.sourceIndex+3],e=256*e+i.source[i.sourceIndex+2],t!=(~e&65535))return this.DATA_ERROR;for(i.sourceIndex+=4,s=t;s;--s)i.dest[i.destIndex++]=i.source[i.sourceIndex++];return i.bitcount=0,this.OK},this.inflate_fixed_block=function(i){return this.inflate_block_data(i,this.sltree,this.sdtree)},this.inflate_dynamic_block=function(i){return this.decode_trees(i,i.ltree,i.dtree),this.inflate_block_data(i,i.ltree,i.dtree)},this.init=function(){this.build_fixed_trees(this.sltree,this.sdtree),this.build_bits_base(this.length_bits,this.length_base,4,3),this.build_bits_base(this.dist_bits,this.dist_base,2,1),this.length_bits[28]=0,this.length_base[28]=258},this.uncompress=function(i,t,e){var s=new this.DATA(this),n;s.source=i,s.sourceIndex=t,s.bitcount=0,s.dest=new Uint8Array(e),s.destIndex=0;do{var a,c;switch(n=this.getbit(s),a=this.read_bits(s,2,0),a){case 0:c=this.inflate_uncompressed_block(s);break;case 1:c=this.inflate_fixed_block(s);break;case 2:c=this.inflate_dynamic_block(s);break;default:return{status:this.DATA_ERROR}}if(c!=this.OK)return{status:this.DATA_ERROR}}while(!n);return this.round_to_byte_boundary(s),{status:this.OK,data:s.dest,offset:s.sourceIndex,dataSize:s.destIndex}}}const sa=typeof window>"u";function tf(){return typeof InstallTrigger<"u"}function Bb(i){return i[0]==="$"||i[0]==="&"?parseInt(i.substring(1),16):i.indexOf("0x")===0?parseInt(i.substring(2),16):parseInt(i,16)}const Co=[],E={SEMICOLON_PLUS:[7,5],MINUS:[7,1],LEFT_SQUARE_BRACKET:[8,3],RIGHT_SQUARE_BRACKET:[8,5],COMMA:[6,6],PERIOD:[7,6],SLASH:[8,6],SHIFTLOCK:[0,5],TAB:[0,6],RETURN:[9,4],DELETE:[9,5],COPY:[9,6],SHIFT:[0,0],ESCAPE:[0,7],CTRL:[1,0],CAPSLOCK:[0,4],LEFT:[9,1],UP:[9,3],RIGHT:[9,7],DOWN:[9,2],K0:[7,2],K1:[0,3],K2:[1,3],K3:[1,1],K4:[2,1],K5:[3,1],K6:[4,3],K7:[4,2],K8:[5,1],K9:[6,2],Q:[0,1],W:[1,2],E:[2,2],R:[3,3],T:[3,2],Y:[4,4],U:[5,3],I:[5,2],O:[6,3],P:[7,3],A:[1,4],S:[1,5],D:[2,3],F:[3,4],G:[3,5],H:[4,5],J:[5,4],K:[6,4],L:[6,5],Z:[1,6],X:[2,4],C:[2,5],V:[3,6],B:[4,6],N:[5,5],M:[5,6],F0:[0,2],F1:[1,7],F2:[2,7],F3:[3,7],F4:[4,1],F5:[4,7],F6:[5,7],F7:[6,1],F8:[6,7],F9:[7,7],SPACE:[2,6],UNDERSCORE_POUND:[8,2],AT:[7,4],COLON_STAR:[8,4],PIPE_BACKSLASH:[8,7],HAT_TILDE:[8,1],NUMPADPLUS:[10,3],NUMPADMINUS:[11,3],NUMPADSLASH:[10,4],NUMPADASTERISK:[11,5],NUMPAD7:[11,1],NUMPAD8:[10,2],NUMPAD9:[11,2],NUMPADHASH:[10,5],NUMPAD4:[10,7],NUMPAD5:[11,7],NUMPAD6:[10,1],NUMPAD_DELETE:[11,4],NUMPAD1:[11,6],NUMPAD2:[12,7],NUMPAD3:[12,6],NUMPADCOMMA:[12,5],NUMPAD0:[10,6],NUMPAD_DECIMAL_POINT:[12,4],NUMPADENTER:[12,3]};function Yr(i){const t=[];let e=!1,s=!0;for(let n=0;n<i.length;++n){const a=i.charCodeAt(n);let c=i.charAt(n),u=null,p=!1,x=!0;if(a>=65&&a<=90)u=E[c];else if(a>=97&&a<=122)c=String.fromCharCode(a-32),u=E[c],x=!1;else if(a>=48&&a<=57)u=E["K"+c];else if(a>=33&&a<=41)c=String.fromCharCode(a+16),u=E["K"+c],p=!0;else switch(c){case`
`:u=E.RETURN;break;case"	":u=E.TAB;break;case" ":u=E.SPACE;break;case"-":u=E.MINUS;break;case"=":u=E.MINUS,p=!0;break;case"^":u=E.HAT_TILDE;break;case"~":u=E.HAT_TILDE,p=!0;break;case"\\":u=E.PIPE_BACKSLASH;break;case"|":u=E.PIPE_BACKSLASH,p=!0;break;case"@":u=E.AT;break;case"[":u=E.LEFT_SQUARE_BRACKET;break;case"{":u=E.LEFT_SQUARE_BRACKET,p=!0;break;case"_":u=E.UNDERSCORE_POUND;break;case";":u=E.SEMICOLON_PLUS;break;case"+":u=E.SEMICOLON_PLUS,p=!0;break;case":":u=E.COLON_STAR;break;case"*":u=E.COLON_STAR,p=!0;break;case"]":u=E.RIGHT_SQUARE_BRACKET;break;case"}":u=E.RIGHT_SQUARE_BRACKET,p=!0;break;case",":u=E.COMMA;break;case"<":u=E.COMMA,p=!0;break;case".":u=E.PERIOD;break;case">":u=E.PERIOD,p=!0;break;case"/":u=E.SLASH;break;case"?":u=E.SLASH,p=!0;break}u&&((p&&!e||!p&&e)&&(t.push(E.SHIFT),e=!e),(x&&!s||!x&&s)&&(t.push(E.CAPSLOCK),s=!s),t.push(u))}return e&&t.push(E.SHIFT),s||t.push(E.CAPSLOCK),t}const A={UNDEFINED:0,BACKSPACE:8,TAB:9,CLEAR:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,BREAK:19,CAPSLOCK:20,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINTSCREEN:44,INSERT:45,DELETE:46,K0:48,K1:49,K2:50,K3:51,K4:52,K5:53,K6:54,K7:55,K8:56,K9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOWS:91,MENU:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,NUMPADASTERISK:106,NUMPADPLUS:107,NUMPAD_DECIMAL_COMMA:108,NUMPADMINUS:109,NUMPAD_DECIMAL_POINT:110,NUMPADSLASH:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL_LOCK:145,VOLUMEUP:174,VOLUMEDOWN:175,FASTFORWARD:176,FASTREWIND:177,PLAYPAUSE:179,COMMA:188,PERIOD:190,SLASH:191,LEFT_SQUARE_BRACKET:219,BACKSLASH:220,RIGHT_SQUARE_BRACKET:221,NUMPADENTER:255,SHIFT_LEFT:256,SHIFT_RIGHT:257,ALT_LEFT:258,ALT_RIGHT:259,CTRL_LEFT:260,CTRL_RIGHT:261};function Fb(){if(sa)return"UK";if(localStorage.keyboardLayout)return localStorage.keyboardLayout==="US"?"US":"UK";if(navigator.language){if(navigator.language.toLowerCase()==="en-gb")return"UK";if(navigator.language.toLowerCase()==="en-us")return"US"}return"UK"}const Bi=Fb()==="UK";tf()?(A.SEMICOLON=59,A.HASH=163,A.APOSTROPHE=222,A.BACK_QUOTE=192,A.MUTE=-1,A.MINUS=173,A.EQUALS=61):(A.SEMICOLON=186,A.HASH=Bi?222:223,A.APOSTROPHE=Bi?192:222,A.MUTE=173,A.MINUS=189,A.EQUALS=187,A.BACK_QUOTE=Bi?223:192);!sa&&window.navigator.userAgent.indexOf("Mac")!==-1&&(A.BACK_QUOTE=192,A.APOSTROPHE=222,A.HASH=223);function Ub(i){const t=[];t[!0]={},t[!1]={};function e(n,a,c){t[c][n]&&t[c][n]!==a&&console.log("Warning: duplicate binding for key",(c?"<SHIFT>":"")+n,a,t[c][n]),t[c][n]=a}function s(n,a,c){(!n&&n!==0||!a)&&console.log("error binding key",n,a),typeof n=="string"&&(n=n.charCodeAt(0)),c===void 0?(e(n,a,!0),e(n,a,!1)):e(n,a,c)}for(s(A.Q,E.Q),s(A.W,E.W),s(A.E,E.E),s(A.R,E.R),s(A.T,E.T),s(A.Y,E.Y),s(A.U,E.U),s(A.I,E.I),s(A.O,E.O),s(A.P,E.P),s(A.A,E.A),s(A.S,E.S),s(A.D,E.D),s(A.F,E.F),s(A.G,E.G),s(A.H,E.H),s(A.J,E.J),s(A.K,E.K),s(A.L,E.L),s(A.Z,E.Z),s(A.X,E.X),s(A.C,E.C),s(A.V,E.V),s(A.B,E.B),s(A.N,E.N),s(A.M,E.M),s(A.F10,E.F0),s(A.F1,E.F1),s(A.F2,E.F2),s(A.F3,E.F3),s(A.F4,E.F4),s(A.F5,E.F5),s(A.F6,E.F6),s(A.F7,E.F7),s(A.F8,E.F8),s(A.F9,E.F9),s(A.COMMA,E.COMMA),s(A.PERIOD,E.PERIOD),s(A.SLASH,E.SLASH),s(A.SPACE,E.SPACE),s(A.TAB,E.TAB),s(A.ENTER,E.RETURN),s(A.SHIFT,E.SHIFT),s(A.SHIFT_RIGHT,E.SHIFT),s(A.LEFT,E.LEFT),s(A.UP,E.UP),s(A.RIGHT,E.RIGHT),s(A.DOWN,E.DOWN),i==="natural"?(s(A.SHIFT_LEFT,E.SHIFT),s(A.BACK_QUOTE,Bi?E.UNDERSCORE_POUND:E.HAT_TILDE),s(A.APOSTROPHE,Bi?E.AT:E.K2,!0),s(A.K2,Bi?E.K2:E.AT,!0),s(A.K3,E.UNDERSCORE_POUND,!0),s(A.K7,E.K6,!0),s(A.K8,E.COLON_STAR,!0),s(A.K9,E.K8,!0),s(A.K0,E.K9,!0),s(A.K2,E.K2,!1),s(A.K3,E.K3,!1),s(A.K7,E.K7,!1),s(A.K8,E.K8,!1),s(A.K9,E.K9,!1),s(A.K0,E.K0,!1),s(A.K1,E.K1),s(A.K4,E.K4),s(A.K5,E.K5),s(A.K6,E.K6),s(A.MINUS,E.MINUS),s(A.LEFT_SQUARE_BRACKET,E.LEFT_SQUARE_BRACKET),s(A.RIGHT_SQUARE_BRACKET,E.RIGHT_SQUARE_BRACKET),s(A.SEMICOLON,E.SEMICOLON_PLUS),s(A.APOSTROPHE,E.COLON_STAR,!1),s(A.HASH,E.HAT_TILDE),s(A.EQUALS,E.SEMICOLON_PLUS),s(A.WINDOWS,E.SHIFTLOCK),s(A.END,E.COPY),s(A.F11,E.COPY),s(A.ESCAPE,E.ESCAPE),s(A.CTRL,E.CTRL),s(A.CTRL_LEFT,E.CTRL),s(A.CTRL_RIGHT,E.CTRL),s(A.CAPSLOCK,E.CAPSLOCK),s(A.DELETE,E.DELETE),s(A.BACKSPACE,E.DELETE),s(A.BACKSLASH,E.PIPE_BACKSLASH)):i==="gaming"?(s(A.ESCAPE,E.F0),s(A.BACK_QUOTE,E.ESCAPE),s(A.K1,E.K1),s(A.K2,E.K2),s(A.K3,E.K3),s(A.K4,E.K4),s(A.K5,E.K5),s(A.K6,E.K6),s(A.K7,E.K7),s(A.K8,E.K8),s(A.K9,E.K9),s(A.K0,E.K0),s(A.MINUS,E.MINUS),s(A.EQUALS,E.HAT_TILDE),s(A.BACKSPACE,E.PIPE_BACKSLASH),s(A.INSERT,E.LEFT),s(A.HOME,E.RIGHT),s(A.LEFT_SQUARE_BRACKET,E.AT),s(A.RIGHT_SQUARE_BRACKET,E.LEFT_SQUARE_BRACKET),s(A.DELETE,E.UP),s(A.END,E.DOWN),s(A.CAPSLOCK,E.CTRL),s(A.SEMICOLON,E.SEMICOLON_PLUS),s(A.APOSTROPHE,E.COLON_STAR),s(A.HASH,E.RIGHT_SQUARE_BRACKET),s(A.SHIFT_LEFT,Bi?E.SHIFTLOCK:E.SHIFT),s(A.BACKSLASH,Bi?E.SHIFT:E.UNDERSCORE_POUND),s(A.CTRL_LEFT,E.CAPSLOCK),s(A.ALT_LEFT,E.CTRL),s(A.MENU,E.DELETE),s(A.CTRL_RIGHT,E.COPY),s(A.ALT_RIGHT,E.SHIFTLOCK),s(A.WINDOWS,E.SHIFTLOCK)):(s(A.K1,E.K1),s(A.K2,E.K2),s(A.K3,E.K3),s(A.K4,E.K4),s(A.K5,E.K5),s(A.K6,E.K6),s(A.K7,E.K7),s(A.K8,E.K8),s(A.K9,E.K9),s(A.K0,E.K0),s(A.SHIFT_LEFT,E.SHIFT),s(A.EQUALS,E.HAT_TILDE),s(A.SEMICOLON,E.SEMICOLON_PLUS),s(A.MINUS,E.MINUS),s(A.LEFT_SQUARE_BRACKET,E.LEFT_SQUARE_BRACKET),s(A.RIGHT_SQUARE_BRACKET,E.RIGHT_SQUARE_BRACKET),s(A.COMMA,E.COMMA),s(A.PERIOD,E.PERIOD),s(A.SLASH,E.SLASH),s(A.WINDOWS,E.SHIFTLOCK),s(A.TAB,E.TAB),s(A.ENTER,E.RETURN),s(A.DELETE,E.DELETE),s(A.BACKSPACE,E.DELETE),s(A.END,E.COPY),s(A.F11,E.COPY),s(A.SHIFT,E.SHIFT),s(A.ESCAPE,E.ESCAPE),s(A.CTRL,E.CTRL),s(A.CTRL_LEFT,E.CTRL),s(A.CTRL_RIGHT,E.CTRL),s(A.CAPSLOCK,E.CAPSLOCK),s(A.LEFT,E.LEFT),s(A.UP,E.UP),s(A.RIGHT,E.RIGHT),s(A.DOWN,E.DOWN),s(A.APOSTROPHE,E.COLON_STAR),s(A.HASH,E.RIGHT_SQUARE_BRACKET),s(A.BACK_QUOTE,E.AT),s(A.BACKSLASH,E.PIPE_BACKSLASH),s(A.PAGEUP,E.UNDERSCORE_POUND)),s(A.NUMPAD0,E.NUMPAD0),s(A.NUMPAD1,E.NUMPAD1),s(A.NUMPAD2,E.NUMPAD2),s(A.NUMPAD3,E.NUMPAD3),s(A.NUMPAD4,E.NUMPAD4),s(A.NUMPAD5,E.NUMPAD5),s(A.NUMPAD6,E.NUMPAD6),s(A.NUMPAD7,E.NUMPAD7),s(A.NUMPAD8,E.NUMPAD8),s(A.NUMPAD9,E.NUMPAD9),s(A.NUMPAD_DECIMAL_POINT,E.NUMPAD_DECIMAL_POINT),s(A.NUMPADPLUS,E.NUMPADPLUS),s(A.NUMPADMINUS,E.NUMPADMINUS),s(A.NUMPADSLASH,E.NUMPADSLASH),s(A.NUMPADASTERISK,E.NUMPADASTERISK),s(A.NUMPADENTER,E.NUMPADENTER);Co.length>0;){const n=Co.pop();s(A[n.native],E[n.bbc])}return t}function et(i){return(i>>>4&15).toString(16)+(i&15).toString(16)}function Vt(i){return et(i>>>8)+et(i&255)}function ef(i,t,e,s){s=s||{};const n=s.width||16,a=s.gap===void 0?8:s.gap,c=[];let u="",p=0;for(let _=t;_<e;++_)u+=" ",u+=et(i(_)),++p===a&&(u+=" "),p===n&&(c.push(u),u="",p=0);u&&c.push(u);let x="";for(let _=0;_<c.length;++_)x+=Vt(t+_*n)+" :"+c[_]+`
`;return x}function sf(i){return i>=128?i-256:i}function vo(){}function Kt(i,t,e){!sa&&(window.location.host.endsWith(".godbolt.org")||window.location.host.endsWith(".xania.org"))&&gtag("event",i,{type:t,label:e}),console.log("event noted:",i,t,e)}let $b="";function rf(i){let t="";for(let e=0;e<i.length;++e)t+=String.fromCharCode(i[e]);return t}function Xr(i){if(i instanceof Uint8Array)return i;const t=i.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=i.charCodeAt(s)&255;return e}function Hb(i){return new Promise(function(t,e){const s=new XMLHttpRequest;s.open("GET",$b+i,!0),s.overrideMimeType("text/plain; charset=x-user-defined"),s.onload=function(){s.status!==200&&e(new Error("Unable to load "+i+", http code "+s.status)),typeof s.response!="string"?t(s.response):t(Xr(s.response))},s.onerror=function(){e(new Error("A network error occurred loading "+i))},s.send(null)})}async function zb(i){if(typeof readbuffer<"u")return new Uint8Array(readbuffer(i));if(typeof read<"u")return read(i,"binary");{const t=await Mb(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);return i[0]==="/"&&(i="."+i),t.existsSync("public/"+i)?t.readFileSync("public/"+i):t.readFileSync(i)}}function Fe(i){return sa?zb(i):Hb(i)}function Wb(i,t){return i[t+3]<<24|i[t+2]<<16|i[t+1]<<8|i[t+0]}function nf(i,t){return i[t+1]<<8|i[t+0]}const af=new ArrayBuffer(4),_n=new Uint8Array(af),Gb=new Float32Array(af);function Vb(i,t){return _n[0]=i[t],_n[1]=i[t+1],_n[2]=i[t+2],_n[3]=i[t+3],Gb[0]}function Kb(i){const t=new J0;t.init();const e=[];for(;i.length;){if(e.length>1e3)throw new Error("Seems like something went wrong");if(i[0]!==31||i[1]!==139)throw new Error("Corrupt data");let c=10;if(i[3]&2&&(c+=2),i[3]&4&&(c+=2+nf(i,c)),i[3]&8){for(;i[c]!==0;)c++;c++}if(i[3]&16){for(;i[c]!==0;)c++;c++}let u=16384,p;for(;;){if(p=t.uncompress(i,c,u),p.status!==0)throw"Unable to ungzip";if(p.dataSize<u)break;u*=2}e.push(p.data.subarray(0,p.dataSize));const x=p.offset+8;i=i.subarray(x)}const s=e.reduce(function(c,u){return c+u.length},0),n=new Uint8Array(s);let a=0;return e.forEach(function(c){n.set(c,a),a+=c.length}),n}class gc{constructor(t,e,s){if(this.name=t,this.pos=0,this.data=Xr(e),!s&&this.data&&this.data.length>4&&this.data[0]===31&&this.data[1]===139&&(console.log("Ungzipping "+t),this.data=Kb(this.data)),!this.data)throw new Error("No data in "+t);this.end=this.data.length}bytesLeft(){return this.end-this.pos}eof(){return this.bytesLeft()===0}advance(t){if(this.bytesLeft()<t)throw new RangeError("EOF in "+this.name);return this.pos+=t,this.pos-t}readFloat32(t){return t===void 0&&(t=this.advance(4)),Vb(this.data,t)}readInt32(t){return t===void 0&&(t=this.advance(4)),Wb(this.data,t)}readInt16(t){return t===void 0&&(t=this.advance(2)),nf(this.data,t)}readByte(t){return t===void 0&&(t=this.advance(1)),this.data[t]}readNulString(t,e){e||(e=1024);let s=t===void 0?this.pos:t,n="",a;for(;(a=this.readByte(s++))!==0&&--e;)n+=String.fromCharCode(a);return e===0?"":(t===void 0&&(this.pos=s),n)}substream(t,e){let s;if(e===void 0)e=t,s=this.advance(e);else if(s=t,s+e>=this.end)throw new RangeError("EOF in "+this.name);return new gc(this.name+".sub",this.data.subarray(s,s+e))}seek(t){if(t>=this.end)throw new RangeError("Seek out of range in "+this.name);this.pos=t}}function ls(i){return new Int32Array(i.buffer)}const qb={uef:!0,ssd:!0,dsd:!0,adl:!0},jb={rom:!0};function of(i,t){const e=new Nb;console.log("Attempting to unzip");const s=e.open(i);if(!s.status)throw new Error("Error unzipping "+s.error);let n=null,a;for(const c in e.files){const u=c.match(/.*\.([a-z]+)/i);if(!u||!t[u[1].toLowerCase()]){console.log("Skipping file",c);continue}if(n){console.log("Ignoring",c,"as already found a file");continue}a=c,n=e.read(c)}if(!n)throw new Error("Couldn't find any compatible files in the archive");if(!n.status)throw new Error("Failed to uncompress file '"+a+"' - "+n.error);return console.log("Unzipped '"+a+"'"),{data:n.data,name:a}}function Mr(i){return of(i,qb)}function Yb(i){return of(i,jb)}function cf(i){let t=!1,e=!1,s=80*10*256,n=i.toLowerCase();return n.endsWith(".dsd")&&(s*=2,t=!0),n.endsWith(".adl")&&(s=2*80*16*256,t=!0,e=!0),(n.endsWith(".adf")||n.endsWith(".adm"))&&(s=80*16*256,t=!1,e=!0),{isDsd:t,isDoubleDensity:e,byteSize:s}}function hf(i,t){for(let e=0;e<8;++e)i[e]=t.charCodeAt(e)&255}class Xb{constructor(t){this._buffer=new Uint8Array(t),this._size=0,this._wPtr=0,this._rPtr=0}get size(){return this._size}get full(){return this._size===this._buffer.length}get empty(){return this._size===0}clear(){this._size=0,this._wPtr=0,this._rPtr=0}put(t){this.full||(this._buffer[this._wPtr%this._buffer.length]=t,this._wPtr++,this._size++)}get(){if(this.empty)return;const t=this._buffer[this._rPtr%this._buffer.length];return this._rPtr++,this._size--,t}}function Qb(){return new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,1,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,1,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,0,0,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,1,1,1,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,0,1,0,1,0,1,0,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,1,1,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,1,1,1,1,1,0,0,1,0,1,0,0,1,1,1,1,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,0,1,1,1,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,1,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,0,0,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0,1,0,0,0,0,1,0,1,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,0,1,1,1,1,0,0,0,0,0,1,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,0,0,0,0,1,0,0,0,1,1,0,0,1,0,0,0,0,1,1,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0])}class Zb{constructor(){this.prevCol=0,this.col=7,this.bg=0,this.sep=!1,this.dbl=this.oldDbl=this.secondHalfOfDouble=this.wasDbl=!1,this.gfx=!1,this.flash=this.flashOn=!1,this.flashTime=0,this.heldChar=0,this.holdChar=!1,this.dataQueue=[0,0,0,0],this.scanlineCounter=0,this.levelDEW=!1,this.levelDISPTMG=!1,this.levelRA0=!1,this.normalGlyphs=ls(new Uint32Array(96*20)),this.graphicsGlyphs=ls(new Uint32Array(96*20)),this.separatedGlyphs=ls(new Uint32Array(96*20)),this.colour=ls(new Uint32Array(256)),this.nextGlyphs=this.normalGlyphs,this.curGlyphs=this.normalGlyphs,this.heldGlyphs=this.normalGlyphs,this.init()}init(){const t=Qb(),e=1/2.2;for(let u=0;u<256;++u){const p=(u&3)/3,x=!!(u&4),_=!!(u&8),y=!!(u&16),T=!!(u&32),D=!!(u&64),v=!!(u&128),M=Math.pow(x*p+T*(1-p),e)*240,Y=Math.pow(_*p+D*(1-p),e)*240,z=Math.pow(y*p+v*(1-p),e)*240;this.colour[u]=M|Y<<8|z<<16|255<<24}function s(u,p){if(p<0||p>=20)return 0;{let x=u*60+(p>>>1)*6,_=0;for(let y=0;y<6;++y)_|=t[x++]*3<<y*2;return _}}function n(u,p){return u|u>>>1&p&~(p>>>1)|u<<1&p&~(p<<1)}function a(u,p){let x=0;for(let _=0;_<96;++_)for(let y=0;y<20;++y){let T;!p||_&32?T=n(s(_,y),s(_,y+(y&1?1:-1))):T=s(_,y),u[x++]=(T&1)*7+(T&2)*20+(T&4)*52+(T&8)*224+(T&16)*640+(T&32)*1664+(T&64)*7168+(T&128)*20480+(T&256)*53248+(T&512)*229376+(T&1024)*655360+(T&2048)*1703936}}a(this.normalGlyphs,!1);function c(u,p,x,_,y,T,D){for(let v=0;v<y;++v)for(let M=0;M<_;++M)t[u*60+(x+v)*6+(p+M)]=T&&(M===0||v===y-1)?0:D}for(let u=0;u<96;++u)u&32||(c(u,0,0,3,3,!1,!!(u&1)),c(u,3,0,3,3,!1,!!(u&2)),c(u,0,3,3,4,!1,!!(u&4)),c(u,3,3,3,4,!1,!!(u&8)),c(u,0,7,3,3,!1,!!(u&16)),c(u,3,7,3,3,!1,!!(u&64)));a(this.graphicsGlyphs,!0);for(let u=0;u<96;++u)u&32||(c(u,0,0,3,3,!0,!!(u&1)),c(u,3,0,3,3,!0,!!(u&2)),c(u,0,3,3,4,!0,!!(u&4)),c(u,3,3,3,4,!0,!!(u&8)),c(u,0,7,3,3,!0,!!(u&16)),c(u,3,7,3,3,!0,!!(u&64)));a(this.separatedGlyphs,!0)}setNextChars(){this.gfx?this.sep?this.nextGlyphs=this.separatedGlyphs:this.nextGlyphs=this.graphicsGlyphs:this.nextGlyphs=this.normalGlyphs}handleControlCode(t){const e=this.gfx,s=this.holdChar;switch(t){case 1:case 2:case 3:case 4:case 5:case 6:case 7:this.gfx=!1,this.col=t,this.setNextChars();break;case 8:this.flash=!0;break;case 9:this.flash=!1;break;case 12:case 13:this.dbl=!!(t&1),this.dbl&&(this.wasDbl=!0);break;case 17:case 18:case 19:case 20:case 21:case 22:case 23:this.gfx=!0,this.col=t&7,this.setNextChars();break;case 24:this.col=this.prevCol=this.bg;break;case 25:this.sep=!1,this.setNextChars();break;case 26:this.sep=!0,this.setNextChars();break;case 28:this.bg=0;break;case 29:this.bg=this.col;break;case 30:this.holdChar=!0;break;case 31:this.holdChar=!1;break}return e&&(s||this.holdChar)&&this.dbl===this.oldDbl?(t=this.heldChar,t>=64&&t<96&&(t=32),this.curGlyphs=this.heldGlyphs):(this.heldChar=32,t=32),t}fetchData(t){this.dataQueue.shift(),this.dataQueue.push(t&127)}setDEW(t){const e=this.levelDEW;this.levelDEW=t,!(!e||t)&&(this.scanlineCounter=0,this.secondHalfOfDouble=!1,++this.flashTime===64&&(this.flashTime=0),this.flashOn=this.flashTime<16)}setDISPTMG(t){const e=this.levelDISPTMG;this.levelDISPTMG=t,!(!e||t)&&(this.col=7,this.bg=0,this.holdChar=!1,this.heldChar=32,this.nextGlyphs=this.heldGlyphs=this.normalGlyphs,this.flash=!1,this.sep=!1,this.gfx=!1,this.dbl=!1,this.scanlineCounter++,this.scanlineCounter===10&&(this.scanlineCounter=0,this.secondHalfOfDouble?this.secondHalfOfDouble=!1:this.secondHalfOfDouble=this.wasDbl),this.wasDbl=!1)}setRA0(t){this.levelRA0=t}render(t,e){let s=this.dataQueue[0],n=this.scanlineCounter<<1;this.levelRA0&&n++,this.oldDbl=this.dbl,this.prevCol=this.col,this.curGlyphs=this.nextGlyphs;const a=this.flash;s<32?s=this.handleControlCode(s):this.gfx?s&32&&(this.heldChar=s,this.heldGlyphs=this.curGlyphs):this.heldChar=32,this.oldDbl&&(n=n>>>1,this.secondHalfOfDouble&&(n+=10));let c=this.curGlyphs[(s-32)*20+n];if(a&&this.flashOn||this.secondHalfOfDouble&&!this.dbl){const u=this.colour[(this.bg&7)<<5];for(let p=0;p<16;++p)t[e++]=u}else{const u=(this.bg&7)<<5|(this.prevCol&7)<<2;for(let p=0;p<16;++p)t[e+p]=this.colour[u+(c&3)],c>>>=2}}}const os=1,Hs=2,So=4,On=8,Wn=16,vr=32,au=os|Hs|So|On|Wn|vr;class Jb{constructor(t){this.video=t}write(t,e){if(t|=0,e|=0,t&1){const s=e>>>4&15;this.video.actualPal[s]=e&15;let n=e&7;e&8&&this.video.ulactrl&1||(n^=7),this.video.ulaPal[s]!==this.video.collook[n]&&(this.video.ulaPal[s]=this.video.collook[n])}else{if((this.video.ulactrl^e)&1){const n=!!(e&1);for(let a=0;a<16;++a){let c=this.video.actualPal[a]&7;n&&this.video.actualPal[a]&8||(c^=7),this.video.ulaPal[a]!==this.video.collook[c]&&(this.video.ulaPal[a]=this.video.collook[c])}}this.video.ulactrl=e,this.video.pixelsPerChar=e&16?8:16,this.video.halfClock=!(e&16);const s=e>>>2&3;s!==this.video.ulaMode&&(this.video.ulaMode=s),this.video.teletextMode=!!(e&2)}}}class ty{constructor(t){this.video=t,this.curReg=0,this.crtcmask=new Uint8Array([255,255,255,255,127,31,127,127,243,31,127,31,63,255,63,255,63,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0])}read(t){if(!(t&1))return 0;switch(this.curReg){case 12:case 13:case 14:case 15:case 16:case 17:return this.video.regs[this.curReg]}return 0}write(t,e){if(t&1)switch(this.video.regs[this.curReg]=e&this.crtcmask[this.curReg],this.curReg){case 3:this.video.hpulseWidth=e&15,this.video.vpulseWidth=(e&240)>>>4;break;case 8:{this.video.interlacedSyncAndVideo=(e&3)===3;const s=(e&48)>>>4;s<3?(this.video.displayEnableSkew=s,this.video.dispEnableSet(Wn)):this.video.dispEnableClear(Wn);break}case 14:case 15:this.video.cursorPos=(this.video.regs[15]|this.video.regs[14]<<8)&16383;break}else this.curReg=e&31}}function ou(i,t){for(let e=0;e<1024*768;++e)i[e]=t[e]}function Wa(i,t,e){let s=(t-i)*e+i;return s<0&&(s=0),s>255&&(s=255),s}function ey(i,t,e){e<0&&(e=0),e>1&&(e=1);const s=i>>>16&255,n=i>>>8&255,a=i>>>0&255,c=t>>>16&255,u=t>>>8&255,p=t>>>0&255,x=Wa(s,c,e),_=Wa(n,u,e),y=Wa(a,p,e);return x<<16|_<<8|y}function Ii(i,t){return i<<12|t<<4}class iy{constructor(t,e,s){this.isMaster=t,this.fb32=ls(e),this.collook=ls(new Uint32Array([4278190080,4278190335,4278255360,4278255615,4294901760,4294902015,4294967040,4294967295])),this.screenAddrAdd=new Uint16Array([16384,12288,24576,22528]),this.cursorTable=new Uint8Array([0,0,0,128,64,32,32]),this.cursorFlashMask=new Uint8Array([0,0,8,16]),this.regs=new Uint8Array(32),this.bitmapX=0,this.bitmapY=0,this.oddClock=!1,this.frameCount=0,this.doEvenFrameLogic=!1,this.isEvenRender=!0,this.lastRenderWasEven=!1,this.firstScanline=!0,this.inHSync=!1,this.inVSync=!1,this.hadVSyncThisRow=!1,this.checkVertAdjust=!1,this.endOfMainLatched=!1,this.endOfVertAdjustLatched=!1,this.endOfFrameLatched=!1,this.inVertAdjust=!1,this.inDummyRaster=!1,this.hpulseWidth=0,this.vpulseWidth=0,this.hpulseCounter=0,this.vpulseCounter=0,this.dispEnabled=vr,this.horizCounter=0,this.vertCounter=0,this.scanlineCounter=0,this.vertAdjustCounter=0,this.addr=0,this.lineStartAddr=0,this.nextLineStartAddr=0,this.ulactrl=0,this.pixelsPerChar=8,this.halfClock=!1,this.ulaMode=0,this.teletextMode=!1,this.displayEnableSkew=0,this.ulaPal=ls(new Uint32Array(16)),this.actualPal=new Uint8Array(16),this.teletext=new Zb,this.cursorOn=!1,this.cursorOff=!1,this.cursorOnThisFrame=!1,this.cursorDrawIndex=0,this.cursorPos=0,this.interlacedSyncAndVideo=!1,this.doubledScanlines=!0,this.frameSkipCount=0,this.screenAdd=0,this.topBorder=12,this.bottomBorder=13,this.leftBorder=5*16,this.rightBorder=3*16,this.paint_ext=s,this.debugPrevScreen=null,this.table4bpp=(()=>{const n=new Uint8Array(16384);let a,c,u,p;for(c=0;c<256;++c){for(u=c,a=0;a<16;++a)p=0,u&2&&(p|=1),u&8&&(p|=2),u&32&&(p|=4),u&128&&(p|=8),n[Ii(3,c)+a]=p,u<<=1,u|=1;for(a=0;a<16;++a)n[Ii(2,c)+a]=n[Ii(3,c)+(a>>>1)],n[Ii(1,c)+a]=n[Ii(3,c)+(a>>>2)],n[Ii(0,c)+a]=n[Ii(3,c)+(a>>>3)]}return n})(),this.crtc=new ty(this),this.ula=new Jb(this),this.reset(null),this.clearPaintBuffer(),this.paint()}reset(t,e){this.cpu=t,this.sysvia=e,e&&(e.cb2changecallback=this.cb2changed.bind(this))}paint(){this.paint_ext(this.leftBorder,this.topBorder,1024-this.rightBorder,625-this.bottomBorder)}clearPaintBuffer(){const t=this.fb32;if(this.interlacedSyncAndVideo||!this.doubledScanlines){let e=this.frameCount&1;for(;e<625;){const s=e*1024;t.fill(0,s,s+1024),e+=2}}else t.fill(0)}paintAndClear(){this.dispEnabled&vr&&(this.paint(),this.clearPaintBuffer()),this.dispEnabled&=-33;let t=vr;this.frameSkipCount>1&&this.frameCount%this.frameSkipCount&&(t=0),this.dispEnabled|=t,this.bitmapY=0,this.regs[8]&1&&this.frameCount&1&&(this.bitmapY=-1)}debugOffset(t,e){return t<0||t>=1024||e<0||e>=768?-1:e*1024+t}debugPaint(){this.debugPrevScreen||(this.debugPrevScreen=new Uint32Array(1024*768)),ou(this.debugPrevScreen,this.fb32);const t=10;for(let e=-10;e<=t;e++)for(let s=-10;s<=t;++s){const n=Math.sqrt(s*s+e*e)/t;if(n>1)continue;const a=this.debugOffset(this.bitmapX+s,this.bitmapY+e);this.fb32[a]=ey(this.fb32[a],16777215,Math.pow(1-n,2))}this.paint(),ou(this.fb32,this.debugPrevScreen)}blitFb(t,e,s){e|=0;const n=Ii(this.ulaMode,t),a=this.fb32,c=this.ulaPal,u=this.table4bpp;if(s===8)for(let p=0;p<8;++p)a[e+p]=c[u[n+p]];else for(let p=0;p<16;++p)a[e+p]=c[u[n+p]]}handleCursor(t){if(this.cursorOnThisFrame&&this.ulactrl&this.cursorTable[this.cursorDrawIndex]){for(let e=0;e<this.pixelsPerChar;++e)this.fb32[t+e]^=16777215;if(this.doubledScanlines&&!this.interlacedSyncAndVideo)for(let e=0;e<this.pixelsPerChar;++e)this.fb32[t+1024+e]^=16777215}++this.cursorDrawIndex===7&&(this.cursorDrawIndex=0)}setScreenAdd(t){this.screenAdd=this.screenAddrAdd[t]}readVideoMem(){if(this.addr&8192){let t=this.addr&1023;return this.addr&2048||this.isMaster?t|=31744:t|=15360,this.cpu.videoRead(t)}else{let t=this.scanlineCounter&7|this.addr<<3;return this.addr&4096&&(t+=this.screenAdd),this.cpu.videoRead(t&32767)}}endOfFrame(){this.vertCounter=0,this.firstScanline=!0,this.nextLineStartAddr=(this.regs[13]|this.regs[12]<<8)&16383,this.lineStartAddr=this.nextLineStartAddr,this.dispEnableSet(os);const t=(this.regs[10]&96)>>>5;this.cursorOnThisFrame=t===0||!!(this.frameCount&this.cursorFlashMask[t]),this.lastRenderWasEven=this.isEvenRender,this.isEvenRender=!(this.frameCount&1),this.inVSync||(this.doEvenFrameLogic=!1)}endOfCharacterLine(){this.vertCounter=this.vertCounter+1&127,this.scanlineCounter=0,this.hadVSyncThisRow=!1,this.dispEnableSet(On),this.cursorOn=!1,this.cursorOff=!1}endOfScanline(){this.firstScanline=!1,this.scanlineCounter===this.regs[11]&&(this.cursorOff=!0),this.vpulseCounter=this.vpulseCounter+1&15;const t=this.scanlineCounter===this.regs[9];t&&(this.lineStartAddr=this.nextLineStartAddr),this.interlacedSyncAndVideo?this.scanlineCounter=this.scanlineCounter+2&30:this.scanlineCounter=this.scanlineCounter+1&31,this.teletextMode||(this.scanlineCounter>>>3&1?this.dispEnableClear(On):this.dispEnableSet(On)),!this.inVertAdjust&&t&&this.endOfCharacterLine(),this.endOfMainLatched&&!this.endOfVertAdjustLatched&&(this.inVertAdjust=!0);let e=!1;this.endOfFrameLatched&&(e=!0),this.endOfVertAdjustLatched&&(this.inVertAdjust=!1,this.regs[8]&1&&this.doEvenFrameLogic?(this.inDummyRaster=!0,this.endOfFrameLatched=!0):e=!0),e&&(this.endOfMainLatched=!1,this.endOfVertAdjustLatched=!1,this.endOfFrameLatched=!1,this.inDummyRaster=!1,this.endOfCharacterLine(),this.endOfFrame()),this.addr=this.lineStartAddr;const s=this.regs[10]&31;this.scanlineCounter===s&&(this.cursorOn=!0);let n=this.scanlineCounter;this.interlacedSyncAndVideo&&this.frameCount&1&&n++,this.teletext.setRA0(!!(n&1))}handleHSync(){this.hpulseCounter=this.hpulseCounter+1&15,this.hpulseCounter===this.hpulseWidth>>>1?(this.bitmapX=-8,this.hpulseWidth&1&&(this.bitmapX-=4),this.bitmapY+=2,this.bitmapY>=768&&this.paintAndClear()):this.hpulseCounter===(this.regs[3]&15)&&(this.inHSync=!1)}cb2changed(t,e){t&&e&&(this.regs[16]=this.addr>>8&63,this.regs[17]=this.addr&255)}dispEnableChanged(){const t=Hs|os|Wn,e=(this.dispEnabled&t)===t;this.teletext.setDISPTMG(e)}dispEnableSet(t){this.dispEnabled|=t,this.dispEnableChanged()}dispEnableClear(t){this.dispEnabled&=~t,this.dispEnableChanged()}polltime(t){for(;t--;){if(this.oddClock=!this.oddClock,this.bitmapX+=8,this.halfClock&&!this.oddClock)continue;this.inHSync&&this.handleHSync();const e=this.displayEnableSkew+(this.teletextMode?2:0);this.horizCounter===e&&this.dispEnableSet(So),this.horizCounter===this.regs[1]&&(this.nextLineStartAddr=this.addr),(this.horizCounter===this.regs[1]+e||this.horizCounter===this.regs[0]+e)&&this.dispEnableClear(Hs|So),this.horizCounter===this.regs[2]&&!this.inHSync&&(this.inHSync=!0,this.hpulseCounter=0);const s=!!(this.regs[8]&1),n=this.horizCounter===this.regs[0]>>>1,a=!s||!this.doEvenFrameLogic||n;let c=!1,u=!1;this.inVSync&&this.vpulseCounter===this.vpulseWidth&&a&&(c=!0,this.inVSync=!1),this.vertCounter===this.regs[7]&&!this.inVSync&&!this.hadVSyncThisRow&&a&&(u=!0,this.inVSync=!0),u&&!c&&(this.hadVSyncThisRow=!0,this.vpulseCounter=0,this.regs[0]&&this.regs[4]&&this.paintAndClear()),(u||c)&&(this.sysvia.setVBlankInt(this.inVSync),this.teletext.setDEW(this.inVSync));const p=(this.dispEnabled&(Hs|os))===(Hs|os);if((p||this.cursorDrawIndex)&&this.dispEnabled&vr){const y=this.readVideoMem();if(p&&(this.teletextMode&&this.teletext.fetchData(y),this.addr===this.cursorPos&&this.cursorOn&&!this.cursorOff&&this.horizCounter<this.regs[1]&&(this.cursorDrawIndex=3-(this.regs[8]>>>6&3))),this.bitmapX>=0&&this.bitmapX<1024&&this.bitmapY<625){let T=!1,D=this.bitmapY;(this.doubledScanlines&&!this.interlacedSyncAndVideo||this.isEvenRender===this.lastRenderWasEven)&&(T=!0,D&=-2),D=D*1024+this.bitmapX,(this.dispEnabled&au)===au&&(this.teletextMode?this.teletext.render(this.fb32,D):this.blitFb(y,D,this.pixelsPerChar,T),T&&this.fb32.copyWithin(D+1024,D,D+this.pixelsPerChar)),this.cursorDrawIndex&&this.handleCursor(D,T)}}this.addr=this.addr+1&16383,this.checkVertAdjust&&(this.checkVertAdjust=!1,this.endOfMainLatched&&(this.vertAdjustCounter===this.regs[5]&&(this.endOfVertAdjustLatched=!0),this.vertAdjustCounter++,this.vertAdjustCounter&=31)),this.horizCounter===1&&(this.vertCounter===this.regs[4]&&this.scanlineCounter===this.regs[9]&&(this.endOfMainLatched=!0,this.vertAdjustCounter=0),this.checkVertAdjust=!0),this.horizCounter===this.regs[0]?(this.endOfScanline(),this.horizCounter=0,this.dispEnableSet(Hs)):this.horizCounter=this.horizCounter+1&255;const x=this.vertCounter===this.regs[6];x&&!this.firstScanline&&this.dispEnabled&os&&(this.dispEnableClear(os),this.frameCount++);const _=this.vertCounter===this.regs[7];(x||_)&&(this.doEvenFrameLogic=!!(this.frameCount&1))}}}class uf{constructor(){this.ula=this.crtc={read:function(){return 255},write:vo},this.regs=new Uint8Array(32)}reset(){}polltime(){}setScreenAdd(){}}const Sr=16;function lf(i){return'<span class="addr">'+Vt(i)+"</span>"}class sy{constructor(t,e){this._widget=t,this._peekMem=e,this._addr=0,this._prevSnapshot=new Uint8Array(65536),this._rows=[];const s=this._widget.find(".template");for(let n=0;n<Sr;n++)this._rows.push(s.clone().removeClass("template").appendTo(this._widget));s.remove(),t.bind("wheel",n=>{const a=n.originalEvent.deltaY;if(a===0)return;const c=a/20|0;this.update(this._addr+8*c),n.preventDefault()})}update(t){t!==void 0&&(this._addr=t);let e=this._addr-8*Math.floor(this._rows.length/2);e<0&&(e=0);for(const s of this._rows){s.find(".dis_addr").html(lf(e)),s.toggleClass("highlight",e===this._addr);const n=this.dump(e,e+8),a=s.find(".mem_bytes span"),c=s.find(".mem_asc span");for(let u=0;u<8;++u)U(a[u]).text(n.hex[u]).toggleClass("changed",n.changed[u]),U(c[u]).text(n.asc[u]).toggleClass("changed",n.changed[u]);e=e+8&65535}}dump(t,e){const s=[],n=[],a=[];for(let c=t;c<e;++c){const u=this._peekMem(c);s.push(et(u)),a.push(c<this._prevSnapshot.length&&this._prevSnapshot[c]!==u),u>=32&&u<128?n.push(String.fromCharCode(u)):n.push(".")}return{hex:s,asc:n,changed:a}}snapshot(){for(let t=0;t<65536;++t)this._prevSnapshot[t]=this._peekMem(t)}step(t){this.update(this._addr+t)}}class ry{constructor(t){this.video=t,this.patchInstructions={},this._enabled=!1,this.disass=U("#disassembly"),this._memoryView=new sy(U("#memory"),s=>this.cpu?this.cpu.peekmem(s):0),this.debugNode=U("#debug, #hardware_debug, #crtc_debug"),this.disassPc=0,this.disassStack=[],this.uservia=this.sysvia=this.crtc=null,this.breakpoints={};function e(s,n){const a=s.find(".goto-addr");s.on("submit",c=>{n(Bb(a.val())),a.val(""),a.blur(),c.preventDefault()})}e(U("#goto-mem-addr-form"),s=>this._memoryView.update(s)),e(U("#goto-dis-addr-form"),this.updateDisassembly.bind(this)),this.enable(!1);for(let s=0;s<Sr;s++)this.disass.find(".template").clone().removeClass("template").appendTo(this.disass);this.disass.find(".bp_gutter").click(this.bpClick.bind(this)),this.disass.bind("wheel",s=>{let n=s.originalEvent.deltaY;if(n===0)return;let a=this.disassPc;const c=n<0?this.prevInstruction.bind(this):this.nextInstruction.bind(this);for(n=Math.abs(n);n>0;)a=c(a),n-=30;this.updateDisassembly(a),s.preventDefault()})}setCpu(t){this.cpu=t,this.sysvia=this.setupVia(U("#sysvia"),t.sysvia),this.uservia=this.setupVia(U("#uservia"),t.uservia),this.crtc=this.setupCrtc(U("#crtc_debug"),t.video)}disassemble(t){return this.cpu.disassembler.disassemble(t)}setupCrtc(t,e){if(!e)return vo;const s=[],n=t.find(".crtc_regs");function a(x,_){const y=x.find(".template").clone().removeClass("template").appendTo(x);return y.find(".register").text(_),y.find(".value")}for(let x=0;x<16;++x){const _=a(n,"R"+x);s.push(()=>{this.updateElem(_,et(e.regs[x]))})}const c=t.find(".crtc_state"),u=["bitmapX","bitmapY","dispEnabled","horizCounter","inHSync","scanlineCounter","vertAdjustCounter","vertCounter","inVSync","endOfMainLatched","endOfVertAdjustLatched","inVertAdjust","inDummyRaster","addr","lineStartAddr","nextLineStartAddr"];for(const x of u){const _=a(c,x);typeof e[x]=="boolean"?s.push(()=>this.updateElem(_,e[x]?"true":"false")):s.push(()=>this.updateElem(_,Vt(e[x])))}const p=()=>{for(const x of s)x()};return p(),p}setupVia(t,e){const s=[];if(!e)return vo;const n=["ora","orb","ira","irb","ddra","ddrb","acr","pcr","ifr","ier","t1c","t1l","t2c","t2l","portapins","portbpins","IC32"];for(const c of n){if(e[c]===void 0)continue;const u=t.find(".template").clone().removeClass("template").appendTo(t);u.find(".register").text(c.toUpperCase());const p=u.find(".value");c.match(/t[12][cl]/)?s.push(()=>{const x=e[c];this.updateElem(p,et(x>>>16&255)+et(x>>>8&255)+et(x&255))}):s.push(()=>{this.updateElem(p,et(e[c]))})}const a=()=>{for(const c of s)c()};return a(),a}updateElem(t,e){const s=t.text();s!==e&&t.text(e),t.toggleClass("changed",s!==e&&s!=="")}updateRegisters(){this.updateElem(U("#cpu6502_a"),et(this.cpu.a)),this.updateElem(U("#cpu6502_x"),et(this.cpu.x)),this.updateElem(U("#cpu6502_y"),et(this.cpu.y)),this.updateElem(U("#cpu6502_s"),et(this.cpu.s)),this.updateElem(U("#cpu6502_pc"),Vt(this.cpu.pc));for(const t of["c","z","i","d","v","n"])this.updateElem(U("#cpu6502_flag_"+t),this.cpu.p[t]?t.toUpperCase():t)}execPatch(t){const e=t.split(",");if(e.length!==1){ce.each(e,this.execPatch);return}if(!t)return;const s=t.split(":");let n=parseInt(s[0],16);const a=s[1];for(let c=0;c<a.length;c+=2){const u=parseInt(a.substring(c,2),16);this.cpu.writemem(n,u),n++}}setPatch(t){if(ce.each(t.split(";"),e=>{if(e[0]==="@"){const s=parseInt(e.substring(1,4),16);e=e.substring(5),this.patchInstructions[s]||(this.patchInstructions[s]=[]),this.patchInstructions[s].push(e)}else this.execPatch(e)}),Object.keys(this.patchInstructions).length!==0){const e=this.cpu.debugInstruction.add(s=>{const n=this.patchInstructions[s];return n&&(ce.each(n,this.execPatch),delete this.patchInstructions[s],Object.keys(this.patchInstructions).length===0&&(console.log("All patches done"),e.remove())),!1})}}debug(t){this.enable(!0),this.updateDisassembly(t),this.updateRegisters(),this._memoryView.update(),this.sysvia(),this.uservia(),this.crtc(),this.video.debugPaint()}enable(t){this._enabled&&!t&&this.updatePrevMem(),this._enabled=t,this.debugNode.toggle(this._enabled)}enabled(){return this._enabled}updateDisassembly(t){this.disassPc=t;const e=this.disass.children().filter(":visible"),s=(n,a)=>{const c=this.disassemble(a),u=this._memoryView.dump(a,c[1]);n.find(".dis_addr").html(lf(a)),n.toggleClass("current",a===this.cpu.pc),n.toggleClass("highlight",a===this.disassPc),n.find(".instr_bytes").text(u.hex.join(" ")),n.find(".instr_asc").text(u.asc.join(""));const p=n.find(".disassembly").html(c[0]);return p.find(".instr_mem_ref").click(x=>this.memClick(x)),p.find(".instr_instr_ref").click(x=>this.instrClick(x)),n.find(".bp_gutter").toggleClass("active",!!this.breakpoints[a]),n.data({addr:a,ref:c[2]}),c[1]};for(let n=0;n<Sr/2;++n){const a=U(e[n+Sr/2]);t=s(a,t)}t=this.disassPc;for(let n=Sr/2-1;n>=0;--n){t=this.prevInstruction(t);const a=U(e[n]);s(a,t)}}prevInstruction(t){const e=/(RTS|B..|JMP|JSR|LD[AXY]|ST[AXY]|TA[XY]|T[XY]A|AD[DC]|SUB|SBC|CLC|SEC|CMP|EOR|ORR|AND|INC|DEC).*/,s=/.*,\s*([XY]|X\))$/;t&=65535;let n=t-1,a=0;for(let c=t-20;c!==t;c++){let u=0,p=c&65535;for(;p<t;){const x=this.disassemble(p);if(x[0]===this.cpu.pc&&(u+=10),x[0].match(e)&&!x[0].match(s)&&u++,x[1]===t&&u>a){a=u,n=p;break}p=x[1]}}return n}updatePrevMem(){this._memoryView.snapshot()}hide(){this.enable(!1)}stepUntil(t){this.cpu.targetCycles=this.cpu.currentCycles;for(let e=0;e<65536&&(this.cpu.execute(1),!t());e++);this.debug(this.cpu.pc)}step(){this.updatePrevMem();const t=this.cpu.pc;this.stepUntil(()=>this.cpu.pc!==t)}isUnconditionalJump(t){return!!this.disassemble(t)[0].match(/^(JMP|RTS|BRA)/)}stepOver(){if(this.updatePrevMem(),this.isUnconditionalJump(this.cpu.pc))return this.step();const t=this.nextInstruction(this.cpu.pc);this.stepUntil(()=>this.cpu.pc===t)}isReturn(t){return this.disassemble(t)[0]==="RTS"}stepOut(){this.updatePrevMem();const t=this.cpu.s;this.stepUntil(()=>{if(this.cpu.s>=t&&this.isReturn(this.cpu.pc)){const e=this.nextInstruction(this.cpu.pc);return this.step(),this.cpu.pc!==e}return!1})}nextInstruction(t){return this.disassemble(t)[1]&65535}instrClick(t){const e=U(t.target).data();this.disassStack.push(this.disassPc),this.updateDisassembly(e.ref)}memClick(t){const e=U(t.target).data();this._memoryView.update(e.ref)}toggleBreakpoint(t){this.breakpoints[t]?(console.log("Removing breakpoint from address "+Vt(t)),this.breakpoints[t].remove(),this.breakpoints[t]=void 0):(console.log("Adding breakpoint to address "+Vt(t)),this.breakpoints[t]=this.cpu.debugInstruction.add(e=>e===t))}bpClick(t){const e=U(t.target).closest(".dis_elem").data().addr;this.toggleBreakpoint(e),U(t.target).toggleClass("active",!!this.breakpoints[e])}keyPress(t){if(U(":focus").length>0)return!1;switch(String.fromCharCode(t)){case"b":this.disassStack.length&&this.updateDisassembly(this.disassStack.pop());break;case"k":this.updateDisassembly(this.prevInstruction(this.disassPc));break;case"j":this.updateDisassembly(this.nextInstruction(this.disassPc));break;case"t":this.toggleBreakpoint(this.disassPc),this.updateDisassembly(this.disassPc);break;case"u":this._memoryView.step(8);break;case"i":this._memoryView.step(-8);break;case"U":this._memoryView.step(64);break;case"I":this._memoryView.step(-64);break;case"n":this.step();break;case"N":this.updatePrevMem(),this.cpu.execute(1),self.debug(this.cpu.pc);break;case"m":this.stepOver();break;case"o":this.stepOut();break}return!0}}const cu=0,hu=1,uu=2,lu=3,fu=4,du=5,pu=6,mu=7,gu=8,_u=9,xu=10,bu=11,yu=12,Cu=13,vu=14,Su=15,Eu=64,Ga=32,ny=2,ay=1,oy=16,cy=8;class ff{constructor(t,e,s){this.cpu=t,this.irq=s,this.scheduler=e,this.ora=0,this.orb=0,this.ira=0,this.irb=0,this.ddra=0,this.ddrb=0,this.sr=0,this.t1l=0,this.t2l=0,this.t1c=0,this.t2c=0,this.acr=0,this.pcr=0,this.ifr=0,this.ier=0,this.t1hit=!1,this.t2hit=!1,this.portapins=0,this.portbpins=0,this.ca1=!1,this.ca2=!1,this.cb1=!1,this.cb2=!1,this.ca2changecallback=null,this.cb2changecallback=null,this.justhit=0,this.t1_pb7=0,this.task=this.scheduler.newTask(()=>this._onTimeout()),this.lastPolltime=0}reset(){this.ora=this.orb=0,this.ddra=this.ddrb=0,this.ifr=this.ier=0,this.t1c=this.t1l=this.t2c=this.t2l=131070,this.t1hit=this.t2hit=!0,this.acr=this.pcr=0,this.t1_pb7=1,this.updateNextTime()}updateNextTime(){let t=this.t1c;this.acr&32||(t=Math.min(this.t2c,t)),this.task.reschedule(Math.max(1,t))}_onTimeout(){this._catchUp()}_catchUp(){const t=this.scheduler.epoch-this.lastPolltime;t&&this._polltime(t),this.lastPolltime=this.scheduler.epoch,this.updateNextTime()}_polltime(t){t|=0,this.justhit=0;const e=this.t1c-t;if(e<-2?this.t1c=this._handleT1c(e):this.t1c=e,!(this.acr&32)){const s=this.t2c-t;s<-2?this.t2c=this._handleT2c(s):this.t2c=s}}_handleT1c(t){for(t<-2&&this.t1c>-3&&(this.t1hit||(this.ifr|=Eu,this.updateIFR(),t===-3&&(this.justhit|=1),this.t1_pb7=!this.t1_pb7),this.acr&64||(this.t1hit=!0));t<-3;)t+=this.t1l+4;return t}_handleT2c(t){return this.t2hit||(this.ifr|=Ga,this.updateIFR(),t===-3&&(this.justhit|=2),this.t2hit=!0),t+=131072,t}updateIFR(){this.ifr&this.ier&127?(this.ifr|=128,this.cpu.interrupt|=this.irq):(this.ifr&=-129,this.cpu.interrupt&=~this.irq)}write(t,e){this._catchUp();let s;switch(e|=0,t&15){case hu:this.ifr&=-3,(this.pcr&10)!==2&&(this.ifr&=-2),this.updateIFR(),s=this.pcr&14,s===8?this.setca2(!1):s===10&&(this.setca2(!1),this.setca2(!0));case Su:this.ora=e,this.recalculatePortAPins();break;case cu:this.ifr&=-17,(this.pcr&160)!==32&&(this.ifr&=-9),this.updateIFR(),this.orb=e,this.recalculatePortBPins(),s=(this.pcr&224)>>>4,s===8?this.setcb2(!1):s===10&&(this.setcb2(!1),this.setcb2(!0));break;case lu:this.ddra=e,this.recalculatePortAPins();break;case uu:this.ddrb=e,this.recalculatePortBPins();break;case bu:this.acr=e,this.justhit&1&&!(e&64)&&(this.t1hit=!0);break;case yu:this.pcr=e,(e&14)===12?this.setca2(!1):e&8&&this.setca2(!0),(e&224)===192?this.setcb2(!1):e&128&&this.setcb2(!0);break;case xu:this.sr=e;break;case pu:case fu:this.t1l&=130560,this.t1l|=e<<1;break;case mu:this.t1l&=510,this.t1l|=e<<9,this.justhit&1||(this.ifr&=-65,this.updateIFR());break;case du:this.t1l&=510,this.t1l|=e<<9,this.t1c=this.t1l+1,this.t1hit=!1,this.justhit&1||(this.ifr&=-65,this.updateIFR()),this.t1_pb7=0,this.updateNextTime();break;case gu:this.t2l&=130560,this.t2l|=e<<1;break;case _u:this.t2l&=510,this.t2l|=e<<9,this.t2c=this.t2l+1,this.acr&32&&(this.t2c-=2),this.justhit&2||(this.ifr&=-33,this.updateIFR()),this.t2hit=!1,this.updateNextTime();break;case vu:e&128?this.ier|=e&127:this.ier&=~(e&127),this.updateIFR();break;case Cu:this.ifr&=~(e&127),this.justhit&1&&(this.ifr|=Eu),this.justhit&2&&(this.ifr|=Ga),this.updateIFR();break}}read(t){switch(this._catchUp(),t&15){case hu:this.ifr&=-3,(this.pcr&10)!==2&&(this.ifr&=-2),this.updateIFR();case Su:return this.acr&1?this.ira:(this.recalculatePortAPins(),this.portapins);case cu:{this.ifr&=-17,(this.pcr&160)!==32&&(this.ifr&=-9),this.updateIFR(),this.recalculatePortBPins();let e=this.orb&this.ddrb;return this.acr&2?e|=this.irb&~this.ddrb:e|=this.portbpins&~this.ddrb,this.acr&128&&(e&=127,e|=this.t1_pb7<<7),e}case lu:return this.ddra;case uu:return this.ddrb;case pu:return(this.t1l&510)>>>1&255;case mu:return this.t1l>>>9&255;case fu:return this.justhit&1||(this.ifr&=-65,this.updateIFR()),this.t1c+1>>>1&255;case du:return this.t1c+1>>>9&255;case gu:return this.justhit&2||(this.ifr&=-33,this.updateIFR()),this.t2c+1>>>1&255;case _u:return this.t2c+1>>>9&255;case xu:return this.sr;case bu:return this.acr;case yu:return this.pcr;case vu:return this.ier|128;case Cu:return this.ifr;default:throw"Unknown VIA read"}}drivePortA(){}portAUpdated(){}drivePortB(){}portBUpdated(){}getJoysticks(){return{button1:!0,button2:!0}}recalculatePortAPins(){this.portapins=this.ora&this.ddra,this.portapins|=~this.ddra&255,this.drivePortA(),this.portAUpdated()}recalculatePortBPins(){const t=!!(this.portbpins&64);this.portbpins=this.orb&this.ddrb;const e=this.getJoysticks();e.button1||(this.portbpins|=16),e.button2||(this.portbpins|=32),this.portbpins|=~this.ddrb&255,this.drivePortB(),t&&!(this.portbpins&64)&&this.acr&32&&(this.t2c-=2,this.t2c<0&&(this.t2c=65535,this.ifr|=Ga,this.updateIFR())),this.portBUpdated()}setca1(t){if(t===this.ca1)return;!!(this.pcr&1)===t&&(this.acr&1&&(this.ira=this.portapins),this.ifr|=ny,this.updateIFR(),(this.pcr&12)===8&&this.setca2(!0)),this.ca1=t}setca2(t){if(t===this.ca2)return;this.ca2=t;const e=!!(this.pcr&8);if(this.ca2changecallback&&this.ca2changecallback(t,e),e)return;!!(this.pcr&4)===t&&(this.ifr|=ay,this.updateIFR())}setcb1(t){if(t===this.cb1)return;!!(this.pcr&16)===t&&(this.acr&2&&(this.irb=this.portbpins),this.ifr|=oy,this.updateIFR(),(this.pcr&192)===128&&this.setcb2(!0)),this.cb1=t}setcb2(t){if(t===this.cb2)return;this.cb2=t;const e=!!(this.pcr&128);if(this.cb2changecallback&&this.cb2changecallback(t,e),e)return;!!(this.pcr&64)===t&&(this.ifr|=cy,this.updateIFR())}}class hy extends ff{constructor(t,e,s,n,a,c,u,p){super(t,e,1),this.IC32=0,this.capsLockLight=!1,this.shiftLockLight=!1,this.keys=[];for(let x=0;x<16;++x)this.keys[x]=new Uint8Array(16);this.keyboardEnabled=!0,this.setKeyLayout(u),this.video=s,this.soundChip=n,this.cmos=a,this.isMaster=c,this.getGamepadsFunc=p,this.reset()}setKeyLayout(t){this.keycodeToRowCol=Ub(t)}setVBlankInt(t){this.setca1(t)}clearKeys(){for(let t=0;t<this.keys.length;++t)for(let e=0;e<this.keys[t].length;++e)this.keys[t][e]=!1;this.updateKeys()}disableKeyboard(){this.keyboardEnabled=!1,this.clearKeys()}enableKeyboard(){this.keyboardEnabled=!0,this.clearKeys()}set(t,e,s){if(!this.keyboardEnabled)return;const n=this.keycodeToRowCol[!!s][t];n&&(this.keys[n[0]][n[1]]=e,this.updateKeys())}keyDown(t,e){this.set(t,1,e)}keyUp(t){this.set(t,0,!0),this.set(t,0,!1)}keyDownRaw(t){this.keys[t[0]][t[1]]=1,this.updateKeys()}keyUpRaw(t){this.keys[t[0]][t[1]]=0,this.updateKeys()}keyToggleRaw(t){this.keys[t[0]][t[1]]=1-this.keys[t[0]][t[1]],this.updateKeys()}hasAnyKeyDown(){for(let e=0;e<13;++e)for(let s=0;s<8;++s)if(this.keys[e][s])return!0;return!1}updateKeys(){if(this.IC32&8){for(let e=0;e<13;++e)for(let s=1;s<8;++s)if(this.keys[e][s]){this.setca2(!0);return}}else{const e=this.portapins,s=e>>>4&7,n=e&15;if(this.keys[n][s]?this.ddra&128||(this.portapins|=128):this.portapins&=127,n<13){for(let a=1;a<8;++a)if(this.keys[n][a]){this.setca2(!0);return}}}this.setca2(!1)}portAUpdated(){this.updateKeys(),this.soundChip.updateSlowDataBus(this.portapins,!(this.IC32&1))}portBUpdated(){const t=this.portbpins;t&8?this.IC32|=1<<(t&7):this.IC32&=~(1<<(t&7)),this.capsLockLight=!(this.IC32&64),this.shiftLockLight=!(this.IC32&128),this.video.setScreenAdd((this.IC32&16?2:0)|(this.IC32&32?1:0)),this.isMaster&&this.cmos.writeControl(t,this.portapins,this.IC32),this.recalculatePortAPins()}drivePortA(){let t=255;this.isMaster&&(t&=this.cmos.read(this.IC32)),this.portapins&=t,this.updateKeys()}drivePortB(){}getGamepads(){return this.getGamepadsFunc?this.getGamepadsFunc():null}getJoysticks(){let t=!1,e=!1;const s=this.getGamepads();if(s&&s[0]){const n=s[0],a=s[1];t=n.buttons[10].pressed,e=a?a.buttons[10].pressed:n.buttons[11].pressed}return{button1:t,button2:e}}}class uy extends ff{constructor(t,e,s,n){super(t,e,2),this.isMaster=s,this.userPortPeripheral=n,this.reset()}portBUpdated(){this.userPortPeripheral.write(this.portbpins)}drivePortB(){this.portbpins&=this.userPortPeripheral.read()}}class ly{constructor(t,e,s,n){this.cpu=t,this.toneGen=e,this.rs423Handler=n,this.sr=0,this.cr=0,this.dr=0,this.rs423Selected=!1,this.motorOn=!1,this.tapeCarrierCount=0,this.tapeDcdLineLevel=!1,this.hadDcdHigh=!1,this.serialReceiveRate=0,this.serialReceiveCyclesPerByte=0,this.setSerialReceive(19200),this.txCompleteTask=s.newTask(()=>{this.sr|=2}),this.runTapeTask=s.newTask(()=>this.runTape()),this.runRs423Task=s.newTask(()=>this.runRs423())}updateIrq(){this.sr&this.cr&128?this.cpu.interrupt|=4:this.cpu.interrupt&=-5}reset(){this.sr&=12,this.sr|=2,this.hadDcdHigh=!1,this.updateIrq()}tone(t){t?this.toneGen.tone(t):this.toneGen.mute()}setMotor(t){t&&!this.motorOn?this.runTape():!t&&this.motorOn&&(this.toneGen.mute(),this.runTapeTask.cancel(),this.setTapeCarrier(!1)),this.motorOn=t}read(t){if(t&1)return this.sr&=-162,this.hadDcdHigh=!1,this.updateIrq(),this.dr;{let e=this.sr&127|this.sr&this.cr&128;return e&8&&(e&=-3),this.hadDcdHigh&&(e|=4),e}}write(t,e){t&1?(this.sr&=-3,this.txCompleteTask.reschedule(2e3),this.updateIrq(),this.rs423Selected&&this.rs423Handler&&this.rs423Handler.onTransmit(e)):(e&3)===3?this.reset():(this.cr=e,this.setSerialReceive(this.serialReceiveRate))}selectRs423(t){this.rs423Selected=!!t,this.rs423Selected?this.sr|=8:this.sr&=-9,this.dcdLineUpdated(),this.runRs423Task.ensureScheduled(this.rs423Selected,this.serialReceiveCyclesPerByte)}dcdLineUpdated(){const t=this.rs423Selected?!1:this.tapeDcdLineLevel;t&&!(this.sr&4)?(this.sr|=132,this.hadDcdHigh=!0):!t&&this.sr&4&&(this.sr&=-5),this.updateIrq()}setTapeCarrier(t){t?(this.tapeCarrierCount++,this.tapeDcdLineLevel=this.tapeCarrierCount===209):(this.tapeCarrierCount=0,this.tapeDcdLineLevel=!1),this.dcdLineUpdated()}receive(t){t|=0,this.sr&1?(console.log("Serial overrun"),this.sr|=160):(this.dr=t&(this.cr&16?255:127),this.sr|=129),this.updateIrq()}setTape(t){this.tape=t}rewindTape(){this.tape&&(console.log("rewinding tape"),this.tape.rewind())}secondsToCycles(t){return Math.floor(2*1e3*1e3*t)|0}numBitsPerByte(){const t=this.cr&16?8:7;let e,s;switch(this.cr>>>2&7){case 0:e=2,s=1;break;case 1:e=2,s=1;break;case 2:e=1,s=1;break;case 3:e=1,s=1;break;case 4:e=2,s=0;break;case 5:e=1,s=0;break;case 6:e=1,s=1;break;case 7:e=1,s=1;break}return t+e+s}rts(){return(this.cr&64)===0||(this.cr&96)===96}setSerialReceive(t){this.serialReceiveRate=t,this.serialReceiveCyclesPerByte=this.secondsToCycles(this.numBitsPerByte()/t)}runTape(){this.tape&&this.runTapeTask.reschedule(this.tape.poll(this))}runRs423(){if(!this.rs423Handler)return;const t=this.rs423Handler.tryReceive(this.rts());t>=0&&this.receive(t),this.runRs423Task.reschedule(this.serialReceiveCyclesPerByte)}}const fy=[19200,9600,4800,2400,1200,300,150,75];class dy{constructor(t){this.acia=t,this.reset()}reset(){this.reg=0,this.transmitRate=0,this.receiveRate=0}write(t,e){e&=255,this.reg=e,this.transmitRate=e&7,this.receiveRate=e>>>3&7,this.acia.setSerialReceive(fy[this.receiveRate]),this.acia.setMotor(!!(e&128)),this.acia.selectRs423(!!(e&64))}read(){return this.write(0,254),0}}const py=8,Nt=0,te=1,kt=2,Wt=3,Va=0,xn=1,Au=2,bn=3,wu=4,yn=5,Tu=6,Cn=7,Gt=128,$t=64,my=1,gy=2,_y=4,xy=8,by=16,yy=32,Cy=64,vy=128,Sy=my,Ey=gy,Ay=_y,wy=xy,Ka=by,qa=yy,Ty=Cy,ky=vy,ja=24;class Dy{constructor(t,e){this.hostCpu=t,this.parasiteCpu=e,this.internalStatusRegister=0,this.hostStatus=new Uint8Array(4),this.parasiteStatus=new Uint8Array(4),this.parasiteToHostData=[new Uint8Array(ja),new Uint8Array(1),new Uint8Array(2),new Uint8Array(1)],this.hostToParasiteData=[new Uint8Array(1),new Uint8Array(1),new Uint8Array(2),new Uint8Array(1)],this.parasiteToHostFifoByteCount1=0,this.parasiteToHostFifoByteCount3=0,this.hostToParasiteFifoByteCount3=0,this.debug=!1}reset(t=!0){t&&(this.internalStatusRegister=0);for(let e=0;e<4;e++)this.hostStatus[e]=$t,this.parasiteStatus[e]=$t,e===kt&&(this.hostStatus[e]|=Gt,this.parasiteToHostData[e][0]=0);this.parasiteToHostFifoByteCount1=0,this.parasiteToHostFifoByteCount3=1,this.hostToParasiteFifoByteCount3=0,this.updateInterrupts()}updateInterrupts(){this.hostStatus[Wt]&Gt&&this.internalStatusRegister&Sy?this.hostCpu.interrupt|=py:this.hostCpu.interrupt&=-9,this.parasiteStatus[Nt]&Gt&&this.internalStatusRegister&Ey||this.parasiteStatus[Wt]&Gt&&this.internalStatusRegister&Ay?this.parasiteCpu.interrupt=!0:this.parasiteCpu.interrupt=!1;const t=this.internalStatusRegister&Ka?2:1;this.internalStatusRegister&wy&&(this.hostToParasiteFifoByteCount3>=t||this.parasiteToHostFifoByteCount3===0)?this.parasiteCpu.NMI(!0):this.parasiteCpu.NMI(!1),this.parasiteCpu.resetHeldLow=this.internalStatusRegister&qa}hostRead(t){let e=254;switch(t&7){case Va:e=this.hostStatus[Nt]&(Gt|$t)|this.internalStatusRegister&-193;break;case xn:if(e=this.parasiteToHostData[Nt][0],this.hostStatus[Nt]&Gt){for(let s=1;s<ja;s++)this.parasiteToHostData[Nt][s-1]=this.parasiteToHostData[Nt][s];this.parasiteStatus[Nt]|=$t,this.parasiteToHostFifoByteCount1--,this.parasiteToHostFifoByteCount1===0&&(this.hostStatus[Nt]&=-129)}break;case Au:e=this.hostStatus[te];break;case bn:e=this.parasiteToHostData[te][0],this.parasiteStatus[te]|=$t,this.hostStatus[te]&=-129;break;case wu:e=this.hostStatus[kt];break;case yn:e=this.parasiteToHostData[kt][0],this.hostStatus[kt]&Gt&&(this.parasiteToHostData[kt][0]=this.parasiteToHostData[kt][1],this.parasiteStatus[kt]|=$t,this.parasiteToHostFifoByteCount3--,this.parasiteToHostFifoByteCount3===0&&(this.hostStatus[kt]&=-129));break;case Tu:e=this.hostStatus[Wt];break;case Cn:e=this.parasiteToHostData[Wt][0],this.parasiteStatus[Wt]|=$t,this.hostStatus[Wt]&=-129;break}return this.updateInterrupts(),this.debug&&console.log("TUBE ULA: host read "+Vt(t)+" = "+et(e)),e}hostWrite(t,e){switch(this.debug&&console.log("TUBE ULA: host write "+Vt(t)+" = "+et(e)),t&7){case Va:e&ky?this.internalStatusRegister|=e&-193:this.internalStatusRegister&=~(e&-193),e&Ty&&this.reset(!1),e&qa&&this.internalStatusRegister&qa&&this.parasiteCpu.reset(!0);break;case xn:this.hostStatus[Nt]&$t&&(this.hostToParasiteData[Nt][0]=e,this.parasiteStatus[Nt]|=Gt,this.hostStatus[Nt]&=-65);break;case bn:this.hostStatus[te]&$t&&(this.hostToParasiteData[te][0]=e,this.parasiteStatus[te]|=Gt,this.hostStatus[te]&=-65);break;case yn:this.hostStatus[kt]&$t&&(this.internalStatusRegister&Ka?(this.hostToParasiteFifoByteCount3<2&&(this.hostToParasiteData[this.hostToParasiteFifoByteCount3++]=e),this.hostToParasiteFifoByteCount3===2&&(this.parasiteStatus[kt]|=Gt,this.hostStatus[kt]&=-65)):(this.hostToParasiteData[kt][0]=e,this.hostToParasiteFifoByteCount3=1,this.parasiteStatus[kt]|=Gt,this.hostStatus[kt]&=-65));break;case Cn:this.hostStatus[Wt]&$t&&(this.hostToParasiteData[Wt][0]=e,this.parasiteStatus[Wt]|=Gt,this.hostStatus[Wt]&=-65);break}this.updateInterrupts()}parasiteRead(t){let e=0;switch(t&7){case Va:e=this.parasiteStatus[Nt];break;case xn:e=this.hostToParasiteData[Nt][0],this.hostStatus[Nt]|=$t,this.parasiteStatus[Nt]&=-129;break;case Au:e=this.parasiteStatus[te];break;case bn:e=this.hostToParasiteData[te][0],this.hostStatus[te]|=$t,this.parasiteStatus[te]&=-129;break;case wu:e=this.parasiteStatus[kt];break;case yn:e=this.hostToParasiteData[kt][0],this.parasiteStatus[kt]&Gt&&(this.hostToParasiteData[kt][0]=this.hostToParasiteData[kt][1],this.hostToParasiteFifoByteCount3--,this.hostToParasiteFifoByteCount3===0&&(this.hostStatus[kt]|=$t,this.parasiteStatus[kt]&=-129));break;case Tu:e=this.parasiteStatus[Wt];break;case Cn:e=this.hostToParasiteData[Wt][0],this.hostStatus[Wt]|=$t,this.parasiteStatus[Wt]&=-129;break}return this.updateInterrupts(),this.debug&&console.log("TUBE ULA: parasite read "+Vt(t)+" = "+et(e)),e}parasiteWrite(t,e){switch(this.debug&&console.log("TUBE ULA: parasite write "+Vt(t)+" = "+et(e)),t&7){case xn:this.parasiteStatus[Nt]&$t&&(this.parasiteToHostData[Nt][this.parasiteToHostFifoByteCount1++]=e,this.hostStatus[Nt]|=Gt,this.parasiteToHostFifoByteCount1===ja&&(this.parasiteStatus[Nt]&=-65));break;case bn:this.parasiteStatus[te]&$t&&(this.parasiteToHostData[te][0]=e,this.hostStatus[te]|=Gt,this.parasiteStatus[te]&=-65);break;case yn:this.parasiteStatus[kt]&$t&&(this.internalStatusRegister&Ka?(this.parasiteToHostFifoByteCount3<2&&(this.parasiteToHostData[kt][this.parasiteToHostFifoByteCount3++]=e),this.parasiteToHostFifoByteCount3===2&&(this.hostStatus[kt]|=Gt,this.parasiteStatus[kt]&=-65)):(this.parasiteToHostData[kt][0]=e,this.parasiteToHostFifoByteCount3=1,this.hostStatus[kt]|=Gt,this.parasiteStatus[kt]&=-65));break;case Cn:this.parasiteStatus[Wt]&$t&&(this.parasiteToHostData[Wt][0]=e,this.hostStatus[Wt]|=Gt,this.parasiteStatus[Wt]&=-65);break}this.updateInterrupts()}}class Ry{constructor(t,e){this.sysvia=t,this.task=e.newTask(this.onComplete.bind(this)),this.status=64,this.low=0,this.high=0}reset(){this.status=64,this.low=0,this.high=0}read(t){switch(t&3){case 0:return this.status;case 1:return this.high;case 2:return this.low}return 64}write(t,e){(t&3)===0&&(this.task.cancel(),this.task.schedule(e&8?2e4:8e3),this.status=e&15|128,this.sysvia.setcb1(!0))}onComplete(){let t=32768;const e=this.sysvia.getGamepads();if(e&&e[0]){const s=e[0],n=e[1];let a=0;switch(Math.floor(this.status&3)){default:case 0:a=s.axes[0];break;case 1:a=s.axes[1];break;case 2:n?a=n.axes[0]:a=s.axes[2];break;case 3:n?a=n.axes[1]:a=s.axes[3];break}t=Math.floor((1-a)/2*65535)}this.status=this.status&15|64|t>>>10&3,this.low=t&255,this.high=t>>>8&255,this.sysvia.setcb1(!1)}}const ku=4294967295;class Ly{static get MaxHeadroom(){return ku}constructor(){this.scheduled=null,this.epoch=0}schedule(t,e){if(t.scheduler!==this)throw new Error("Wrong scheduler for task, or non-task");if(t.scheduled())throw new Error("Task is already scheduled");const s=e+this.epoch;t.expireEpoch=s,t._scheduled=!0;let n=this.scheduled,a=null;for(;n&&n.expireEpoch<=s;)a=n,n=n.next;t.next=n,t.prev=a,t.next&&(t.next.prev=t),t.prev?t.prev.next=t:this.scheduled=t}cancel(t){t.scheduled()&&(t.prev?t.prev.next=t.next:this.scheduled=t.next,t.next&&(t.next.prev=t.prev),t.next=t.prev=null,t._scheduled=!1)}polltime(t){const e=this.epoch+t;for(;this.scheduled&&this.scheduled.expireEpoch<=e;){const s=this.scheduled;this.epoch=s.expireEpoch,s.cancel(),s.onExpire()}this.epoch=e}headroom(){return this.scheduled===null?ku:this.scheduled.expireEpoch-this.epoch}newTask(t){return new Py(this,t)}}class Py{constructor(t,e){this.scheduler=t,this.prev=null,this.next=null,this.expireEpoch=0,this.onExpire=e,this._scheduled=!1}scheduled(){return this._scheduled}schedule(t){this.scheduler.schedule(this,t)}reschedule(t){this.scheduler.cancel(this),this.scheduler.schedule(this,t)}cancel(){this.scheduler.cancel(this)}ensureScheduled(t,e){t?this.scheduled()||this.schedule(e):this.cancel()}}const Iy=8,Du=2*1e3*1e3/Iy;function Ru(i,t,e){return i=(i-e)/(1-2*e),i*t}class Oy{constructor(t){this.scheduler=t,this.mouse=[],this.outBuffer=new Xb(16),this.delay=0,this.mode=0,this.pollTask=this.scheduler.newTask(this.poll)}tryReceive(t){return this.outBuffer.size&&t?this.outBuffer.get():-1}doRead(){const a=Ru(this.mouse.x,120,.13),c=Ru(1-this.mouse.y,100,.03),u=[79,79,79,79],p=Math.min(255,Math.max(0,a))|0,x=Math.min(255,Math.max(0,c))|0;this.mouse.button&&(u[0]=64|(p&240)>>>4,u[1]=64|p&15,u[2]=64|(x&240)>>>4,u[3]=64|x&15);for(let _=0;_<4;++_)this.store(u[_]);this.store(46)}poll(){this.doRead(),this.pollTask.reschedule(Du)}store(t){this.outBuffer.put(t)}onMouse(t,e,s){this.mouse={x:t,y:e,button:s}}onTransmit(t){switch(String.fromCharCode(t)){case"M":this.mode=0;break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":this.mode=10*this.mode+t-48;break;case".":break;case"?":this.mode===1&&this.doRead();break}this.pollTask.ensureScheduled(this.mode===129||this.mode===130,Du)}}const Lu=5,Pu=860,My=5e4;class Ny{constructor(t){this.cpu=t,this.teletextStatus=15,this.teletextInts=!1,this.teletextEnable=!1,this.channel=0,this.currentFrame=0,this.totalFrames=0,this.rowPtr=0,this.colPtr=0,this.frameBuffer=new Array(16).fill(0).map(()=>new Array(64).fill(0)),this.streamData=null,this.pollCount=0}reset(t){t&&(console.log("Teletext adaptor: initialisation"),this.loadChannelStream(this.channel))}loadChannelStream(t){console.log("Teletext adaptor: switching to channel "+t);const e=this;Fe("teletext/txt"+t+".dat").then(function(s){e.streamData=s,e.totalFrames=s.length/Pu,e.currentFrame=0})}read(t){let e=0;switch(t){case 0:e=this.teletextStatus;break;case 1:break;case 2:e=this.frameBuffer[this.rowPtr][this.colPtr++];break;case 3:this.teletextStatus&=-209,this.cpu.interrupt&=-33;break}return e}write(t,e){switch(t){case 0:this.teletextInts=(e&8)===8,this.teletextInts&&this.teletextStatus&128?this.cpu.interrupt|=1<<Lu:this.cpu.interrupt&=-33,this.teletextEnable=(e&4)===4,(e&3)!==this.channel&&this.teletextEnable&&(this.channel=e&3,this.loadChannelStream(this.channel));break;case 1:this.rowPtr=e,this.colPtr=0;break;case 2:this.frameBuffer[this.rowPtr][this.colPtr++]=e&255;break;case 3:this.teletextStatus&=-209,this.cpu.interrupt&=-33;break}}polltime(t){this.pollCount+=t,this.pollCount>My&&(this.pollCount=0,this.cpu.resetLine?this.update():this.pollCount=-5e4*10)}update(){this.currentFrame>=this.totalFrames&&(this.currentFrame=0);const t=this.currentFrame*Pu+3*43;if(this.teletextStatus&=15,this.teletextStatus|=208,this.teletextEnable)for(let e=0;e<16;++e)if(this.streamData[t+e*43]!==0){this.frameBuffer[e][0]=103;for(let s=1;s<=42;s++)this.frameBuffer[e][s]=this.streamData[t+(e*43+(s-1))]}else this.frameBuffer[e][0]=0;this.currentFrame++,this.rowPtr=0,this.colPtr=0,this.teletextInts&&(this.cpu.interrupt|=1<<Lu)}}class Iu{constructor(){this.control1=0,this.control2=0,this.control3=0,this.control4=0,this.txfifo=new Uint8Array(3),this.rxfifo=new Uint8Array(3),this.txfptr=0,this.rxfptr=0,this.txftl=0,this.rxffc=0,this.rxap=0,this.status1=0,this.status2=0,this.sr2pse=0,this.cts=0,this.idle=0}}class Ke{constructor(...t){this.buffer=new Uint8Array(32*1024),this.pointer=0,this.bytesInBuffer=t.length,this.controlFlag=0,this.port=0;for(let e=0;e<t.length;e++)this.buffer[e]=t[e]}get full(){return this.pointer>=this.buffer.length}}class By{constructor(t,e,s,n,a){this.id=t,this.controlFlag=e,this.receivePort=s,this.bufferStart=n,this.bufferEnd=a,this.data=new Ke,this.stationId=0}}class Fy{constructor(t){this.TIME_BETWEEN_BYTES=128,this.SERVER_STATION_ID=254,this.FWH_Idle=0,this.FWH_RX_Scout_Received=1,this.FWH_RX_ScoutAck_Received=2,this.FWH_RX_Body_Received=3,this.FWH_TX_Scout_Sent=4,this.stationId=t,this.ADLC=new Iu,this.ADLCprev=new Iu,this.beebTx=new Ke,this.beebRx=new Ke,this.serverTx=new Ke,this.pollTotalCycles=0,this.pollNextTrigger=0,this.powers=[1,2,4,8],this.econetNMIEnabled=!0,this.econetStateChanged=!1,this.receiveBlocks=[],this.nextReceiveBlockNumber=1,this.wireState=this.FWH_Idle,this.wireStateEntryTimer=0,this.statusLight=!1,this.txPort=0,this.txControlFlag=0}copyBuffer(t,e){t.bytesInBuffer=e.bytesInBuffer,t.pointer=e.pointer,t.buffer=e.buffer.slice()}sniffBuffer(t){let e=Math.min(30,t.pointer),s="";for(let n=0;n<e;n++)s+=(t.buffer[n]<16?"0":"")+t.buffer[n].toString(16)+" ";return s+="("+t.pointer+" bytes)",s}deleteReceiveBlock(t){let e=this.receiveBlocks.findIndex(s=>s.id===t);e>=0&&this.receiveBlocks.splice(e,1)}activityLight(){return this.statusLight}advanceState(t){this.wireState=t,this.wireStateEntryTimer=this.pollTotalCycles,this.wireState>0&&(this.statusLight=!0)}polltime(t){if(this.pollTotalCycles+=t,this.pollNextTrigger<=this.pollTotalCycles||this.econetStateChanged){if(this.econetStateChanged=!1,this.wireState===this.FWH_Idle&&this.serverTx.bytesInBuffer>0&&(this.beebRx=new Ke(this.stationId,0,this.SERVER_STATION_ID,0,this.serverTx.controlFlag,this.serverTx.port),this.advanceState(this.FWH_RX_Scout_Received)),this.wireState===this.FWH_RX_ScoutAck_Received&&(this.copyBuffer(this.beebRx,this.serverTx),this.advanceState(this.FWH_RX_Body_Received)),this.pollTotalCycles>this.wireStateEntryTimer+1e6)if(this.wireState!==this.FWH_Idle)switch(this.wireState){case this.FWH_RX_Scout_Received:this.beebRx=new Ke(this.stationId,0,this.SERVER_STATION_ID,0,this.serverTx.controlFlag,this.serverTx.port),this.advanceState(this.FWH_RX_Scout_Received);break;case this.FWH_RX_Body_Received:this.copyBuffer(this.beebRx,this.serverTx),this.advanceState(this.FWH_RX_Body_Received);break;default:this.beebRx=new Ke(this.SERVER_STATION_ID,0,this.stationId,0)}else this.statusLight=!1;return this.updateRegisters(),this.pollNextTrigger<=this.pollTotalCycles&&(this.transmit(),this.receive()),this.status(),this.checkForNMI()}return!1}reset(){console.log("Econet: initialisation"),this.ADLC.control1=192,this.ADLC.control4=0,this.ADLC.control2=0,this.ADLC.control3=0,this.ADLC.status1=0,this.ADLC.status2=0,this.ADLC.sr2pse=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.txfptr=0,this.ADLC.txftl=0,this.ADLC.idle=1,this.ADLC.cts=0,this.irqcause=0,this.sr1b2cause=0,this.pollNextTrigger=this.pollTotalCycles+this.TIME_BETWEEN_BYTES,this.econetStateChanged=!0,this.receiveBlocks=[],this.nextReceiveBlockNumber=1}readRegister(t){return t===0?this.ADLC.status1:t===1?this.ADLC.status2:t>1&&(this.ADLC.control1&64)===0&&this.ADLC.rxfptr&&this.ADLC.rxfptr?(this.econetStateChanged=!0,this.ADLC.rxfifo[--this.ADLC.rxfptr]):0}writeRegister(t,e){t===0?this.ADLC.control1=e:t===1&&!(this.ADLC.control1&1)?this.ADLC.control2=e:t===1&&this.ADLC.control1&1?this.ADLC.control3=e:t===3&&this.ADLC.control1&1?this.ADLC.control4=e:(t===2||t===3)&&(this.ADLC.control1&128)===0&&(this.ADLC.txfifo[2]=this.ADLC.txfifo[1],this.ADLC.txfifo[1]=this.ADLC.txfifo[0],this.ADLC.txfifo[0]=e,this.ADLC.txfptr++,this.ADLC.txftl=this.ADLC.txftl<<1,t===3&&(this.ADLC.control2|=16)),this.econetStateChanged=!0}updateRegisters(){this.ADLCprev.status1=this.ADLC.status1,this.ADLCprev.status2=this.ADLC.status2,this.ADLC.control1&32&&(this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.control1&=-33),this.ADLC.control2&16&&(this.ADLC.txftl|=1,this.ADLC.control2&=-17),(this.ADLC.control2&32||this.ADLC.control1&64)&&(this.ADLC.control2&=-33,this.ADLC.status1&=-11,this.ADLC.status2&=-127,this.ADLC.control2&1&&this.ADLC.sr2pse?(this.ADLC.sr2pse++,this.ADLC.sr2pse>4&&(this.ADLC.sr2pse=0)):this.ADLC.sr2pse=0,this.sr1b2cause=0,this.ADLC.control1&64&&(this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0,this.ADLC.rxfptr=0,this.ADLC.rxap=0,this.ADLC.rxffc=0,this.ADLC.sr2pse=0)),(this.ADLC.control2&64||this.ADLC.control1&128)&&(this.ADLC.control2&=-65,this.ADLC.status1&=-113,this.ADLC.cts&&(this.ADLC.status1|=16,this.ADLCprev.status1|=16),this.ADLC.control1&128&&(this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.txfptr=0,this.ADLC.txftl=0)),this.ADLC.control4&32&&(this.ADLC.txfptr=0,this.ADLC.txftl=0,this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.control4&=-33)}transmit(){if(!(this.ADLC.control1&128)&&this.ADLC.txfptr){let t=!1;if(this.ADLC.txftl&this.powers[this.ADLC.txfptr-1]&&(t=!0),this.beebTx.full||this.ADLC.txfptr>4?(this.ADLC.status1|=32,this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0,this.ADLC.txfptr=0,this.ADLC.txftl=0):(this.beebTx.buffer[this.beebTx.pointer]=this.ADLC.txfifo[--this.ADLC.txfptr],this.beebTx.pointer++),t){if(this.beebTx.bytesInBuffer=this.beebTx.pointer,this.beebTx.bytesInBuffer===10&&this.beebTx.buffer[5]===0&&this.beebTx.buffer[4]>=130&&this.beebTx.buffer[4]<=136&&(this.beebRx=new Ke(this.stationId,0,this.SERVER_STATION_ID,0,1,0,96,3)),this.beebTx.bytesInBuffer===4&&(this.wireState===this.FWH_RX_Scout_Received&&this.advanceState(this.FWH_RX_ScoutAck_Received),this.wireState===this.FWH_RX_Body_Received&&(this.serverTx.bytesInBuffer=0,this.advanceState(this.FWH_Idle))),this.beebTx.bytesInBuffer>=6&&this.wireState===this.FWH_TX_Scout_Sent){let e=this.receiveBlocks.find(s=>s.receivePort===this.txPort);e&&(this.copyBuffer(e.data,this.beebTx),e.stationId=this.stationId,e.controlFlag=this.txControlFlag),this.beebRx=new Ke(this.stationId,0,this.SERVER_STATION_ID,0),this.advanceState(this.FWH_Idle)}this.beebTx.bytesInBuffer===6&&this.wireState===this.FWH_Idle&&(this.txControlFlag=this.beebTx.buffer[4],this.txPort=this.beebTx.buffer[5],this.receiveBlocks.find(e=>e.receivePort===this.txPort)&&(this.beebRx=new Ke(this.stationId,0,this.SERVER_STATION_ID,0),this.advanceState(this.FWH_TX_Scout_Sent))),this.beebTx.pointer=0,this.beebTx.bytesInBuffer=0}}}receive(){this.ADLC.control1&64||(this.beebRx.pointer<this.beebRx.bytesInBuffer&&this.ADLC.rxfptr<3&&(this.ADLC.rxfifo[2]=this.ADLC.rxfifo[1],this.ADLC.rxfifo[1]=this.ADLC.rxfifo[0],this.ADLC.rxfifo[0]=this.beebRx.buffer[this.beebRx.pointer],this.ADLC.rxfptr++,this.ADLC.rxffc=this.ADLC.rxffc<<1&7,this.ADLC.rxap=this.ADLC.rxap<<1&7,this.beebRx.pointer===0&&(this.ADLC.rxap|=1),this.beebRx.pointer++,this.beebRx.pointer>=this.beebRx.bytesInBuffer&&(this.ADLC.rxffc|=1,this.beebRx.pointer=0,this.beebRx.bytesInBuffer=0)),this.ADLC.rxfptr===0&&(this.ADLC.control1&=-33)),!(this.ADLC.control1&64)&&!this.ADLC.rxfptr&&!(this.ADLC.status2&2)&&this.beebRx.bytesInBuffer===0?this.ADLC.idle=!0:this.ADLC.idle=!1,this.pollNextTrigger=this.pollTotalCycles+this.TIME_BETWEEN_BYTES}status(){this.ADLC.control1&64||(this.ADLC.rxfptr&&!(this.ADLC.control2&2)||this.ADLC.rxfptr>1&&this.ADLC.control2&2?(this.ADLC.status1|=1,this.ADLC.status2|=128):(this.ADLC.status1&=-2,this.ADLC.status2&=-129)),this.ADLC.status1&=-9,this.ADLC.control2&128?(this.ADLC.cts=!1,this.ADLC.status1&=-17):this.ADLC.cts=!0,this.ADLC.control1&128&&this.ADLC.cts&&(this.ADLC.status1|=16),this.ADLC.txfptr>4&&(this.ADLC.status1|=32,this.ADLC.txfptr=4),this.ADLC.control1&128||(this.ADLC.control2&8?this.ADLC.txfptr?this.ADLC.status1&=-65:this.ADLC.status1|=64:(this.ADLC.txfptr<3&&!(this.ADLC.control2&2)||this.ADLC.txfptr<2&&this.ADLC.control2&2)&&!(this.ADLC.status1&16)&&!(this.ADLC.status2&32)?this.ADLC.status1|=64:this.ADLC.status1&=-65),this.ADLC.control1&64||(this.ADLC.rxfptr&&this.ADLC.rxap&this.powers[this.ADLC.rxfptr-1]?this.ADLC.status2|=1:this.ADLC.status2&=-2,this.ADLC.rxfptr&&this.ADLC.rxffc&this.powers[this.ADLC.rxfptr-1]&&(this.ADLC.status2|=2),this.ADLC.idle?this.ADLC.status2|=4:this.ADLC.status2&=-5),this.ADLC.status2&=-33,this.ADLC.rxfptr>4&&(this.ADLC.status2|=64,this.ADLC.rxfptr=4),this.ADLC.control2&1?(this.ADLC.sr2pse<=1&&this.ADLC.status2&122?(this.ADLC.sr2pse=1,this.ADLC.status2&=-134):this.ADLC.sr2pse<=2&&this.ADLC.status2&4?(this.ADLC.sr2pse=2,this.ADLC.status2&=-130):this.ADLC.sr2pse<=3&&this.ADLC.status2&1?(this.ADLC.sr2pse=3,this.ADLC.status2&=-129):this.ADLC.status2&128?(this.ADLC.sr2pse=4,this.ADLC.status2&=-3):this.ADLC.sr2pse=0,this.ADLC.status2&128?this.ADLC.status1|=1:this.ADLC.status1&=-2):this.ADLC.sr2pse=0}checkForNMI(){let t=!1;if(this.ADLC.status1!==this.ADLCprev.status1||this.ADLC.status2!==this.ADLCprev.status2){let e,s;e=(this.ADLC.status2^this.ADLCprev.status2)&this.ADLC.status2&-129,this.ADLC.control1&2||(e=0),e?(this.ADLC.status1|=2,this.sr1b2cause=this.sr1b2cause|e):this.ADLC.status2&this.sr1b2cause||(this.ADLC.status1&=-3,this.sr1b2cause=0),e=(this.ADLC.status1^this.ADLCprev.status1)&this.ADLC.status1&-129,this.ADLC.control1&2||(e=e&-12),this.ADLC.control1&4||(e=e&-113),e&&(t=!0,this.irqcause=this.irqcause|e,this.ADLC.status1|=128),s=(this.ADLC.status1^this.ADLCprev.status1)&this.ADLCprev.status1&-129,s&&(this.irqcause=this.irqcause&~s,this.irqcause===0?this.ADLC.status1&=-129:this.ADLC.control2&1&&(t=!0))}return t}}class Uy{constructor(t,e){this.cpu=t,this.econet=e,this.scsi=[],this.l3fs=[],this.pollCount=0,this.ram=new Uint8Array(96*1024),this.emulationSpeed=0,this.logTemp="",this.A=this.X=this.Y=this.SP=this.M=0,this.PC=this.XPC=this.L=this.R=0,this.N=this.V=this.Z=this.C=this.F=0}GBYTE(){return this.ram[this.PC++]}GWORD(){return this.ram[this.PC++]|this.ram[this.PC++]<<8}WORD(t){return this.ram[t]|this.ram[t+1]<<8}PUSH(t){this.ram[256+this.SP]=t,this.SP--,this.SP&=255}PULL(){return this.SP++,this.SP&=255,this.ram[256+this.SP]}NZ(t){return t&=255,this.Z=0|t===0,this.N=0|t>=128,t}oswrch(t){this.emulationSpeed===0&&(t>=32&&t<=127&&(this.logTemp+=String.fromCharCode(t)),t===13&&(console.log("Filestore: "+this.logTemp.trim()),this.logTemp.includes("Starting")&&(this.emulationSpeed=20),this.logTemp=""))}osword(){let t=this.Y<<8|this.X;switch(this.A){case 0:{let e=this.ram[t]|this.ram[t+1]<<8;this.ram[e]=49,this.ram[e+1]=13,this.Y=1,this.C=0,this.oswrch(49);break}case 14:{const e=new Date;this.ram[t]=e.getFullYear()-2e3,this.ram[t+1]=e.getMonth()+1,this.ram[t+2]=e.getDate(),this.ram[t+3]=e.getDay()+1,this.ram[t+4]=e.getHours(),this.ram[t+5]=e.getMinutes(),this.ram[t+6]=e.getSeconds();break}case 16:{let e=this.ram[t+2];if(e!==255){let s=(this.ram[t+4]|this.ram[t+5]<<8|this.ram[t+6]<<16|this.ram[t+7]<<24)>>>0,a=((this.ram[t+8]|this.ram[t+9]<<8|this.ram[t+10]<<16|this.ram[t+11]<<24)>>>0)-s;s>=65536&&(s=s&65535|65536),this.econet.serverTx=new Ke(e,0,254,0),this.econet.serverTx.controlFlag=this.ram[t],this.econet.serverTx.port=this.ram[t+1];for(let c=0;c<a;c++)this.econet.serverTx.buffer[c+4]=this.ram[s+c];this.econet.serverTx.bytesInBuffer=4+a}break}case 17:{if(this.ram[t+0]===0){let e=new By(this.econet.nextReceiveBlockNumber,this.ram[t+1],this.ram[t+2],(this.ram[t+5]|this.ram[t+6]<<8|this.ram[t+7]<<16|this.ram[t+8]<<24)>>>0,(this.ram[t+9]|this.ram[t+10]<<8|this.ram[t+11]<<16|this.ram[t+12]<<24)>>>0);this.econet.receiveBlocks.push(e),this.ram[t]=this.econet.nextReceiveBlockNumber,this.econet.nextReceiveBlockNumber++,this.econet.nextReceiveBlockNumber&=255,this.econet.nextReceiveBlockNumber===0&&(this.econet.nextReceiveBlockNumber=1)}else{let e=this.econet.receiveBlocks.find(n=>n.id===this.ram[t+0]);e.bufferStart+e.data.bytesInBuffer-4<e.bufferEnd&&(e.bufferEnd=e.bufferStart+e.data.bytesInBuffer-4),this.ram[t+1]=e.controlFlag,this.ram[t+2]=e.receivePort,this.ram[t+3]=e.stationId,this.ram[t+4]=0,this.ram[t+5]=e.bufferStart&255,this.ram[t+6]=e.bufferStart>>>8&255,this.ram[t+7]=e.bufferStart>>>16&255,this.ram[t+8]=e.bufferStart>>>24&255,this.ram[t+9]=e.bufferEnd&255,this.ram[t+10]=e.bufferEnd>>>8&255,this.ram[t+11]=e.bufferEnd>>>16&255,this.ram[t+12]=e.bufferEnd>>>24&255;let s=e.bufferStart;s>=65536&&(s=s&65535|65536);for(let n=0;n<e.bufferEnd-e.bufferStart;n++)this.ram[s+n]=e.data.buffer[n+4];this.econet.deleteReceiveBlock(this.ram[t])}break}case 19:this.ram[t+1]=254;break;case 114:{let e=(this.ram[t+1]|this.ram[t+2]<<8|this.ram[t+3]<<16|this.ram[t+4]<<24)>>>0;e>=65536&&(e=e&65535|65536);let s=4,n=(this.ram[t+6]&31)<<16|this.ram[t+7]<<8|this.ram[t+8],a=this.ram[t+9]*256;switch(a||(a=this.ram[t+11]|(this.ram[t+12]<<8|this.ram[t+13]<<16|this.ram[t+14]<<24>>>0)),this.ram[t+5]){case 8:case 10:if(this.ram[t+5]===8)for(let c=n*256;c<n*256+a;c++)this.ram[e++]=this.scsi[c];else for(let c=n*256;c<n*256+a;c++)this.scsi[c]=this.ram[e++];s=0;break}this.ram[t]=s;break}case 115:this.ram[t]=0,this.ram[t+1]=0,this.ram[t+2]=0,this.ram[t+3]=0,this.ram[t+4]=0;break;default:console.log("Filestore: unhandled osword 0x"+this.A.toString(16));break}}osbyte(){switch(this.A){case 13:case 14:case 15:break;case 50:this.econet.serverTx.bytesInBuffer>0?this.X=128:this.X=0;break;case 51:{let t=this.econet.receiveBlocks.find(e=>e.id===this.X);this.X=0,t&&(this.X=t.controlFlag,this.X>=128&&(this.X=t.controlFlag));break}case 52:this.econet.deleteReceiveBlock(this.X);break;case 53:break;case 133:this.X=0,this.Y=128;break;case 134:this.X=this.Y=0;break;case 135:case 150:case 151:break;case 180:this.X=0;break;case 229:break;default:console.log("Filestore: unhandled osbyte 0x"+this.A.toString(16));break}}reset(){console.log("Filestore: initialisation");const t=this;Fe("econet/L3FS.dat").then(function(e){t.l3fs=e;for(let s=0;s<e.length;s++)t.ram[1024+s]=e[s];t.PC=1024,t.SP=255,t.A=1}),Fe("econet/scsi.dat").then(function(e){t.scsi=e})}polltime(t){if(this.pollCount+=t,this.pollCount>this.emulationSpeed){this.pollCount=0;let e,s,n,a=0;if(this.XPC=this.PC,this.PC>=63488?e=96:e=this.GBYTE(),s=e&31,n=s&3,a=e>>5,s===0&&a<4)switch(a){case 0:this.PC=this.WORD(514);break;case 1:this.L=this.GWORD(),this.PUSH(--this.PC>>8),this.PUSH(this.PC),this.PC=this.L;break;case 2:break;case 3:this.PC=this.PULL(),this.PC|=this.PULL()<<8,this.PC++;break}else if(s===8)switch(a){case 0:this.M=this.N<<7|this.V<<6|this.Z<<1|this.C,this.PUSH(this.M);break;case 1:this.M=this.PULL(),this.N=(this.M&128)>0,this.V=(this.M&64)>0,this.Z=(this.M&2)>0,this.C=this.M&1;break;case 2:this.PUSH(this.A);break;case 3:this.A=this.NZ(this.PULL());break;case 4:this.Y--,this.Y&=255,this.NZ(this.Y);break;case 5:this.Y=this.NZ(this.A);break;case 6:this.Y++,this.Y&=255,this.NZ(this.Y);break;case 7:this.X++,this.X&=255,this.NZ(this.X);break}else if(s===10&&a>3)switch(a){case 4:this.A=this.NZ(this.X);break;case 5:this.X=this.NZ(this.A);break;case 6:this.X--,this.X&=255,this.NZ(this.X);break}else if(s===16){let c=~a&1;switch(a>>1){case 0:c^=this.N;break;case 1:c^=this.V;break;case 2:c^=this.C;break;case 3:c^=this.Z;break}this.M=this.GBYTE(),c&&(this.M&128&&(this.PC-=256),this.PC+=this.M)}else if(s===24)switch(a){case 0:this.C=0;break;case 1:this.C=1;break;case 2:break;case 3:break;case 4:this.A=this.NZ(this.Y);break;case 5:this.V=0;break}else if(s===26)a&1?this.X=this.NZ(this.SP):this.SP=this.X;else{let c=0,u=0,p=0;if(s===10)c=1;else if(s===1)this.L=this.GBYTE()+this.X,this.L=this.WORD(this.L);else if(s===25||e===190)this.L=this.GWORD()+this.Y;else switch(s>>2){case 0:case 2:u=1;break;case 1:this.L=this.GBYTE();break;case 3:this.L=this.GWORD();break;case 4:this.L=this.GBYTE(),this.L=this.WORD(this.L)+this.Y;break;case 5:e===150?this.L=this.GBYTE()+this.Y:this.L=this.GBYTE()+this.X;break;case 7:this.L=this.GWORD()+this.X;break}switch(c?this.M=this.A:u?this.M=this.GBYTE():this.M=this.ram[this.L],n){case 0:switch(a){case 1:this.NZ(this.A&this.M),this.V=(this.M&64)>0,this.N=(this.M&128)>0;break;case 2:this.PC=this.L;break;case 3:this.PC=this.WORD(this.L);break;case 4:this.M=this.Y,p=1;break;case 5:this.Y=this.NZ(this.M);break;case 6:this.NZ(this.Y-this.M),this.C=this.Y>=this.M;break;case 7:this.NZ(this.X-this.M),this.C=this.X>=this.M;break}break;case 1:switch(a){case 0:this.A=this.NZ(this.A|this.M);break;case 1:this.A=this.NZ(this.A&this.M);break;case 2:this.A=this.NZ(this.A^this.M);break;case 7:this.M=~this.M&255;case 3:this.R=this.A+this.M+this.C,this.C=this.R>=256,this.V=((this.A^this.R)&(this.M^this.R)&128)>0,this.A=this.NZ(this.R);break;case 4:this.M=this.A,p=1;break;case 5:this.A=this.NZ(this.M);break;case 6:this.NZ(this.A-this.M),this.C=this.A>=this.M;break}break;case 2:switch(p=1,a){case 0:this.C=0;case 1:this.F=(this.M&128)>0,this.M=this.NZ(this.M<<1|this.C),this.C=this.F;break;case 2:this.C=0;case 3:this.F=this.M&1,this.M=this.NZ(this.M>>1|this.C<<7),this.C=this.F;break;case 4:this.M=this.X;break;case 5:this.X=this.NZ(this.M),p=0;break;case 6:this.M--,this.M&=255,this.NZ(this.M);break;case 7:this.M++,this.M&=255,this.NZ(this.M);break}break}p&&(c?this.A=this.M:this.ram[this.L]=this.M)}if(this.PC>=63488)switch(this.PC){case 63488:break;case 65504:this.A=83,this.C=0;break;case 65521:this.osword();break;case 65524:this.osbyte();break;case 65511:case 65507:case 65518:this.oswrch(this.A);break}}}}const $y=sf;function Ms(i,t,e){return i&~t|(e?t:0)}class Hy{constructor(){this._byte=48}get c(){return!!(this._byte&1)}set c(t){this._byte=Ms(this._byte,1,t)}get z(){return!!(this._byte&2)}set z(t){this._byte=Ms(this._byte,2,t)}get i(){return!!(this._byte&4)}set i(t){this._byte=Ms(this._byte,4,t)}get d(){return!!(this._byte&8)}set d(t){this._byte=Ms(this._byte,8,t)}get v(){return!!(this._byte&64)}set v(t){this._byte=Ms(this._byte,64,t)}get n(){return!!(this._byte&128)}set n(t){this._byte=Ms(this._byte,128,t)}reset(){this._byte=48}debugString(){return(this.n?"N":"n")+(this.v?"V":"v")+"xx"+(this.d?"D":"d")+(this.i?"I":"i")+(this.z?"Z":"z")+(this.c?"C":"c")}setzn(t){return t&=255,this._byte=this._byte&-131|t&128|(t===0?2:0),t|0}asByte(){return this._byte|48}setFromByte(t){this._byte=t|48}}class df{constructor(t){this.model=t,this.a=this.x=this.y=this.s=0,this.p=new Hy,this.pc=0,this.opcodes=t.opcodesFactory(this),this.disassembler=this.opcodes.disassembler,this.forceTracing=!1,this.runner=this.opcodes.runInstruction,this.interrupt=0,this._nmiLevel=!1,this._nmiEdge=!1,t.nmos?(this.adc=function(e){this.p.d?this.adcBCD(e):this.adcNonBCD(e)},this.sbc=function(e){this.p.d?this.sbcBCD(e):this.adcNonBCD(e^255)}):(this.adc=function(e){this.p.d?this.adcBCDcmos(e):this.adcNonBCD(e)},this.sbc=function(e){this.p.d?this.sbcBCDcmos(e):this.adcNonBCD(e^255)})}incpc(){this.pc=this.pc+1&65535}getb(){const t=this.readmem(this.pc);return this.incpc(),t|0}getw(){let t=this.readmem(this.pc)|0;return this.incpc(),t|=(this.readmem(this.pc)|0)<<8,this.incpc(),t|0}checkInt(){this.takeInt=!!(this.interrupt&&!this.p.i),this.takeInt|=this._nmiEdge}writemem(t,e){throw new Error("Must be overridden")}writememZpStack(t,e){this.writemem(t,e)}readmem(t){throw new Error("Must be overridden")}readmemZpStack(t){return this.readmem(t)}push(t){this.writememZpStack(256+this.s,t),this.s=this.s-1&255}pull(){return this.s=this.s+1&255,this.readmemZpStack(256+this.s)}get nmi(){return this._nmiLevel}NMI(t){const e=this._nmiLevel;this._nmiLevel=!!t,this._nmiLevel&&!e&&(this._nmiEdge=!0)}polltime(){throw new Error("Must be overridden")}brk(t){let e=this.pc;t||(e=e+1&65535),this.readmem(e),this.push(e>>>8),this.push(e&255);let s=this.p.asByte();t&&(s&=-17),this.push(s),this.polltime(4);let n=65534;(this.model.nmos||t)&&this._nmiEdge&&(n=65530,this._nmiEdge=!1),this.takeInt=!1,this.pc=this.readmem(n)|this.readmem(n+1)<<8,this.p.i=!0,this.model.nmos?this.polltime(3):(this.p.d=!1,t?this.polltime(3):(this.polltime(2),this.checkInt(),this.polltime(1)))}branch(t){const e=$y(this.getb());if(!t){this.polltime(1),this.checkInt(),this.polltime(1);return}const s=this.pc+e&65535,n=!!(this.pc&65280^s&65280);if(this.pc=s,!this.model.nmos)this.polltime(2+n),this.checkInt(),this.polltime(1);else if(!n)this.polltime(1),this.checkInt(),this.polltime(2);else{this.polltime(1),this.checkInt();const a=this.takeInt;this.polltime(2),this.checkInt(),this.takeInt|=a,this.polltime(1)}}adcNonBCD(t){const e=this.a+t+(this.p.c?1:0);this.p.v=!!((this.a^e)&(t^e)&128),this.p.c=!!(e&256),this.a=this.p.setzn(e)}adcBCD(t){let e=0;const s=this.a+t+(this.p.c?1:0)&255;this.p.z=!s;let n=(this.a&15)+(t&15)+(this.p.c?1:0);n>9&&(n-=10,n&=15,e=1),e+=(this.a>>>4)+(t>>>4),this.p.n=!!(e&8),this.p.v=!((this.a^t)&128)&&!!((this.a^e<<4)&128),this.p.c=!1,e>9&&(this.p.c=!0,e-=10,e&=15),this.a=(n&15|e<<4)&255}sbcBCD(t){const e=this.p.c?0:1;let s=(this.a&15)-(t&15)-e,n=(this.a>>>4)-(t>>>4);s&16&&(s=s-6&15,n--),n&16&&(n=n-6&15);const a=this.a-t-e;this.p.n=!!(a&128),this.p.z=!(a&255),this.p.v=!!((this.a^a)&(t^this.a)&128),this.p.c=!(a&256),this.a=s|n<<4}adcBCDcmos(t){this.polltime(1);const e=this.p.c?1:0;let s=(this.a&15)+(t&15)+e,n=(this.a>>>4)+(t>>>4);s>9&&(s=s-10&15,n++),this.p.v=!((this.a^t)&128)&&!!((this.a^n<<4)&128),this.p.c=!1,n>9&&(n=n-10&15,this.p.c=!0),this.a=this.p.setzn(s|n<<4)}sbcBCDcmos(t){this.polltime(1);const e=this.p.c?0:1,s=(this.a&15)-(t&15)-e;let n=this.a-t-e;n<0&&(n-=96),s<0&&(n-=6),this.adcNonBCD(t^255),this.a=this.p.setzn(n)}arr(t){if(this.p.d){const e=this.a&t,s=e>>>4,n=e&15;this.p.n=this.p.c,this.a=e>>>1|(this.p.c?128:0),this.p.z=!this.a,this.p.v=(e^this.a)&64,n+(n&1)>5&&(this.a=this.a&240|this.a+6&15),this.p.c=s+(s&1)>5,this.p.c&&(this.a=this.a+96&255)}else this.a=this.a&t,this.p.v=!!((this.a>>>7^this.a>>>6)&1),this.a>>>=1,this.p.c&&(this.a|=128),this.p.setzn(this.a),this.p.c=!!(this.a&64)}}class zy extends df{constructor(t,e){super(t),this.cycles=0,this.romPaged=!0,this.memory=new Uint8Array(65536),this.rom=new Uint8Array(4096),this.tube=new Dy(e,this)}reset(t){this.romPaged=!0,this.pc=this.readmem(65532)|this.readmem(65533)<<8,this.p.i=!0,this.tube.reset(t)}readmem(t){return(t&65528)===65272?((t&7)===0&&(this.romPaged=!1),this.tube.parasiteRead(t)):this.romPaged&&(t&61440)===61440?this.rom[t&4095]:this.memory[t&65535]}readmemZpStack(t){return this.memory[t&65535]}writemem(t,e){if((t&65528)===65272)return this.tube.parasiteWrite(t,e);this.memory[t&65535]=e}writememZpStack(t,e){this.memory[t&65535]=e}polltime(t){this.cycles-=t}polltimeAddr(t){this.polltime(t)}read(t){return this.tube.hostRead(t)}write(t,e){this.tube.hostWrite(t,e)}execute(t){if(this.cycles+=t*2,!(this.cycles<3))for(;this.cycles>0;){const e=this.readmem(this.pc);this.incpc(),this.runner.run(e),this.takeInt&&this.brk(!0)}}async loadOs(){console.log("Loading tube rom from roms/"+this.model.os);const t=this.rom,e=await Fe("roms/"+this.model.os),s=e.length;if(s!==2048)throw new Error("Broken ROM file (length="+s+")");for(let n=0;n<s;++n)t[n+2048]=e[n]}}class Wy{read(){return 254}write(){}execute(){}reset(){}}class Gy{write(){}read(){return 255}}function Vy(i){return i===void 0&&(i={}),i.keyLayout||(i.keyLayout="physical"),i.cpuMultiplier||(i.cpuMultiplier=1),i.userPort||(i.userPort=new Gy),i.printerPort===void 0&&(i.printerPort=null),i.extraRoms=i.extraRoms||[],i.debugFlags=i.debugFlags||{},i}class Ya{constructor(t,e){this.cpu=t,this.functionName=e,this.handlers=[]}add(t){const e=this;return this.handlers.push(t),this.cpu[this.functionName]||(this.cpu[this.functionName]=function(){for(let s=0;s<e.handlers.length;++s){const n=e.handlers[s];if(n.apply(n,arguments))return e.cpu.stop(),!0}return!1}),t.remove=function(){e.remove(t)},t}remove(t){const e=this.handlers.indexOf(t);if(e<0)throw"Unable to find debug hook handler";this.handlers=this.handlers.slice(0,e).concat(this.handlers.slice(e+1)),this.handlers.length===0&&(this.cpu[this.functionName]=null)}clear(){this.handlers=[],this.cpu[this.functionName]=null}}function Ky(i){const t=[!0,!1,!0,!0,!1,!1,!0,!1];return i>=64512&&i<65280&&(i<65024||t[i>>>5&7])}let pf=class extends df{constructor(t,e,s,n,a,c,u,p,x){super(t),this.config=Vy(p),this.debugFlags=this.config.debugFlags,this.cmos=u,this.debugger=e,this.video=s,this.crtc=this.video.crtc,this.ula=this.video.ula,this.soundChip=n,this.music5000=c,this.ddNoise=a,this.memStatOffsetByIFetchBank=0,this.memStatOffset=0,this.memStat=new Uint8Array(512),this.memLook=new Int32Array(512),this.ramRomOs=new Uint8Array(128*1024+17*16*16384),this.romOffset=128*1024,this.osOffset=this.romOffset+16*16*1024,this.romsel=0,this.acccon=0,this.oldPcArray=new Uint16Array(256),this.oldAArray=new Uint8Array(256),this.oldXArray=new Uint8Array(256),this.oldYArray=new Uint8Array(256),this.oldPcIndex=0,this.resetLine=!0,this.cpuMultiplier=this.config.cpuMultiplier,this.videoCyclesBatch=this.config.videoCyclesBatch|0,this.peripheralCyclesPerSecond=2*1e3*1e3,this.tube=t.tube?new zy(t.tube,this):new Wy,this.music5000PageSel=0,this.econet=x,this.peripheralCycles=0,this.videoCycles=0,this.cpuMultiplier===1&&this.videoCyclesBatch===0?this.polltime=this.polltimeFast:this.polltime=this.polltimeSlow,this._debugRead=this._debugWrite=this._debugInstruction=null,this.debugInstruction=new Ya(this,"_debugInstruction"),this.debugRead=new Ya(this,"_debugRead"),this.debugWrite=new Ya(this,"_debugWrite"),this.scheduler=new Ly,this.sysvia=new hy(this,this.scheduler,this.video,this.soundChip,this.cmos,this.model.isMaster,this.config.keyLayout,this.config.getGamepads),this.uservia=new uy(this,this.scheduler,this.model.isMaster,this.config.userPort),this.acia=new ly(this,this.soundChip.toneGenerator,this.scheduler,this.touchScreen),this.serial=new dy(this.acia),this.adconverter=new Ry(this.sysvia,this.scheduler),this.soundChip.setScheduler(this.scheduler),this.fdc=new this.model.Fdc(this,this.ddNoise,this.scheduler,this.debugFlags)}getPrevPc(t){return this.oldPcArray[this.oldPcIndex-t&255]}romSelect(t){this.romsel=t;const s=((t&15)<<14)+this.romOffset-32768;for(let a=128;a<192;++a)this.memLook[a]=this.memLook[256+a]=s;const n=this.model.swram[t&15]?1:2;for(let a=128;a<192;++a)this.memStat[a]=this.memStat[256+a]=n;if(this.model.isMaster&&t&128)for(let a=128;a<144;++a)this.memLook[a]=this.memLook[256+a]=0,this.memStat[a]=this.memStat[256+a]=1}writeAcccon(t){this.acccon=t,this.videoDisplayPage=t&1?32768:0;const e=!!(t&2),s=!!(t&4),n=!!(t&8);for(let u=48;u<128;++u)this.memLook[u]=s?32768:0,n?this.memLook[u+256]=this.memLook[u]:this.memLook[u+256]=e?32768:0;const a=n?1:2,c=n?-12288:this.osOffset-49152;for(let u=192;u<224;++u)this.memLook[u]=this.memLook[u+256]=c,this.memStat[u]=this.memStat[u+256]=a}readmemZpStack(t){t&=65535;const e=this.ramRomOs[t];return this._debugRead&&this._debugRead(t,0,e),e|0}writememZpStack(t,e){t&=65535,e|=0,this._debugWrite&&this._debugWrite(t,e),this.ramRomOs[t]=e}readString(t){let e="";for(;;){const s=this.readmem(t);if(t++,s===0||s===13)break;e+=String.fromCharCode(s)}return e}findString(t,e){for(e=e|0;e<65535;++e){let s;for(s=0;s<t.length&&this.readmem(e+s)===t.charCodeAt(s);++s);if(s===t.length)return e}return null}readArea(t,e){let s="";for(let n=0;n<e;++n)s+=et(this.readmem(t+n));return s}handleEconetStationId(){return this.econet?(this.econet.econetNMIEnabled=!1,this.econet.stationId):255}handleEconetNMIEnable(){return this.econet&&!this.econet.econetNMIEnabled&&(this.econet.econetNMIEnabled=!0,this.econet.ADLC.status1&128&&this.NMI(!0)),255}readDevice(t){if(this.model.isMaster&&this.acccon&64)return this.ramRomOs[this.osOffset+(t&16383)];switch(t&=65535,t&-4){case 64528:if(this.model.hasTeletextAdaptor)return this.teletextAdaptor.read(t-64528);break;case 64544:case 64548:case 64552:case 64556:case 64560:case 64564:case 64568:case 64572:break;case 64576:case 64580:case 64584:case 64588:case 64592:case 64596:case 64600:case 64604:break;case 64764:if(t===64767&&this.model.hasMusic5000)return this.music5000PageSel;break;case 65024:case 65028:return this.crtc.read(t);case 65032:case 65036:return this.acia.read(t);case 65040:case 65044:return this.serial.read(t);case 65048:return this.model.isMaster?this.adconverter.read(t):this.handleEconetStationId();case 65056:if(!this.model.isMaster)return this.handleEconetNMIEnable();break;case 65060:case 65064:if(this.model.isMaster)return this.fdc.read(t);break;case 65072:if(this.model.isMaster)return this.romsel&143;break;case 65076:if(this.model.isMaster)return this.acccon;break;case 65080:if(this.model.isMaster)return this.handleEconetStationId();break;case 65084:if(this.model.isMaster)return this.handleEconetNMIEnable();break;case 65088:case 65092:case 65096:case 65100:case 65104:case 65108:case 65112:case 65116:return this.sysvia.read(t);case 65120:case 65124:case 65128:case 65132:case 65136:case 65140:case 65144:case 65148:return this.uservia.read(t);case 65152:case 65156:case 65160:case 65164:case 65168:case 65172:case 65176:case 65180:if(!this.model.isMaster)return this.fdc.read(t);break;case 65184:if(this.econet)return this.econet.readRegister(t&3);break;case 65216:case 65220:case 65224:case 65228:case 65232:case 65236:case 65240:case 65244:if(!this.model.isMaster)return this.adconverter.read(t);break;case 65248:case 65252:case 65256:case 65260:case 65264:case 65268:case 65272:case 65276:return this.tube.read(t)}return this.model.hasMusic5000&&(this.music5000PageSel&240)===48&&(t&65280)===64768?this.music5000.read(this.music5000PageSel,t):t>=64512&&t<65024?255:t>>>8}videoRead(t){return this.ramRomOs[t|this.videoDisplayPage]|0}readmem(t){t&=65535;const e=this.memStatOffset+(t>>>8);if(this.memStat[e]){const s=this.memLook[e],n=this.ramRomOs[s+t];return this._debugRead&&this._debugRead(t,n,s),n|0}else{const s=this.readDevice(t);return this._debugRead&&this._debugRead(t,s,0),s|0}}peekmem(t){const e=this.memStatOffset+(t>>>8);if(this.memStat[e]){const s=this.memLook[e];return this.ramRomOs[s+t]}else return 255}writemem(t,e){t&=65535,e|=0,this._debugWrite&&this._debugWrite(t,e);const s=this.memStatOffset+(t>>>8);if(this.memStat[s]===1){const n=this.memLook[s];this.ramRomOs[n+t]=e;return}t<64512||t>=65280||this.writeDevice(t,e)}writeDevice(t,e){if(t&=65535,e|=0,this.model.hasMusic5000&&(t&65280)===64768&&(this.music5000PageSel&240)===48){this.music5000.write(this.music5000PageSel,t,e);return}switch(t&-4){case 64528:if(this.model.hasTeletextAdaptor)return this.teletextAdaptor.write(t-64528,e);break;case 64544:case 64548:case 64552:case 64556:case 64560:case 64564:case 64568:case 64572:break;case 64576:case 64580:case 64584:case 64588:case 64592:case 64596:case 64600:case 64604:break;case 64764:t===64767&&this.model.hasMusic5000&&(this.music5000PageSel=e);break;case 65024:case 65028:return this.crtc.write(t,e);case 65032:case 65036:return this.acia.write(t,e);case 65040:case 65044:return this.serial.write(t,e);case 65048:if(this.model.isMaster)return this.adconverter.write(t,e);!this.model.isMaster&&this.econet&&(this.econet.econetNMIEnabled=!1);break;case 65056:return this.ula.write(t,e);case 65060:case 65064:return this.model.isMaster?this.fdc.write(t,e):this.ula.write(t,e);case 65068:if(!this.model.isMaster)return this.ula.write(t,e);break;case 65072:return this.romSelect(e);case 65076:return this.model.isMaster?this.writeAcccon(e):this.romSelect(e);case 65080:this.model.isMaster&&this.econet&&(this.econet.econetNMIEnabled=!1);break;case 65084:if(!this.model.isMaster)return this.romSelect(e);break;case 65088:case 65092:case 65096:case 65100:case 65104:case 65108:case 65112:case 65116:return this.sysvia.write(t,e);case 65120:case 65124:case 65128:case 65132:case 65136:case 65140:case 65144:case 65148:return this.uservia.write(t,e);case 65152:case 65156:case 65160:case 65164:case 65168:case 65172:case 65176:case 65180:if(!this.model.isMaster)return this.fdc.write(t,e);break;case 65184:case 65188:case 65192:case 65196:case 65200:case 65204:case 65208:case 65212:this.econet&&this.econet.writeRegister(t&3,e);break;case 65216:case 65220:case 65224:case 65228:case 65232:case 65236:case 65240:case 65244:if(!this.model.isMaster)return this.adconverter.write(t,e);break;case 65248:case 65252:case 65256:case 65260:case 65264:case 65268:case 65272:case 65276:return this.tube.write(t,e)}}async loadRom(t,e){t.indexOf("http")!==0&&(t="roms/"+t),console.log("Loading ROM from "+t);const s=this.ramRomOs;let n=await Fe(t);/\.zip/i.test(t)&&(n=Yb(n).data),s.set(n,e)}async loadOs(t){const e=Array.prototype.slice.call(arguments,1).concat(this.config.extraRoms);t="roms/"+t,console.log(`Loading OS from ${t}`);const s=this.ramRomOs,n=await Fe(t),a=n.length;if(a<16384||a&16383)throw new Error(`Broken OS ROM file (length=${a})`);s.set(n,this.osOffset);const c=(a-16384)/16384;let u=16-c;for(let x=0;x<c;++x){const _=16384+16384*x,y=this.romOffset+(u+x)*16384;s.set(n.subarray(_,_+16384),y)}const p=[];for(let x=0;x<e.length;++x){for(u--;this.model.swram[u];)u--;p.push(this.loadRom(e[x],this.romOffset+u*16384))}return await Promise.all(p)}setReset(t){this.resetLine=!t}reset(t){if(t){if(this.memStatOffsetByIFetchBank=this.model.isMaster?12288:0,this.model.isTest)for(let e=0;e<256;++e)this.memStat[e]=this.memStat[256+e]=1,this.memLook[e]=this.memLook[256+e]=0;else{for(let e=0;e<128;++e)this.memStat[e]=this.memStat[256+e]=1;for(let e=128;e<256;++e)this.memStat[e]=this.memStat[256+e]=2;for(let e=0;e<128;++e)this.memLook[e]=this.memLook[256+e]=0;for(let e=128;e<192;++e)this.memLook[e]=this.memLook[256+e]=this.romOffset-32768;for(let e=192;e<256;++e)this.memLook[e]=this.memLook[256+e]=this.osOffset-49152;for(let e=252;e<255;++e)this.memStat[e]=this.memStat[256+e]=0}for(let e=0;e<this.romOffset;++e)e<256?this.ramRomOs[e]=0:this.ramRomOs[e]=255;this.videoDisplayPage=0,this.config.printerPort&&(this.uservia.ca2changecallback=this.config.printerPort.outputStrobe),this.sysvia.reset(),this.uservia.reset(),this.acia.reset(),this.serial.reset(),this.ddNoise.spinDown(),this.fdc.powerOnReset(),this.adconverter.reset(),this.touchScreen=new Oy(this.scheduler),this.model.hasTeletextAdaptor&&(this.teletextAdaptor=new Ny(this)),this.econet&&(this.filestore=new Uy(this,this.econet))}else this.fdc.reset();this.tube.reset(t),t&&(this.targetCycles=0,this.currentCycles=0,this.cycleSeconds=0),this.pc=this.readmem(65532)|this.readmem(65533)<<8,this.p.i=!0,this._nmiEdge=!1,this._nmiLevel=!1,this.halted=!1,this.music5000PageSel=0,this.video.reset(this,this.sysvia,t),this.soundChip.reset(t),this.teletextAdaptor&&this.teletextAdaptor.reset(t),this.music5000&&this.music5000.reset(t),t&&this.econet&&(this.econet.reset(),this.filestore.reset())}updateKeyLayout(){this.sysvia.setKeyLayout(this.config.keyLayout)}polltimeAddr(t,e){t=t|0,Ky(e)&&(t+=1+((t^this.currentCycles)&1)),this.polltime(t)}polltimeCommon(t){this.scheduler.polltime(t),this.tube.execute(t),this.teletextAdaptor&&this.teletextAdaptor.polltime(t),this.music5000&&this.music5000.polltime(t),this.econet&&(this.econet.polltime(t)&&this.econet.econetNMIEnabled&&this.NMI(!0),this.filestore.polltime(t))}polltimeSlow(t){t|=0,this.currentCycles+=t,this.peripheralCycles+=t,this.videoCycles+=t,t=this.videoCycles/this.cpuMultiplier|0,t>this.videoCyclesBatch&&(this.video.polltime(t),this.videoCycles-=t*this.cpuMultiplier|0),t=this.peripheralCycles/this.cpuMultiplier|0,t&&(this.peripheralCycles-=t*this.cpuMultiplier|0,this.polltimeCommon(t))}polltimeFast(t){t|=0,this.currentCycles+=t,this.video.polltime(t),this.polltimeCommon(t)}execute(t){return this.halted=!1,this.targetCycles+=t,(Math.min(this.targetCycles,this.currentCycles)&4294967294)>=2*1e3*1e3&&(this.targetCycles-=2*1e3*1e3,this.currentCycles-=2*1e3*1e3,this.cycleSeconds++),this.forceTracing||this._debugInstruction||this._debugRead||this._debugWrite?this.executeInternal():this.executeInternalFast()}executeInternal(){let t=!0;for(;!this.halted&&this.currentCycles<this.targetCycles;){this.oldPcIndex=this.oldPcIndex+1&255,this.oldPcArray[this.oldPcIndex]=this.pc,this.memStatOffset=this.memStatOffsetByIFetchBank&1<<(this.pc>>>12)?256:0;const e=this.readmem(this.pc);if(this._debugInstruction&&!t&&this._debugInstruction(this.pc,e))return!1;t=!1,this.incpc(),this.runner.run(e),this.oldAArray[this.oldPcIndex]=this.a,this.oldXArray[this.oldPcIndex]=this.x,this.oldYArray[this.oldPcIndex]=this.y,this.takeInt&&this.brk(!0),this.resetLine||this.reset(!1)}return!this.halted}executeInternalFast(){for(;!this.halted&&this.currentCycles<this.targetCycles;){this.memStatOffset=this.memStatOffsetByIFetchBank&1<<(this.pc>>>12)?256:0;const t=this.readmem(this.pc);this.incpc(),this.runner.run(t),this.takeInt&&this.brk(!0),this.resetLine||this.reset(!1)}return!this.halted}stop(){this.halted=!0}dumpTrace(t,e){t||(t=256),t>256&&(t=256);const s=this.disassembler;e=e||function(n,a,c,u){const p=s.disassemble(n,!0)[0];console.log(Vt(n),(p+"                       ").substring(0,15),et(a),et(c),et(u))};for(let n=t-2;n>=0;--n){const a=this.oldPcIndex-n&255;e(this.oldPcArray[a],this.oldAArray[a],this.oldXArray[a],this.oldYArray[a])}e(this.pc,this.a,this.x,this.y)}async initialise(){this.model.os.length&&await this.loadOs.apply(this,this.model.os),this.model.tube&&await this.tube.loadOs(),this.reset(!0),this.debugger.setCpu(this)}};const qy=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,254,0,235,0,201,255,255,18,0,23,202,30,5,0,53,166,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let mf=0;function Ou(){const i=new Date(Date.now()+mf);return i.setMilliseconds(0),i}function is(i){return parseInt(i.toString(10),16)}function ss(i){return parseInt(i.toString(16),10)}class gf{constructor(t,e,s){this.store=t?t.load():null,this.persistence=t,this.enabled=!1,this.isRead=!1,this.addressSelect=!1,this.dataSelect=!1,this.cmosAddr=0,this.store||(this.store=qy),e&&(this.store=e(this.store)),s&&(this.store[14]=s.stationId,this.store[15]===0&&(this.store[15]=254)),this.save()}save(){this.persistence&&this.persistence.save(this.store)}read(){if(!this.enabled)return 255;if(!this.addressSelect&&this.dataSelect&&this.isRead)if(this.cmosAddr<10){const t=Ou();switch(this.cmosAddr){case 0:return is(t.getSeconds());case 2:return is(t.getMinutes());case 4:return is(t.getHours());case 6:return is(t.getDay()+1);case 7:return is(t.getDate());case 8:return is(t.getMonth()+1);case 9:return is(t.getFullYear())}}else return this.store[this.cmosAddr]&255;return 255}writeControl(t,e,s){if(this.enabled=!!(t&64),!this.enabled)return;const n=this.dataSelect,a=this.addressSelect;if(this.isRead=!!(s&2),this.dataSelect=!!(s&4),this.addressSelect=!!(t&128),a&&!this.addressSelect&&(this.cmosAddr=e&63),n&&!this.dataSelect&&!this.addressSelect&&!this.isRead)if(this.cmosAddr>11)this.store[this.cmosAddr]=e,this.save();else{const c=Ou();switch(this.cmosAddr){case 0:c.setSeconds(ss(e));break;case 2:c.setMinutes(ss(e));break;case 4:c.setHours(ss(e));break;case 7:c.setDate(ss(e));break;case 8:c.setMonth(ss(e-1));break;case 9:{const p=ss(e)>80?1900:2e3;c.setFullYear(ss(e)+p);break}}const u=Math.floor(Date.now()/1e3)*1e3;mf=c.getTime()-u}}}const jy="reclist.php?sort=name&filter=.zip",Yy="www.stairwaytohell.com/bbc/archive";async function Xy(i){const t=await fetch(i);if(!t.ok)throw new Error("Network response was not ok");const s=new DOMParser().parseFromString(await t.text(),"text/html"),n=[];return s.querySelectorAll("tr td:nth-child(3) a").forEach(a=>{const c=a.getAttribute("href");c.indexOf(".zip")>0&&n.push(c)}),n.sort(),n}class _f{constructor(t,e,s,n){this._baseUrl=`${document.location.protocol}//${Yy}/${n?"tape":"disk"}images/`,this._catalog=[],this._onStart=t,this._onCat=e,this._onError=s}async populate(){if(this._onStart(),this._catalog.length===0)try{this._catalog=await Xy(this._baseUrl+jy)}catch(t){console.error("Failed to fetch catalog:",t),this._onError&&this._onError();return}this._onCat&&this._onCat(this._catalog)}async fetch(t){const e=this._baseUrl+t;console.log("Loading ZIP from "+e);const s=await fetch(e);if(!s.ok)throw new Error("Network response was not ok");try{return Mr(new Uint8Array(await s.arrayBuffer())).data}catch(n){throw console.error("Failed to fetch file:",n),n}}}const rs=E;class Qy{constructor(){this.gamepad0=null,this.gamepadMapping=[],this.gamepadMapping[14]=rs.Z,this.gamepadMapping[15]=rs.X,this.gamepadMapping[13]=rs.SLASH,this.gamepadMapping[12]=rs.COLON_STAR,this.gamepadMapping[0]=rs.RETURN,this.gamepadMapping[9]=rs.SPACE,this.gamepadAxisMapping=[[],[],[],[]]}remap(t,e){"0123456789".indexOf(e)>0&&(e="K"+e);const s=rs[e];if(!s){console.log("unknown BBC key: "+e);return}switch(t){case"LEFT":this.gamepadMapping[3]=s,this.gamepadAxisMapping[0][-1]=s,this.gamepadAxisMapping[2][-1]=s;break;case"RIGHT":this.gamepadMapping[1]=s,this.gamepadAxisMapping[0][1]=s,this.gamepadAxisMapping[2][1]=s;break;case"UP":this.gamepadMapping[0]=s,this.gamepadAxisMapping[1][-1]=s,this.gamepadAxisMapping[3][-1]=s;break;case"DOWN":this.gamepadMapping[2]=s,this.gamepadAxisMapping[1][1]=s,this.gamepadAxisMapping[3][1]=s;break;case"FIRE":for(let n=0;n<16;n++)this.gamepadMapping[n]=s;break;case"UP2":this.gamepadAxisMapping[3][-1]=s;break;case"UP1":this.gamepadAxisMapping[1][-1]=s;break;case"UP3":this.gamepadMapping[0]=s;break;case"DOWN2":this.gamepadAxisMapping[3][1]=s;break;case"DOWN1":this.gamepadAxisMapping[1][1]=s;break;case"DOWN3":this.gamepadMapping[2]=s;break;case"LEFT2":this.gamepadAxisMapping[2][-1]=s;break;case"LEFT1":this.gamepadAxisMapping[0][-1]=s;break;case"LEFT3":this.gamepadMapping[3]=s;break;case"RIGHT2":this.gamepadAxisMapping[2][1]=s;break;case"RIGHT1":this.gamepadAxisMapping[0][1]=s;break;case"RIGHT3":this.gamepadMapping[1]=s;break;case"FIRE2":this.gamepadMapping[11]=s;break;case"FIRE1":this.gamepadMapping[10]=s;break;case"A":this.gamepadMapping[0]=s;break;case"B":this.gamepadMapping[1]=s;break;case"X":this.gamepadMapping[2]=s;break;case"Y":this.gamepadMapping[3]=s;break;case"START":this.gamepadMapping[9]=s;break;case"BACK":this.gamepadMapping[8]=s;break;case"RB":this.gamepadMapping[5]=s;break;case"RT":this.gamepadMapping[7]=s;break;case"LB":this.gamepadMapping[4]=s;break;case"LT":this.gamepadMapping[6]=s;break;default:console.log("unknown gamepad key: "+t)}}update(t){if(navigator.getGamepads&&!this.gamepad0){const e=navigator.getGamepads();this.gamepad0=e[0],this.gamepad0&&(console.log("initing gamepad"),this.gamepadButtons=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.gamepadAxes=[0,0,0,0])}if(this.gamepad0){tf()||(this.gamepad0=navigator.getGamepads()[0]);for(let e=0;e<4;e++){const s=this.gamepad0.axes[e],n=.15;let a;if(s<-.15?a=-1:s>n?a=1:a=0,a!==this.gamepadAxes[e]){const c=this.gamepadAxisMapping[e][this.gamepadAxes[e]];c&&t.keyUpRaw(c);const u=this.gamepadAxisMapping[e][a];u&&t.keyDownRaw(u)}this.gamepadAxes[e]=a}for(let e=0;e<16;e++)if(this.gamepad0.buttons[e]){const s=this.gamepad0.buttons[e];s.pressed!==this.gamepadButtons[e]&&this.gamepadMapping[e]&&(s.pressed?t.keyDownRaw(this.gamepadMapping[e]):t.keyUpRaw(this.gamepadMapping[e])),this.gamepadButtons[e]=s.pressed}}}}class Zy{constructor(t){this._track=t,this._track.length=N.bytesPerTrack,this._index=0,this._pulsesIndex=0,this._lastMfmBit=0,this._crc=0}get track(){return this._track}setTrackLength(){if(this._index>N.bytesPerTrack)throw new Error("Overflowed disc size");return this._index!==0&&(this._track.length=this._index),this}resetCrc(){return this._crc=N.crcInit(!1),this}appendFmDataAndClocks(t,e){if(this._index>=N.bytesPerTrack)throw new Error("Overflow in disc buliding");return this._track.pulses2Us[this._index++]=N.fmTo2usPulses(e,t),this._crc=N.crcAddByte(this._crc,t),this}appendFmByte(t){return this.appendFmDataAndClocks(t,255),this}appendRepeatFmByte(t,e){for(let s=0;s<e;++s)this.appendFmByte(t);return this}fillFmByte(t){if(this._index>=N.bytesPerTrack)throw new Error("Overflowed disc size");return this.appendRepeatFmByte(t,N.bytesPerTrack-this._index),this}appendRepeatFmByteWithClocks(t,e,s){for(let n=0;n<s;++n)this.appendFmDataAndClocks(t,e);return this}appendFmChunk(t){for(const e of t)this.appendFmByte(e);return this}appendCrc(t){const e=this._crc>>>8&255,s=this._crc&255;return t?(this.appendMfmByte(e),this.appendMfmByte(s)):(this.appendFmByte(e),this.appendFmByte(s)),this}appendMfmPulses(t){if(this._index>=N.bytesPerTrack)throw new Error("Overflowed disc size");const e=this._track.pulses2Us[this._index],s=65535<<this._pulsesIndex;return this._pulsesIndex=this._pulsesIndex+16&31,this._track.pulses2Us[this._index]=e&s|t<<this._pulsesIndex,this._pulsesIndex===0&&this._index++,this}appendMfmByte(t){const{lastBit:e,pulses:s}=N.mfmTo2usPulses(this._lastMfmBit,t);return this._lastMfmBit=e,this.appendMfmPulses(s),this._crc=N.crcAddByte(this._crc,t),this}appendRepeatMfmByte(t,e){for(let s=0;s<e;++s)this.appendMfmByte(t);return this}appendMfm3xA1Sync(){for(let t=0;t<3;++t)this.appendMfmPulses(N.mfmA1Sync),this._crc=N.crcAddByte(this._crc,161);return this}appendMfmChunk(t){for(const e of t)this.appendMfmByte(e);return this}fillMfmByte(t){if(this._index>=N.bytesPerTrack)throw new Error("Overflowed disc size");for(;this._index<N.bytesPerTrack;)this.appendMfmByte(t);return this}buildFromPulses(t,e){let s=!1;for(const n of t)N.checkPulse(n,e)||console.log(`Found a bad pulse for ${this.track.description}`),!this.appendPulseDelta(n,e)&&!s&&(console.log(`Truncated disc data for ${this.track.description}, ignoring the rest`),s=!0);this.setTrackLength()}appendPulseDelta(t,e){let s=e?Math.round(t/2):2*Math.round(t/4);for(;s--;){if(this._index===N.bytesPerTrack)return!1;s===0&&(this._track.pulses2Us[this._index]|=2147483648>>>this._pulsesIndex),this._pulsesIndex++,this._pulsesIndex===32&&(this._pulsesIndex=0,this._index++)}return!0}}class Jy{constructor(t,e){this._track=t,this._pos=e}readPulses(){let t=this._pos>>>5;const e=this._pos&31;let s=this._track.pulses2Us[t],n=s<<e&68719476735;return t===this._track.length?(t=0,this._pos=e):(t++,this._pos+=32),e>0&&(s=this._track.pulses2Us[t],n|=s>>>32-e),n}}class tC{constructor(t){this._rawReader=t}read(t){const e=new Uint8Array(t);let s=0;for(let n=0;n<t;++n)(n&1)===0?s=this._rawReader.readPulses():s=s<<16&4294967295,e[n]=N._2usPulsesToMfm(s>>>16);return{data:e,clocks:null,iffyPulses:!1}}get initialCrc(){let t=N.crcInit(!1);return t=N.crcAddByte(t,161),t=N.crcAddByte(t,161),t=N.crcAddByte(t,161),t}}class eC{constructor(t){this._rawReader=t}read(t){const e=new Uint8Array(t),s=new Uint8Array(t);let n=!1;for(let a=0;a<t;++a){const c=this._rawReader.readPulses(),{data:u,clock:p,iffyPulses:x}=N._2usPulsesToFm(c);e[a]=u,s[a]=p,n|=x}return{data:e,clocks:s,iffyPulses:n}}get initialCrc(){return N.crcInit(!1)}}class _c{constructor(t,e,s){this.track=t,this.isMfm=e,this.idPosBitOffset=s,this.dataPosBitOffset=null,this.isDeleted=!1,this.sectorData=null,this.hasDataCrcError=!1,this.byteLength=null;const n=this._readerAt(this.idPosBitOffset),{data:a,iffyPulses:c}=n.read(6);c&&console.log(`Iffy pulse in sector header ${this.description}`),this.header=a;let u=n.initialCrc;u=N.crcAddByte(u,N.idMarkDataPattern),u=N.crcAddBytes(u,this.header.slice(0,4));const p=this.header[4]<<8|this.header[5];this.hasHeaderCrcError=u!==p}_readerAt(t){const e=new Jy(this.track,t);return this.isMfm?new tC(e):new eC(e)}get trackNumber(){return this.header?this.header[0]:void 0}get sectorNumber(){return this.header?this.header[2]:void 0}get description(){return`${this.track.description} idpos ${this.idPosBitOffset} idtrack ${this.trackNumber} idsector ${this.sectorNumber} datapos ${this.dataPosBitOffset}`}read(t){const e=this.isMfm?16:32;if(this.dataPosBitOffset===null){console.log(`"Sector header without data ${this.description}"`);return}const s=this.isDeleted?N.deletedDataMarkDataPattern:N.dataMarkDataPattern,n=this.dataPosBitOffset/e|0,a=(t?t.idPosBitOffset/e:this.track.length*32/e)|0;let c=_c.toSectorSize(a-n-5);this.hasDataCrcError=!0;let u=!1;do{const{crcOk:p,sectorData:x,iffyPulses:_}=this._tryLoadSectorData(s,c);if(u=_,p){this.byteLength=c,this.hasDataCrcError=!1,this.sectorData=x;break}c=c>>>1}while(c>=128);u&&console.log(`"Iffy pulse in sector data ${this.description}"`)}_tryLoadSectorData(t,e){const s=this._readerAt(this.dataPosBitOffset);let n=N.crcAddByte(s.initialCrc,t);const{data:a,iffyPulses:c}=s.read(e+2);return n=N.crcAddBytes(n,a.slice(0,e)),{crcOk:(a[e]<<8|a[e+1])===n,sectorData:a,iffyPulses:c}}static toSectorSize(t){return t<256?128:t<512?256:t<1024?512:t<2048?1024:2048}}class iC{constructor(t,e,s){this.length=N.bytesPerTrack,this.upper=t,this.trackNum=e,this.pulses2Us=new Uint32Array(256*13),this.pulses2Us.fill(s|s<<8|s<<16|s<<24)}get description(){return`Track ${this.trackNum} ${this.upper?"upper":"lower"}`}findSectors(){const t=this.findSectorIds();for(let e=0;e!==t.length;++e){const s=t[e+1];t[e].read(s)}return t}findSectorIds(){const t=[],e=this.length*32;let s=0,n=0,a=!1,c=!1,u=0,p=0n,x=0n;const _=0xffffffffffffffffn,y=0xffffffff00000000n,T=0x8888888800000000n,D=0xaaaa448944894489n;let v=0,M=null;for(let Y=0;Y<e;++Y){if((Y&31)===0&&(u=this.pulses2Us[Y>>>5]),x=x<<1n&_,x|=p>>63n,p=p<<1n&_,s=s<<1&4294967295,n++,u&2147483648&&(p|=1n,s|=1),u=u<<1&4294967295,(p&y)===T){const{clocks:z,data:at,iffyPulses:mt}=N._2usPulsesToFm(Number(p&0xffffffffn));if(mt||z!==N.markClockPattern)continue;c=!1,a=!1;let Q=8;for(let ct=x;(ct&0xfn)===0x8n;ct>>=4n)Q++;Q<=16&&console.log(`Short zeros sync ${this.description}`),v=at}else if(p===D){c=!0,a=!0,s=0,n=0;continue}else if(a&&n===16)v=N._2usPulsesToMfm(s),a=!1;else continue;switch(v){case N.idMarkDataPattern:{M=new _c(this,c,Y+1),t.push(M),s=0,n=0;break}case N.dataMarkDataPattern:case N.deletedDataMarkDataPattern:!M||M.dataPosBitOffset?console.log(`Sector data without header ${this.description}; mark bitpos ${Y}; previous good sector ${M?M.description:"none"}`):(M.dataPosBitOffset=Y+1,v===N.deletedDataMarkDataPattern&&(M.isDeleted=!0),s=0,n=0);break;default:console.log(`Unknown marker byte ${et(v)} ${this.description}`)}}return t}}class Mu{constructor(t,e){this.tracks=[];for(let s=0;s<N.tracksPerDisc;++s)this.tracks[s]=new iC(t,s,e)}}class xf{constructor(){this.logProtection=!1,this.logIffyPulses=!1,this.expandTo80=!1,this.isQuantizeFm=!1,this.isSkipOddTracks=!1,this.isSkipUpperSide=!1,this.rev=0,this.revSpec=""}}class Mt{static get sectorSize(){return 256}static get sectorsPerTrack(){return 10}static get tracksPerDisc(){return 80}}function sC(i,t,e,s){const n=new Uint8Array(Mt.sectorSize),a=e?2:1;if(t.length%Mt.sectorSize!==0)throw new Error("SSD file size is not a multiple of sector size");const c=Mt.sectorSize*Mt.sectorsPerTrack*Mt.tracksPerDisc*a;if(t.length>c)throw new Error("SSD file is too large");let u=0;for(let p=0;p<Mt.tracksPerDisc;++p)for(let x=0;x<a;++x){const _=i.buildTrack(x===1,p);_.appendRepeatFmByte(255,N.stdGap1FFs).appendRepeatFmByte(0,N.stdSync00s);for(let y=0;y<Mt.sectorsPerTrack;++y){_.resetCrc().appendFmDataAndClocks(N.idMarkDataPattern,N.markClockPattern).appendFmByte(p).appendFmByte(0).appendFmByte(y).appendFmByte(1).appendCrc(!1),_.appendRepeatFmByte(255,N.stdGap2FFs).appendRepeatFmByte(0,N.stdSync00s);const T=u<t.length?t.subarray(u,u+Mt.sectorSize):n;u+=Mt.sectorSize,_.resetCrc().appendFmDataAndClocks(N.dataMarkDataPattern,N.markClockPattern).appendFmChunk(T).appendCrc(!1),y!==Mt.sectorsPerTrack-1&&_.appendRepeatFmByte(255,N.std10SectorGap3FFs).appendRepeatFmByte(0,N.stdSync00s)}_.fillFmByte(255)}if(s){const p=new Uint8Array(c);p.set(t),i.setWriteTrackCallback((x,_,y)=>{const T=Mt.sectorSize*Mt.sectorsPerTrack*(_*a+(x?1:0));for(const D of y.findSectors()){const v=D.sectorNumber*Mt.sectorSize;for(let M=0;M<Mt.sectorSize;++M)p[T+v+M]=D.sectorData[M]}s(p)})}return i}class di{static get sectorSize(){return 256}static get sectorsPerTrack(){return 16}static get tracksPerDisc(){return 80}}function Nu(i,t,e){const s=new Uint8Array(di.sectorSize),n=e?2:1;if(t.length%di.sectorSize!==0)throw new Error("ADF file size is not a multiple of sector size");const a=di.sectorSize*di.sectorsPerTrack*di.tracksPerDisc*n;if(t.length>a)throw new Error("ADF file is too large");let c=0;for(let u=0;u<di.tracksPerDisc&&!(c>=t.length);++u)for(let p=0;p<n;++p){const x=i.buildTrack(p===1,u);x.appendRepeatMfmByte(78,60);for(let _=0;_<di.sectorsPerTrack;++_){x.appendRepeatMfmByte(0,12).resetCrc().appendMfm3xA1Sync().appendMfmByte(N.idMarkDataPattern).appendMfmByte(u).appendMfmByte(0).appendMfmByte(_).appendMfmByte(1).appendCrc(!0),x.appendRepeatMfmByte(78,22).appendRepeatMfmByte(0,12);const y=c<t.length?t.subarray(c,c+di.sectorSize):s;c+=di.sectorSize,x.resetCrc().appendMfm3xA1Sync().appendMfmByte(N.dataMarkDataPattern).appendMfmChunk(y).appendCrc(!0),x.appendRepeatMfmByte(78,24)}x.fillMfmByte(78)}return i}function rC(i){const t=i.isDoubleSided?2:1,e=new Uint8Array(t*Mt.tracksPerDisc*Mt.sectorsPerTrack*Mt.sectorSize);let s=0;for(let n=0;n<i.tracksUsed;++n)for(let a=0;a<t;++a){const c=i.getTrack(a===1,n);for(const u of c.findSectors()){const p=s+u.sectorNumber*Mt.sectorSize;if(u.hasDataCrcError||u.hasHeaderCrcError){console.log(`Skipping sector ${u.description} with bad CRC`);continue}for(let x=0;x<Mt.sectorSize;++x)e[p+x]=u.sectorData[x]}s+=Mt.sectorsPerTrack*Mt.sectorSize}return e.slice(0,s)}const nC="HXCPICFE",aC="HXCHFEV3",Bu=240,oC=240,cC=241,hC=242,uC=243,lC=244;function fC(i){let t=0;return i&128&&(t|=1),i&64&&(t|=2),i&32&&(t|=4),i&16&&(t|=8),i&8&&(t|=16),i&4&&(t|=32),i&2&&(t|=64),i&1&&(t|=128),t}function dC(i,t){const e=t<<2,s=512*(i[e]+(i[e+1]<<8)),n=i[e+2]+(i[e+3]<<8);return{offset:s,length:n}}function pC(i,t){if(t.length<512)throw new Error("HFE file missing header");const e=new TextDecoder("ascii").decode(t.slice(0,8));let s=!1,n=1;if(e!==nC)if(e===aC)n=3,s=!0;else throw new Error(`HFE file bad header '${e}'`);if(t[8]!==0)throw new Error("HFE file revision not 0");if(t[11]!==2&&t[11]!==0)if(t[11]===255)console.log(`Unknown HFE encoding ${t[11]}, trying anyway`);else throw new Error(`HFE encoding not ISOIBM_(M)FM_ENCODING: ${t[11]}`);const a=t[10];if(a<1||a>2)throw new Error(`Invalid number of sides: ${a}`);const c=t[9];if(c>N.tracksPerDisc)throw new Error(`Too many tracks: ${c}`);let u=0;i.config.expandTo80&&c*2<=N.tracksPerDisc&&(u=1,console.log("Expanding 40 tracks to 80")),console.log(`HFE v${n} loading ${a} sides, ${c} tracks`);const p=512*(t[18]+(t[19]<<8));if(p+512>t.length)throw new Error("HFE LUT doesn't fit");const x=t.slice(p,p+512);for(let _=0;_<c;++_){let y=_;if(i.config.isSkipOddTracks){if(_&1)continue;y=_>>>1}y=y<<u;const{offset:T,length:D}=dC(x,_);if(T+D>t.length)throw new Error(`HFE track ${_} doesn't fit (length ${D} offset ${T} file length ${t.length})`);const v=t.slice(T,T+D);for(let M=0;M<a;++M){const Y=D>>1;let z=0;if(i.config.isSkipUpperSide&&M===1)continue;let at=!1,mt=!1,Q=0,ct=0,gt=0;const l=i.getTrack(M===1,y);i.setTrackUsed(M===1,y);const X=l.pulses2Us;for(let j=0;j<Y;++j){if(z===X.length){console.log(`HFE track ${_} truncated`);break}const ut=(j>>>8<<9)+(M<<8)+(j&255);let it=fC(v[ut]),Pt=8;if(at){at=!1,(it<64||it>80)&&console.log(`HFE v3 SETBITRATE wild (72=250kbit) track: ${_} ${it}`);continue}else if(mt){if(mt=!1,it===0||it>=8)throw new Error(`HFE v3 invalid skipbits ${it}`);Q=it;continue}else if(Q)it=it<<8-Q&255,Pt=Q,Q=0;else if(s&&(it&Bu)===Bu)switch(it){case oC:continue;case cC:z!==0&&console.log(`HFEv3 SETINDEX not at byte 0, track ${_}: ${z}`);continue;case hC:at=!0;continue;case uC:mt=!0;continue;case lC:it=0;break;default:throw new Error(`Unknown HFE v3 opcode ${it}`)}for(let tt=0;tt<Pt;++tt)ct=ct<<1&4294967295|(it&128?1:0),it=it<<1&255,++gt===32&&(X[z]=ct,z++,ct=0,gt=0)}l.length=z}}return i}class xc{static createBlank(){return new xc(!0,new xf)}constructor(t,e,s){this.config=e,this.name=s,this.isDirty=!1,this.dirtySide=-1,this.dirtyTrack=-1,this.tracksUsed=0,this.isDoubleSided=!1,this.writeTrackCallback=void 0,this.isWriteable=t,this.initSurface(0)}setWriteTrackCallback(t){this.writeTrackCallback=t}get writeProtected(){return!this.isWriteable}getTrack(t,e){return t?this.upperSide.tracks[e]:this.lowerSide.tracks[e]}buildTrack(t,e){return this.setTrackUsed(t,e),new Zy(this.getTrack(t,e))}setTrackUsed(t,e){t&&(this.isDoubleSided=!0),this.tracksUsed=Math.max(this.tracksUsed,e+1)}initSurface(t){this.lowerSide=new Mu(!1,t),this.upperSide=new Mu(!0,t),this.tracksUsed=0,this.isDoubleSided=!1}readPulses(t,e,s){return this.getTrack(t,e).pulses2Us[s]}writePulses(t,e,s,n){const a=this.getTrack(t,e);if(s>=a.length)throw new Error(`Attempt to write off end of track ${s} > ${e.length}`);if(this.isDirty&&(t!==this.dirtySide||e!==this.dirtyTrack))throw new Error("Switched dirty track or side");this.isDirty=!0,this.dirtySide=t,this.dirtyTrack=e,a.pulses2Us[s]=n}flushWrites(){if(!this.isDirty){if(this.dirtySide!==-1||this.dirtyTrack!==-1)throw new Error("Bad state in disc dirty tracking");return}const t=this.dirtySide,e=this.dirtyTrack;if(this.isDirty=!1,this.dirtySide=-1,this.dirtyTrack=-1,!this.writeTrackCallback)return;const s=this.getTrack(t,e);this.writeTrackCallback(t,e,s),this.setTrackUsed(t,e)}logSummary(){const t=this.tracksUsed,e=this.isDoubleSided?2:1;for(let s=0;s<e;++s)for(let n=0;n<t;++n){const a=this.getTrack(s===1,n),c=a.findSectors();if(c.length){a.length>=N.bytesPerTrack*1.015?console.log(`Long track ${a.description}, ${a.length} bytes`):a.length<=N.bytesPerTrack*.985&&console.log(`Short track ${a.description}, ${a.length} bytes`),c[0].isMfm?c.length!==16&&c.length!==18&&console.log(`Non-standard MFM sector count ${a.description} count ${c.length}`):c.length!==10&&console.log(`Non-standard FM sector count ${a.description} count ${c.length}`);for(const u of c)u.hasHeaderCrcError&&console.log(`${u.description} has bad header crc`),u.trackNumber!==n&&console.log(`${u.description} has bad track id`),u.hasDataCrcError&&console.log(`${u.description} has bad data crc`)}else console.log(`"Unformatted track ${a.description}"`)}}}class N{static get bytesPerTrack(){return 3125}static get tracksPerDisc(){return 84}static get markClockPattern(){return 199}static get idMarkDataPattern(){return 254}static get dataMarkDataPattern(){return 251}static get deletedDataMarkDataPattern(){return 248}static get mfmA1Sync(){return 17545}static get mfmC2Sync(){return 21028}static get stdSync00s(){return 6}static get stdGap1FFs(){return 16}static get stdGap2FFs(){return 11}static get std10SectorGap3FFs(){return 21}static crcInit(t){return t?52660:65535}static crcAddByte(t,e){for(let s=0;s<8;++s){const n=e&128,a=t&32768^n<<8;t=t<<1&65535,a&&(t^=4129),e<<=1}return t}static crcAddBytes(t,e){for(const s of e)t=N.crcAddByte(t,s);return t}static fmTo2usPulses(t,e){let s=0;for(let n=0;n<8;++n)s<<=4,t&128&&(s|=4),e&128&&(s|=1),t=t<<1&255,e=e<<1&255;return s}static _2usPulsesToFm(t){let e=0,s=0,n=!1;for(let a=0;a<8;++a)e<<=1,s<<=1,t&2147483648&&(e|=1),t&536870912&&(s|=1),t&1342177280&&(n=!0),t=t<<4&4294967295;return{clocks:e,data:s,iffyPulses:n}}static mfmTo2usPulses(t,e){let s=0;for(let n=0;n<8;++n){const a=!!(e&128);s=s<<2&65535,e<<=1,a?s|=1:t||(s|=2),t=a}return{lastBit:t,pulses:s}}static _2usPulsesToMfm(t){let e=0;for(let s=0;s<8;++s)e<<=1,(t&49152)===16384&&(e|=1),t=t<<2&65535;return e}static checkPulse(t,e){return t<3.5||t>8.5?!1:e&&t>5.5&&t<6.5?!0:!(t>4.5&&t<7.5)}}function mC(i){return console.log("Loading disc from "+i),Fe(i)}function Fi(i,t,e,s){const n=typeof e!="string"?e:Xr(e),a=t.toLowerCase(),c=new xc(!0,new xf,t);return a.endsWith(".hfe")?pC(c,n):a.endsWith(".adl")?Nu(c,n,!0):a.endsWith(".adf")||a.endsWith(".adm")?Nu(c,n,!1):sC(c,n,a.endsWith(".dsd"),s)}function gC(i,t){const e="disc_"+t;let s;const n=window.localStorage[e];return n?(console.log("Loading browser-local disc "+t),s=Xr(n)):(console.log("Creating browser-local disc "+t),s=new Uint8Array(cf(t).byteSize),hf(s,t)),Fi(i,t,s,c=>{try{const u=rf(c);window.localStorage.setItem(e,u)}catch(u){window.alert("Writing to localStorage failed: "+u)}})}function Fu(){return[{name:"Elite",desc:"An 8-bit classic. Hit F10 to launch from the space station, then use <, >, S, X and A to fly around.",file:"elite.ssd"},{name:"Welcome",desc:"The disc supplied with BBC Disc systems to demonstrate some of the features of the system.",file:"Welcome.ssd"},{name:"Music 5000",desc:"The Music 5000 system disk and demo songs.",file:"5000mstr36008.ssd"}]}function Xa(i){return 2*1e3*1e3*i|0}function _C(i){let t=!1;for(;i;)t=!t,i>>>=1;return t}const Qa=78;class xC{constructor(t){this.stream=t,this.baseFrequency=1200,this.rewind(),this.curChunk=this.readChunk()}rewind(){this.dummyData=[!1,!1,!0,!1,!0,!1,!0,!1,!0,!0],this.state=-1,this.count=0,this.curByte=0,this.numDataBits=8,this.parity=Qa,this.numParityBits=0,this.numStopBits=1,this.carrierBefore=0,this.carrierAfter=0,this.stream.seek(10);const t=this.stream.readByte(),e=this.stream.readByte();if(e!==0)throw"Unsupported UEF version "+e+"."+t}readChunk(){const t=this.stream.readInt16(),e=this.stream.readInt32();return{id:t,stream:this.stream.substream(e)}}poll(t){if(!this.curChunk)return;if(this.state===-1){if(this.stream.eof()){this.curChunk=null;return}this.curChunk=this.readChunk()}let e;switch(this.curChunk.id){case 0:console.log("Origin: "+this.curChunk.stream.readNulString());break;case 256:return t.setTapeCarrier(!1),this.state===-1?(this.state=0,this.curByte=this.curChunk.stream.readByte(),t.tone(this.baseFrequency)):this.state<9?(this.state===0?t.tone(this.baseFrequency):t.tone(this.curByte&1<<this.state-1?2*this.baseFrequency:this.baseFrequency),this.state++):(t.receive(this.curByte),t.tone(2*this.baseFrequency),this.curChunk.stream.eof()?this.state=-1:(this.state=0,this.curByte=this.curChunk.stream.readByte())),this.cycles(1);case 260:if(t.setTapeCarrier(!1),this.state===-1&&(this.numDataBits=this.curChunk.stream.readByte(),this.parity=this.curChunk.stream.readByte(),this.numStopBits=this.curChunk.stream.readByte(),this.numParityBits=this.parity!==Qa?1:0,console.log(`Defined data with ${this.numDataBits}${String.fromCharCode(this.parity)}${this.numStopBits}`),this.state=0),this.state===0)this.curChunk.stream.eof()?this.state=-1:(this.curByte=this.curChunk.stream.readByte()&(1<<this.numDataBits)-1,t.tone(this.baseFrequency),this.state++);else if(this.state<1+this.numDataBits)t.tone(this.curByte&1<<this.state-1?2*this.baseFrequency:this.baseFrequency),this.state++;else if(this.state<1+this.numDataBits+this.numParityBits){let s=_C(this.curByte);this.parity===Qa&&(s=!s),t.tone(s?2*this.baseFrequency:this.baseFrequency),this.state++}else if(this.state<1+this.numDataBits+this.numParityBits+this.numStopBits)t.tone(2*this.baseFrequency),this.state++;else return t.receive(this.curByte),this.state=0,0;return this.cycles(1);case 273:return this.state===-1&&(this.state=0,this.carrierBefore=this.curChunk.stream.readInt16(),this.carrierAfter=this.curChunk.stream.readInt16(),console.log("Carrier with",this.carrierBefore,this.carrierAfter)),this.state===0?(t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.carrierBefore--,this.carrierBefore<=0&&(this.state=1)):this.state<11?(t.setTapeCarrier(!1),t.tone(this.dummyData[this.state-1]?this.baseFrequency:2*this.baseFrequency),this.state===10&&t.receive(170),this.state++):(t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.carrierAfter--,this.carrierAfter<=0&&(this.state=-1)),this.cycles(1);case 276:console.log("Ignoring security cycles");break;case 277:console.log("Ignoring polarity change");break;case 272:return this.state===-1&&(this.state=0,this.count=this.curChunk.stream.readInt16()),t.setTapeCarrier(!0),t.tone(2*this.baseFrequency),this.count--,this.count<=0&&(this.state=-1),this.cycles(1);case 275:this.baseFrequency=this.curChunk.stream.readFloat32(),console.log("Frequency change ",this.baseFrequency);break;case 274:return t.setTapeCarrier(!1),e=1/(2*this.curChunk.stream.readInt16()*this.baseFrequency),console.log("Tape gap of "+e+"s"),t.tone(0),Xa(e);case 278:return t.setTapeCarrier(!1),e=this.curChunk.stream.readFloat32(),console.log("Tape gap of "+e+"s"),t.tone(0),Xa(e);default:console.log("Skipping unknown chunk "+Vt(this.curChunk.id)),this.curChunk=this.readChunk();break}return this.cycles(1)}cycles(t){return Xa(t/this.baseFrequency)}}const bC=[1,16,64,-1];class yC{constructor(t){this.count=0,this.stream=t}rate(t){let e=9;t.cr&128||e++;const s=bC[t.cr&3],n=2*1e3*1e3/(19200/s);return Math.floor(e*n)}rewind(){this.stream.seek(10)}poll(t){if(this.stream.eof())return 1e5;let e=this.stream.readByte();if(e===255){if(e=this.stream.readByte(),e===0)return t.setTapeCarrier(!1),0;if(e===4)return t.setTapeCarrier(!0),5*2*1e3*1e3;if(e!==255)throw"Got a weird byte in the tape"}return t.receive(e),this.rate(t)}}function Dr(i,t){const e=new gc(i,t);return e.readByte(0)===255&&e.readByte(1)===4?(console.log("Detected a 'tapefile' tape"),new yC(e)):e.readNulString(0)==="UEF File!"?(console.log("Detected a UEF tape"),new xC(e)):(console.log("Unknown tape format"),null)}async function CC(i){return console.log("Loading tape from "+i),Dr(i,await Fe(i))}const Za="application/vnd.jsbeeb.disc-image",vC="356883185894-bhim19837nroivv18p0j25gecora60r5.apps.googleusercontent.com",SC="https://www.googleapis.com/auth/drive.file",EC="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",Uu="id,name,capabilities",Ja="jsbeeb disc images",bc="-------314159265358979323846",$u=`\r
--${bc}\r
`,AC=`\r
--${bc}--`,Hu="application/vnd.google-apps.folder";class wC{constructor(){this.authorized=!1,this.parentFolderId=void 0,this.driveClient=void 0}async initialise(){console.log("Creating GAPI");const t=await this._loadScript("https://apis.google.com/js/api.js",()=>window.gapi);return console.log("Got GAPI, creating token client"),this.tokenClient=await this._loadScript("https://accounts.google.com/gsi/client",()=>window.google.accounts.oauth2.initTokenClient({client_id:vC,scope:SC,error_callback:"",callback:""})),console.log("Token client created, loading client"),await t.load("client",async()=>{console.log("Client loaded; initialising GAPI"),await t.client.init({discoveryDocs:[EC]}),console.log("GAPI initialised"),this.driveClient=t.client.drive}),console.log("Google Drive: available"),!0}_loadScript(t,e){return new Promise(s=>{const n=document.createElement("script");n.src=t,n.onload=()=>s(e()),document.body.appendChild(n)})}authorize(t){return this.authorized?!0:t?!1:new Promise((e,s)=>{console.log("Authorizing..."),this.tokenClient.callback=n=>{n.error!==void 0&&s(n),console.log("Authorized OK"),this.authorized=!0,e(!0)},this.tokenClient.error_callback=n=>{console.log(`Token client failure: ${n.type}; failed to authorize`),s(new Error(`Token client failure: ${n.type}; failed to authorize`))},this.tokenClient.requestAccessToken({select_account:!1})})}async listFiles(){let t=await this.driveClient.files.list({q:`mimeType = '${Za}' and trashed = false`}),e=t.result.files;for(;t.result.nextPageToken;)t=await this.driveClient.files.list({pageToken:t.result.nextPageToken}),e=e.concat(t.result.files);return e}async _findOrCreateParentFolder(){const t=await this.driveClient.files.list({q:`name = '${Ja}' and mimeType = '${Hu}' and trashed = false`,corpora:"user"});if(t.result.files.length===1)return console.log("Found existing parent folder"),t.result.files[0].id;console.log(`Creating parent folder ${Ja}`);const e=await this.driveClient.files.create({resource:{name:Ja,mimeType:Hu},fields:"id"});return console.log("Folder Id:",e.result.id),e.result.id}async saveFile(t,e,s){this.parentFolderId===void 0&&(this.parentFolderId=await this._findOrCreateParentFolder());const n={name:t,mimeType:Za};s||(n.parents=[this.parentFolderId]);const a=btoa(rf(e)),c=`${$u}Content-Type: application/json\r
\r
${JSON.stringify(n)}${$u}Content-Type: ${Za}\r
Content-Transfer-Encoding: base64\r
\r
${a}${AC}`;return this.gapi.client.request({path:`/upload/drive/v3/files${s?`/${s}`:""}`,method:s?"PATCH":"POST",params:{uploadType:"multipart",newRevision:!1,fields:Uu},headers:{"Content-Type":`multipart/mixed; boundary="${bc}"`},body:c})}async create(t,e){console.log(`Google Drive: creating disc image: '${e}'`);const s=cf(e).byteSize,n=new Uint8Array(s);hf(n,e);const c=(await this.saveFile(e,n)).result;return{fileId:c.id,disc:this.makeDisc(t,n,c)}}makeDisc(t,e,s){let n=null;const a=s.name,c=s.id;return s.capabilities.canEdit?(console.log("Making editable disc"),n=ce.debounce(async u=>{console.log("Data changed..."),await this.saveFile(a,u,c),console.log("Saved ok")},200)):console.log("Making read-only disc"),Fi(t,a,e,n)}async load(t,e){const s=(await this.driveClient.files.get({fileId:e,fields:Uu})).result,n=(await this.driveClient.files.get({fileId:e,alt:"media"})).body;return this.makeDisc(t,n,s)}}class TC extends Event{constructor(t){super("step"),this.stepAmount=t}}class _s extends EventTarget{static get TicksPerRevolution(){return 4e5}static get DiscIndexMs(){return 4}constructor(t,e){super(),this._scheduler=e,this._disc=void 0,this._is40Track=!1,this._track=0,this._isSideUpper=!1,this._headPosition=0,this._pulsePosition=0,this._in32usMode=!1,this._pulsesCallback=null,this._timer=this._scheduler.newTask(this._onTimer.bind(this)),this._spinning=!1}get disc(){return this._disc}getQuasiRandomPulses(){const t=this._scheduler.epoch,e=(t^t>>>8^t>>>16^t>>>24)&255;return N.fmTo2usPulses(255,e)}get trackLength(){const t=this.disc;return t?t.getTrack(this._isSideUpper,this._track).length:N.bytesPerTrack}_onTimer(){let t=this.disc?this.disc.readPulses(this._isSideUpper,this._track,this._headPosition):0,e=32;(this._pulsePosition===16||this._in32usMode)&&(e=16,this._pulsePosition===0&&(t>>>=16),t&=65535),t===0&&(t=this.getQuasiRandomPulses()),this._pulsesCallback&&this._pulsesCallback(t,e);const s=this.positionTime;e===16?this._pulsePosition===0?this._pulsePosition=16:(this._pulsePosition=0,this._headPosition++):this._headPosition++;const n=this.positionTime;this._headPosition===this.trackLength&&(this._headPosition=0,this._checkTrackNeedsWrite()),this._spinning&&this._timer.reschedule(n-s)}get headPosition(){return this._headPosition}get track(){return this._track}get positionFraction(){return(this._headPosition+this._pulsePosition/32)/this.trackLength}set positionFraction(t){this._headPosition=this.trackLength*t|0,this._pulsePosition=0}get positionTime(){return this.positionFraction*_s.TicksPerRevolution|0}setPulsesCallback(t){this._pulsesCallback=t}get spinning(){return this._spinning}startSpinning(){this._spinning||(this.dispatchEvent(new Event("startSpinning")),this._timer.schedule(1)),this._spinning=!0}stopSpinning(){this._spinning&&this.dispatchEvent(new Event("stopSpinning")),this._timer.cancel(),this._spinning=!1}selectSide(t){const e=this.positionFraction;this._checkTrackNeedsWrite(),this._isSideUpper=t,this.positionFraction=e}setDisc(t){this._disc=t}get indexPulse(){return this.disc?this._headPosition<this.trackLength*_s.DiscIndexMs/200:!0}writePulses(t){if(this.disc&&!this.disc.writeProtected){if(this._in32usMode){if(t&4294901760)throw new Error(`Unable to write 32us pulses for ${t}`);const e=this.disc.readPulses(this._isSideUpper,this.track,this.headPosition);this._pulsePosition===0?t=e&65535|t<<16:t=e&4294901760|t}this.disc.writePulses(this._isSideUpper,this.track,this.headPosition,t)}}get writeProtect(){return this.disc?this.disc.writeProtected:!1}set32usMode(t){this._in32usMode=t}seekOneTrack(t){this._is40Track&&(t*=2),this._selectTrack(this._track+t)}notifySeek(t){this.notifySeekAmount(t-this._track)}notifySeekAmount(t){this.dispatchEvent(new TC(t))}_selectTrack(t){this._checkTrackNeedsWrite(),t<0?(t=0,console.log("Clang! disc head stopped at track 0")):t>=N.tracksPerDisc&&(t=N.tracksPerDisc-1,console.log("Clang! disc head stopper at track max"));const e=this.positionFraction;this._track=t,this.positionFraction=e}_checkTrackNeedsWrite(){this.disc&&this.disc.flushWrites()}}const Ct=Object.freeze({restore:0,seek:16,stepInNoUpdate:64,stepInWithUpdate:80,stepOutNoUpdate:96,stepOutWithUpdate:112,readSector:128,readSectorMulti:144,writeSector:160,writeSectorMulti:176,readAddress:192,forceInterrupt:208,readTrack:224,writeTrack:240}),yr=Object.freeze({typeIIMulti:16,disableSpinUp:8,typeIVerify:4,typeIIorIIISettle:4,typeIIDeleted:1}),ee=Object.freeze({reset:32,density:8,side:4,drive1:2,drive0:1}),dt=Object.freeze({motorOn:128,writeProtected:64,typeISpinUpDone:32,typeIIorIIIDeletedMark:32,recordNotFound:16,crcError:8,typeITrack0:4,typeIIorIIILostByte:4,typeIIndex:2,typeIIorIIIDrq:2,busy:1}),st=Object.freeze({null:0,idle:1,timerWait:2,spinUpWait:3,waitIndex:4,searchId:5,inId:6,searchData:7,inData:8,inReadTrack:8,writeSectorDelay:9,writeSectorLeadInFm:10,writeSectorLeadInMfm:11,writeSectorMarkerFm:12,writeSectorMarkerMfm:13,writeSectorBody:14,writeTrackSetup:15,inWriteTrack:16,checkMulti:17,done:18}),Ve=Object.freeze({none:1,settle:2,seek:3,done:4});class kC{constructor(t,e,s,n){this._cpu=t,s?this._drives=s:this._drives=[new _s(0,e),new _s(1,e)],this._isMaster=t.model.isMaster,this._is1772=!1,this._isOpus=!1,this._controlRegister=0,this._statusRegister=0,this._trackRegister=0,this._sectorRegister=0,this._dataRegister=0,this._isIntRq=!1,this._isDrq=!1,this._doRaiseIntRq=!1,this._currentDrive=null,this._isIndexPulse=!1,this._isInterruptOnIndexPulse=!1,this._isWriteTrackCrcSecondByte=!1,this._command=0,this._commandType=0,this._isCommandSettle=!1,this._isCommandWrite=!1,this._isCommandVerify=!1,this._isCommandMulti=!1,this._isCommandDeleted=!1,this._commandStepRateMs=0,this._state=st.idle,this._timerState=Ve.none,this._timerTask=e.newTask(()=>this._timerFired()),this._stateCount=0,this._indexPulseCount=0,this._markDetector=0n,this._dataShifter=0,this._dataShiftCount=0,this._deliverData=0,this._deliverIsMarker=!1,this._crc=0,this._onDiscTrack=0,this._onDiscSector=0,this._onDiscLength=0,this._onDiscCrc=0,this._lastMfmBit=!1,this._logCommands=n?!!n.logFdcCommands:!1,this._logStateChanges=n?!!n.logFdcStateChanges:!1;const a=(c,u)=>this._pulsesCallback(c,u);for(const c of this._drives)c.setPulsesCallback(a);this.powerOnReset()}reset(){this._writeControl(0)}powerOnReset(){this.reset(),this._trackRegister=0,this._dataRegister=0}_updateNmi(){const t=this._isDrq|(this._isOpus?!1:this._isIntRq);this._cpu.NMI(t)}_setIntRq(t){this._isIntRq=t,this._updateNmi()}_setDrq(t){this._isDrq=t,t?(this._statusRegister&dt.typeIIorIIIDrq&&(this._statusRegister|=dt.typeIIorIIILostByte),this._statusRegister|=dt.typeIIorIIIDrq):this._statusRegister&=~dt.typeIIorIIIDrq,this._updateNmi()}_log(t){console.log(`WD1770: ${t}`)}_logCommand(t){this._logCommands&&this._log(t)}_opusRemapAddr(t){return t^4}_opusRemapVal(t,e){if(t>=4)return e;let s=ee.reset;return e&1?s|=ee.drive0:s|=ee.drive1,e&2&&(s|=ee.side),e&64&&(s|=ee.density),s}_masterRemapVal(t,e){if(t>=4)return e;let s=0;return e&4&&(s|=ee.reset),e&1&&(s|=ee.drive0),e&2&&(s|=ee.drive1),e&16&&(s|=ee.side),e&32&&(s|=ee.density),s}_remapVal(t,e){return this._isMaster?this._masterRemapVal(t,e):this._isOpus?this._opusRemapVal(t,e):e}_remapAddr(t){return t&=7,this._isMaster?t^4:this._isOpus?this._opusRemapAddr(t):t}read(t){switch(this._remapAddr(t)){case 4:return this._setIntRq(!1),this._statusRegister;case 5:return this._trackRegister;case 6:return this._sectorRegister;case 7:return(this._commandType===2||this._commandType===3)&&this._setDrq(!1),this._dataRegister}return 254}write(t,e){switch(t=this._remapAddr(t),e=this._remapVal(t,e),t){case 0:case 1:case 2:case 3:if(this._logCommand(`control register now ${et(e)}`),this._statusRegister&dt.busy&&!this._isReset(e))throw new Error("Control register updated while busy; without reset");this._writeControl(e);break;case 4:this._isReset(this._controlRegister)||this._doCommand(e);break;case 5:this._logCommand(`track register now ${e}`),this._trackRegister=e;break;case 6:this._isReset(this._controlRegister)?this._logCommand(`ignoring sector write of ${e}`):(this._logCommand(`sector register now ${e}`),this._sectorRegister=e);break;case 7:(this._commandType===2||this._commandType===3)&&this._setDrq(!1),this._dataRegister=e;break}}_doCommand(t){if(!this._currentDrive)throw new Error("Command while no selected drive");this._logCommand(`command ${et(t)} tr ${this._trackRegister} sr ${this._sectorRegister} dr ${this._dataRegister} cr ${et(this._controlRegister)} ptrk ${this._currentDrive.track} hpos ${this._currentDrive.headPosition}`);const e=t&240;if(e===Ct.forceInterrupt){this._handleForceInterrupt(t);return}if(this._statusRegister&dt.busy){this._log(`command ${et(t)} while busy with ${et(this._command)} - ignoring`);return}switch(this._command=e,this._isCommandSettle=!1,this._isCommandWrite=!1,this._isCommandVerify=!1,this._isCommandMulti=!1,this._isCommandDeleted=!1,this._isInterruptOnIndexPulse=!1,this._isWriteTrackCrcSecondByte=!1,e){case Ct.restore:case Ct.seek:case Ct.stepInNoUpdate:case Ct.stepInWithUpdate:case Ct.stepOutNoUpdate:case Ct.stepOutWithUpdate:this._commandType=1,this._isCommandVerify=!!(t&yr.typeIVerify),this._commandStepRateMs=this._stepRateMsFor(t);break;case Ct.readSector:case Ct.readSectorMulti:case Ct.writeSector:case Ct.writeSectorMulti:this._commandType=2,this._isCommandMulti=!!(t&yr.typeIIMulti);break;case Ct.readAddress:case Ct.readTrack:case Ct.writeTrack:this._commandType=3;break;default:throw new Error(`unimplemented command ${et(t)}`)}(this._commandType===2||this._commandType===3&&t&yr.typeIIorIIISettle)&&(this._isCommandSettle=!0),(this._command===Ct.writeSector||this._command===Ct.writeSectorMulti||this._command===Ct.writeTrack)&&(this._isCommandWrite=!0,this._isCommandDeleted=!!(t&yr.typeIIDeleted)),this._setDrq(!1),this._setIntRq(!1),this._statusRegister=this._statusRegister&dt.motorOn|dt.busy,this._indexPulseCount=0,this._statusRegister&dt.motorOn?this._dispatchCommand():(this._statusRegister|=dt.motorOn,this._currentDrive.startSpinning(),t&yr.disableSpinUp?(this._indexPulseCount=6,this._log(`command ${et(t)} spin up wait disabled, motor was off`),this._dispatchCommand()):this._setState(st.spinUpWait))}_setState(t){this._logStateChanges&&t!==this._state&&this._log(`State ${this._state} -> ${t} @ tr ${this._trackRegister} sr ${this._sectorRegister} dr ${this._dataRegister} cr ${et(this._controlRegister)} ptrk ${this._currentDrive.track} hpos ${this._currentDrive.headPosition}`),this._state=t,this._stateCount=0}_clearTimer(){this._timerState!==Ve.none&&(this._timerTask.cancel(),this._timerState=Ve.none)}_clearState(){this._setState(st.idle),this._clearTimer(),this._indexPulseCount=0}_stepRateMsFor(t){switch(t&3){case 0:return 6;case 1:return 12;case 2:return this._is1772?2:20;case 3:return this._is1772?3:30}}_handleForceInterrupt(t){const e=t&15;if(this._statusRegister&dt.busy)this._commandDone(!1);else{if(this._state!==st.idle)throw new Error(`Unexpected state when force interrupt: ${this._state}`);this._indexPulseCount=0,this._commandType=1,this._statusRegister&=dt.motorOn,this._statusRegister&dt.motorOn||(this._statusRegister|=dt.motorOn,this._currentDrive.startSpinning())}if(e===0)this._isInterruptOnIndexPulse=!1;else if(e===4)this._isInterruptOnIndexPulse=!0;else throw new Error(`1700 force interrupt flags not handled: ${e}`)}_timerFired(){if(!(this._statusRegister&dt.busy))throw new Error("Should be busy");const t=this._timerState;switch(this._timerState=Ve.none,t){case Ve.settle:this._dispatchCommand();break;case Ve.seek:this._command===Ct.stepInNoUpdate||this._command===Ct.stepInWithUpdate||this._command===Ct.stepOutNoUpdate||this._command===Ct.stepOutWithUpdate?this._checkVerify():this._doSeekStepOrVerify();break;case Ve.done:this._doneTimer();break;default:throw new Error(`Unexpected timer state ${t}`)}}_isSide(t){return!!(t&ee.side)}_isDoubleDensity(t){return!(t&ee.density)}_isReset(t){return!(t&ee.reset)}_writeControl(t){const e=!!(this._statusRegister&dt.motorOn);if(this._currentDrive&&this._currentDrive.spinning){if(!e)throw new Error(`Unexpected motor control bit off when setting the control register to ${et(t)}`);this._currentDrive.stopSpinning()}t&ee.drive0||t&ee.drive1?this._currentDrive=this._drives[t&ee.drive0?0:1]:this._currentDrive=null,this._currentDrive&&(e&&this._currentDrive.startSpinning(),this._currentDrive.selectSide(this._isSide(t)));for(const s of this._drives)s.set32usMode(this._isDoubleDensity(t));this._controlRegister=t,this._isReset(t)&&(this._clearState(),this._currentDrive&&e&&this._currentDrive.stopSpinning(),this._statusRegister=0,this._sectorRegister=1,this._isIntRq=!1,this._isDrq=!1,this._updateNmi(),this._markDetector=0n,this._dataShifter=0,this._dataShiftCount=0,this._isIndexPulse=!1,this._lastMfmBit=!1,this._deliverData=0,this._deliverIsMarker=!1)}_makeSeekNoise(t){this._currentDrive&&this._currentDrive.notifySeekAmount(t)}_dispatchCommand(){if(!this._currentDrive)throw new Error("Unexpectedly dispatching a command with no drive set");if(this._isCommandWrite&&this._currentDrive.writeProtect){this._statusRegister|=dt.writeProtected,this._commandDone(!0);return}switch(this._command){case Ct.restore:this._trackRegister=255,this._logCommand(`track register now ${this._trackRegister}`),this._dataRegister=0;case Ct.seek:this._doSeekStepOrVerify(),this._makeSeekNoise(this._dataRegister-this._trackRegister);break;case Ct.stepInNoUpdate:this._doSeekStep(1,!1),this._makeSeekNoise(1);break;case Ct.stepInWithUpdate:this._doSeekStep(1,!0),this._makeSeekNoise(1);break;case Ct.stepOutNoUpdate:this._doSeekStep(-1,!1),this._makeSeekNoise(-1);break;case Ct.stepOutWithUpdate:this._doSeekStep(-1,!0),this._makeSeekNoise(-1);break;case Ct.readSector:case Ct.readSectorMulti:case Ct.writeSector:case Ct.writeSectorMulti:case Ct.readAddress:this._setState(st.searchId),this._indexPulseCount=0;break;case Ct.readTrack:this._setState(st.waitIndex),this._indexPulseCount=0;break;case Ct.writeTrack:this._setState(st.writeTrackSetup),this._indexPulseCount=0;break;default:throw new Error(`Invalid command ${this._command} in dispatch`)}}_pulsesCallback(t,e){if(!this._currentDrive||!this._currentDrive.spinning||!(this._statusRegister&dt.motorOn))throw new Error("Something unfortunate happened in the 1770 pulses callback");const s=this._isIndexPulse;this._isIndexPulse=this._currentDrive.indexPulse;const n=this._isIndexPulse&&!s,a=e===16;switch(this._isInterruptOnIndexPulse&&n&&this._setIntRq(!0),this._updateTypeIStatusBits(),this._state){case st.idle:this._pulsesCallbackIdle();break;case st.timerWait:break;case st.spinUpWait:this._pulsesCallbackSpinUpWait();break;case st.waitIndex:n&&(this._setState(st.inReadTrack),this._bitstreamReceived(t,e,!1));break;case st.searchId:case st.inId:case st.searchData:case st.inData:case st.readTrack:this._bitstreamReceived(t,e,n),this._indexPulseCount>=6&&(this._statusRegister|=dt.recordNotFound,this._commandDone(!0));break;case st.writeSectorDelay:this._pulsesCallbackSectorDelay(a);break;case st.writeSectorLeadInFm:this._writeByte(a,0,!1),++this._stateCount===6&&this._setState(st.writeSectorMarkerFm);break;case st.writeSectorLeadInMfm:this._stateCount>=11&&this._writeByte(a,0,!1),++this._stateCount===23&&this._setState(st.writeSectorMarkerMfm);break;case st.writeSectorMarkerFm:{const c=this._isCommandDeleted?N.deletedDataMarkDataPattern:N.dataMarkDataPattern;this._crc=N.crcAddByte(N.crcInit(!1),c),this._writeByte(!1,c,!0),this._setState(st.writeSectorBody);break}case st.writeSectorMarkerMfm:this._pulsesCallbackWriteSectorMarkerMfm();break;case st.writeSectorBody:this._pulsesCallbackWriteSectorBody(a);break;case st.checkMulti:this._isCommandMulti?(this._sectorRegister++,this._indexPulseCount=0,this._setState(st.searchId)):this._commandDone(!0);break;case st.writeTrackSetup:this._pulsesCallbackWriteTrackSetup();break;case st.inWriteTrack:this._pulsesCallbackInWriteTrack(a,n);break;case st.done:this._commandDone(!0);break;default:throw new Error(`Unexpected state ${this._state}`)}n&&this._indexPulseCount++}_pulsesCallbackIdle(){if(this._statusRegister&dt.busy)throw new Error("Unexpectedly busy in idle state");this._indexPulseCount<9||(this._logCommand("automatic motor off"),this._currentDrive.stopSpinning(),this._statusRegister&=~dt.motorOn,this._commandType===1&&(this._statusRegister&=~(dt.typeITrack0|dt.typeIIndex)))}_pulsesCallbackSpinUpWait(){if(!(this._indexPulseCount<6))if(this._commandType===1&&(this._statusRegister|=dt.typeISpinUpDone),this._isCommandSettle){const t=this._is1772?15:30;this._startTimer(Ve.settle,t*1e3)}else this._dispatchCommand()}_pulsesCallbackSectorDelay(t){this._stateCount===0?this._indexPulseCount=0:this._stateCount===1?this._setDrq(!0):this._stateCount===10&&this._statusRegister&dt.typeIIorIIIDrq&&(this._statusRegister|=dt.typeIIorIIILostByte,this._commandDone(!0)),this._stateCount++,this._stateCount===12&&this._setState(t?st.writeSectorLeadInMfm:st.writeSectorLeadInFm)}_pulsesCallbackWriteSectorMarkerMfm(){if(this._stateCount<3&&this._writeByte(!0,161,!0),++this._stateCount===4){const t=this._isCommandDeleted?N.deletedDataMarkDataPattern:N.dataMarkDataPattern;this._crc=N.crcAddByte(N.crcInit(!0),t),this._writeByte(!0,t,!1),this._setState(st.writeSectorBody)}}_pulsesCallbackWriteSectorBody(t){if(this._stateCount<this._onDiscLength){let e=this._dataRegister;this._statusRegister&dt.typeIIorIIIDrq&&(e=0,this._statusRegister|=dt.typeIIorIIILostByte),this._crc=N.crcAddByte(this._crc,e),this._writeByte(t,e,!1),this._stateCount!==this._onDiscLength-1&&this._setDrq(!0)}else this._stateCount<this._onDiscLength+2?(this._writeByte(t,this._crc>>>8&255,!1),this._crc=this._crc<<8&65535):(this._writeByte(t,255,!1),this._setState(st.checkMulti));this._stateCount++}_pulsesCallbackWriteTrackSetup(){if(this._stateCount===0)this._indexPulseCount=0,this._setDrq(!0);else if(this._stateCount===3)if(this._statusRegister&dt.typeIIorIIIDrq)this._statusRegister|=dt.typeIIorIIILostByte,this._commandDone(!0);else{this._setState(st.inWriteTrack);return}this._stateCount++}_pulsesCallbackInWriteTrack(t,e){if(this._stateCount===0&&!e)return;if(this._stateCount>0&&e){this._commandDone(!0);return}if(this._isWriteTrackCrcSecondByte){this._writeByte(t,this._crc&255,!1),this._isWriteTrackCrcSecondByte=!1,this._setDrq(!0);return}let s=this._dataRegister;this._statusRegister&dt.typeIIorIIIDrq&&(s=0,this._statusRegister|=dt.typeIIorIIILostByte);let n=!1,a=!1;switch(s){case 245:if(!t)throw new Error("Unhandled 0xf5 in FM");n=!0,a=!0,s=161;break;case 246:if(!t)throw new Error("Unhandled 0xf6 in FM");n=!0,s=194;break;case 248:case 249:case 250:case 251:case 254:t||(n=!0,a=!0);break;case 252:t||(n=!0);break}a&&(this._crc=N.crcInit(t)),s===247?(this._writeByte(t,this._crc>>>8&255,!1),this._isWriteTrackCrcSecondByte=!0):(this._writeByte(t,s,n),t&&a||(this._crc=N.crcAddByte(this._crc,s)),this._setDrq(!0)),this._stateCount++}_markDetectorTriggered(){if(this._isDoubleDensity(this._controlRegister)){if((this._markDetector&0xffffffffn)===0xaaaa4489n)return this._deliverData=161,!0;(this._markDetector&0xffffffffffff0000n)===0x4489448944890000n&&(this._deliverIsMarker=!0)}else if((this._markDetector&0x0000ffff00000000n)===0x0000888800000000n){const{clocks:t,data:e,iffyPulses:s}=N._2usPulsesToFm(Number(this._markDetector&0xffffffffn));if(!s&&t===199&&(e===248||e===251||e===254))return this._deliverData=e,this._deliverIsMarker=!0,!0}return!1}_bitReceived(t){if(this._markDetector=this._markDetector<<1n&0xffffffffffffffffn|(t?1n:0n),this._markDetectorTriggered()){this._dataShifter=0,this._dataShiftCount=0;return}if(this._dataShifter=(this._dataShifter<<1|(t?1:0))&4294967295,this._dataShiftCount++,this._isDoubleDensity(this._controlRegister))this._dataShiftCount===16&&(this._deliverData=N._2usPulsesToMfm(this._dataShifter),this._dataShifter=0,this._dataShiftCount=0);else if(this._dataShiftCount===32){const{data:e,iffyPulses:s}=N._2usPulsesToFm(this._dataShifter);if(s){const{data:n}=N._2usPulsesToFm(this._currentDrive.getQuasiRandomPulses());this._deliverData=n}else this._deliverData=e;this._dataShifter=0,this._dataShiftCount=0}}_bitstreamReceived(t,e,s){t=t<<32-e&4294967295;for(let n=0;n<e;++n)this._bitReceived(!!(t&2147483648)),t=t<<1&4294967295;this._byteReceived(s)}_writeByte(t,e,s){let n;if(t)if(s)n=this._mfmMarkerFor(e);else{const a=N.mfmTo2usPulses(this._lastMfmBit,e);this._lastMfmBit=a.lastBit,n=a.pulses}else{const a=s?this._fmMarkerClocksFor(e):255;n=N.fmTo2usPulses(a,e)}this._currentDrive.writePulses(n)}_fmMarkerClocksFor(t){switch(t){case 252:return 215;case 248:case 249:case 250:case 251:case 254:return N.markClockPattern}}_mfmMarkerFor(t){switch(t){case 161:return N.mfmA1Sync;case 194:return N.mfmC2Sync;default:throw new Error(`Bad marker byte ${et(t)}`)}}_updateTypeIStatusBits(){this._commandType===1&&(this._statusRegister&=~(dt.typeITrack0|dt.typeIIndex),this._currentDrive.track===0&&(this._statusRegister|=dt.typeITrack0),this._currentDrive.indexPulse&&(this._statusRegister|=dt.typeIIndex))}_startTimer(t,e){if(!(this._statusRegister&dt.busy))throw new Error("Should be busy");if(this._timerState!==Ve.none)throw new Error("Timer started but still running");this._timerTask.cancel(),this._timerState=t,this._setState(st.timerWait),this._timerTask.schedule(e*2)}_commandDone(t){if(!(this._statusRegister&dt.busy))throw new Error("Should be busy");this._doRaiseIntRq=t,this._startTimer(Ve.done,32)}_doneTimer(){this._statusRegister&=~dt.busy,this._clearState(),this._updateTypeIStatusBits(),this._doRaiseIntRq&&this._setIntRq(!0),this._logCommand(`result status ${et(this._statusRegister)}`)}_checkVerify(){this._isCommandVerify?(this._indexPulseCount=0,this._setState(st.searchId)):this._commandDone(!0)}_doSeekStep(t,e){this._currentDrive.seekOneTrack(t),e&&(this._trackRegister+=t),this._updateTypeIStatusBits(),this._startTimer(Ve.seek,this._commandStepRateMs*1e3)}_doSeekStepOrVerify(){if(this._trackRegister===this._dataRegister){this._checkVerify();return}const t=this._trackRegister>this._dataRegister?-1:1;if(this._currentDrive.track===0&&t===-1){this._trackRegister=0,this._checkVerify();return}this._doSeekStep(t,!0)}_byteReceived(t){const e=this._isDoubleDensity(this._controlRegister),s=this._deliverIsMarker,n=this._deliverData;switch(this._deliverIsMarker=!1,this._state){case st.searchId:if(!s||n!==N.idMarkDataPattern)break;this._setState(st.inId),this._crc=N.crcAddByte(N.crcInit(e),N.idMarkDataPattern);break;case st.inId:this._byteReceivedInId(n);break;case st.searchData:this._byteReceivedSearchData(n,s);break;case st.inData:this._byteReceivedInData(n);break;case st.inReadTrack:t?this._commandDone(!0):this._sendDataToHost(n);break;default:throw new Error(`Bad state ${this._state}`)}}_byteReceivedInId(t){const e=this._command===Ct.readAddress;switch(this._stateCount){case 0:this._onDiscTrack=t,e&&(this._sectorRegister=t);break;case 2:this._onDiscSector=t;break;case 3:this._onDiscLength=128<<(t&3);break}if(e&&this._sendDataToHost(t),this._stateCount<4?this._crc=N.crcAddByte(this._crc,t):this._onDiscCrc=this._onDiscCrc<<8&65535|t,++this._stateCount!==6)return;const s=this._crc!==this._onDiscCrc;if(e){s&&(this._statusRegister|=dt.crcError),this._setState(st.done);return}if(this._trackRegister!==this._onDiscTrack){this._setState(st.searchId);return}if(this._commandType===2&&this._sectorRegister!==this._onDiscSector){this._setState(st.searchId);return}if(s){this._statusRegister|=dt.crcError,this._setState(st.searchId);return}this._commandType===1?this._commandDone(!0):this._isCommandWrite?this._setState(st.writeSectorDelay):this._setState(st.searchData)}_byteReceivedSearchData(t,e){this._stateCount++;const s=this._isDoubleDensity(this._controlRegister),n=s?2:1;if(!(this._stateCount<14*n)){if(this._stateCount>31*n){this._setState(st.searchId);return}if(e){if(t!==N.dataMarkDataPattern)if(t===N.deletedDataMarkDataPattern)this._statusRegister|=dt.typeIIorIIIDeletedMark;else return;this._setState(st.inData),this._statusRegister&=~dt.crcError,this._crc=N.crcAddByte(N.crcInit(s),t)}}}_byteReceivedInData(t){if(this._stateCount++,this._stateCount<=this._onDiscLength){this._crc=N.crcAddByte(this._crc,t),this._sendDataToHost(t);return}else if(this._stateCount<=this._onDiscLength+2){this._onDiscCrc=this._onDiscCrc<<8&65535|t;return}if(this._crc!==this._onDiscCrc){this._statusRegister|=dt.crcError,this._commandDone(!0);return}this._setState(st.checkMulti)}_sendDataToHost(t){if(this._commandType!==2&&this._commandType!==3)throw new Error("Bad command type");this._setDrq(!0),this._dataRegister=t}loadDisc(t,e){this._drives[t].setDisc(e)}get motorOn(){return[this._drives[0]?this._drives[0].spinning:!1,this._drives[0]?this._drives[1].spinning:!1]}get drives(){return this._drives}}class zs extends kC{constructor(t,e,s,n){super(t,s,void 0,n);let a=0,c=0;const u=()=>{c?e.spinUp():e.spinDown()};for(const p of this.drives)p.addEventListener("startSpinning",()=>{c++,setTimeout(u,2)}),p.addEventListener("stopSpinning",()=>{--c,setTimeout(u,2)}),p.addEventListener("step",x=>{const _=Date.now();_>a&&(a=_+e.seek(x.stepAmount)*1e3)})}}const I=Object.freeze({internalPointer:0,internalCountMsbCopy:0,internalParamCount:1,internalSeekRetryCount:1,internalParamDataMarker:2,internalParam_5:3,internalParam_4:4,internalParam_3:5,currentSector:6,internalParam_2:6,internalParam_1:7,internalHeaderPointer:8,internalMsCountHi:8,internalMsCountLo:9,internalSeekCount:10,internalIdSector:10,internalSeekTarget_1:11,internalDynamicDispatch:11,internalSeekTarget_2:12,internalIdTrack:12,headStepRate:13,headSettleTime:14,headLoadUnload:15,badTrack_1Drive_0:16,badTrack_2Drive_0:17,trackDrive_0:18,internalCountLsb:19,internalCountMsb:20,internalDriveInCopy:21,internalWriteRunData:21,internalGap2Skip:21,internalResult:22,mode:23,internalStatus:23,badTrack_1Drive_1:24,badTrack_2Drive_1:25,trackDrive_1:26,internalDriveInLatched:27,internalIndexPulseCount:28,internalData:29,internalParameter:30,internalCommand:31,mmioDriveIn:34,mmioDriveOut:35,mmioClocks:36,mmioData:37}),Et=Object.freeze({select_1:128,select_0:64,side:32,lowHeadCurrent:16,loadHead:8,direction:4,step:2,writeEnable:1,selectFlags:192}),zu=Object.freeze({singleActuator:2,noDma:1}),ae=Object.freeze({status:0,result:1,unknown_read_2:2,unknown_read_3:3,command:0,parameter:1,reset:2,data:4}),Ie=Object.freeze({ok:0,clockError:8,lateDma:10,idCrcError:12,dataCrcError:14,driveNotReady:16,writeProtected:18,sectorNotFound:24,flagDeletedData:32}),Ot=Object.freeze({scanData:0,scanDataAndDeleted:1,writeData:2,writeDeletedData:3,readData:4,readDataAndDeleted:5,readId:6,verify:7,format:8,unused_9:9,seek:10,readDriveStatus:11,unused_12:12,specify:13,writeSpecialRegister:14,readSpecialRegister:15}),Bt=Object.freeze({busy:128,commandFull:64,paramFull:32,resultReady:16,nmi:8,needData:4}),Oi=Object.freeze({none:0,command:1,specify:2}),oe=Object.freeze({none:1,timeout:2,spindown:3,startReadId:4,startFormat:5,stopFormat:6}),Mi=Object.freeze({none:0,seekStep:1,postSeek:2}),W=Object.freeze({null:0,idle:1,syncingForIdWait:2,syncingForId:3,checkIdMarker:4,inId:5,inIdCrc:6,syncingForData:7,checkDataMarker:8,inData:9,inDataCrc:10,skipGap_2:11,writeRun:12,writeDataMark:13,writeSectorData:14,writeCrc_2:15,writeCrc_3:16,dynamicDispatch:17,formatWriteIdMarker:18,formatIdCrc_2:19,formatIdCrc_3:20,formatWriteDataMarker:21,formatDataCrc_2:22,formatDataCrc_3:23,formatGap_4:24}),At=Object.freeze({uninitialised:0,unchanged:1,seek:2,readId:3,read:4,write:5,format:6,formatGap1OrGap3FFs:7,formatGap1orGap300s:8,formatGap2_FFs:9,formatGap2_00s:10,formatData:11});class cs{static get NumRegisters(){return 32}constructor(t,e,s,n){this._cpu=t,s?this._drives=s:this._drives=[new _s(0,e),new _s(1,e)],this._currentDrive=null,this._paramCallback=Oi.none,this._indexPulseCallback=oe.none,this._timerState=Mi.none,this._callContext=At.uninitialised,this._didSeekStep=!1,this._regs=new Uint8Array(cs.NumRegisters),this._isResultReady=!1,this._status=0,this._mmioData=0,this._mmioClocks=0,this._driveOut=0,this._shiftRegister=0,this._numShifts=0,this._state=W.null,this._stateCount=0,this._stateIsIndexPulse=!1,this._crc=0,this._onDiscCrc=0,this._logCommands=n?!!n.logFdcCommands:!1,this._logStateChanges=n?!!n.logFdcStateChanges:!1,this._timerTask=e.newTask(()=>this._timerFired());const a=(c,u)=>this._pulsesCallback(c,u);for(const c of this._drives)c.setPulsesCallback(a);this.powerOnReset()}_commandAbort(){this._driveOut&Et.writeEnable&&this._currentDrive.writePulses(N.fmTo2usPulses(255,255)),this._cpu.NMI(!1)}powerOnReset(){this.reset(),this._regs.fill(0),this._isResultReady=!1,this._mmioData=0,this._mmioClocks=0,this._stateCount=0,this._stateIsIndexPulse=!1}reset(){this._commandAbort(),this._clearCallbacks(),this._setDriveOut(0),this._statusLower(this.internalStatus)}get internalStatus(){return this._regs[I.internalStatus]}read(t){switch(t&7){case ae.status:return this._status;case ae.result:{const e=this._result;return this._resultConsumed(),this._statusLower(Bt.nmi),e}case ae.data:case ae.data+1:case ae.data+2:case ae.data+3:return this._statusLower(Bt.needData|Bt.nmi),this._regs[I.internalData];case ae.unknown_read_2:return this._regs[I.internalCountMsb];case ae.unknown_read_3:return this._regs[I.internalCountLsb];default:throw new Error(`"Unexpected read of addr ${Vt(t)}"`)}}_log(t){console.log(`8271: ${t}`)}_logCommand(t){this._logCommands&&this._log(t)}write(t,e){switch(t&7){case ae.command:this._commandWritten(e);break;case ae.parameter:this._paramWritten(e);break;case ae.data:case ae.data+1:case ae.data+2:case ae.data+3:this._statusLower(Bt.needData|Bt.nmi),this._regs[I.internalData]=e;break;case ae.reset:e!==0&&e!==1&&this._log("funky reset"),e===1&&(this._logCommand("reset"),this.reset());break;case 3:default:this._log(`Not supported: ${Vt(t)}=${et(e)}`)}}_checkIndexPulse(){const t=this._stateIsIndexPulse;if(this._stateIsIndexPulse=this._index,!(!this._stateIsIndexPulse||t))switch(this._indexPulseCallback){case oe.none:break;case oe.timeout:--this._regs[I.internalIndexPulseCount]===0&&this._finishCommand(Ie.sectorNotFound);break;case oe.spindown:--this._regs[I.internalIndexPulseCount]===0&&(this._logCommand("automatic head unload"),this._spinDown(),this._indexPulseCallback=oe.none);break;case oe.startFormat:if(this._regs[I.internalParam_4]!==0)throw new Error("format GAP5 not supported");this._regs[I.internalParam_2]--,this._regs[I.internalDynamicDispatch]=4,this._indexPulseCallback=oe.none,this._writeFFsAnd00s(At.formatGap1OrGap3FFs,this._regs[I.internalParam_5]);break;case oe.stopFormat:this._checkCompletion();break;case oe.startReadId:this._startIndexPulseTimeout(),this._startSyncingForHeader();break;default:throw new Error(`Unexpected index pulse callback ${this._indexPulseCallback}`)}}_pulsesCallback(t,e){if(e!==32)throw new Error("Expected FM pulses only");if(this._checkIndexPulse(),this._driveOut&Et.writeEnable){const s=this._mmioClocks,n=this._mmioData,a=N.fmTo2usPulses(s,n);s!==255&&s!==N.markClockPattern&&this._log(`writing unusual clocks=${et(s)} data=${et(n)}`),this._currentDrive.writePulses(a)}switch(this._mmioData=this._regs[I.internalData],this._state){case W.idle:break;case W.syncingForIdWait:case W.syncingForId:case W.checkIdMarker:case W.inId:case W.inIdCrc:case W.skipGap_2:case W.syncingForData:case W.checkDataMarker:case W.inData:case W.inDataCrc:{for(let s=0;s<16;++s){const n=!!(t&3221225472);t=t<<2&4294967295,this._shiftDataBit(n)}break}case W.writeRun:case W.writeDataMark:case W.dynamicDispatch:case W.writeSectorData:case W.writeCrc_2:case W.writeCrc_3:case W.formatWriteIdMarker:case W.formatIdCrc_2:case W.formatIdCrc_3:case W.formatWriteDataMarker:case W.formatDataCrc_2:case W.formatDataCrc_3:case W.formatGap_4:this._byteCallbackWriting();break;default:throw new Error(`Unknown state ${this._state}`)}}_shiftDataBit(t){const e=this._state;switch(e){case W.syncingForIdWait:this._stateCount++,this._stateCount===4*8*2&&this._startSyncingForHeader();break;case W.syncingForId:case W.syncingForData:{const s=this._stateCount;if(t===!(s&1))this._stateCount++;else if(s>=32&&s&1){if(!t)throw new Error("Assertion failed; was expecting a one bit");this._setState(e===W.syncingForId?W.checkIdMarker:W.checkDataMarker),this._shiftRegister=3,this._numShifts=2}else this._stateCount=t?1:0;break}case W.checkIdMarker:case W.inId:case W.inIdCrc:case W.checkDataMarker:case W.inData:case W.inDataCrc:case W.skipGap_2:{const s=this._shiftRegister<<1&4294967295|(t?1:0);if(this._shiftRegister=s,this._numShifts++,this._numShifts!==16)break;const n=cs.extractBits(s),a=cs.extractBits(s<<1);n!==255&&e!==W.checkIdMarker&&e!==W.checkDataMarker&&e!==W.skipGap_2||this._byteCallbackReading(a,n),this._shiftRegister=0,this._numShifts=0;break}case W.idle:case W.writeRun:break;default:throw new Error(`"Unexpected state ${e}"`)}}static extractBits(t){let e=0;return t&32768&&(e|=128),t&8192&&(e|=64),t&2048&&(e|=32),t&512&&(e|=16),t&128&&(e|=8),t&32&&(e|=4),t&8&&(e|=2),t&2&&(e|=1),e}_checkDataLossOk(){let t=!0;this._regs[I.mode]&zu.noDma||(t=!1);const e=this._internalCommand;return(e===Ot.scanData||e===Ot.scanDataAndDeleted)&&(t=!1),this.internalStatus&Bt.needData&&(t=!1),t?!0:(this._commandAbort(),this._finishCommand(Ie.lateDma),!1)}_byteCallbackReading(t,e){const s=this._internalCommand;if(this._irqCallbacks){if(!this._checkDataLossOk())return;this._regs[I.internalData]=t,this._statusRaise(Bt.nmi|Bt.needData)}switch(this._state){case W.skipGap_2:if(--this._regs[I.internalGap2Skip])break;if(this._callContext===At.read)this._setState(W.syncingForData);else if(this._callContext===At.write)this._doWriteRun(At.write,0);else throw new Error(`Unexpected call context ${this._callContext}`);break;case W.checkIdMarker:e===N.markClockPattern&&t===N.idMarkDataPattern?(this._crc=N.crcAddByte(N.crcInit(!1),t),s===Ot.readId&&this._startIrqCallbacks(),this._setState(W.inId)):this._startSyncingForHeader();break;case W.inId:this._crc=N.crcAddByte(this._crc,t),this._writeRegister(this._regs[I.internalHeaderPointer],t),this._regs[I.internalHeaderPointer]--,(this._regs[I.internalHeaderPointer]&7)===0&&(this._onDiscCrc=0,this._stopIrqCallbacks(),this._setState(W.inIdCrc));break;case W.inIdCrc:if(this._onDiscCrc=(this._onDiscCrc<<8|t)&4294967295,++this._stateCount===2){if(!this._checkCrc(Ie.idCrcError))break;this._regs[I.internalCommand]===24?this._checkCompletion():this._regs[I.internalIdTrack]!==this._regs[I.internalParam_1]?++this._regs[I.internalSeekRetryCount]===3?this._finishCommand(Ie.sectorNotFound):(this._logCommand("stepping due to track mismatch"),this._doSeek(At.unchanged)):this._regs[I.internalIdSector]===this._regs[I.internalParam_2]?(this._regs[I.internalGap2Skip]=11,this._callContext===At.write&&(this._regs[I.internalCountMsb]=0,this._regs[I.internalCountLsb]=5),this._setState(W.skipGap_2)):this._setState(W.syncingForIdWait)}break;case W.checkDataMarker:if(e===N.markClockPattern&&(t===N.dataMarkDataPattern||t===N.deletedDataMarkDataPattern)){let n=!0;t===N.deletedDataMarkDataPattern&&((this._regs[I.internalCommand]&15)===0&&(n=!1),this._setResult(Ie.flagDeletedData)),this._regs[I.internalCommand]===28&&(n=!1),n&&this._startIrqCallbacks(),this._crc=N.crcAddByte(N.crcInit(!1),t),this._setState(W.inData)}else this._finishCommand(Ie.clockError);break;case W.inData:{this._crc=N.crcAddByte(this._crc,t),this._decrementCounter()&&(this._onDiscCrc=0,this._setState(W.inDataCrc));break}case W.inDataCrc:if(this._onDiscCrc=(this._onDiscCrc<<8|t)&4294967295,++this._stateCount===2){if(!this._checkCrc(Ie.dataCrcError))break;this._checkCompletion()}break;default:throw new Error(`Unexpected state ${this._state}`)}}_callbackWriteRun(){if(!this._decrementCounter()){this._mmioData=this._regs[I.internalWriteRunData],this._crc=N.crcAddByte(this._crc,this._mmioData);return}switch(this._callContext){case At.write:this._mmioData=0,this._startIrqCallbacks(),this._setState(W.writeDataMark);break;case At.formatGap1OrGap3FFs:this._regs[I.internalCountLsb]=5,this._doWriteRun(At.formatGap1orGap300s,0);break;case At.formatGap1orGap300s:this._mmioData=0,this._startIrqCallbacks(),this._setState(W.formatWriteIdMarker);break;case At.formatGap2_FFs:this._regs[I.internalCountLsb]=5,this._doWriteRun(At.formatGap2_00s,0);break;case At.formatGap2_00s:this._mmioData=0,this._setState(W.formatWriteDataMarker);break;case At.formatData:this._mmioData=this._crc>>>8&255,this._setState(W.formatDataCrc_2);break;default:throw new Error(`Unexpected call context ${this._callContext}`)}}_callbackDynamicDispatch(){const t=this._regs[I.internalDynamicDispatch]++;switch(t){case 0:this._crc=N.crcAddByte(this._crc,this._mmioData);break;case 1:this._mmioData=this._crc>>>8&255,this._setState(W.writeCrc_2);break;case 2:this._checkCompletion();break;case 4:this._mmioClocks=255;case 5:case 6:case 7:t===6&&this._stopIrqCallbacks(),this._crc=N.crcAddByte(this._crc,this._mmioData);break;case 8:this._mmioData=this._crc>>>8&255,this._setState(W.formatIdCrc_2);break;case 9:this._regs[I.internalCountLsb]=10,this._writeFFsAnd00s(At.formatGap2_FFs,-1);break;case 10:this._resetSectorByteCount(),this._doWriteRun(At.formatData,229);break;case 11:this._mmioData=255,(--this._regs[I.internalParam_3]&31)===0?(this._regs[I.internalParam_3]=1,this._indexPulseCallback=oe.stopFormat,this._setState(W.formatGap_4)):(this._regs[I.internalDynamicDispatch]=4,this._writeFFsAnd00s(At.formatGap1OrGap3FFs,this._regs[I.internalParam_2]));break;default:throw new Error(`Dodgy routine number ${t}`)}}_byteCallbackWriting(){if(this._irqCallbacks){if(!this._checkDataLossOk())return;this._statusRaise(Bt.nmi|Bt.needData)}switch(this._state){case W.writeRun:this._callbackWriteRun();break;case W.writeDataMark:this._mmioData=this._regs[I.internalParamDataMarker],this._crc=N.crcAddByte(N.crcInit(!1),this._mmioData),this._mmioClocks=N.markClockPattern,this._resetSectorByteCount(),this._regs[I.internalCountLsb]--,this._setState(W.writeSectorData);break;case W.writeSectorData:this._mmioClocks=255,this._crc=N.crcAddByte(this._crc,this._mmioData),this._decrementCounter()&&(this._regs[I.internalDynamicDispatch]=0,this._setState(W.dynamicDispatch));break;case W.writeCrc_2:this._mmioData=this._crc&255,this._setState(W.writeCrc_3);break;case W.writeCrc_3:this._mmioData=255,this._setState(W.dynamicDispatch);break;case W.dynamicDispatch:this._callbackDynamicDispatch();break;case W.formatWriteIdMarker:this._mmioData=N.idMarkDataPattern,this._mmioClocks=N.markClockPattern,this._crc=N.crcAddByte(N.crcInit(!1),this._mmioData),this._setState(W.dynamicDispatch);break;case W.formatIdCrc_2:this._mmioData=this._crc&255,this._setState(W.formatIdCrc_3);break;case W.formatIdCrc_3:this._mmioData=255,this._setState(W.dynamicDispatch);break;case W.formatWriteDataMarker:this._mmioData=N.dataMarkDataPattern,this._mmioClocks=N.markClockPattern,this._crc=N.crcAddByte(N.crcInit(!1),this._mmioData),this._setState(W.dynamicDispatch);break;case W.formatDataCrc_2:this._mmioData=this._crc&255,this._setState(W.formatDataCrc_3);break;case W.formatDataCrc_3:this._mmioData=255,this._setState(W.dynamicDispatch);break;case W.formatGap_4:this._mmioData=255;break;default:throw new Error(`Bad write state ${this._state}`)}}_resetSectorByteCount(){this._regs[I.internalCountMsb]=this._regs[I.internalCountMsbCopy],this._regs[I.internalCountLsb]=128}_checkCompletion(){this._checkDriveReady()&&(this._driveOutLower(Et.writeEnable),this._clearCallbacks(),(--this._regs[I.internalParam_3]&31)===0?this._finishCommand(Ie.ok):(this._regs[I.internalParam_2]+=this._regs[I.internalParam_4]&63,this._doCommandDispatch()))}_checkCrc(t){return this._crc===this._onDiscCrc?!0:(this._finishCommand(t),!1)}_statusRaise(t){this._regs[I.internalStatus]|=t,t&Bt.nmi&&this._updateNmi(),this._updateExternalStatus()}_statusLower(t){this._regs[I.internalStatus]&=~t,t&Bt.nmi&&this._updateNmi(),this._updateExternalStatus()}_setResult(t){this._regs[I.internalResult]=t,this._isResultReady=!0,this._updateExternalStatus()}get _result(){return this._regs[I.internalResult]}_updateNmi(){const e=!!(this.internalStatus&Bt.nmi);this._cpu.nmi&&e&&this._log("edge triggered NMI already high"),this._cpu.NMI(e)}_updateExternalStatus(){let t=this.internalStatus;t&=-4,t&=~Bt.resultReady,this._isResultReady&&(t|=Bt.resultReady),t&=-97,this._status=t}_commandWritten(t){this.internalStatus&Bt.busy&&this._log(`command ${et(t)} while busy with ${et(this._regs[I.internalCommand])}`),this._regs[I.internalCommand]=t,this._statusRaise(Bt.busy),this._statusLower(Bt.commandFull),this._setResult(0),this._regs[I.internalParam_3]=1,this._regs[I.internalParam_4]=1;const s=t&24?t&3:5;this._regs[I.internalParamCount]=s,s?(this._regs[I.internalPointer]=I.internalParam_1,this._paramCallback=Oi.command):this._startCommand()}_resultConsumed(){this._isResultReady=!1,this._updateExternalStatus()}_paramWritten(t){switch(this._regs[I.internalParameter]=t,this._resultConsumed(),this._paramCallback){case Oi.none:break;case Oi.command:{this._writeRegister(this._regs[I.internalPointer],t),--this._regs[I.internalPointer],--this._regs[I.internalParamCount]===0&&this._startCommand();break}case Oi.specify:{this._logCommand(`specify param ${et(t)}`),this._writeRegister(this._regs[I.internalPointer],t),++this._regs[I.internalPointer],--this._regs[I.internalParamCount]===0&&this._finishSimpleCommand();break}default:throw new Error(`Unexpected param callback ${this._paramCallback}`)}}_readRegister(t){if(t&=63,t<cs.NumRegisters)return this._regs[t];switch(t&=7,t){case I.mmioDriveIn&7:return this._driveIn;case I.mmioDriveOut&7:return this._driveOut;case I.mmioClocks&7:return this._mmioClocks;case I.mmioData&7:return this._mmioData;default:this._log(`direct read from MMIO register ${et(t)}`);break}return 0}_writeRegister(t,e){if(t&=63,t<cs.NumRegisters){this._regs[t]=e;return}switch(t&=7,t){case I.mmioDriveOut&7:this._setDriveOut(e);break;case I.mmioClocks&7:this._mmioClocks=e;break;case I.mmioData&7:this._mmioData=e;break;default:this._log(`direct write to MMIO register ${et(t)}`);break}}_driveOutRaise(t){this._setDriveOut(t|this._driveOut)}_driveOutLower(t){this._setDriveOut(this._driveOut&~t)}_setDriveOut(t){this._currentDrive&&this._currentDrive.stopSpinning(),this._currentDrive=null;const e=t&Et.selectFlags;e===Et.select_0?this._currentDrive=this._drives[0]:e===Et.select_1&&(this._currentDrive=this._drives[1]),this._currentDrive&&(t&Et.loadHead&&this._currentDrive.startSpinning(),this._currentDrive.selectSide(!!(t&Et.side))),this._driveOut=t}_setState(t){this._state!==t&&this._logStateChanges&&this._log(`State ${this._state} -> ${t}`),this._state=t,this._stateCount=0,(t===W.syncingForId||t===W.syncingForData)&&(this._shiftRegister=0,this._numShifts=0)}_doSeek(t){t!==At.unchanged&&(this._callContext=t);let e=this._regs[I.internalParam_1]+this._regs[I.internalSeekRetryCount];const s=this._driveOut&Et.select_1?I.badTrack_1Drive_1:I.badTrack_1Drive_0;e>0&&(this._regs[s+0]<=e&&(e=e+1&255),this._regs[s+1]<=e&&(e=e+1&255)),this._regs[I.internalSeekTarget_1]=e,this._regs[I.internalSeekTarget_2]=e,e>=43?this._driveOut|=Et.lowHeadCurrent:this._driveOut&=~Et.lowHeadCurrent;const n=e===0?255:this._regs[s+2];if(this._didSeekStep=!1,e===n){this._doLoadHead();return}e>n?(this._regs[I.internalSeekCount]=e-n,this._driveOut|=Et.direction):(this._regs[I.internalSeekCount]=n-e,this._driveOut&=~Et.direction),this._currentDrive&&this._currentDrive.notifySeek(e),this._driveOut&=~Et.step,this._regs[s+2]=this._regs[I.internalSeekTarget_2],this._regs[I.mode]&zu.singleActuator&&(this._regs[I.trackDrive_0]=this._regs[I.internalSeekTarget_2],this._regs[I.trackDrive_1]=this._regs[I.internalSeekTarget_2]),this._doSeekStep()}_doSeekStep(){if(this._trk0&&this._regs[I.internalSeekTarget_2]===0||this._regs[I.internalSeekCount]===0){this._doLoadHead();return}this._didSeekStep=!0,this._regs[I.internalSeekCount]--,this._currentDrive&&this._currentDrive.seekOneTrack(this._driveOut&Et.direction?1:-1);let t=this._regs[I.headStepRate];t===0?t=3:t*=2,this._setTimerMs(Mi.seekStep,t)}_doLoadHead(){let t=0;this._driveOut&Et.loadHead?this._didSeekStep&&(t=2*this._regs[I.headSettleTime]):(this._driveOutRaise(Et.loadHead),t=4*(this._regs[I.headLoadUnload]&15)),t?this._setTimerMs(Mi.postSeek,t):this._postSeekDispatch()}_postSeekDispatch(){if(this._timerState=Mi.none,!!this._checkDriveReady())switch(this._callContext){case At.seek:this._finishCommand(Ie.ok);break;case At.readId:this._indexPulseCallback=oe.startReadId;break;case At.format:this._setupSectorSize(),this._indexPulseCallback=oe.startFormat,this._checkWriteProtect();break;case At.read:case At.write:this._setupSectorSize(),this._startIndexPulseTimeout(),this._startSyncingForHeader(),this._callContext===At.write&&this._checkWriteProtect();break;default:throw new Error(`Surprising call context post seek ${this._callContext}`)}}get _sectorSize(){return 128<<(this._regs[I.internalParam_3]>>>5)}_setupSectorSize(){const t=(this._sectorSize>>>7)-1;this._regs[I.internalCountLsb]=128,this._regs[I.internalCountMsb]=t,this._regs[I.internalCountMsbCopy]=t}_setTimerMs(t,e){this._timerTask.cancel(),this._timerState=t,this._timerTask.schedule(e*2e3)}_startIndexPulseTimeout(){this._regs[I.internalIndexPulseCount]=3,this._indexPulseCallback=oe.timeout}_startSyncingForHeader(){this._regs[I.internalHeaderPointer]=12,this._setState(W.syncingForId)}_checkDriveReady(){this._doReadDriveStatus();const t=this._driveOut&Et.select_1?64:4;return this._regs[I.internalDriveInLatched]&t?!0:(this._finishCommand(Ie.driveNotReady),!1)}_checkWriteProtect(){this._regs[I.internalDriveInLatched]&8&&this._finishCommand(Ie.writeProtected)}_startCommand(){let t=this._regs[I.internalCommand];const e=t;this._doReadDriveStatus(),this._paramCallback=Oi.none;const s=t&Et.selectFlags;if(this._mmioClocks=s,s!==(this._driveOut&Et.selectFlags)){const a=s|this._driveOut&Et.side;this._setDriveOut(a)}t&=~(Et.selectFlags|3),this._regs[I.internalCommand]=t,this._logCommand(`command ${et(e&63)} sel ${et(s)} params ${et(this._regs[I.internalParam_1])} ${et(this._regs[I.internalParam_2])} ${et(this._regs[I.internalParam_3])} ${et(this._regs[I.internalParam_4])} ${et(this._regs[I.internalParam_5])} ptrk ${this._currentDrive?this._currentDrive.track:-1} hpos ${this._currentDrive?this._currentDrive.headPosition:-1}`);const n=this._internalCommand;(n===Ot.scanData||n===Ot.scanDataAndDeleted)&&this._log("scan sectors doesn't work in a beeb"),this._doCommandDispatch()}get _internalCommand(){return(this._regs[I.internalCommand]&~(Et.selectFlags|3))>>>2}get _currentDiscIsSpinning(){return this._currentDrive?this._currentDrive.spinning:!1}get _trk0(){return this._currentDrive?this._currentDrive.track===0:!1}get _index(){return this._currentDrive?this._currentDrive.indexPulse:!1}get _wrProt(){return this._currentDrive?this._currentDrive.writeProtect:!1}get _driveIn(){let t=129;return this._currentDiscIsSpinning&&(this._trk0&&(t|=2),this._driveOut&Et.select_0&&(t|=4),this._driveOut&Et.select_1&&(t|=64),this._wrProt&&(t|=8),this._index&&(t|=16)),t}_doReadDriveStatus(){let t=this._driveIn;return this._regs[I.internalDriveInCopy]=t,this._regs[I.internalDriveInLatched]|=187,t&=this._regs[I.internalDriveInLatched],this._regs[I.internalDriveInLatched]=t,t}_doCommandDispatch(){const t=this._internalCommand;switch(t){case Ot.unused_9:case Ot.unused_12:throw new Error("Unused 8271 command");case Ot.readDriveStatus:{const e=this._doReadDriveStatus();this._setResult(e),this._regs[I.internalDriveInLatched]=this._regs[I.internalDriveInCopy],this._finishSimpleCommand();break}case Ot.specify:this._regs[I.internalPointer]=this._regs[I.internalParam_1],this._regs[I.internalParamCount]=3,this._paramCallback=Oi.specify;break;case Ot.writeSpecialRegister:this._writeRegister(this._regs[I.internalParam_1],this._regs[I.internalParam_2]),this._lowerBusyAndLog();break;case Ot.readSpecialRegister:this._setResult(this._readRegister(this._regs[I.internalParam_1])),this._finishSimpleCommand();break;case Ot.readId:this._regs[I.internalParam_2]===0?this._doSeek(At.readId):this._startSyncingForHeader();break;case Ot.seek:this._doSeek(At.seek);break;case Ot.readData:case Ot.readDataAndDeleted:case Ot.verify:case Ot.scanData:case Ot.scanDataAndDeleted:this._doSeek(At.read);break;case Ot.writeData:this._regs[I.internalParamDataMarker]=N.dataMarkDataPattern,this._doSeek(At.write);break;case Ot.writeDeletedData:this._regs[I.internalParamDataMarker]=N.deletedDataMarkDataPattern,this._doSeek(At.write);break;case Ot.format:this._doSeek(At.format);break;default:throw new Error(`Unexpected command ${t}`)}}_finishSimpleCommand(){this._lowerBusyAndLog(),this._stopIrqCallbacks(),this._clearCallbacks();const t=this._regs[I.headLoadUnload]>>>4;t===0?this._spinDown():t===15||(this._regs[I.internalIndexPulseCount]=t,this._indexPulseCallback=oe.spindown)}_finishCommand(t){t!==Ie.ok&&this._driveOutLower(Et.direction|Et.step|Et.writeEnable),this._setResult(t|this._result),this._statusRaise(Bt.nmi),this._finishSimpleCommand()}get _irqCallbacks(){return(this._regs[I.internalStatus]&48)===48}_startIrqCallbacks(){this._regs[I.internalStatus]|=48}_stopIrqCallbacks(){this._regs[I.internalStatus]&=-49}_decrementCounter(){return--this._regs[I.internalCountLsb]?!1:(--this._regs[I.internalCountMsb],this._regs[I.internalCountMsb]!==255?(this._regs[I.internalCountLsb]=128,!1):(this._regs[I.internalCountMsb]=0,this._stopIrqCallbacks(),!0))}_clearCallbacks(){this._paramCallback=Oi.none,this._indexPulseCallback=oe.none,this._timerState!==Mi.none&&(this._timerTask.cancel(),this._timerState=Mi.none),this._setState(W.idle)}_lowerBusyAndLog(){this._statusLower(Bt.busy),this._logCommand(`status ${et(this._status)} result ${et(this._result)}`)}_spinDown(){this._driveOutLower(Et.selectFlags|Et.loadHead)}_timerFired(){switch(this._regs[I.internalMsCountHi]=0,this._regs[I.internalMsCountLo]=0,this._timerState){case Mi.seekStep:this._doSeekStep();break;case Mi.postSeek:this._postSeekDispatch();break}}_doWriteRun(t,e){this._mmioData=e&255,this._mmioClocks=255,this._crc=N.crcAddByte(this._crc,this._mmioData),this._regs[I.internalWriteRunData]=this._mmioData,this._driveOutRaise(Et.writeEnable),this._callContext=t,this._setState(W.writeRun)}_writeFFsAnd00s(t,e){e!==-1&&(this._regs[I.internalCountLsb]=e,this._regs[I.internalCountMsb]=0),this._doWriteRun(t,255)}loadDisc(t,e){this._drives[t].setDisc(e)}get motorOn(){return[this._drives[0]?this._drives[0].spinning:!1,this._drives[0]?this._drives[1].spinning:!1]}get drives(){return this._drives}}class Nr extends cs{constructor(t,e,s,n){super(t,s,void 0,n);let a=0,c=0;const u=()=>{c?e.spinUp():e.spinDown()};for(const p of this.drives)p.addEventListener("startSpinning",()=>{c++,setTimeout(u,2)}),p.addEventListener("stopSpinning",()=>{--c,setTimeout(u,2)}),p.addEventListener("step",x=>{const _=Date.now();_>a&&(a=_+e.seek(x.stepAmount)*1e3)})}}const vn=Vt,Sn=et,DC=sf;function pi(i,t){const e=[];return i?(t||e.push("const newBotBit = cpu.p.c ? 0x01 : 0x00;"),e.push("cpu.p.c = !!(REG & 0x80);"),t?e.push("REG = (REG << 1) & 0xff;"):e.push("REG = ((REG << 1) & 0xff) | newBotBit;")):(t||e.push("const newTopBit = cpu.p.c ? 0x80 : 0x00;"),e.push("cpu.p.c = !!(REG & 0x01);"),t?e.push("REG >>>= 1;"):e.push("REG = (REG >>> 1) | newTopBit;")),e.push("cpu.p.setzn(REG);"),e}function En(i){return i==="p"?["cpu.p.setFromByte(cpu.pull());"]:[`cpu.${i} = cpu.p.setzn(cpu.pull());`]}function An(i){return i==="p"?"cpu.push(cpu.p.asByte());":`cpu.push(cpu.${i});`}class Eo{constructor(t){this.is65c12=t,this.ops={},this.cycle=0}appendOrPrepend(t,e,s,n,a){s===void 0&&(s=e,e=this.cycle),n=n||!1,typeof s=="string"&&(s=[s]),this.ops[e]?(this.ops[e].op=t(this.ops[e].op,s),n&&(this.ops[e].exact=!0),this.ops[e].addr||(this.ops[e].addr=a)):this.ops[e]={op:s,exact:n,addr:a}}append(t,e,s,n){this.appendOrPrepend((a,c)=>a.concat(c),t,e,s,n)}prepend(t,e,s,n){this.appendOrPrepend((a,c)=>c.concat(a),t,e,s,n)}tick(t){this.cycle+=t||1}readOp(t,e,s){this.cycle++;let n;e?n=`${e} = cpu.readmem(${t});`:n=`cpu.readmem(${t});`,s&&(n+=" // spurious"),this.append(this.cycle,n,!0,t)}writeOp(t,e,s){this.cycle++;let n=`cpu.writemem(${t}, ${e});`;s&&(n+=" // spurious"),this.append(this.cycle,n,!0,t)}zpReadOp(t,e){this.cycle++,this.append(this.cycle,`${e} = cpu.readmemZpStack(${t});`,!1)}zpWriteOp(t,e){this.cycle++,this.append(this.cycle,`cpu.writememZpStack(${t}, ${e});`,!0)}render(t){return this.cycle<2&&(this.cycle=2),this.prepend(this.cycle-1,"cpu.checkInt();",!0),this.renderInternal(t)}spuriousOp(t,e){this.is65c12?this.readOp(t,"",!0):this.writeOp(t,e,!0)}renderInternal(t){t=t||0;let e=0,s=[];for(let n=t;n<this.cycle;++n){if(!this.ops[n]){e++;continue}e&&this.ops[n].exact&&(this.ops[n].addr?s.push(`cpu.polltimeAddr(${e}, ${this.ops[n].addr});`):s.push(`cpu.polltime(${e});`),e=0),s=s.concat(this.ops[n].op),e++}return e&&(this.ops[this.cycle]&&this.ops[this.cycle].addr?s.push(`cpu.polltimeAddr(${e}, ${this.ops[this.cycle].addr});`):s.push(`cpu.polltime(${e});`)),this.ops[this.cycle]&&(s=s.concat(this.ops[this.cycle].op)),s.filter(n=>n)}split(t){return new RC(this,t,this.is65c12)}}class RC{constructor(t,e,s){this.preamble=t,this.condition=e,this.ifTrue=new Eo(s),this.ifTrue.tick(t.cycle),this.ifFalse=new Eo(s),this.ifFalse.tick(t.cycle),["append","prepend","readOp","writeOp","spuriousOp"].forEach(n=>{this[n]=(...a)=>{this.ifTrue[n](...a),this.ifFalse[n](...a)}})}indent(t){return t.map(e=>`  ${e}`)}render(){return this.preamble.renderInternal().concat(`if (${this.condition}) {`).concat(this.indent(this.ifTrue.render(this.preamble.cycle))).concat("} else {").concat(this.indent(this.ifFalse.render(this.preamble.cycle))).concat("}")}}function LC(i,t){switch(i){case"NOP":return{op:"",read:t!==void 0};case"BRK":return{op:"cpu.brk(false);"};case"CLC":return{op:"cpu.p.c = false;"};case"SEC":return{op:"cpu.p.c = true;"};case"CLD":return{op:"cpu.p.d = false;"};case"SED":return{op:"cpu.p.d = true;"};case"CLI":return{op:"cpu.p.i = false;"};case"SEI":return{op:"cpu.p.i = true;"};case"CLV":return{op:"cpu.p.v = false;"};case"LDA":return{op:["cpu.a = cpu.p.setzn(REG);"],read:!0};case"LDX":return{op:["cpu.x = cpu.p.setzn(REG);"],read:!0};case"LDY":return{op:["cpu.y = cpu.p.setzn(REG);"],read:!0};case"STA":return{op:"REG = cpu.a;",write:!0};case"STX":return{op:"REG = cpu.x;",write:!0};case"STY":return{op:"REG = cpu.y;",write:!0};case"INC":return{op:["REG = cpu.p.setzn(REG + 1);"],read:!0,write:!0};case"DEC":return{op:["REG = cpu.p.setzn(REG - 1);"],read:!0,write:!0};case"INX":return{op:["cpu.x = cpu.p.setzn(cpu.x + 1);"]};case"INY":return{op:["cpu.y = cpu.p.setzn(cpu.y + 1);"]};case"DEX":return{op:["cpu.x = cpu.p.setzn(cpu.x - 1);"]};case"DEY":return{op:["cpu.y = cpu.p.setzn(cpu.y - 1);"]};case"ADC":return{op:"cpu.adc(REG);",read:!0};case"SBC":return{op:"cpu.sbc(REG);",read:!0};case"BIT":return t==="imm"?{op:"cpu.p.z = !(cpu.a & REG);",read:!0}:{op:["cpu.p.z = !(cpu.a & REG);","cpu.p.v = !!(REG & 0x40);","cpu.p.n = !!(REG & 0x80);"],read:!0};case"ROL":return{op:pi(!0,!1),read:!0,write:!0,rotate:!0};case"ROR":return{op:pi(!1,!1),read:!0,write:!0,rotate:!0};case"ASL":return{op:pi(!0,!0),read:!0,write:!0,rotate:!0};case"LSR":return{op:pi(!1,!0),read:!0,write:!0,rotate:!0};case"EOR":return{op:["cpu.a = cpu.p.setzn(cpu.a ^ REG);"],read:!0};case"AND":return{op:["cpu.a = cpu.p.setzn(cpu.a & REG);"],read:!0};case"ORA":return{op:["cpu.a = cpu.p.setzn(cpu.a | REG);"],read:!0};case"CMP":return{op:["cpu.p.setzn(cpu.a - REG);","cpu.p.c = cpu.a >= REG;"],read:!0};case"CPX":return{op:["cpu.p.setzn(cpu.x - REG);","cpu.p.c = cpu.x >= REG;"],read:!0};case"CPY":return{op:["cpu.p.setzn(cpu.y - REG);","cpu.p.c = cpu.y >= REG;"],read:!0};case"TXA":return{op:["cpu.a = cpu.p.setzn(cpu.x);"]};case"TAX":return{op:["cpu.x = cpu.p.setzn(cpu.a);"]};case"TXS":return{op:"cpu.s = cpu.x;"};case"TSX":return{op:["cpu.x = cpu.p.setzn(cpu.s);"]};case"TYA":return{op:["cpu.a = cpu.p.setzn(cpu.y);"]};case"TAY":return{op:["cpu.y = cpu.p.setzn(cpu.a);"]};case"BEQ":return{op:"cpu.branch(cpu.p.z);"};case"BNE":return{op:"cpu.branch(!cpu.p.z);"};case"BCS":return{op:"cpu.branch(cpu.p.c);"};case"BCC":return{op:"cpu.branch(!cpu.p.c);"};case"BMI":return{op:"cpu.branch(cpu.p.n);"};case"BPL":return{op:"cpu.branch(!cpu.p.n);"};case"BVS":return{op:"cpu.branch(cpu.p.v);"};case"BVC":return{op:"cpu.branch(!cpu.p.v);"};case"PLA":return{op:En("a"),extra:3};case"PLP":return{op:En("p"),extra:3};case"PLX":return{op:En("x"),extra:3};case"PLY":return{op:En("y"),extra:3};case"PHA":return{op:An("a"),extra:2};case"PHP":return{op:An("p"),extra:2};case"PHX":return{op:An("x"),extra:2};case"PHY":return{op:An("y"),extra:2};case"RTS":return{op:["let temp = cpu.pull();","temp |= cpu.pull() << 8;","cpu.pc = (temp + 1) & 0xffff;"],extra:5};case"RTI":return{preop:["let temp = cpu.pull();","cpu.p.c = !!(temp & 0x01);","cpu.p.z = !!(temp & 0x02);","cpu.p.i = !!(temp & 0x04);","cpu.p.d = !!(temp & 0x08);","cpu.p.v = !!(temp & 0x40);","cpu.p.n = !!(temp & 0x80);","temp = cpu.pull();","cpu.pc = temp | (cpu.pull() << 8);"],extra:5};case"JSR":return{op:["const pushAddr = cpu.pc - 1;","cpu.push(pushAddr >>> 8);","cpu.push(pushAddr & 0xff);","cpu.pc = addr;"],extra:3};case"JMP":return{op:"cpu.pc = addr;"};case"TSB":return{op:["cpu.p.z = !(REG & cpu.a);","REG |= cpu.a;"],read:!0,write:!0};case"TRB":return{op:["cpu.p.z = !(REG & cpu.a);","REG &= ~cpu.a;"],read:!0,write:!0};case"BRA":return{op:"cpu.branch(true);"};case"STZ":return{op:"REG = 0;",write:!0};case"SAX":return{op:"REG = cpu.a & cpu.x;",write:!0};case"ASR":return{op:["REG &= cpu.a;"].concat(pi(!1,!0)).concat(["cpu.a = REG;"])};case"SLO":return{op:pi(!0,!0).concat(["cpu.a |= REG;","cpu.p.setzn(cpu.a);"]),read:!0,write:!0};case"SHX":return{op:"REG = (cpu.x & ((addr >>> 8)+1)) & 0xff;",write:!0,zpQuirk:!0};case"SHY":return{op:"REG = (cpu.y & ((addr >>> 8)+1)) & 0xff;",write:!0,zpQuirk:!0};case"LAX":return{op:["const magic = 0xff;","cpu.a = cpu.x = cpu.p.setzn((cpu.a|magic) & REG);"],read:!0};case"LXA":return{op:["const magic = 0xee;","cpu.a = cpu.x = cpu.p.setzn((cpu.a|magic) & REG);"],read:!0};case"SRE":return{op:pi(!1,!0).concat(["cpu.a = cpu.p.setzn(cpu.a ^ REG);"]),read:!0,write:!0};case"RLA":return{op:pi(!0,!1).concat(["cpu.a = cpu.p.setzn(cpu.a & REG);"]),read:!0,write:!0};case"ANC":return{op:["cpu.a = cpu.p.setzn(cpu.a & REG); cpu.p.c = cpu.p.n;"],read:!0};case"ANE":return{op:["cpu.a = cpu.p.setzn((cpu.a | 0xee) & REG & cpu.x);"],read:!0};case"ARR":return{op:"cpu.arr(REG);",read:!0};case"DCP":return{op:["REG = cpu.p.setzn(REG - 1);","cpu.p.setzn(cpu.a - REG);","cpu.p.c = cpu.a >= REG;"],read:!0,write:!0};case"LAS":return{op:["cpu.a = cpu.x = cpu.s = cpu.p.setzn(cpu.s & REG);"],read:!0};case"RRA":return{op:pi(!1,!1).concat(["cpu.adc(REG);"]),read:!0,write:!0};case"SBX":return{op:["const temp = cpu.a & cpu.x;","cpu.p.c = temp >= REG;","cpu.x = cpu.p.setzn(temp - REG);"],read:!0};case"SHA":return{op:["REG = cpu.a & cpu.x & ((addr >>> 8) + 1) & 0xff;"],write:!0,zpQuirk:!0};case"SHS":return{op:["cpu.s = cpu.a & cpu.x;","REG = cpu.a & cpu.x & ((addr >>> 8) + 1) & 0xff;"],write:!0,zpQuirk:!0};case"ISB":return{op:["REG = (REG + 1) & 0xff;","cpu.sbc(REG);"],read:!0,write:!0};case"RMB0":case"RMB1":case"RMB2":case"RMB3":case"RMB4":case"RMB5":case"RMB6":case"RMB7":return{op:[`REG = REG & (${~(1<<i[3]-"0")});`],read:!0,write:!0};case"SMB0":case"SMB1":case"SMB2":case"SMB3":case"SMB4":case"SMB5":case"SMB6":case"SMB7":return{op:[`REG = REG | ${1<<i[3]-"0"};`],read:!0,write:!0};case"BBR0":case"BBR1":case"BBR2":case"BBR3":case"BBR4":case"BBR5":case"BBR6":case"BBR7":return{op:`cpu.branch(!(REG & ${1<<i[3]-"0"}));`,read:!0};case"BBS0":case"BBS1":case"BBS2":case"BBS3":case"BBS4":case"BBS5":case"BBS6":case"BBS7":return{op:`cpu.branch(REG & ${1<<i[3]-"0"});`,read:!0}}throw new Error(`Unrecognised operation '${i}'`)}const PC={0:"BRK",1:"ORA (,x)",3:"SLO (,x)",4:"NOP zp",5:"ORA zp",6:"ASL zp",7:"SLO zp",8:"PHP",9:"ORA imm",10:"ASL A",11:"ANC imm",12:"NOP abs",13:"ORA abs",14:"ASL abs",15:"SLO abs",16:"BPL branch",17:"ORA (),y",19:"SLO (),y",20:"NOP zp,x",21:"ORA zp,x",22:"ASL zp,x",23:"SLO zp,x",24:"CLC",25:"ORA abs,y",26:"NOP",27:"SLO abs,y",28:"NOP abs,x",29:"ORA abs,x",30:"ASL abs,x",31:"SLO abs,x",32:"JSR abs",33:"AND (,x)",35:"RLA (,x)",36:"BIT zp",37:"AND zp",38:"ROL zp",39:"RLA zp",40:"PLP",41:"AND imm",42:"ROL A",43:"ANC imm",44:"BIT abs",45:"AND abs",46:"ROL abs",47:"RLA abs",48:"BMI branch",49:"AND (),y",51:"RLA (),y",52:"NOP zp,x",53:"AND zp,x",54:"ROL zp,x",55:"RLA zp,x",56:"SEC",57:"AND abs,y",58:"NOP",59:"RLA abs,y",60:"NOP abs,x",61:"AND abs,x",62:"ROL abs,x",63:"RLA abs,x",64:"RTI",65:"EOR (,x)",67:"SRE (,x)",68:"NOP zp",69:"EOR zp",70:"LSR zp",71:"SRE zp",72:"PHA",73:"EOR imm",74:"LSR A",75:"ASR imm",76:"JMP abs",77:"EOR abs",78:"LSR abs",79:"SRE abs",80:"BVC branch",81:"EOR (),y",83:"SRE (),y",84:"NOP zp,x",85:"EOR zp,x",86:"LSR zp,x",87:"SRE zp,x",88:"CLI",89:"EOR abs,y",90:"NOP",91:"SRE abs,y",92:"NOP abs,x",93:"EOR abs,x",94:"LSR abs,x",95:"SRE abs,x",96:"RTS",97:"ADC (,x)",99:"RRA (,x)",100:"NOP zp",101:"ADC zp",102:"ROR zp",103:"RRA zp",104:"PLA",105:"ADC imm",106:"ROR A",107:"ARR imm",108:"JMP (abs)",109:"ADC abs",110:"ROR abs",111:"RRA abs",112:"BVS branch",113:"ADC (),y",115:"RRA (),y",116:"NOP zp,x",117:"ADC zp,x",118:"ROR zp,x",119:"RRA zp,x",120:"SEI",121:"ADC abs,y",122:"NOP",123:"RRA abs,y",124:"NOP abs,x",125:"ADC abs,x",126:"ROR abs,x",127:"RRA abs,x",128:"NOP imm",129:"STA (,x)",130:"NOP imm",131:"SAX (,x)",132:"STY zp",133:"STA zp",134:"STX zp",135:"SAX zp",136:"DEY",137:"NOP imm",138:"TXA",139:"ANE imm",140:"STY abs",141:"STA abs",142:"STX abs",143:"SAX abs",144:"BCC branch",145:"STA (),y",147:"SHA (),y",148:"STY zp,x",149:"STA zp,x",150:"STX zp,y",151:"SAX zp,y",152:"TYA",153:"STA abs,y",154:"TXS",155:"SHS abs,y",156:"SHY abs,x",157:"STA abs,x",158:"SHX abs,y",159:"SHA abs,y",160:"LDY imm",161:"LDA (,x)",162:"LDX imm",163:"LAX (,x)",164:"LDY zp",165:"LDA zp",166:"LDX zp",167:"LAX zp",168:"TAY",169:"LDA imm",170:"TAX",171:"LXA imm",172:"LDY abs",173:"LDA abs",174:"LDX abs",175:"LAX abs",176:"BCS branch",177:"LDA (),y",179:"LAX (),y",180:"LDY zp,x",181:"LDA zp,x",182:"LDX zp,y",183:"LAX zp,y",184:"CLV",185:"LDA abs,y",186:"TSX",187:"LAS abs,y",188:"LDY abs,x",189:"LDA abs,x",190:"LDX abs,y",191:"LAX abs,y",192:"CPY imm",193:"CMP (,x)",194:"NOP imm",195:"DCP (,x)",196:"CPY zp",197:"CMP zp",198:"DEC zp",199:"DCP zp",200:"INY",201:"CMP imm",202:"DEX",203:"SBX imm",204:"CPY abs",205:"CMP abs",206:"DEC abs",207:"DCP abs",208:"BNE branch",209:"CMP (),y",211:"DCP (),y",212:"NOP zp,x",213:"CMP zp,x",214:"DEC zp,x",215:"DCP zp,x",216:"CLD",217:"CMP abs,y",218:"NOP",219:"DCP abs,y",220:"NOP abs,x",221:"CMP abs,x",222:"DEC abs,x",223:"DCP abs,x",224:"CPX imm",225:"SBC (,x)",226:"NOP imm",227:"ISB (,x)",228:"CPX zp",229:"SBC zp",230:"INC zp",231:"ISB zp",232:"INX",233:"SBC imm",234:"NOP",235:"SBC imm",236:"CPX abs",237:"SBC abs",238:"INC abs",239:"ISB abs",240:"BEQ branch",241:"SBC (),y",243:"ISB (),y",244:"NOP zpx",245:"SBC zp,x",246:"INC zp,x",247:"ISB zp,x",248:"SED",249:"SBC abs,y",250:"NOP",251:"ISB abs,y",252:"NOP abs,x",253:"SBC abs,x",254:"INC abs,x",255:"ISB abs,x"},bf={0:"BRK",1:"ORA (,x)",4:"TSB zp",5:"ORA zp",6:"ASL zp",8:"PHP",9:"ORA imm",10:"ASL A",12:"TSB abs",13:"ORA abs",14:"ASL abs",16:"BPL branch",17:"ORA (),y",18:"ORA ()",20:"TRB zp",21:"ORA zp,x",22:"ASL zp,x",24:"CLC",25:"ORA abs,y",26:"INC A",28:"TRB abs",29:"ORA abs,x",30:"ASL abs,x",32:"JSR abs",33:"AND (,x)",36:"BIT zp",37:"AND zp",38:"ROL zp",40:"PLP",41:"AND imm",42:"ROL A",44:"BIT abs",45:"AND abs",46:"ROL abs",48:"BMI branch",49:"AND (),y",50:"AND ()",52:"BIT zp,x",53:"AND zp,x",54:"ROL zp,x",56:"SEC",57:"AND abs,y",58:"DEC A",60:"BIT abs,x",61:"AND abs,x",62:"ROL abs,x",64:"RTI",65:"EOR (,x)",69:"EOR zp",70:"LSR zp",72:"PHA",73:"EOR imm",74:"LSR A",76:"JMP abs",77:"EOR abs",78:"LSR abs",80:"BVC branch",81:"EOR (),y",82:"EOR ()",85:"EOR zp,x",86:"LSR zp,x",88:"CLI",89:"EOR abs,y",90:"PHY",93:"EOR abs,x",94:"LSR abs,x",96:"RTS",97:"ADC (,x)",100:"STZ zp",101:"ADC zp",102:"ROR zp",104:"PLA",105:"ADC imm",106:"ROR A",108:"JMP (abs)",109:"ADC abs",110:"ROR abs",112:"BVS branch",113:"ADC (),y",114:"ADC ()",116:"STZ zp,x",117:"ADC zp,x",118:"ROR zp,x",120:"SEI",121:"ADC abs,y",122:"PLY",124:"JMP (abs,x)",125:"ADC abs,x",126:"ROR abs,x",128:"BRA branch",129:"STA (,x)",132:"STY zp",133:"STA zp",134:"STX zp",136:"DEY",137:"BIT imm",138:"TXA",140:"STY abs",141:"STA abs",142:"STX abs",144:"BCC branch",145:"STA (),y",146:"STA ()",148:"STY zp,x",149:"STA zp,x",150:"STX zp,y",152:"TYA",153:"STA abs,y",154:"TXS",156:"STZ abs",157:"STA abs,x",158:"STZ abs,x",160:"LDY imm",161:"LDA (,x)",162:"LDX imm",164:"LDY zp",165:"LDA zp",166:"LDX zp",168:"TAY",169:"LDA imm",170:"TAX",172:"LDY abs",173:"LDA abs",174:"LDX abs",176:"BCS branch",177:"LDA (),y",178:"LDA ()",180:"LDY zp,x",181:"LDA zp,x",182:"LDX zp,y",184:"CLV",185:"LDA abs,y",186:"TSX",188:"LDY abs,x",189:"LDA abs,x",190:"LDX abs,y",192:"CPY imm",193:"CMP (,x)",196:"CPY zp",197:"CMP zp",198:"DEC zp",200:"INY",201:"CMP imm",202:"DEX",204:"CPY abs",205:"CMP abs",206:"DEC abs",208:"BNE branch",209:"CMP (),y",210:"CMP ()",213:"CMP zp,x",214:"DEC zp,x",216:"CLD",217:"CMP abs,y",218:"PHX",221:"CMP abs,x",222:"DEC abs,x",224:"CPX imm",225:"SBC (,x)",228:"CPX zp",229:"SBC zp",230:"INC zp",232:"INX",233:"SBC imm",234:"NOP",236:"CPX abs",237:"SBC abs",238:"INC abs",240:"BEQ branch",241:"SBC (),y",242:"SBC ()",245:"SBC zp,x",246:"INC zp,x",248:"SED",249:"SBC abs,y",250:"PLX",253:"SBC abs,x",254:"INC abs,x"},IC={...bf,7:"RMB0 zp",23:"RMB1 zp",39:"RMB2 zp",55:"RMB3 zp",71:"RMB4 zp",87:"RMB5 zp",103:"RMB6 zp",119:"RMB7 zp",135:"SMB0 zp",151:"SMB1 zp",167:"SMB2 zp",183:"SMB3 zp",199:"SMB4 zp",215:"SMB5 zp",231:"SMB6 zp",247:"SMB7 zp",15:"BBR0 zp,branch",31:"BBR1 zp,branch",47:"BBR2 zp,branch",63:"BBR3 zp,branch",79:"BBR4 zp,branch",95:"BBR5 zp,branch",111:"BBR6 zp,branch",127:"BBR7 zp,branch",143:"BBS0 zp,branch",159:"BBS1 zp,branch",175:"BBS2 zp,branch",191:"BBS3 zp,branch",207:"BBS4 zp,branch",223:"BBS5 zp,branch",239:"BBS6 zp,branch",255:"BBS7 zp,branch"};class OC{constructor(t,e){this.cpu=t,this.opcodes=e}disassemble(t,e){let s=y=>`<span class="instr_mem_ref" data-ref="${y}">${vn(y)}</span>`,n=y=>`<span class="instr_instr_ref" data-ref="${y}">${vn(y)}</span>`;e&&(s=vn,n=vn);const a=this.opcodes[this.cpu.peekmem(t)];if(!a)return["???",t+1];const c=a.split(" ");if(!c[1])return[a,t+1];let u=c[1]||"",p="",x="";const _=u.match(/(.*),([xy])$/);switch(_&&(u=_[1],p=`,${_[2].toUpperCase()}`,x=` + ${_[2].toUpperCase()}`),u){case"imm":return[`${c[0]} #$${Sn(this.cpu.peekmem(t+1))}${p}`,t+2];case"abs":{const y=c[0]==="JMP"||c[0]==="JSR"?n:s,T=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8;return[`${c[0]} $${y(T)}${p}`,t+3,T]}case"branch":{const y=t+DC(this.cpu.peekmem(t+1))+2;return[`${c[0]} $${n(y)}${p}`,t+2,y]}case"zp":return[`${c[0]} $${Sn(this.cpu.peekmem(t+1))}${p}`,t+2];case"(,x)":return[`${c[0]} ($${Sn(this.cpu.peekmem(t+1))}, X)${p}`,t+2];case"()":{const y=this.cpu.peekmem(t+1),T=this.cpu.peekmem(y)|this.cpu.peekmem(y+1)<<8;return[`${c[0]} ($${Sn(y)})${p} ; $${Vt(T)}${x}`,t+2]}case"(abs)":{const y=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8,T=this.cpu.peekmem(y)|this.cpu.peekmem(y+1)<<8;return[`${c[0]} ($${n(y)})${p} ; $${Vt(T)}${x}`,t+3,T]}case"(abs,x)":{const y=this.cpu.peekmem(t+1)|this.cpu.peekmem(t+2)<<8,T=this.cpu.peekmem(y)|this.cpu.peekmem(y+1)<<8;return[`${c[0]} ($${n(y)},x)${p}`,t+3,T]}}return[a,t+1]}}function yc(i,t,e){function s(p,x){const _=p.split(" "),y=_[0],T=_[1],D=LC(y,T);if(!D)return null;let v=new Eo(e);switch(x&&v.append("let REG = 0|0;"),T){case void 0:if(D.read||D.write)throw new Error(`Unsupported ${p}`);return v.append(D.preop),v.tick(Math.max(2,1+(D.extra||0))),v.append(D.op),v.render();case"branch":return[D.op];case"zp,branch":return v.tick(2),v.append("const addr = cpu.getb() | 0;"),D.read&&(v.zpReadOp("addr","REG"),D.write&&v.tick(1)),v.append(D.op),D.write&&v.zpWriteOp("addr","REG"),v.render();case"zp":case"zpx":case"zp,x":case"zp,y":return T==="zp"?(v.tick(2),v.append("const addr = cpu.getb() | 0;")):(v.tick(3),v.append(`const addr = (cpu.getb() + cpu.${T[3]}) & 0xff;`)),D.read&&(v.zpReadOp("addr","REG"),D.write&&v.tick(1)),v.append(D.op),D.write&&v.zpWriteOp("addr","REG"),v.render();case"abs":return v.tick(3+(D.extra||0)),v.append("const addr = cpu.getw() | 0;"),D.read&&(v.readOp("addr","REG"),D.write&&v.spuriousOp("addr","REG")),v.append(D.op),D.write&&v.writeOp("addr","REG"),v.render();case"abs,x":case"abs,y":return v.append("const addr = cpu.getw() | 0;"),v.append(`let addrWithCarry = (addr + cpu.${T[4]}) & 0xffff;`),v.append("const addrNonCarry = (addr & 0xff00) | (addrWithCarry & 0xff);"),v.tick(3),v=v.split("addrWithCarry !== addrNonCarry"),D.read&&!D.write?(e?v.ifTrue.tick(1):v.ifTrue.readOp("addrNonCarry"),v.readOp("addrWithCarry","REG")):D.read?e?(v.ifTrue.tick(1),D.rotate||v.ifFalse.readOp("addrNonCarry","REG"),v.readOp("addrWithCarry","REG"),v.writeOp("addrWithCarry","REG")):(v.readOp("addrNonCarry"),v.readOp("addrWithCarry","REG"),v.spuriousOp("addrWithCarry","REG")):D.write&&(e?(v.ifTrue.tick(1),v.ifFalse.readOp("addrNonCarry")):(v.readOp("addrNonCarry"),D.zpQuirk&&v.append("if (addrWithCarry !== addrNonCarry) addrWithCarry &= 0xff;"))),v.append(D.op),D.write&&v.writeOp("addrWithCarry","REG"),v.render();case"imm":if(D.write)throw new Error("This isn't possible");return D.read,v.tick(2),v.append("REG = cpu.getb() | 0;"),v.append(D.op),v.render();case"A":return v.tick(2),v.append("REG = cpu.a;"),v.append(D.op),v.append("cpu.a = REG;"),v.render();case"(,x)":return v.tick(3),v.append("const zpAddr = (cpu.getb() + cpu.x) & 0xff;"),v.append("let lo, hi;"),v.zpReadOp("zpAddr","lo"),v.zpReadOp("(zpAddr + 1) & 0xff","hi"),v.append("const addr = lo | (hi << 8);"),D.read&&(v.readOp("addr","REG"),D.write&&v.spuriousOp("addr","REG")),v.append(D.op),D.write&&v.writeOp("addr","REG"),v.render();case"(),y":return v.tick(2),v.append("const zpAddr = cpu.getb() | 0;"),v.append("let lo, hi;"),v.zpReadOp("zpAddr","lo"),v.zpReadOp("(zpAddr + 1) & 0xff","hi"),v.append("const addr = lo | (hi << 8);"),v.append("let addrWithCarry = (addr + cpu.y) & 0xffff;"),v.append("const addrNonCarry = (addr & 0xff00) | (addrWithCarry & 0xff);"),D.read&&!D.write?(v=v.split("addrWithCarry !== addrNonCarry"),e?v.ifTrue.tick(1):v.ifTrue.readOp("addrNonCarry"),v.readOp("addrWithCarry","REG")):D.read?(v.readOp("addrNonCarry"),v.readOp("addrWithCarry","REG"),v.spuriousOp("addrWithCarry","REG")):D.write&&(v.readOp("addrNonCarry"),D.zpQuirk&&v.append("if (addrWithCarry !== addrNonCarry) addrWithCarry &= 0xff;")),v.append(D.op),D.write&&v.writeOp("addrWithCarry","REG"),v.render();case"(abs)":return v.tick(e?4:3),v.append("const absAddr = cpu.getw() | 0;"),e?v.append("const nextAddr = (absAddr + 1) & 0xffff;"):v.append("const nextAddr = ((absAddr + 1) & 0xff) | (absAddr & 0xff00);"),v.append("let lo, hi;"),v.readOp("absAddr","lo"),v.readOp("nextAddr","hi"),v.append("const addr = lo | (hi << 8);"),v.append(D.op),v.render();case"(abs,x)":return v.tick(4),v.append("const absAddr = (cpu.getw() + cpu.x) | 0;"),v.append("let lo, hi;"),v.readOp("absAddr","lo"),v.readOp("(absAddr + 1) & 0xffff","hi"),v.append("const addr = lo | (hi << 8);"),v.append(D.op),v.render();case"()":return v.tick(2),v.append("const zpAddr = cpu.getb() | 0;"),v.append("let lo, hi;"),v.zpReadOp("zpAddr","lo"),v.zpReadOp("(zpAddr + 1) & 0xff","hi"),v.append("const addr = lo | (hi << 8);"),D.read&&v.readOp("addr","REG"),v.append(D.op),D.write&&v.writeOp("addr","REG"),v.render();default:throw new Error(`Unknown arg type ${T}`)}}function n(p,x,_){const y=t[x];return p+['"use strict";',`// ${et(x)} - ${y}
`].concat(y?s(y,!0):[`this.invalidOpcode(cpu, 0x${et(x)});`]).join(`
${p}`)}function a(){}function c(){const p=[];for(let x=0;x<256;++x){const _=new Function("cpu",n("  ",x));let y=`exec_${et(x)}_`;if(t[x]){const T=t[x].replace("()","ind").replace("(,x)","ind_x").replace("(abs)","ind_abs").replace(/[^A-Za-z0-9]/g,"_").toLowerCase();y+=T}else y+="undef";Object.defineProperty(_,"name",{writable:!0,value:y}),p[x]=_}return function(_){return p[_].call(this,this.cpu)}}function u(p,x){if(e){switch(x){case 2:case 34:case 66:case 98:case 130:case 194:case 226:p.getb(),p.polltime(2);break;case 68:p.getb(),p.polltime(3);break;case 84:case 212:case 244:p.getb(),p.polltime(4);break;case 92:p.getw(),p.polltime(8);break;case 220:case 252:p.polltimeAddr(4,p.getw());break;default:p.polltime(1);break}return}p.pc--,p.polltime(1)}return a.prototype.invalidOpcode=u,a.prototype.cpu=i,a.prototype.run=c(),{disassembler:new OC(i,t),runInstruction:new a,opcodes:t,getInstruction:s}}function MC(i){return yc(i,PC,!1)}function NC(i){return yc(i,bf,!0)}function BC(i){return yc(i,IC,!0)}const ie=Object.freeze({MOS6502:0,CMOS65C02:1,CMOS65C12:2});class Oe{constructor(t,e,s,n,a,c,u,p,x){this.name=t,this.synonyms=e,this.os=s,this._cpuModel=n,this.isMaster=a,this.Fdc=u,this.swram=c,this.isTest=!1,this.tube=p,this.cmosOverride=x}get nmos(){return this._cpuModel===ie.MOS6502}get opcodesFactory(){switch(this._cpuModel){case ie.MOS6502:return MC;case ie.CMOS65C02:return BC;case ie.CMOS65C12:return NC}throw new Error("Unknown CPU model")}}function FC(i){return i[19]=i[19]&240|13,i}function UC(i){return i[19]=i[19]&240|8,i}function $C(i){return i[19]=i[19]&240|9,i}const Er=[!0,!0,!0,!0,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1],Gs=[!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!1,!1,!1,!1,!1],Wu=[new Oe("BBC B with DFS 1.2",["B-DFS1.2"],["os.rom","BASIC.ROM","b/DFS-1.2.rom"],ie.MOS6502,!1,Er,Nr),new Oe("BBC B with DFS 0.9",["B-DFS0.9","B"],["os.rom","BASIC.ROM","b/DFS-0.9.rom"],ie.MOS6502,!1,Er,Nr),new Oe("BBC B with 1770 (DFS)",["B1770"],["os.rom","BASIC.ROM","b1770/dfs1770.rom","b1770/zADFS.ROM"],ie.MOS6502,!1,Er,zs),new Oe("BBC B with 1770 (ADFS)",["B1770A"],["os.rom","BASIC.ROM","b1770/zADFS.ROM","b1770/dfs1770.rom"],ie.MOS6502,!1,Er,zs),new Oe("BBC Master 128 (DFS)",["Master"],["master/mos3.20"],ie.CMOS65C12,!0,Gs,zs,null,$C),new Oe("BBC Master 128 (ADFS)",["MasterADFS"],["master/mos3.20"],ie.CMOS65C12,!0,Gs,zs,null,FC),new Oe("BBC Master 128 (ANFS)",["MasterANFS"],["master/mos3.20"],ie.CMOS65C12,!0,Gs,zs,null,UC),new Oe("Tube65C02",[],["tube/6502Tube.rom"],ie.CMOS65C02,!1)];function Ao(i){i=i.toLowerCase();for(let t=0;t<Wu.length;++t){const e=Wu[t];if(e.name.toLowerCase()===i)return e;for(let s=0;s<e.synonyms.length;++s)if(e.synonyms[s].toLowerCase()===i)return e}return null}const yf=new Oe("TEST",["TEST"],[],ie.MOS6502,!1,Er,Nr);yf.isTest=!0;const HC=new Oe("TEST",["TEST"],[],ie.CMOS65C02,!1,Gs,Nr);HC.isTest=!0;const zC=new Oe("TEST",["TEST"],[],ie.CMOS65C12,!1,Gs,Nr);zC.isTest=!0;const WC=new Oe("Basic only",["Basic only"],["master/mos3.20"],ie.CMOS65C12,!0,Gs,zs),Ni=new Float32Array(16);(()=>{let i=1;for(let t=0;t<15;++t)Ni[t]=i/4,i*=Math.pow(10,-.1);Ni[15]=0})();function GC(i){const t=new Float32Array(8192);for(let e=0;e<t.length;++e)t[e]=Math.sin(2*Math.PI*e/t.length)*i;return t}class VC{constructor(t){this._onBuffer=t,this.soundchipFreq=4e6/8;const e=this.soundchipFreq;this.waveDecrementPerSecond=this.soundchipFreq/2,this.sampleDecrement=this.waveDecrementPerSecond/e,this.samplesPerCycle=e/2e6,this.minCyclesWELow=14,this.registers=new Uint16Array(4),this.counter=new Float32Array(4),this.outputBit=[!1,!1,!1,!1],this.volume=new Float32Array(4),this.generators=[this.toneChannel.bind(this),this.toneChannel.bind(this),this.toneChannel.bind(this),this.noiseChannel.bind(this),this.sineChannel.bind(this)],this.sineTable=GC(1/this.generators.length),this.sineStep=0,this.sineOn=!1,this.sineTime=0,this.lfsr=0,this.shiftLfsr=this.shiftLfsrWhiteNoise.bind(this),this.enabled=!0,this.scheduler={epoch:0},this.lastRunEpoch=0,this.activeTask=null,this.residual=0,this.position=0,this.buffer=new Float32Array(512),this.latchedRegister=0,this.slowDataBus=0,this.active=!1,this.toneGenerator={mute:()=>{this.catchUp(),this.sineOn=!1},tone:s=>{this.catchUp(),this.sineOn=!0,this.sineStep=s/e*this.sineTable.length}}}sineChannel(t,e,s,n){if(this.sineOn){for(let a=0;a<n;++a)e[a+s]+=this.sineTable[this.sineTime&this.sineTable.length-1],this.sineTime+=this.sineStep;for(;this.sineTime>this.sineTable.length;)this.sineTime-=this.sineTable.length}}_doChannelStep(t,e){const s=this.counter[t]-this.sampleDecrement;return s<0?(this.counter[t]=Math.max(0,s+e),this.outputBit[t]=!this.outputBit[t],this.outputBit[t]):(this.counter[t]=s,!1)}toneChannel(t,e,s,n){const a=this.registers[t]===0?1024:this.registers[t],c=this.volume[t];for(let u=0;u<n;++u)this._doChannelStep(t,a),e[u+s]+=this.outputBit[t]*c}shiftLfsrWhiteNoise(){const t=this.lfsr&1^(this.lfsr&2)>>>1;this.lfsr=this.lfsr>>>1|t<<14}shiftLfsrPeriodicNoise(){this.lfsr>>=1,this.lfsr===0&&(this.lfsr=16384)}noisePoked(){this.shiftLfsr=this.registers[3]&4?this.shiftLfsrWhiteNoise.bind(this):this.shiftLfsrPeriodicNoise.bind(this),this.lfsr=16384}addFor(t){switch(t=t|0,this.registers[t]&3){case 0:return 16;case 1:return 32;case 2:return 64;case 3:return this.registers[t-1]}}noiseChannel(t,e,s,n){const a=this.addFor(t),c=this.volume[t];for(let u=0;u<n;++u)this._doChannelStep(t,a)&&this.shiftLfsr(),e[u+s]+=(this.lfsr&1)*c}debugPokeAll(t,e,s,n,a,c,u,p){this.catchUp(),this.registers[0]=t&16777215,this.registers[1]=s&16777215,this.registers[2]=a&16777215,this.registers[3]=u&16777215,this.volume[0]=Ni[e],this.volume[1]=Ni[n],this.volume[2]=Ni[c],this.volume[3]=Ni[p],this.noisePoked()}generate(t,e,s){e=e|0,s=s|0;for(let n=0;n<s;++n)t[n+e]=0;if(this.enabled)for(let n=0;n<this.generators.length;++n)this.generators[n](n,t,e,s)}catchUp(){const t=this.scheduler.epoch-this.lastRunEpoch;t>0&&this.advance(t),this.lastRunEpoch=this.scheduler.epoch}setScheduler(t){this.scheduler=t,this.lastRunEpoch=this.scheduler.epoch,this.activeTask=this.scheduler.newTask(()=>{this.active&&this.poke(this.slowDataBus)})}render(t,e,s){this.catchUp();const n=this.position>s?s:this.position;for(let a=0;a<n;++a)t[e+a]=this.buffer[a];e+=n,s-=n;for(let a=n;a<this.position;++a)this.buffer[a-n]=this.buffer[a];this.position-=n,s!==0&&this.generate(t,e,s)}advance(t){const e=t*this.samplesPerCycle+this.residual;let s=e|0;this.residual=e-s;const n=this.buffer.length;for(;s>0;){const a=n-this.position,c=Math.min(s,a);this.generate(this.buffer,this.position,c),this.position+=c,s-=c,this.position===n&&(this._onBuffer(this.buffer),this.buffer=new Float32Array(n),this.position=0)}}poke(t){this.catchUp();let e;t&128?(this.latchedRegister=t&112,e=t&240):e=this.latchedRegister;const s=e>>5&3;if(e&16){const n=t&15;this.volume[s]=Ni[n]}else s===3?(this.registers[s]=t&15,this.noisePoked()):e&128?this.registers[s]=this.registers[s]&-16|t&15:this.registers[s]=this.registers[s]&15|(t&63)<<4}updateSlowDataBus(t,e){this.slowDataBus=t,this.active=e,e&&this.activeTask.ensureScheduled(!0,this.minCyclesWELow)}reset(t){if(t){for(let e=0;e<4;++e)this.counter[e]=0,this.registers[e]=0,this.volume[e]=Ni[8];this.noisePoked(),this.lastRunEpoch=this.scheduler.epoch}}enable(t){this.enabled=t}mute(){this.enabled=!1}unmute(){this.enabled=!0}}class Cf{reset(){}enable(){}mute(){}unmute(){}render(){}updateSlowDataBus(){}setScheduler(){}constructor(){this.toneGenerator={mute:()=>{},tone:()=>{}}}}const wn=0,Gu=1,Vu=2,Ku=.25;class KC{constructor(t){this.context=t,this.sounds={},this.state=wn,this.motor=null,this.gain=t.createGain(),this.gain.gain.value=Ku,this.gain.connect(t.destination),this.playing=[]}async initialise(){const t=await qC(this.context,{motorOn:"sounds/disc525/motoron.wav",motorOff:"sounds/disc525/motoroff.wav",motor:"sounds/disc525/motor.wav",step:"sounds/disc525/step.wav",seek:"sounds/disc525/seek.wav",seek2:"sounds/disc525/seek2.wav",seek3:"sounds/disc525/seek3.wav"});this.sounds=t}oneShot(t){const e=t.duration,s=this.context;if(s.state!=="running")return e;const n=s.createBufferSource();return n.buffer=t,n.connect(this.gain),n.start(),e}play(t,e){return this.context.state!=="running"?Promise.reject():new Promise(s=>{const n=this.context.createBufferSource();n.loop=!!e,n.buffer=t,n.connect(this.gain),n.onended=()=>{this.playing=ce.without(this.playing,n),n.loop||s()},n.start(),this.playing.push(n),n.loop&&s(n)})}spinUp(){this.state===Vu||this.state===Gu||(this.state=Gu,this.play(this.sounds.motorOn).then(()=>{this.state!==wn&&this.play(this.sounds.motor,!0).then(t=>{this.motor=t,this.state=Vu})},()=>{}))}spinDown(){this.state!==wn&&(this.state=wn,this.motor&&(this.motor.stop(),this.motor=null,this.oneShot(this.sounds.motorOff)))}seek(t){return t<0&&(t=-t),t===0?0:t<=2?this.oneShot(this.sounds.step):t<=20?this.oneShot(this.sounds.seek):t<=40?this.oneShot(this.sounds.seek2):this.oneShot(this.sounds.seek3)}mute(){this.gain.gain.value=0}unmute(){this.gain.gain.value=Ku}}async function qC(i,t){const e=await Promise.all(ce.map(t,async a=>{const c=await Fe(a);return await new Promise(u=>{i.decodeAudioData(c.buffer,p=>{u(p)})})})),s=ce.keys(t),n={};for(let a=0;a<s.length;++a)n[s[a]]=e[a];return n}class wo{constructor(){}seek(){return 0}initialise(){return Promise.resolve()}spinUp(){}spinDown(){}mute(){}unmute(){}}const qu=256,ju=2048,vf=128,jC=14,mi=16,Ns=jC*vf,Bs=128,YC=15,XC=16,QC=32,Yu=128,ZC=127,JC=1,tv=254,to=0,ev=1;class iv{constructor(t){this._onBufferMusic5000=t,this.waveRam=new Uint8Array(ju),this.phaseRam=new Uint32Array(mi),this.cycleCount=0,this.curCh=0,this.activeRegSet=to,this.sampleLeft=0,this.sampleRight=0,this.chordBase=[0,8.25,24.75,57.75,123.75,255.75,519.75,1047.75],this.stepInc=[.5,1,2,4,8,16,32,64],this.stereoLeft=[0,0,0,0,0,0,0,0,100,100,100,83,67,50,33,17],this.stereoRight=[100,100,100,100,100,100,100,100,0,0,0,17,33,50,67,83],this.D2ATable=new Uint16Array(128),this.sampleBuffer=new Float64Array(qu),this.position=0,this.cReg_freqLow=function(e,s){return this.waveRam[Ns+s*Bs+0*mi+e]},this.cReg_freqMedium=function(e,s){return this.waveRam[Ns+s*Bs+1*mi+e]},this.cReg_freqHigh=function(e,s){return this.waveRam[Ns+s*Bs+2*mi+e]},this.cReg_waveformReg=function(e,s){return this.waveRam[Ns+s*Bs+5*mi+e]},this.cReg_amplitudeReg=function(e,s){return this.waveRam[Ns+s*Bs+6*mi+e]},this.cReg_controlReg=function(e,s){return this.waveRam[Ns+s*Bs+7*mi+e]},this.waveTableVal=function(e,s){return this.waveRam[e*vf+s]}}reset(t){if(t){console.log("Music 5000: initialisation");let e=0;for(let s=0;s<8;s++){let n=this.chordBase[s];for(let a=0;a<16;a++)this.D2ATable[e]=Math.floor(n*4),n+=this.stepInc[s],e++}}for(let e=0;e<ju;e++)this.waveRam[e]=0;for(let e=0;e<mi;e++)this.phaseRam[e]=0}read(t,e){const s=((t&14)<<7)+e;return this.waveRam[s]}write(t,e,s){const n=((t&14)<<7)+(e&255);this.waveRam[n]=s}polltime(t){let e,s,n,a,c,u,p,x,_=0;for(this.cycleCount+=t*3;this.cycleCount>=8;){this.cReg_freqLow(this.curCh,this.activeRegSet)&JC?(this.phaseRam[this.curCh]=0,e=0):(s=(this.cReg_freqHigh(this.curCh,this.activeRegSet)<<16)+(this.cReg_freqMedium(this.curCh,this.activeRegSet)<<8)+(this.cReg_freqLow(this.curCh,this.activeRegSet)&tv),this.phaseRam[this.curCh]+=s,e=this.phaseRam[this.curCh]&1<<24,this.phaseRam[this.curCh]&=16777215),n=this.phaseRam[this.curCh]>>17&127,a=this.cReg_waveformReg(this.curCh,this.activeRegSet)>>4,p=this.waveTableVal(a,n),c=this.cReg_amplitudeReg(this.curCh,this.activeRegSet),u=this.cReg_controlReg(this.curCh,this.activeRegSet),x=p&Yu,p&=ZC,u&QC&&(x||e)?this.activeRegSet=ev:this.activeRegSet=to,c>128&&(c=128),p=p*c/128;let y=this.D2ATable[parseInt(p)];u&XC&&(x^=Yu),x&&(y=-y),_=u&YC,this.sampleLeft+=y*this.stereoLeft[_]/100,this.sampleRight+=y*this.stereoRight[_]/100,this.curCh++,this.curCh===mi&&(this.curCh=0,this.activeRegSet=to,this.sampleLeft<-32768?this.sampleLeft=-32768:this.sampleLeft>32767&&(this.sampleLeft=32767),this.sampleRight<-32768?this.sampleRight=-32768:this.sampleRight>32767&&(this.sampleRight=32767),this.sampleBuffer[this.position++]=this.sampleLeft,this.sampleBuffer[this.position++]=this.sampleRight,this.position===qu&&(this._onBufferMusic5000(this.sampleBuffer),this.position=0),this.sampleLeft=0,this.sampleRight=0),this.cycleCount-=8}}}class Sf{constructor(){this.reset=function(){},this.polltime=function(){},this.read=function(){return 0},this.write=function(){}}}const sv=new uf,rv=new Cf,nv={setCpu:()=>{}};function av(i,t){t=t||{};const e=t.video||sv;return i=i||yf,t.tube&&(i.tube=Ao("Tube65c02")),new pf(i,nv,e,rv,new wo,new Sf,new gf)}async function ov(){const i=av(WC),t=function(a){i.pc=36274,i.s=240;let T=4096;i.writemem(59,0),i.writemem(60,0),i.writemem(55,T&255),i.writemem(56,T>>>8&255),i.writemem(65072,12);for(let M=0;M<a.length;++M)i.writemem(T+M,a.charCodeAt(M));i.writemem(T+a.length,13);let D=20*1e3*1e3,v="";for(;i.s<=240&&(i.execute(1),--D!==0);)if(i.pc===36513){let M=i.readmemZpStack(56)<<8|i.readmemZpStack(55);for(;T<M;)v+=String.fromCharCode(i.readmem(T)),T++;v+=String.fromCharCode(i.a),T+=i.y,i.writememZpStack(55,T&255),i.writememZpStack(56,T>>>8&255),++T,i.pc+=3}for(let M=T;i.readmem(M)!==13;++M)v+=String.fromCharCode(i.readmem(M));if(D===0)throw new Error("Unable to tokenize '"+a+"' - got as far as '"+v+"' pc="+Vt(i.pc));return v},e=/^([0-9]+)?(.*)/,s=function(a,c){const u=a.match(e),p=u[1]?parseInt(u[1]):c,x=t(u[2]);if(x.length>251)throw new Error("Line "+p+" tokenised length "+x.length+" > 251 bytes");return"\r"+String.fromCharCode(p>>>8&255)+String.fromCharCode(p&255)+String.fromCharCode(x.length+4)+x},n=function(a){let c="";return a.split(`
`).forEach(function(u,p){u&&(c+=s(u,10+p*10))}),c+"\rÃ¿"};return await i.initialise(),{tokenise:n}}var cv=function(i){window.console&&window.console.log&&window.console.log(i)},hv=function(i){window.console&&window.console.error?window.console.error(i):cv(i)},uv={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},Vs=null,To=null;function Ef(i){if(Vs==null){Vs={},To={};for(var t in i)typeof i[t]=="number"&&(Vs[i[t]]=t,To[t]=i[t])}}function Af(){if(Vs==null)throw"WebGLDebugUtils.init(ctx) not called"}function lv(i){return Af(),Vs[i]!==void 0}function Rr(i){Af();var t=Vs[i];return t!==void 0?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+i.toString(16)}function Cc(i,t,e,s){var n=uv[i];if(n!==void 0&&(n=n[t],n!==void 0&&n[e]))if(typeof n[e]=="object"&&n[e].enumBitwiseOr!==void 0){for(var a=n[e].enumBitwiseOr,c=0,u=[],p=0;p<a.length;++p){var x=To[a[p]];(s&x)!==0&&(c|=x,u.push(Rr(x)))}return c===s?u.join(" | "):Rr(s)}else return Rr(s);return s===null?"null":s===void 0?"undefined":s.toString()}function fv(i,t){for(var e="",s=t.length,n=0;n<s;++n)e+=(n==0?"":", ")+Cc(i,s,n,t[n]);return e}function wf(i,t,e){i.__defineGetter__(e,function(){return t[e]}),i.__defineSetter__(e,function(s){t[e]=s})}function Tf(i,t,e,s){s=s||i,Ef(i),t=t||function(x,_,y){for(var T="",D=y.length,v=0;v<D;++v)T+=(v==0?"":", ")+Cc(_,D,v,y[v]);hv("WebGL error "+Rr(x)+" in "+_+"("+T+")")};var n={};function a(x,_){return function(){e&&e(_,arguments);var y=x[_].apply(x,arguments),T=s.getError();return T!=0&&(n[T]=!0,t(T,_,arguments)),y}}var c={};for(var u in i)if(typeof i[u]=="function")if(u!="getExtension")c[u]=a(i,u);else{var p=a(i,u);c[u]=function(){var x=p.apply(i,arguments);return Tf(x,t,e,s)}}else wf(c,i,u);return c.getError=function(){for(var x in n)if(Object.prototype.hasOwnProperty.call(n,x)&&n[x])return n[x]=!1,x;return i.NO_ERROR},c}function kf(i){var t=i.getParameter(i.MAX_VERTEX_ATTRIBS),e=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,e);for(var s=0;s<t;++s)i.disableVertexAttribArray(s),i.vertexAttribPointer(s,4,i.FLOAT,!1,0,0),i.vertexAttrib1f(s,0);i.deleteBuffer(e);var n=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);for(s=0;s<n;++s)i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_CUBE_MAP,null),i.bindTexture(i.TEXTURE_2D,null);for(i.activeTexture(i.TEXTURE0),i.useProgram(null),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.DITHER),i.disable(i.SCISSOR_TEST),i.blendColor(0,0,0,0),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.clearColor(0,0,0,0),i.clearDepth(1),i.clearStencil(-1),i.colorMask(!0,!0,!0,!0),i.cullFace(i.BACK),i.depthFunc(i.LESS),i.depthMask(!0),i.depthRange(0,1),i.frontFace(i.CCW),i.hint(i.GENERATE_MIPMAP_HINT,i.DONT_CARE),i.lineWidth(1),i.pixelStorei(i.PACK_ALIGNMENT,4),i.pixelStorei(i.UNPACK_ALIGNMENT,4),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),i.UNPACK_COLORSPACE_CONVERSION_WEBGL&&i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.BROWSER_DEFAULT_WEBGL),i.polygonOffset(0,0),i.sampleCoverage(1,!1),i.scissor(0,0,i.canvas.width,i.canvas.height),i.stencilFunc(i.ALWAYS,0,4294967295),i.stencilMask(4294967295),i.stencilOp(i.KEEP,i.KEEP,i.KEEP),i.viewport(0,0,i.canvas.width,i.canvas.height),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT|i.STENCIL_BUFFER_BIT);i.getError(););}function dv(i){var t,e=[],s=[],n={},a=1,c=!1,u=[],p=0,x=0,_=!1,y=0,T={};i.getContext=function(l){return function(){var X=l.apply(i,arguments);if(X instanceof WebGLRenderingContext){if(X!=t){if(t)throw"got different context";t=X,n=gt(t)}return n}return X}}(i.getContext);function D(l){return typeof l=="function"?l:function(X){l.handleEvent(X)}}var v=function(l){e.push(D(l))},M=function(l){s.push(D(l))};function Y(l){var X=l.addEventListener;l.addEventListener=function(j,ut){switch(j){case"webglcontextlost":v(ut);break;case"webglcontextrestored":M(ut);break;default:X.apply(l,arguments)}}}Y(i),i.loseContext=function(){if(!c){for(c=!0,p=0,++a;t.getError(););z(),T[t.CONTEXT_LOST_WEBGL]=!0;var l=ct("context lost"),X=e.slice();setTimeout(function(){for(var j=0;j<X.length;++j)X[j](l);y>=0&&setTimeout(function(){i.restoreContext()},y)},0)}},i.restoreContext=function(){c&&s.length&&setTimeout(function(){if(!_)throw"can not restore. webglcontestlost listener did not call event.preventDefault";Q(),kf(t),c=!1,x=0,_=!1;for(var l=s.slice(),X=ct("context restored"),j=0;j<l.length;++j)l[j](X)},0)},i.loseContextInNCalls=function(l){if(c)throw"You can not ask a lost contet to be lost";p=x+l},i.getNumCalls=function(){return x},i.setRestoreTimeout=function(l){y=l};function z(){for(var l=Object.keys(T),X=0;X<l.length;++X)delete T[l]}function at(){++x,c||p==x&&i.loseContext()}function mt(l,X){var j=l[X];return function(){if(at(),!c){var ut=j.apply(l,arguments);return ut}}}function Q(){for(var l=0;l<u.length;++l){var X=u[l];X instanceof WebGLBuffer?t.deleteBuffer(X):X instanceof WebGLFramebuffer?t.deleteFramebuffer(X):X instanceof WebGLProgram?t.deleteProgram(X):X instanceof WebGLRenderbuffer?t.deleteRenderbuffer(X):X instanceof WebGLShader?t.deleteShader(X):X instanceof WebGLTexture&&t.deleteTexture(X)}}function ct(l){return{statusMessage:l,preventDefault:function(){_=!0}}}return i;function gt(l){for(var X in l)typeof l[X]=="function"?n[X]=mt(l,X):wf(n,l,X);n.getError=function(){if(at(),!c)for(var bt;bt=t.getError();)T[bt]=!0;for(bt in T)if(T[bt])return delete T[bt],bt;return n.NO_ERROR};for(var j=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],ut=0;ut<j.length;++ut){var it=j[ut];n[it]=function(bt){return function(){if(at(),c)return null;var Qt=bt.apply(l,arguments);return Qt.__webglDebugContextLostId__=a,u.push(Qt),Qt}}(l[it])}var Pt=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];for(ut=0;ut<Pt.length;++ut)it=Pt[ut],n[it]=function(bt){return function(){return at(),c?null:bt.apply(l,arguments)}}(n[it]);var tt=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];for(ut=0;ut<tt.length;++ut)it=tt[ut],n[it]=function(bt){return function(){return at(),c?!1:bt.apply(l,arguments)}}(n[it]);return n.checkFramebufferStatus=function(bt){return function(){return at(),c?n.FRAMEBUFFER_UNSUPPORTED:bt.apply(l,arguments)}}(n.checkFramebufferStatus),n.getAttribLocation=function(bt){return function(){return at(),c?-1:bt.apply(l,arguments)}}(n.getAttribLocation),n.getVertexAttribOffset=function(bt){return function(){return at(),c?0:bt.apply(l,arguments)}}(n.getVertexAttribOffset),n.isContextLost=function(){return c},n}}const Xu={init:Ef,mightBeEnum:lv,glEnumToString:Rr,glFunctionArgToString:Cc,glFunctionArgsToString:fv,makeDebugContext:Tf,makeLostContextSimulatingCanvas:dv,resetToInitialState:kf};class Df{constructor(t){if(this.ctx=t.getContext("2d"),this.ctx===null)throw new Error("Unable to get a 2D context");this.ctx.fillStyle="black",this.ctx.fillRect(0,0,1024,625),this.backBuffer=window.document.createElement("canvas"),this.backBuffer.width=1024,this.backBuffer.height=625,this.backCtx=this.backBuffer.getContext("2d"),this.imageData=this.backCtx.createImageData(this.backBuffer.width,this.backBuffer.height),this.canvasWidth=t.width,this.canvasHeight=t.height,this.fb32=new Uint32Array(this.imageData.data.buffer)}paint(t,e,s,n){const a=s-t,c=n-e;this.backCtx.putImageData(this.imageData,0,0,t,e,a,c),this.ctx.drawImage(this.backBuffer,t,e,a,c,0,0,this.canvasWidth,this.canvasHeight)}}const ns=1024,Tn=1024;class pv{constructor(t){const e={alpha:!1,antialias:!1,depth:!1,preserveDrawingBuffer:!1,stencil:!1,failIfMajorPerformanceCaveat:!0},s=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);if(this.gl=s,!s)throw new Error("Unable to create a GL context");const n=Xu.makeDebugContext(s,function(T,D){throw new Error("Problem creating GL context: "+Xu.glEnumToString(T)+" in "+D)});n.depthMask(!1);function a(T,D){const v=n.createShader(T);return n.shaderSource(v,D.join(`
`)),n.compileShader(v),v}const c=a(n.VERTEX_SHADER,["attribute vec2 pos;","attribute vec2 uvIn;","varying vec2 uv;","void main() {","  uv = uvIn;","  gl_Position = vec4(2.0 * pos - 1.0, 0.0, 1.0);","}"]),u=a(n.FRAGMENT_SHADER,["precision mediump float;","uniform sampler2D tex;","varying vec2 uv;","void main() {","  gl_FragColor = texture2D(tex, uv).rgba;","}"]),p=n.createProgram();n.attachShader(p,u),n.attachShader(p,c),n.linkProgram(p),n.useProgram(p),this.fb8=new Uint8Array(ns*Tn*4),this.fb32=new Uint32Array(this.fb8.buffer),this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.pixelStorei(n.UNPACK_ALIGNMENT,4),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,ns,Tn,0,n.RGBA,n.UNSIGNED_BYTE,this.fb8),n.bindTexture(n.TEXTURE_2D,null),n.uniform1i(n.getUniformLocation(p,"tex"),0);const x=n.getAttribLocation(p,"pos");n.enableVertexAttribArray(x);const _=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,_),n.bufferData(n.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,0,1,1]),n.STATIC_DRAW),n.vertexAttribPointer(x,2,n.FLOAT,!1,0,0);const y=n.getAttribLocation(p,"uvIn");n.enableVertexAttribArray(y),this.uvBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer),n.vertexAttribPointer(y,2,n.FLOAT,!1,0,0),n.activeTexture(s.TEXTURE0),n.bindTexture(s.TEXTURE_2D,this.texture),this.uvFloatArray=new Float32Array(8),this.lastExtent={},console.log("GL Canvas set up")}paint(t,e,s,n){const a=this.gl;a.texSubImage2D(a.TEXTURE_2D,0,0,e,ns,n-e,a.RGBA,a.UNSIGNED_BYTE,this.fb8.subarray(e*ns*4,n*ns*4));const c={minx:t,miny:e,maxx:s,maxy:n};(c.minx!==this.lastExtent.minx||c.miny!==this.lastExtent.miny||c.maxx!==this.lastExtent.maxx||c.maxy!==this.lastExtent.maxy)&&(this.lastExtent=c,t/=ns,s/=ns,e/=Tn,n/=Tn,this.uvFloatArray[0]=t,this.uvFloatArray[1]=n,this.uvFloatArray[2]=t,this.uvFloatArray[3]=e,this.uvFloatArray[4]=s,this.uvFloatArray[5]=n,this.uvFloatArray[6]=s,this.uvFloatArray[7]=e,a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvFloatArray,a.DYNAMIC_DRAW)),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}function mv(i){try{return new pv(i)}catch(t){console.log("Unable to use OpenGL: "+t)}return new Df(i)}class gv{constructor(t){this.changed={},this.model=null,this.coProcessor=null;const e=document.getElementById("configuration");e.addEventListener("show.bs.modal",()=>{this.changed={},this.setDropdownText(this.model.name),this.set65c02(this.model.tube),this.setTeletext(this.model.hasTeletextAdaptor),this.setMusic5000(this.model.hasMusic5000),this.setEconet(this.model.hasEconet)}),e.addEventListener("hide.bs.modal",()=>t(this.changed)),U(".model-menu a").on("click",s=>{this.changed.model=U(s.target).attr("data-target"),this.setDropdownText(U(s.target).text())}),U("#65c02").on("click",()=>{this.changed.coProcessor=U("#65c02").prop("checked")}),U("#hasTeletextAdaptor").on("click",()=>{this.changed.hasTeletextAdaptor=U("#hasTeletextAdaptor").prop("checked")}),U("#hasEconet").on("click",()=>{this.changed.hasEconet=U("#hasEconet").prop("checked")}),U("#hasMusic5000").on("click",()=>{this.changed.hasMusic5000=U("#hasMusic5000").prop("checked")}),U(".keyboard-menu a").on("click",s=>{const n=U(s.target).attr("data-target");this.changed.keyLayout=n,this.setKeyLayout(n)})}setModel(t){this.model=Ao(t),U(".bbc-model").text(this.model.name)}setKeyLayout(t){U(".keyboard-layout").text(t[0].toUpperCase()+t.substring(1))}set65c02(t){t=!!t,U("#65c02").prop("checked",t),this.model.tube=t?Ao("Tube65c02"):null}setEconet(t){t=!!t,U("#hasEconet").prop("checked",t),this.model.hasEconet=t,t&&this.model.isMaster&&this.addRemoveROM("master/anfs-4.25.rom",!0)}setMusic5000(t){t=!!t,U("#hasMusic5000").prop("checked",t),this.model.hasMusic5000=t,this.addRemoveROM("ample.rom",t)}setTeletext(t){t=!!t,U("#hasTeletextAdaptor").prop("checked",t),this.model.hasTeletextAdaptor=t,this.addRemoveROM("ats-3.0.rom",t)}setDropdownText(t){U("#bbc-model-dropdown .bbc-model").text(t)}addRemoveROM(t,e){if(e&&!this.model.os.includes(t))this.model.os.push(t);else{let s=this.model.os.indexOf(t);s!==-1&&this.model.os.splice(s,1)}}mapLegacyModels(t){t.model&&(t.model.toLowerCase()==="masterturbo"&&(t.model="Master",t.coProcessor=!0),t.model.toLowerCase()==="bmusic5000"&&(t.model="B-DFS1.2",t.hasMusic5000=!0),t.model.toLowerCase()==="bteletext"&&(t.model="B-DFS1.2",t.hasTeletextAdaptor=!0))}}let Rf=function(){};function _v(i){const{loadDiscImage:t,processor:e}=i;window.nodeRequire("electron").ipcRenderer.on("load",async(n,a)=>{const{drive:c,path:u}=a,p=await t(u);e.fdc.loadDisc(c,p)})}typeof window.nodeRequire<"u"&&(Rf=_v);const xv="/assets/audio-renderer-D1-ZS6nv.js",bv="/assets/music5000-worklet-LL9i_-_Z.js";var eo={},Qu;function yv(){return Qu||(Qu=1,function(i){(function(t){/**
 * @license
 * MIT License:
 *
 * Copyright (c) 2010-2013, Joe Walnes
 *               2013-2018, Drew Noakes
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */Date.now=Date.now||function(){return new Date().getTime()};var e={extend:function(){arguments[0]=arguments[0]||{};for(var a=1;a<arguments.length;a++)for(var c in arguments[a])arguments[a].hasOwnProperty(c)&&(typeof arguments[a][c]=="object"?arguments[a][c]instanceof Array?arguments[0][c]=arguments[a][c]:arguments[0][c]=e.extend(arguments[0][c],arguments[a][c]):arguments[0][c]=arguments[a][c]);return arguments[0]},binarySearch:function(a,c){for(var u=0,p=a.length;u<p;){var x=u+p>>1;c<a[x][0]?p=x:u=x+1}return u},pixelSnap:function(a,c){return c%2===0?Math.round(a):Math.floor(a)+.5}};function s(a){this.options=e.extend({},s.defaultOptions,a),this.disabled=!1,this.clear()}s.defaultOptions={resetBoundsInterval:3e3,resetBounds:!0},s.prototype.clear=function(){this.data=[],this.maxValue=Number.NaN,this.minValue=Number.NaN},s.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1],this.minValue=this.data[0][1];for(var a=1;a<this.data.length;a++){var c=this.data[a][1];c>this.maxValue&&(this.maxValue=c),c<this.minValue&&(this.minValue=c)}}else this.maxValue=Number.NaN,this.minValue=Number.NaN},s.prototype.append=function(a,c,u){if(!(isNaN(a)||isNaN(c))){var p=this.data.length-1;if(p>=0)for(var x=p;;){var _=this.data[x];if(a>=_[0]){a===_[0]?u?(_[1]+=c,c=_[1]):_[1]=c:this.data.splice(x+1,0,[a,c]);break}if(x--,x<0){this.data.splice(0,0,[a,c]);break}}else this.data.push([a,c]);this.maxValue=isNaN(this.maxValue)?c:Math.max(this.maxValue,c),this.minValue=isNaN(this.minValue)?c:Math.min(this.minValue,c)}},s.prototype.dropOldData=function(a,c){for(var u=0;this.data.length-u>=c&&this.data[u+1][0]<a;)u++;u!==0&&this.data.splice(0,u)};function n(a){this.options=e.extend({},n.defaultChartOptions,a),this.seriesSet=[],this.currentValueRange=1,this.currentVisMinValue=0,this.lastRenderTimeMillis=0,this.lastChartTimestamp=0,this.mousemove=this.mousemove.bind(this),this.mouseout=this.mouseout.bind(this)}n.tooltipFormatter=function(a,c){var u=this.options.timestampFormatter||n.timeFormatter,p=document.createElement("div"),x;p.appendChild(document.createTextNode(u(new Date(a))));for(var _=0;_<c.length;++_){x=c[_].series.options.tooltipLabel||"",x!==""&&(x=x+" ");var y=document.createElement("span");y.style.color=c[_].series.options.strokeStyle,y.appendChild(document.createTextNode(x+this.options.yMaxFormatter(c[_].value,this.options.labels.precision))),p.appendChild(document.createElement("br")),p.appendChild(y)}return p.innerHTML},n.defaultChartOptions={millisPerPixel:20,enableDpiScaling:!0,yMinFormatter:function(a,c){return parseFloat(a).toFixed(c)},yMaxFormatter:function(a,c){return parseFloat(a).toFixed(c)},yIntermediateFormatter:function(a,c){return parseFloat(a).toFixed(c)},maxValueScale:1,minValueScale:1,interpolation:"bezier",scaleSmoothing:.125,maxDataSetLength:2,scrollBackwards:!1,displayDataFromPercentile:1,grid:{fillStyle:"#000000",strokeStyle:"#777777",lineWidth:2,millisPerLine:1e3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#ffffff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2,showIntermediateLabels:!1,intermediateLabelSameAxis:!0},title:{text:"",fillStyle:"#ffffff",fontSize:15,fontFamily:"monospace",verticalAlign:"middle"},horizontalLines:[],tooltip:!1,tooltipLine:{lineWidth:1,strokeStyle:"#BBBBBB"},tooltipFormatter:n.tooltipFormatter,nonRealtimeData:!1,responsive:!1,limitFPS:0},n.AnimateCompatibility=function(){var a=function(u,p){var x=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(_){return window.setTimeout(function(){_(Date.now())},16)};return x.call(window,u,p)},c=function(u){var p=window.cancelAnimationFrame||function(x){clearTimeout(x)};return p.call(window,u)};return{requestAnimationFrame:a,cancelAnimationFrame:c}}(),n.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#ffffff"},n.prototype.addTimeSeries=function(a,c){this.seriesSet.push({timeSeries:a,options:e.extend({},n.defaultSeriesPresentationOptions,c)}),a.options.resetBounds&&a.options.resetBoundsInterval>0&&(a.resetBoundsTimerId=setInterval(function(){a.resetBounds()},a.options.resetBoundsInterval))},n.prototype.removeTimeSeries=function(a){for(var c=this.seriesSet.length,u=0;u<c;u++)if(this.seriesSet[u].timeSeries===a){this.seriesSet.splice(u,1);break}a.resetBoundsTimerId&&clearInterval(a.resetBoundsTimerId)},n.prototype.getTimeSeriesOptions=function(a){for(var c=this.seriesSet.length,u=0;u<c;u++)if(this.seriesSet[u].timeSeries===a)return this.seriesSet[u].options},n.prototype.bringToFront=function(a){for(var c=this.seriesSet.length,u=0;u<c;u++)if(this.seriesSet[u].timeSeries===a){var p=this.seriesSet.splice(u,1);this.seriesSet.push(p[0]);break}},n.prototype.streamTo=function(a,c){this.canvas=a,this.clientWidth=parseInt(this.canvas.getAttribute("width")),this.clientHeight=parseInt(this.canvas.getAttribute("height")),this.delay=c,this.start()},n.prototype.getTooltipEl=function(){return this.tooltipEl||(this.tooltipEl=document.createElement("div"),this.tooltipEl.className="smoothie-chart-tooltip",this.tooltipEl.style.pointerEvents="none",this.tooltipEl.style.position="absolute",this.tooltipEl.style.display="none",document.body.appendChild(this.tooltipEl)),this.tooltipEl},n.prototype.updateTooltip=function(){if(this.options.tooltip){var a=this.getTooltipEl();if(!this.mouseover||!this.options.tooltip){a.style.display="none";return}for(var c=this.lastChartTimestamp,u=this.options.scrollBackwards?c-this.mouseX*this.options.millisPerPixel:c-(this.clientWidth-this.mouseX)*this.options.millisPerPixel,p=[],x=0;x<this.seriesSet.length;x++){var _=this.seriesSet[x].timeSeries;if(!_.disabled){var y=e.binarySearch(_.data,u);y>0&&y<_.data.length&&p.push({series:this.seriesSet[x],index:y,value:_.data[y][1]})}}p.length?(a.innerHTML=this.options.tooltipFormatter.call(this,u,p),a.style.display="block"):a.style.display="none"}},n.prototype.mousemove=function(a){if(this.mouseover=!0,this.mouseX=a.offsetX,this.mouseY=a.offsetY,this.mousePageX=a.pageX,this.mousePageY=a.pageY,!!this.options.tooltip){var c=this.getTooltipEl();c.style.top=Math.round(this.mousePageY)+"px",c.style.left=Math.round(this.mousePageX)+"px",this.updateTooltip()}},n.prototype.mouseout=function(){this.mouseover=!1,this.mouseX=this.mouseY=-1,this.tooltipEl&&(this.tooltipEl.style.display="none")},n.prototype.resize=function(){var a=!this.options.enableDpiScaling||!window?1:window.devicePixelRatio,c,u;this.options.responsive?(c=this.canvas.offsetWidth,u=this.canvas.offsetHeight,c!==this.lastWidth&&(this.lastWidth=c,this.canvas.setAttribute("width",Math.floor(c*a).toString()),this.canvas.getContext("2d").scale(a,a)),u!==this.lastHeight&&(this.lastHeight=u,this.canvas.setAttribute("height",Math.floor(u*a).toString()),this.canvas.getContext("2d").scale(a,a)),this.clientWidth=c,this.clientHeight=u):(c=parseInt(this.canvas.getAttribute("width")),u=parseInt(this.canvas.getAttribute("height")),a!==1?(Math.floor(this.clientWidth*a)!==c&&(this.canvas.setAttribute("width",Math.floor(c*a).toString()),this.canvas.style.width=c+"px",this.clientWidth=c,this.canvas.getContext("2d").scale(a,a)),Math.floor(this.clientHeight*a)!==u&&(this.canvas.setAttribute("height",Math.floor(u*a).toString()),this.canvas.style.height=u+"px",this.clientHeight=u,this.canvas.getContext("2d").scale(a,a))):(this.clientWidth=c,this.clientHeight=u))},n.prototype.start=function(){if(!this.frame){this.canvas.addEventListener("mousemove",this.mousemove),this.canvas.addEventListener("mouseout",this.mouseout);var a=(function(){this.frame=n.AnimateCompatibility.requestAnimationFrame((function(){if(this.options.nonRealtimeData){var c=new Date(0),u=this.seriesSet.reduce((function(p,x){var _=x.timeSeries.data,y=Math.round(this.options.displayDataFromPercentile*_.length)-1;if(y=y>=0?y:0,y=y<=_.length-1?y:_.length-1,_&&_.length>0){var T=_[y][0];p=p>T?p:T}return p}).bind(this),c);this.render(this.canvas,u>c?u:null)}else this.render();a()}).bind(this))}).bind(this);a()}},n.prototype.stop=function(){this.frame&&(n.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame,this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseout",this.mouseout))},n.prototype.updateValueRange=function(){for(var a=this.options,c=Number.NaN,u=Number.NaN,p=0;p<this.seriesSet.length;p++){var x=this.seriesSet[p].timeSeries;x.disabled||(isNaN(x.maxValue)||(c=isNaN(c)?x.maxValue:Math.max(c,x.maxValue)),isNaN(x.minValue)||(u=isNaN(u)?x.minValue:Math.min(u,x.minValue)))}if(a.maxValue!=null?c=a.maxValue:c*=a.maxValueScale,a.minValue!=null?u=a.minValue:u-=Math.abs(u*a.minValueScale-u),this.options.yRangeFunction){var _=this.options.yRangeFunction({min:u,max:c});u=_.min,c=_.max}if(!isNaN(c)&&!isNaN(u)){var y=c-u,T=y-this.currentValueRange,D=u-this.currentVisMinValue;this.isAnimatingScale=Math.abs(T)>.1||Math.abs(D)>.1,this.currentValueRange+=a.scaleSmoothing*T,this.currentVisMinValue+=a.scaleSmoothing*D}this.valueRange={min:u,max:c}},n.prototype.render=function(a,c){var u=Date.now();if(!(this.options.limitFPS>0&&u-this.lastRenderTimeMillis<1e3/this.options.limitFPS)){if(c=(c||u)-(this.delay||0),c-=c%this.options.millisPerPixel,!this.isAnimatingScale){var p=this.lastChartTimestamp===c;if(p){var x=u-this.lastRenderTimeMillis>166.66666666666666;if(!x)return}}this.lastRenderTimeMillis=u,this.lastChartTimestamp=c,this.resize(),a=a||this.canvas;var _=a.getContext("2d"),y=this.options,T={top:0,left:0,width:this.clientWidth,height:this.clientHeight},D=c-T.width*y.millisPerPixel,v=(function(Rt,fe){var zt=Rt-this.currentVisMinValue,ve=this.currentValueRange===0?T.height:T.height*(1-zt/this.currentValueRange);return e.pixelSnap(ve,fe)}).bind(this),M=function(Rt,fe){var zt=y.scrollBackwards?(c-Rt)/y.millisPerPixel:T.width-(c-Rt)/y.millisPerPixel;return e.pixelSnap(zt,fe)};if(this.updateValueRange(),_.font=y.labels.fontSize+"px "+y.labels.fontFamily,_.save(),_.translate(T.left,T.top),_.beginPath(),_.rect(0,0,T.width,T.height),_.clip(),_.save(),_.fillStyle=y.grid.fillStyle,_.clearRect(0,0,T.width,T.height),_.fillRect(0,0,T.width,T.height),_.restore(),_.save(),_.lineWidth=y.grid.lineWidth,_.strokeStyle=y.grid.strokeStyle,y.grid.millisPerLine>0){_.beginPath();for(var Y=c-c%y.grid.millisPerLine;Y>=D;Y-=y.grid.millisPerLine){var z=M(Y,y.grid.lineWidth);_.moveTo(z,0),_.lineTo(z,T.height)}_.stroke(),_.closePath()}for(var at=1;at<y.grid.verticalSections;at++){var mt=e.pixelSnap(at*T.height/y.grid.verticalSections,y.grid.lineWidth);_.beginPath(),_.moveTo(0,mt),_.lineTo(T.width,mt),_.stroke(),_.closePath()}if(y.grid.borderVisible&&(_.beginPath(),_.strokeRect(0,0,T.width,T.height),_.closePath()),_.restore(),y.horizontalLines&&y.horizontalLines.length)for(var Q=0;Q<y.horizontalLines.length;Q++){var ct=y.horizontalLines[Q],gt=ct.lineWidth||1,l=v(ct.value,gt);_.strokeStyle=ct.color||"#ffffff",_.lineWidth=gt,_.beginPath(),_.moveTo(0,l),_.lineTo(T.width,l),_.stroke(),_.closePath()}for(var X=0;X<this.seriesSet.length;X++){var j=this.seriesSet[X].timeSeries,ut=j.data;if(j.dropOldData(D,y.maxDataSetLength),!(ut.length<=1||j.disabled)){_.save();var it=this.seriesSet[X].options,Pt=it.strokeStyle&&it.strokeStyle!=="none",tt=Pt?it.lineWidth:0;_.beginPath();var bt=M(ut[0][0],tt),Qt=v(ut[0][1],tt),Ft=bt,Lt=Qt,Ce;switch(_.moveTo(bt,Qt),it.interpolation||y.interpolation){case"linear":case"line":{Ce=function(Rt,fe,zt,ve){_.lineTo(Rt,fe)};break}case"bezier":default:{Ce=function(Rt,fe,zt,ve){_.bezierCurveTo(Math.round((zt+Rt)/2),ve,Math.round(zt+Rt)/2,fe,Rt,fe)};break}case"step":{Ce=function(Rt,fe,zt,ve){_.lineTo(Rt,ve),_.lineTo(Rt,fe)};break}}for(var Ht=1;Ht<ut.length;Ht++){var Ye=ut[Ht],ai=M(Ye[0],tt),$e=v(Ye[1],tt);Ce(ai,$e,Ft,Lt),Ft=ai,Lt=$e}Pt&&(_.lineWidth=it.lineWidth,_.strokeStyle=it.strokeStyle,_.stroke()),it.fillStyle&&(_.lineTo(Ft,T.height+tt+1),_.lineTo(bt,T.height+tt+1),_.fillStyle=it.fillStyle,_.fill()),_.restore()}}y.tooltip&&this.mouseX>=0&&(_.lineWidth=y.tooltipLine.lineWidth,_.strokeStyle=y.tooltipLine.strokeStyle,_.beginPath(),_.moveTo(this.mouseX,0),_.lineTo(this.mouseX,T.height),_.closePath(),_.stroke()),this.updateTooltip();var jt=y.labels;if(!jt.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var ke=y.yMaxFormatter(this.valueRange.max,jt.precision),re=y.yMinFormatter(this.valueRange.min,jt.precision),oi=y.scrollBackwards?0:T.width-_.measureText(ke).width-2,Ei=y.scrollBackwards?0:T.width-_.measureText(re).width-2;_.fillStyle=jt.fillStyle,_.fillText(ke,oi,jt.fontSize),_.fillText(re,Ei,T.height-2)}if(jt.showIntermediateLabels&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)&&y.grid.verticalSections>0)for(var He=(this.valueRange.max-this.valueRange.min)/y.grid.verticalSections,Ai=T.height/y.grid.verticalSections,at=1;at<y.grid.verticalSections;at++){var mt=T.height-Math.round(at*Ai),Zt=y.yIntermediateFormatter(this.valueRange.min+at*He,jt.precision),Yi=jt.intermediateLabelSameAxis?y.scrollBackwards?0:T.width-_.measureText(Zt).width-2:y.scrollBackwards?T.width-_.measureText(Zt).width-2:0;_.fillText(Zt,Yi,mt-y.grid.lineWidth)}if(y.timestampFormatter&&y.grid.millisPerLine>0)for(var De=y.scrollBackwards?_.measureText(re).width:T.width-_.measureText(re).width+4,Y=c-c%y.grid.millisPerLine;Y>=D;Y-=y.grid.millisPerLine){var z=M(Y,0);if(!y.scrollBackwards&&z<De||y.scrollBackwards&&z>De){var ci=new Date(Y),wi=y.timestampFormatter(ci),Xi=_.measureText(wi).width;De=y.scrollBackwards?z+Xi+2:z-Xi-2,_.fillStyle=y.labels.fillStyle,y.scrollBackwards?_.fillText(wi,z,T.height-2):_.fillText(wi,z-Xi,T.height-2)}}if(y.title.text!==""){_.font=y.title.fontSize+"px "+y.title.fontFamily;var Ti=y.scrollBackwards?T.width-_.measureText(y.title.text).width-2:2;if(y.title.verticalAlign=="bottom"){_.textBaseline="bottom";var ze=T.height}else if(y.title.verticalAlign=="middle"){_.textBaseline="middle";var ze=T.height/2}else{_.textBaseline="top";var ze=0}_.fillStyle=y.title.fillStyle,_.fillText(y.title.text,Ti,ze)}_.restore()}},n.timeFormatter=function(a){function c(u){return(u<10?"0":"")+u}return c(a.getHours())+":"+c(a.getMinutes())+":"+c(a.getSeconds())},t.TimeSeries=s,t.SmoothieChart=n})(i)}(eo)),eo}var Zu=yv();class Cv{constructor(t,e,s,n,a){if(this.warningNode=t,this.warningNode.toggle(!1),this.chart=new Zu.SmoothieChart({tooltip:!0,labels:{precision:0},yRangeFunction:c=>({min:0,max:c.max})}),this.stats={},this._addStat("queueSize",{strokeStyle:"rgb(51,126,108)"}),this._addStat("queueAge",{strokeStyle:"rgb(162,119,22)"}),this.chart.streamTo(e,100),this.audioContext=typeof AudioContext<"u"?new AudioContext:typeof webkitAudioContext<"u"?new webkitAudioContext:null,this._jsAudioNode=null,this.audioContext&&this.audioContext.audioWorklet)this.audioContext.onstatechange=()=>this.checkStatus(),this.soundChip=new VC((c,u)=>this._onBuffer(c,u)),this.ddNoise=a?new wo:new KC(this.audioContext),this._setup(s,n).then();else{if(this.audioContext&&!this.audioContext.audioWorklet){this.audioContext=null,console.log("Unable to initialise audio: no audio worklet API"),this.warningNode.toggle(!0);const c=new URL(window.location);c.hostname="localhost",this.warningNode.html(`No audio worklet API was found - there will be no audio. 
                    If you are running a local jsbeeb, you must either use a host of
                    <a href="${c}">localhost</a>, 
                    or serve the content over <em>https</em>.`)}this.soundChip=new Cf,this.ddNoise=new wo}this.warningNode.on("mousedown",()=>this.tryResume()),this.warningNode.toggle(!1),this.audioContextM5000=typeof AudioContext<"u"?new AudioContext({sampleRate:46875}):typeof webkitAudioContext<"u"?new webkitAudioContext({sampleRate:46875}):null,this.audioContextM5000&&this.audioContextM5000.audioWorklet?(this.audioContextM5000.onstatechange=()=>this.checkStatus(),this.music5000=new iv(c=>this._onBufferMusic5000(c)),this.audioContextM5000.audioWorklet.addModule(bv).then(()=>{this._music5000workletnode=new AudioWorkletNode(this.audioContextM5000,"music5000",{outputChannelCount:[2]}),this._music5000workletnode.connect(this.audioContextM5000.destination)})):this.music5000=new Sf}async _setup(t,e){if(await this.audioContext.audioWorklet.addModule(xv),t!==0){const s=this.audioContext.createBiquadFilter();s.type="lowpass",s.frequency.value=t,s.Q.value=e,this._audioDestination=s,s.connect(this.audioContext.destination)}else this._audioDestination=this.audioContext.destination;this._jsAudioNode=new AudioWorkletNode(this.audioContext,"sound-chip-processor"),this._jsAudioNode.connect(this._audioDestination),this._jsAudioNode.port.onmessage=s=>{const n=Date.now();for(const a of Object.keys(s.data))this.stats[a]&&this.stats[a].append(n,s.data[a])}}_addStat(t,e){const s=new Zu.TimeSeries;this.stats[t]=s,e.tooltipLabel=t,this.chart.addTimeSeries(s,e)}_onBuffer(t){this._jsAudioNode&&this._jsAudioNode.port.postMessage({time:Date.now(),buffer:t},[t.buffer])}async tryResume(){this.audioContext&&await this.audioContext.resume(),this.audioContextM5000&&await this.audioContextM5000.resume()}_onBufferMusic5000(t){this._music5000workletnode&&this._music5000workletnode.port.postMessage(t)}checkStatus(){this.audioContext&&(this.audioContext.state==="suspended"&&this.warningNode.fadeIn(),this.audioContext.state==="running"&&this.warningNode.fadeOut())}async initialise(){await this.ddNoise.initialise()}mute(){this.soundChip.mute(),this.ddNoise.mute()}unmute(){this.soundChip.unmute(),this.ddNoise.unmute()}}let G,Es,ei,io=0,Ui=0,Lf,vc,Sc,be,xs;const ko=new Qy;let Ar,Br;const Pf=[];typeof Fu=="function"&&(Ar=Fu(),Ar&&Ar[0]&&(Br=Ar[0].file));let as=document.location.search.substring(1)+"&"+window.location.hash.substring(1),Do=null,ot={},fs=!1,If="",Ec=window.localStorage.keyLayout||"physical";const Ro=E,vv=A,Qr={};let Gn=1,Lo=!1,Of=!1,Mf=!1,Mn=!1,Po=!1,Nf=7e3,Bf=5,Ff=101,Ac=null;const Uf=window.navigator.platform.indexOf("Mac")===0;as&&(as[as.length-1]==="/"&&(as=as.substring(0,as.length-1)),as.split("&").forEach(function(i){const t=i.split("="),e=decodeURIComponent(t[0]);let s=null;t.length>1&&(s=decodeURIComponent(t[1])),ot[e]=s;let n;if(e.toUpperCase().indexOf("KEY.")===0)if(n=s.toUpperCase(),Ro[n]){const a=e.substring(4).toUpperCase();vv[a]?(console.log("mapping "+a+" to "+n),Co.push({native:a,bbc:n})):console.log("unknown key: "+a)}else console.log("unknown BBC key: "+s);else if(e.indexOf("GP.")===0){const a=e.substring(3).toUpperCase();ko.remap(a,s.toUpperCase())}else switch(e){case"LEFT":case"RIGHT":case"UP":case"DOWN":case"FIRE":ko.remap(e,s.toUpperCase());break;case"autoboot":fs="boot";break;case"autochain":fs="chain";break;case"autorun":fs="run";break;case"autotype":fs="type",If=s;break;case"keyLayout":Ec=(s+"").toLowerCase();break;case"disc":case"disc1":Br=s;break;case"rom":Pf.push(s);break;case"disc2":Do=s;break;case"embed":U(".embed-hide").hide(),U("body").css("background-color","transparent");break;case"fasttape":Of=!0;break;case"noseek":Mf=!0;break;case"audiofilterfreq":Nf=Number(s);break;case"audiofilterq":Bf=Number(s);break;case"stationId":Ff=Number(s);break}}));ot.frameSkip&&(Ui=parseInt(ot.frameSkip));const Sv={outputStrobe:function(i,t){if(!Io||!t||i)return;const e=G.uservia;e.setca1(!1),e.setca1(!0);const s=String.fromCharCode(e.ora);Io.value+=s}};let $f=null;{let i=255;const t=function(e,s){const n=1<<s-A.K1;e?i&=255^n:i|=n};for(let e=A.K1;e<=A.K8;++e)Qr[e]=t;$f={write:function(){},read:function(){return i}}}const Hf={keyLayout:Ec,coProcessor:ot.coProcessor,cpuMultiplier:Gn,videoCyclesBatch:ot.videoCyclesBatch,extraRoms:Pf,userPort:$f,printerPort:Sv,getGamepads:function(){return navigator.getGamepads?navigator.getGamepads():[]},debugFlags:{logFdcCommands:ot.logFdcCommands!==void 0,logFdcStateChanges:ot.logFdcStateChanges!==void 0}},ji=new gv(function(i){ot=ce.extend(ot,i),(i.model||i.coProcessor!==void 0||i.hasMusic5000!==void 0||i.hasTeletextAdaptor!==void 0||i.hasEconet!==void 0)&&Yv("Changing model requires a restart of the emulator. Restart now?","Yes, restart now","No, thanks",function(){ar(),window.location.reload()}),i.keyLayout&&(window.localStorage.keyLayout=i.keyLayout,Hf.keyLayout=i.keyLayout,G.updateKeyLayout())});ji.mapLegacyModels(ot);ji.setModel(ot.model||Hv());ji.setKeyLayout(Ec);ji.set65c02(ot.coProcessor);ji.setEconet(ot.hasEconet);ji.setMusic5000(ot.hasMusic5000);ji.setTeletext(ot.hasTeletextAdaptor);xs=ji.model;function wc(i,t,e){const s=i.find("img");s.hide(),t&&s.attr("src",t).bind("load",function(){e(i,s),s.show()})}wc(U(".sidebar.left"),ot.sbLeft,function(i,t){i.css({left:-t.width()-5})});wc(U(".sidebar.right"),ot.sbRight,function(i,t){i.css({right:-t.width()-5})});wc(U(".sidebar.bottom"),ot.sbBottom,function(i,t){i.css({bottom:-t.height()})});ot.cpuMultiplier&&(Gn=parseFloat(ot.cpuMultiplier),console.log("CPU multiplier set to "+Gn));const Vn=Gn*2*1e3*1e3|0,Ev=Vn/10;let zf=!0;ot.glEnabled!==void 0&&(zf=ot.glEnabled==="true");const bi=U("#screen"),Ju=zf?mv(bi[0]):new Df(bi[0]);Es=new iy(xs.isMaster,Ju.fb32,function(t,e,s,n){io++,!(io<Ui)&&(io=0,Ju.paint(t,e,s,n))});ot.fakeVideo!==void 0&&(Es=new uf);const Wf=document.getElementById("audio-stats"),qe=new Cv(U("#audio-warning"),Wf,Nf,Bf,Mf);ot.audioDebug||(Wf.style.display="none");window.setTimeout(()=>qe.checkStatus(),1e3);let so=1,ro=1,no=1;ei=new ry(Es);U(".initially-hidden").removeClass("initially-hidden");function Kn(i){const t=i.which||i.charCode||i.keyCode,e=A;switch(i.location){default:switch(t){case e.SHIFT:return so===1?e.SHIFT_LEFT:e.SHIFT_RIGHT;case e.ALT:return no===1?e.ALT_LEFT:e.ALT_RIGHT;case e.CTRL:return ro===1?e.CTRL_LEFT:e.CTRL_RIGHT}break;case 1:switch(t){case e.SHIFT:return so=1,e.SHIFT_LEFT;case e.ALT:return no=1,e.ALT_LEFT;case e.CTRL:return ro=1,e.CTRL_LEFT}break;case 2:switch(t){case e.SHIFT:return so=2,e.SHIFT_RIGHT;case e.ALT:return no=2,e.ALT_RIGHT;case e.CTRL:return ro=2,e.CTRL_RIGHT}break;case 3:switch(t){case e.ENTER:return A.NUMPADENTER;case e.DELETE:return A.NUMPAD_DECIMAL_POINT}break}return t}function Av(i){if(document.activeElement.id==="paste-text"||be||!ei.enabled()&&!Mn)return;const t=Kn(i);if(ei.enabled()&&t===103){ei.hide(),$i();return}if(Mn){if(t===103){Mn=!1,$i();return}else if(t===110){Po=!0,$i();return}}ei.keyPress(Kn(i))&&i.preventDefault()}Qr[A.S]=function(i){i&&(Kt("keyboard","press","S"),vi(!0))};Qr[A.R]=function(i){i&&window.location.reload()};function wv(i){if(qe.tryResume(),document.activeElement.id==="paste-text"||!be)return;const t=Kn(i);if(i.altKey){const e=Qr[t];e&&(e(!0,t),i.preventDefault())}else t===A.HOME&&i.ctrlKey?(Kt("keyboard","press","home"),vi(!0)):t===A.INSERT&&i.ctrlKey?(Kt("keyboard","press","insert"),Lo=!Lo):t===A.END&&i.ctrlKey?(Kt("keyboard","press","end"),Mn=!0,vi(!1)):t===A.F12||t===A.BREAK?(Kt("keyboard","press","break"),G.setReset(!0),i.preventDefault()):t===A.B&&i.ctrlKey?(G.sysvia.keyDown(t,i.shiftKey),i.preventDefault(),Rv()):Uf&&t===A.CAPSLOCK?(Gf(),i.preventDefault()):(G.sysvia.keyDown(t,i.shiftKey),i.preventDefault())}function Tv(i){if(document.activeElement.id==="paste-text")return;const t=Kn(i);if(G&&G.sysvia&&G.sysvia.keyUp(t),!!be){if(i.altKey){const e=Qr[t];e&&e(!1,t)}else t===A.F12||t===A.BREAK?G.setReset(!1):Uf&&t===A.CAPSLOCK&&Gf();i.preventDefault()}}function Gf(){G.sysvia.keyDown(A.CAPSLOCK),setTimeout(()=>G.sysvia.keyUp(A.CAPSLOCK),100),window.localStorage.getItem("warnedAboutRubbishMacs")||(Xf("handling caps lock on Mac OS X","Mac OS X does not generate key up events for caps lock presses. jsbeeb can only simulate a 'tap' of the caps lock key. This means it doesn't work well for games  that use caps lock for left or fire, as we can't tell if it's being held down. If you need to play such a game, please see the documentation about remapping keys.Close this window to continue (you won't see this error again)"),window.localStorage.setItem("warnedAboutRubbishMacs",!0))}function Vf(i){const t=new FileReader;t.onload=function(e){G.fdc.loadDisc(0,Fi(G.fdc,i.name,e.target.result)),delete ot.disc,delete ot.disc1,ar(),$discsModal.hide()},t.readAsBinaryString(i)}function kv(i){const t=new FileReader;t.onload=function(e){G.filestore.scsi=Xr(e.target.result),G.filestore.PC=1024,G.filestore.SP=255,G.filestore.A=1,G.filestore.emulationSpeed=0,G.econet.receiveBlocks=[],G.econet.nextReceiveBlockNumber=1,$fsModal.hide()},t.readAsBinaryString(i)}const Tc=U("#paste-text");Tc.on("paste",function(i){const t=i.originalEvent.clipboardData.getData("text/plain");nr(Yr(t),!0)});Tc.on("dragover",function(i){i.preventDefault(),i.stopPropagation(),i.originalEvent.dataTransfer.dropEffect="copy"});Tc.on("drop",function(i){Kt("local","drop");const t=i.originalEvent.dataTransfer.files[0];Vf(t)});const tl=U("#cub-monitor");tl.on("mousemove mousedown mouseup",function(i){qe.tryResume(),document.activeElement!==document.body&&document.activeElement.blur();const t=tl.offset(),e=bi.offset(),s=(i.offsetX-t.left+e.left)/bi.width(),n=(i.offsetY-t.top+e.top)/bi.height();G.touchScreen&&G.touchScreen.onMouse(s,n,i.buttons),i.preventDefault()});U(window).blur(function(){G.sysvia&&G.sysvia.clearKeys()});U("#fs").click(function(i){bi[0].requestFullscreen(),i.preventDefault()});document.onkeydown=wv;document.onkeypress=Av;document.onkeyup=Tv;U("#debug-pause").click(()=>vi(!0));U("#debug-play").click(()=>{ei.hide(),$i()});document.ondragover=function(i){i.preventDefault(),i.dataTransfer.dropEffect="none"};document.ondrop=function(i){i.preventDefault()};window.onbeforeunload=function(){if(be&&G.sysvia.hasAnyKeyDown())return`It seems like you're still using the emulator. If you're in Chrome, it's impossible for jsbeeb to prevent some shortcuts (like ctrl-W) from performing their default behaviour (e.g. closing the window).
As a workarond, create an 'Application Shortcut' from the Tools menu.  When jsbeeb runs as an application, it *can* prevent ctrl-W from closing the window.`};xs.hasEconet?Ac=new Fy(Ff):U("#fsmenuitem").hide();const Dv=new gf({load:function(){return window.localStorage.cmosRam?JSON.parse(window.localStorage.cmosRam):null},save:function(i){window.localStorage.cmosRam=JSON.stringify(i)}},xs.cmosOverride,Ac);let Cr=null,Io=null;function Rv(){Cr&&!Cr.closed||(Cr=window.open("","_blank","height=300,width=400"),Cr.document.write('<textarea id="text" rows="15" cols="40" placeholder="Printer outputs here..."></textarea>'),Io=Cr.document.getElementById("text"),G.uservia.setca1(!0))}G=new pf(xs,ei,Es,qe.soundChip,qe.ddNoise,xs.hasMusic5000?qe.music5000:null,Dv,Hf,Ac);function kc(i){delete ot.disc,ot.disc1=i,ar()}function Dc(){U("#sth-list li:not('.template')").remove()}function Kf(){U("#sth .loading").text("Loading catalog from STH archive"),U("#sth .loading").show(),Dc()}function Lv(i){Kt("sth","click",i),kc("sth:"+i);const t=ot.autoboot!==void 0;t&&G.reset(!0),popupLoading("Loading "+i),Fr(ot.disc1).then(function(e){G.fdc.loadDisc(0,e)}).then(function(){loadingFinished(),t&&Yf(i)},function(e){loadingFinished(e)})}function Pv(i){Kt("sth","clickTape",i),ot.tape="sth:"+i,ar(),popupLoading("Loading "+i),Zf(ot.tape).then(function(){loadingFinished()},function(t){loadingFinished(t)})}function qf(i){return function(t){Dc();const e=U("#sth-list");U("#sth .loading").hide();const s=e.find(".template");function n(a){const p=a.slice(0,100),x=a.slice(100),_=U("#sth-filter").val();U.each(p,function(y,T){const D=s.clone().removeClass("template").appendTo(e);D.find(".name").text(T),U(D).on("click",function(){i(T),$sthModal.hide()}),D.toggle(T.toLowerCase().indexOf(_)>=0)}),a.length&&ce.delay(n,30,x)}n(t)}}function jf(){U("#sth .loading").text("There was an error accessing the STH archive"),U("#sth .loading").show(),Dc()}vc=new _f(Kf,qf(Lv),jf,!1);Sc=new _f(Kf,qf(Pv),jf,!0);U("#sth .autoboot").click(function(){U("#sth .autoboot").prop("checked")?ot.autoboot="":delete ot.autoboot,ar()});U(document).on("click","a.sth",function(){const i=U(this).data("id");i==="discs"?vc.populate():i==="tapes"?Sc.populate():console.log("unknown id",i)});function Iv(i){i=i.toLowerCase(),U("#sth-list li:not('.template')").each(function(){const t=U(this);t.toggle(t.text().toLowerCase().indexOf(i)>=0)})}U("#sth-filter").on("change keyup",function(){Iv(U("#sth-filter").val())});function nr(i,t){let e,s=0;if(G.sysvia.disableKeyboard(),t){let a=null;G.sysvia.capsLockLight?G.sysvia.shiftLockLight&&(a=Ro.SHIFTLOCK):a=Ro.CAPSLOCK,a&&(i.unshift(a),i.push(a))}const n=G.debugInstruction.add(function(){const c=G.cycleSeconds*1e3+G.currentCycles/(Vn/1e3);if(c<s)return;if(e&&e!==E.SHIFT&&G.sysvia.keyToggleRaw(e),i.length===0){G.sysvia.enableKeyboard(),n.remove();return}const u=i[0],p=e===u;if(e=u,p){e=void 0,s=c+30;return}let x=50;typeof e=="number"?(x=e,e=void 0):G.sysvia.keyToggleRaw(e),i.shift(),s=c+x})}function Yf(i){const t=E;console.log("Autobooting disc"),Kt("init","autoboot",i),nr([t.SHIFT,1e3],!1)}function Ov(i){console.log("Auto typing '"+i+"'"),Kt("init","autochain");const t=Yr(i);nr([1e3].concat(t),!1)}function Mv(){console.log("Auto Chaining Tape"),Kt("init","autochain");const i=Yr(`*TAPE
CH.""
`);nr([1e3].concat(i),!1)}function Nv(){console.log("Auto Running Tape"),Kt("init","autorun");const i=Yr(`*TAPE
*/
`);nr([1e3].concat(i),!1)}function Bv(){console.log("Auto Running basic"),Kt("init","autorunbasic");const i=Yr(`RUN
`);nr([1e3].concat(i),!1)}function ar(){let i=window.location.origin+window.location.pathname,t="?";U.each(ot,function(e,s){e.length>0&&s&&(i+=t+encodeURIComponent(e)+"="+encodeURIComponent(s),t="&")}),window.history.pushState(null,null,i)}const Oo=U("#error-dialog"),Fv=new ni(Oo[0]);function Xf(i,t){Oo.find(".context").text(i),Oo.find(".error").text(t),Fv.show()}function Qf(i){const t=i.match(/(([^:]+):\/?\/?|[!^|])?(.*)/),e=t[2]||t[1]||"";return i=t[3],{image:i,schema:e}}function Fr(i){if(!i)return Promise.resolve(null);const t=Qf(i);i=t.image;const e=t.schema;if(e[0]==="!"||e==="local")return Promise.resolve(gC(G.fdc,i));if(e==="|"||e==="sth")return vc.fetch(i).then(function(s){return Fi(G.fdc,i,s)});if(e==="gd"){const s=i.match(/([^/]+)\/?(.*)/);let n="(unknown)";return s&&(i=s[1],n=s[2]),Uv({name:n,id:i})}if(e==="b64data"){const s=atob(i);return i="disk.ssd",Promise.resolve(Fi(G.fdc,i,s))}if(e==="data"){const s=Array.prototype.map.call(atob(i),c=>c.charCodeAt(0)),n=Mr(s),a=n.data;return i=n.name,Promise.resolve(Fi(G.fdc,i,a))}return e==="http"||e==="https"||e==="file"?Fe(e+"://"+i).then(function(s){if(/\.zip/i.test(i)){const n=Mr(s);s=n.data,i=n.name}return Fi(G.fdc,i,s)}):mC("discs/"+i).then(function(s){return Fi(G.fdc,i,s)})}function Zf(i){const t=Qf(i);i=t.image;const e=t.schema;if(e==="|"||e==="sth")return Sc.fetch(i).then(function(s){G.acia.setTape(Dr(i,s))});if(e==="data"){const s=Array.prototype.map.call(atob(i),a=>a.charCodeAt(0)),n=Mr(s);return Promise.resolve(G.acia.setTape(Dr(n.name,n.data)))}return e==="http"||e==="https"?Fe(e+"://"+i).then(function(s){if(/\.zip/i.test(i)){const n=Mr(s);s=n.data,i=n.name}G.acia.setTape(Dr(i,s))}):CC("tapes/"+i).then(function(s){G.acia.setTape(s)})}U("#disc_load").on("change",function(i){if(console.log(i),i.target.files.length===0)return;Kt("local","click");const t=i.target.files[0];Vf(t),i.target.value=""});U("#fs_load").on("change",function(i){if(i.target.files.length===0)return;Kt("local","click");const t=i.target.files[0];kv(t),i.target.value=""});U("#tape_load").on("change",function(i){if(i.target.files.length===0)return;const t=i.target.files[0],e=new FileReader;Kt("local","clickTape"),e.onload=function(s){G.acia.setTape(Dr("local file",s.target.result)),delete ot.tape,ar(),U("#tapes").modal("hide")},e.readAsBinaryString(t),i.target.value=""});function Jf(){return U(".modal:visible").length!==0}let td=!1;document.addEventListener("show.bs.modal",function(){Jf()||(td=be),be&&vi(!1)});document.addEventListener("hidden.bs.modal",function(){!Jf()&&td&&$i()});const Ur=new wC;async function Rc(i){try{return await Ur.authorize(i)}catch(t){console.log("Error handling google auth: "+t),$googleDrive.find(".loading").text("There was an error accessing your Google Drive account: "+t)}}let ed,id;U("#google-drive-auth form").on("submit",function(i){U("#google-drive-auth").hide(),i.preventDefault(),Rc(!1).then(function(t){t?ed():id(new Error("Unable to authorize Google Drive"))})});function Uv(i){return popupLoading("Loading '"+i.name+"' from Google Drive"),Ur.initialise().then(function(t){if(console.log("Google Drive available =",t),!t)throw new Error("Google Drive is not available");return Rc(!0)}).then(function(t){return console.log("Google Drive authed=",t),t?!0:new Promise(function(e,s){ed=e,id=s,U("#google-drive-auth").show()})}).then(function(){return Ur.load(G.fdc,i.id)}).then(function(t){return console.log("Google Drive loading finished"),loadingFinished(),t}).catch(function(t){console.log("Google Drive loading error:",t),loadingFinished(t)})}U(".if-drive-available").hide();Ur.initialise().then(function(i){i&&(U(".if-drive-available").show(),Rc(!0).then())});const sd=U("#disc-list"),$v=sd.find(".template");U.each(Ar,function(i,t){const e=$v.clone().removeClass("template").appendTo(sd);e.find(".name").text(t.name),e.find(".description").text(t.desc),U(e).on("click",function(){Kt("images","click",t.file),kc(t.file),Fr(ot.disc1).then(function(s){G.fdc.loadDisc(0,s)}),$discsModal.hide()})});U("#google-drive form").on("submit",function(i){i.preventDefault();const t=U("#google-drive .disc-name").val();t&&(popupLoading("Connecting to Google Drive"),$googleDriveModal.hide(),popupLoading("Creating '"+t+"' on Google Drive"),Ur.create(G.fdc,t).then(function(e){kc("gd:"+e.fileId+"/"+t),G.fdc.loadDisc(0,e.disc),loadingFinished()},function(e){console.log(`Error in creating: ${e} | ${JSON.stringify(e)}`),loadingFinished(`Create failed: ${e}`)}))});U("#download-drive-link").on("click",function(){const i=document.createElement("a");document.body.appendChild(i),i.style="display: none";const t=G.fdc.drives[0].disc,e=rC(t);let s=G.fdc.drives[0].disc.name;s=s.substring(0,s.lastIndexOf("."))+(t.isDoubleSided?".dsd":".ssd");const n=new Blob([e],{type:"application/octet-stream"}),a=window.URL.createObjectURL(n);i.href=a,i.download=s,i.click(),window.URL.revokeObjectURL(a)});U("#download-filestore-link").on("click",function(){const i=document.createElement("a");document.body.appendChild(i),i.style="display: none";const t=new Blob([G.filestore.scsi],{type:"application/octet-stream"}),e=window.URL.createObjectURL(t);i.href=e,i.download="scsi.dat",i.click(),window.URL.revokeObjectURL(e)});U("#hard-reset").click(function(i){G.reset(!0),i.preventDefault()});U("#soft-reset").click(function(i){G.reset(!1),i.preventDefault()});function Hv(){return window.location.hostname.indexOf("bbc")===0?"B-DFS1.2":window.location.hostname.indexOf("master")===0?"Master":"B-DFS1.2"}U("#tape-menu a").on("click",function(i){const t=U(i.target).attr("data-id");t!==void 0&&(t==="rewind"?(console.log("Rewinding tape to the start"),G.acia.rewindTape()):console.log("unknown type",t))});function or(i){const t=U("#"+i);let e=!1;this.update=function(s){s!==e&&(e=s,t.toggleClass("on",e))}}const zv=new or("motorlight"),Wv=new or("capslight"),Gv=new or("shiftlight"),Vv=new or("drive0"),Kv=new or("drive1"),qv=new or("networklight");Lf=function(){Wv.update(G.sysvia.capsLockLight),Gv.update(G.sysvia.shiftLockLight),Vv.update(G.fdc.motorOn[0]),Kv.update(G.fdc.motorOn[1]),zv.update(G.acia.motorOn),xs.hasEconet&&qv.update(G.econet.activityLight())};const jv=Promise.all([qe.initialise(),G.initialise()]).then(function(){const i=[];Br&&i.push(Fr(Br).then(function(e){G.fdc.loadDisc(0,e)})),Do&&i.push(Fr(Do).then(function(e){G.fdc.loadDisc(1,e)})),ot.tape&&i.push(Zf(ot.tape));function t(e,s){i.push(e.then(function(n){return ov().then(function(a){return a.tokenise(n)})}).then(function(n){const a=G.model.isMaster?59366:58753,c=G.debugInstruction.add(function(u){if(u!==a)return;const p=G.readmem(24)<<8;for(let T=0;T<n.length;++T)G.writemem(p+T,n.charCodeAt(T));const x=p+n.length,_=x&255,y=x>>>8&255;G.writemem(2,_),G.writemem(3,y),G.writemem(18,_),G.writemem(19,y),c.remove(),s&&Bv()})}))}if(ot.loadBasic){const e=fs==="run";fs="",t(new Promise(function(s){Fe(ot.loadBasic).then(function(n){s(String.fromCharCode.apply(null,n))})}),e)}return ot.embedBasic&&t(new Promise(function(e){e(ot.embedBasic)}),!0),Promise.all(i)});jv.then(function(){switch(fs){case"boot":U("#sth .autoboot").prop("checked",!0),Yf(Br);break;case"type":Ov(If);break;case"chain":Mv();break;case"run":Nv();break;default:U("#sth .autoboot").prop("checked",!1);break}ot.patch&&ei.setPatch(ot.patch),$i()},function(i){Xf("initialising",i),console.log(i)});const wr=U("#are-you-sure"),el=new ni(wr[0]);function Yv(i,t,e,s){wr.find(".context").text(i),wr.find(".ays-yes").text(t),wr.find(".ays-no").text(e),wr.find(".ays-yes").one("click",function(){el.hide(),s()}),el.show()}function rd(i){i=i||10*1e3*1e3;const t=Ui;Ui=1e6;const e=performance.now();G.execute(i);const s=performance.now();Ui=t;const n=s-e,a=i/n/1e3;console.log("Took "+n+"ms to execute "+i+" cycles"),console.log("Virtual "+a.toFixed(2)+"MHz")}function nd(i){i=i||10*1e3*1e3;const t=Ui;Ui=1e6;const e=performance.now();Es.polltime(i);const s=performance.now();Ui=t;const n=s-e,a=i/n/1e3;console.log("Took "+n+"ms to execute "+i+" video cycles"),console.log("Virtual "+a.toFixed(2)+"MHz")}function Xv(i){console.profile("CPU"),rd(i),console.profileEnd()}function Qv(i){console.profile("Video"),nd(i),console.profileEnd()}let kn=0;function Zv(){this.cycles=0,this.time=0,this.v=U(".virtualMHz"),this.header=U("#virtual-mhz-header"),this.speedy=!1,this.update=function(i,t,e){this.cycles+=i,this.time+=t,this.speedy=e},this.display=function(){if(this.cycles){const i=this.cycles/this.time/1e3;this.v.text(i.toFixed(1)),this.cycles>=10*2*1e3*1e3&&(this.cycles=this.time=0),this.header.css("color",this.speedy?"red":"white")}setTimeout(this.display.bind(this),3333)},this.display()}const Jv=new Zv;function Mo(i){if(!be){kn=0;return}i===void 0&&(i=window.performance.now());const t=G.acia.motorOn,e=G.fdc.motorOn[0]||G.fdc.motorOn[1],s=Lo||Of&&t,n=s||t||e,a=s?0:1e3/50,c=s?9:0;if(Es.frameSkipCount=c,n?window.setTimeout(Mo,a):window.requestAnimationFrame(Mo),qe.soundChip.catchUp(),ko.update(G.sysvia),Lf(),kn!==0){let u;s?u=Vn/50:(u=(i-kn)*Vn/1e3,u=Math.min(u,Ev)),u|=0;try{G.execute(u)||vi(!0);const p=performance.now();Jv.update(u,p-i,s)}catch(p){throw be=!1,Kt("exception","thrown",p.stack),ei.debug(G.pc),p}Po&&(vi(!1),Po=!1)}kn=i}function tS(){window.requestAnimationFrame(Mo)}let il=!1;function eS(){if(document.visibilityState==="hidden"){il=be;const i=G.acia.motorOn||G.fdc.motorOn[0]||G.fdc.motorOn[1];be&&!i&&vi(!1)}else il&&$i()}document.addEventListener("visibilitychange",eS,!1);function ad(){U("#debug-play").attr("disabled",be),U("#debug-pause").attr("disabled",!be)}function $i(){qe.unmute(),be=!0,ad(),tS()}function vi(i){be=!1,G.stop(),i&&ei.debug(G.pc),qe.mute(),ad()}(function(){const i=U("#cub-monitor"),t=U("#cub-monitor-pic"),e=t.attr("height"),s=t.attr("width"),n=bi.attr("height")/e,a=bi.attr("width")/s,c=s/e,u=s/4,p=e/4,x=ot.embed!==void 0?0:100,_=ot.embed!==void 0?0:68;function y(){let T=U("#header-bar").outerHeight(),D=Math.max(u,window.innerWidth-x*2),v=Math.max(p,window.innerHeight-T-_);D/v<=c?v=D/c:D=v*c,i.height(v).width(D),t.height(v).width(D),bi.height(v*n).width(D*a)}window.onresize=y,window.setTimeout(y,1),window.setTimeout(y,500)})();const iS=new ni(document.getElementById("info")),sS=new ni(document.getElementById("pp-tos"));Object.hasOwn(ot,"about")&&iS.show();Object.hasOwn(ot,"pp-tos")&&sS.show();window.benchmarkCpu=ce.debounce(rd,1);window.profileCpu=ce.debounce(Xv,1);window.benchmarkVideo=ce.debounce(nd,1);window.profileVideo=ce.debounce(Qv,1);window.go=$i;window.stop=vi;window.soundChip=qe.soundChip;window.processor=G;window.video=Es;window.hd=function(i,t){console.log(ef(function(e){return G.readmem(e)},i,t))};window.m7dump=function(){console.log(ef(function(i){return G.readmem(i)&127},31744,32744,{width:40,gap:!1}))};Rf({loadDiscImage:Fr,processor:G});
//# sourceMappingURL=index-BBgBG1Cu.js.map
